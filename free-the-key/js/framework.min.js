var game_shell=function(){this.version="2.4.2",this.config={},this.screens={},this.game={},this.data={},this.utils={},this.json={},"undefined"==typeof window.console&&(window.console={},window.console.log=function(){});var self=this;return this.loadScripts=function(){var files=self.config.files.slice();self.ScriptLoader.load(files,function(){"undefined"!=typeof document.attachEvent?document.attachEvent("ontouchmove",function(event){event.preventDefault()}):document.addEventListener("touchmove",function(event){event.preventDefault()},!1),setTimeout(function(){self.init.call(self)},1e3)})}.bind(self),this.ScriptLoader={load:function(manifest,callback){this.manifest=manifest,this.callback=callback,this.loadNext=this.loadNext.bind(this),this.loadNext()},loadScript:function(path,callback){var head=document.getElementsByTagName("head")[0],script=document.createElement("script");script.type="text/javascript",script.src=path,script.onload=callback,script.onreadystatechange=function(){"complete"==this.readyState&&callback()},head.appendChild(script)},loadNext:function(){this.manifest.length>0?this.loadScript(this.manifest.shift(),this.loadNext):this.callback()}},this.init=function(){core.settings.copy(this.config),this.onGameEvent({msg:"scripts_loaded"}),core.GenericGame.call(this)},this.onGameEvent=function(event){},this}.call({});Object.defineProperties(game_shell,{time:{configurable:!0,get:function(){return this.updateLoop.currentTime}},resolution:{get:function(){return this.stage.renderer.resolution}}}),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.PIXI=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process,global){!function(){function noop(){}function identity(v){return v}function toBool(v){return!!v}function notId(v){return!v}function only_once(fn){return function(){if(null===fn)throw new Error("Callback was already called.");fn.apply(this,arguments),fn=null}}function _once(fn){return function(){null!==fn&&(fn.apply(this,arguments),fn=null)}}function _isArrayLike(arr){return _isArray(arr)||"number"==typeof arr.length&&arr.length>=0&&arr.length%1===0}function _arrayEach(arr,iterator){for(var index=-1,length=arr.length;++index<length;)iterator(arr[index],index,arr)}function _map(arr,iterator){for(var index=-1,length=arr.length,result=Array(length);++index<length;)result[index]=iterator(arr[index],index,arr);return result}function _range(count){return _map(Array(count),function(v,i){return i})}function _reduce(arr,iterator,memo){return _arrayEach(arr,function(x,i,a){memo=iterator(memo,x,i,a)}),memo}function _forEachOf(object,iterator){_arrayEach(_keys(object),function(key){iterator(object[key],key)})}function _indexOf(arr,item){for(var i=0;i<arr.length;i++)if(arr[i]===item)return i;return-1}function _keyIterator(coll){var len,keys,i=-1;return _isArrayLike(coll)?(len=coll.length,function(){return i++,i<len?i:null}):(keys=_keys(coll),len=keys.length,function(){return i++,i<len?keys[i]:null})}function _restParam(func,startIndex){return startIndex=null==startIndex?func.length-1:+startIndex,function(){for(var length=Math.max(arguments.length-startIndex,0),rest=Array(length),index=0;index<length;index++)rest[index]=arguments[index+startIndex];switch(startIndex){case 0:return func.call(this,rest);case 1:return func.call(this,arguments[0],rest)}}}function _withoutIndex(iterator){return function(value,index,callback){return iterator(value,callback)}}function _eachOfLimit(limit){return function(obj,iterator,callback){callback=_once(callback||noop),obj=obj||[];var nextKey=_keyIterator(obj);if(limit<=0)return callback(null);var done=!1,running=0,errored=!1;!function replenish(){if(done&&running<=0)return callback(null);for(;running<limit&&!errored;){var key=nextKey();if(null===key)return done=!0,void(running<=0&&callback(null));running+=1,iterator(obj[key],key,only_once(function(err){running-=1,err?(callback(err),errored=!0):replenish()}))}}()}}function doParallel(fn){return function(obj,iterator,callback){return fn(async.eachOf,obj,iterator,callback)}}function doParallelLimit(fn){return function(obj,limit,iterator,callback){return fn(_eachOfLimit(limit),obj,iterator,callback)}}function doSeries(fn){return function(obj,iterator,callback){return fn(async.eachOfSeries,obj,iterator,callback)}}function _asyncMap(eachfn,arr,iterator,callback){callback=_once(callback||noop),arr=arr||[];var results=_isArrayLike(arr)?[]:{};eachfn(arr,function(value,index,callback){iterator(value,function(err,v){results[index]=v,callback(err)})},function(err){callback(err,results)})}function _filter(eachfn,arr,iterator,callback){var results=[];eachfn(arr,function(x,index,callback){iterator(x,function(v){v&&results.push({index:index,value:x}),callback()})},function(){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})}function _reject(eachfn,arr,iterator,callback){_filter(eachfn,arr,function(value,cb){iterator(value,function(v){cb(!v)})},callback)}function _createTester(eachfn,check,getResult){return function(arr,limit,iterator,cb){function done(){cb&&cb(getResult(!1,void 0))}function iteratee(x,_,callback){return cb?void iterator(x,function(v){cb&&check(v)&&(cb(getResult(!0,x)),cb=iterator=!1),callback()}):callback()}arguments.length>3?eachfn(arr,limit,iteratee,done):(cb=iterator,iterator=limit,eachfn(arr,iteratee,done))}}function _findGetResult(v,x){return x}function _parallel(eachfn,tasks,callback){callback=callback||noop;var results=_isArrayLike(tasks)?[]:{};eachfn(tasks,function(task,key,callback){task(_restParam(function(err,args){args.length<=1&&(args=args[0]),results[key]=args,callback(err)}))},function(err){callback(err,results)})}function _concat(eachfn,arr,fn,callback){var result=[];eachfn(arr,function(x,index,cb){fn(x,function(err,y){result=result.concat(y||[]),cb(err)})},function(err){callback(err,result)})}function _queue(worker,concurrency,payload){function _insert(q,data,pos,callback){if(null!=callback&&"function"!=typeof callback)throw new Error("task callback must be a function");return q.started=!0,_isArray(data)||(data=[data]),0===data.length&&q.idle()?async.setImmediate(function(){q.drain()}):(_arrayEach(data,function(task){var item={data:task,callback:callback||noop};pos?q.tasks.unshift(item):q.tasks.push(item),q.tasks.length===q.concurrency&&q.saturated()}),void async.setImmediate(q.process))}function _next(q,tasks){return function(){workers-=1;var removed=!1,args=arguments;_arrayEach(tasks,function(task){_arrayEach(workersList,function(worker,index){worker!==task||removed||(workersList.splice(index,1),removed=!0)}),task.callback.apply(task,args)}),q.tasks.length+workers===0&&q.drain(),q.process()}}if(null==concurrency)concurrency=1;else if(0===concurrency)throw new Error("Concurrency must not be zero");var workers=0,workersList=[],q={tasks:[],concurrency:concurrency,payload:payload,saturated:noop,empty:noop,drain:noop,started:!1,paused:!1,push:function(data,callback){_insert(q,data,!1,callback)},kill:function(){q.drain=noop,q.tasks=[]},unshift:function(data,callback){_insert(q,data,!0,callback)},process:function(){for(;!q.paused&&workers<q.concurrency&&q.tasks.length;){var tasks=q.payload?q.tasks.splice(0,q.payload):q.tasks.splice(0,q.tasks.length),data=_map(tasks,function(task){return task.data});0===q.tasks.length&&q.empty(),workers+=1,workersList.push(tasks[0]);var cb=only_once(_next(q,tasks));worker(data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},workersList:function(){return workersList},idle:function(){return q.tasks.length+workers===0},pause:function(){q.paused=!0},resume:function(){if(q.paused!==!1){q.paused=!1;for(var resumeCount=Math.min(q.concurrency,q.tasks.length),w=1;w<=resumeCount;w++)async.setImmediate(q.process)}}};return q}function _console_fn(name){return _restParam(function(fn,args){fn.apply(null,args.concat([_restParam(function(err,args){"object"==typeof console&&(err?console.error&&console.error(err):console[name]&&_arrayEach(args,function(x){console[name](x)}))})]))})}function _times(mapper){return function(count,iterator,callback){mapper(_range(count),iterator,callback)}}function _applyEach(eachfn){return _restParam(function(fns,args){var go=_restParam(function(args){var that=this,callback=args.pop();return eachfn(fns,function(fn,_,cb){fn.apply(that,args.concat([cb]))},callback)});return args.length?go.apply(this,args):go})}function ensureAsync(fn){return _restParam(function(args){var callback=args.pop();args.push(function(){var innerArgs=arguments;sync?async.setImmediate(function(){callback.apply(null,innerArgs)}):callback.apply(null,innerArgs)});var sync=!0;fn.apply(this,args),sync=!1})}var previous_async,async={},root="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global||this;null!=root&&(previous_async=root.async),async.noConflict=function(){return root.async=previous_async,async};var _toString=Object.prototype.toString,_isArray=Array.isArray||function(obj){return"[object Array]"===_toString.call(obj)},_isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj},_keys=Object.keys||function(obj){var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys},_setImmediate="function"==typeof setImmediate&&setImmediate,_delay=_setImmediate?function(fn){_setImmediate(fn)}:function(fn){setTimeout(fn,0)};"object"==typeof process&&"function"==typeof process.nextTick?async.nextTick=process.nextTick:async.nextTick=_delay,async.setImmediate=_setImmediate?_delay:async.nextTick,async.forEach=async.each=function(arr,iterator,callback){return async.eachOf(arr,_withoutIndex(iterator),callback)},async.forEachSeries=async.eachSeries=function(arr,iterator,callback){return async.eachOfSeries(arr,_withoutIndex(iterator),callback)},async.forEachLimit=async.eachLimit=function(arr,limit,iterator,callback){return _eachOfLimit(limit)(arr,_withoutIndex(iterator),callback)},async.forEachOf=async.eachOf=function(object,iterator,callback){function done(err){completed--,err?callback(err):null===key&&completed<=0&&callback(null)}callback=_once(callback||noop),object=object||[];for(var key,iter=_keyIterator(object),completed=0;null!=(key=iter());)completed+=1,iterator(object[key],key,only_once(done));0===completed&&callback(null)},async.forEachOfSeries=async.eachOfSeries=function(obj,iterator,callback){function iterate(){var sync=!0;return null===key?callback(null):(iterator(obj[key],key,only_once(function(err){if(err)callback(err);else{if(key=nextKey(),null===key)return callback(null);sync?async.setImmediate(iterate):iterate()}})),void(sync=!1))}callback=_once(callback||noop),obj=obj||[];var nextKey=_keyIterator(obj),key=nextKey();iterate()},async.forEachOfLimit=async.eachOfLimit=function(obj,limit,iterator,callback){_eachOfLimit(limit)(obj,iterator,callback)},async.map=doParallel(_asyncMap),async.mapSeries=doSeries(_asyncMap),async.mapLimit=doParallelLimit(_asyncMap),async.inject=async.foldl=async.reduce=function(arr,memo,iterator,callback){async.eachOfSeries(arr,function(x,i,callback){iterator(memo,x,function(err,v){memo=v,callback(err)})},function(err){callback(err,memo)})},async.foldr=async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,identity).reverse();async.reduce(reversed,memo,iterator,callback)},async.transform=function(arr,memo,iterator,callback){3===arguments.length&&(callback=iterator,iterator=memo,memo=_isArray(arr)?[]:{}),async.eachOf(arr,function(v,k,cb){iterator(memo,v,k,cb)},function(err){callback(err,memo)})},async.select=async.filter=doParallel(_filter),async.selectLimit=async.filterLimit=doParallelLimit(_filter),async.selectSeries=async.filterSeries=doSeries(_filter),async.reject=doParallel(_reject),async.rejectLimit=doParallelLimit(_reject),async.rejectSeries=doSeries(_reject),async.any=async.some=_createTester(async.eachOf,toBool,identity),async.someLimit=_createTester(async.eachOfLimit,toBool,identity),async.all=async.every=_createTester(async.eachOf,notId,notId),async.everyLimit=_createTester(async.eachOfLimit,notId,notId),async.detect=_createTester(async.eachOf,identity,_findGetResult),async.detectSeries=_createTester(async.eachOfSeries,identity,_findGetResult),async.detectLimit=_createTester(async.eachOfLimit,identity,_findGetResult),async.sortBy=function(arr,iterator,callback){function comparator(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0}async.map(arr,function(x,callback){iterator(x,function(err,criteria){err?callback(err):callback(null,{value:x,criteria:criteria})})},function(err,results){return err?callback(err):void callback(null,_map(results.sort(comparator),function(x){return x.value}))})},async.auto=function(tasks,concurrency,callback){function addListener(fn){listeners.unshift(fn)}function removeListener(fn){var idx=_indexOf(listeners,fn);idx>=0&&listeners.splice(idx,1)}function taskComplete(){remainingTasks--,_arrayEach(listeners.slice(0),function(fn){fn()})}"function"==typeof arguments[1]&&(callback=concurrency,concurrency=null),callback=_once(callback||noop);var keys=_keys(tasks),remainingTasks=keys.length;if(!remainingTasks)return callback(null);concurrency||(concurrency=remainingTasks);var results={},runningTasks=0,hasError=!1,listeners=[];addListener(function(){remainingTasks||callback(null,results)}),_arrayEach(keys,function(k){function ready(){return runningTasks<concurrency&&_reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},!0)&&!results.hasOwnProperty(k)}function listener(){ready()&&(runningTasks++,removeListener(listener),task[task.length-1](taskCallback,results))}if(!hasError){for(var dep,task=_isArray(tasks[k])?tasks[k]:[tasks[k]],taskCallback=_restParam(function(err,args){if(runningTasks--,args.length<=1&&(args=args[0]),err){var safeResults={};_forEachOf(results,function(val,rkey){safeResults[rkey]=val}),safeResults[k]=args,hasError=!0,callback(err,safeResults)}else results[k]=args,async.setImmediate(taskComplete)}),requires=task.slice(0,task.length-1),len=requires.length;len--;){if(!(dep=tasks[requires[len]]))throw new Error("Has nonexistent dependency in "+requires.join(", "));if(_isArray(dep)&&_indexOf(dep,k)>=0)throw new Error("Has cyclic dependencies")}ready()?(runningTasks++,task[task.length-1](taskCallback,results)):addListener(listener)}})},async.retry=function(times,task,callback){function parseTimes(acc,t){if("number"==typeof t)acc.times=parseInt(t,10)||DEFAULT_TIMES;else{if("object"!=typeof t)throw new Error("Unsupported argument type for 'times': "+typeof t);acc.times=parseInt(t.times,10)||DEFAULT_TIMES,acc.interval=parseInt(t.interval,10)||DEFAULT_INTERVAL}}function wrappedTask(wrappedCallback,wrappedResults){function retryAttempt(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}}function retryInterval(interval){return function(seriesCallback){setTimeout(function(){seriesCallback(null)},interval)}}for(;opts.times;){var finalAttempt=!(opts.times-=1);attempts.push(retryAttempt(opts.task,finalAttempt)),!finalAttempt&&opts.interval>0&&attempts.push(retryInterval(opts.interval))}async.series(attempts,function(done,data){data=data[data.length-1],(wrappedCallback||opts.callback)(data.err,data.result)})}var DEFAULT_TIMES=5,DEFAULT_INTERVAL=0,attempts=[],opts={times:DEFAULT_TIMES,interval:DEFAULT_INTERVAL},length=arguments.length;if(length<1||length>3)throw new Error("Invalid arguments - must be either (task), (task, callback), (times, task) or (times, task, callback)");return length<=2&&"function"==typeof times&&(callback=task,task=times),"function"!=typeof times&&parseTimes(opts,times),opts.callback=callback,opts.task=task,opts.callback?wrappedTask():wrappedTask},async.waterfall=function(tasks,callback){function wrapIterator(iterator){return _restParam(function(err,args){if(err)callback.apply(null,[err].concat(args));else{var next=iterator.next();next?args.push(wrapIterator(next)):args.push(callback),ensureAsync(iterator).apply(null,args)}})}if(callback=_once(callback||noop),!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}return tasks.length?void wrapIterator(async.iterator(tasks))():callback()},async.parallel=function(tasks,callback){_parallel(async.eachOf,tasks,callback)},async.parallelLimit=function(tasks,limit,callback){_parallel(_eachOfLimit(limit),tasks,callback)},async.series=function(tasks,callback){_parallel(async.eachOfSeries,tasks,callback)},async.iterator=function(tasks){function makeCallback(index){function fn(){return tasks.length&&tasks[index].apply(null,arguments),fn.next()}return fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null},fn}return makeCallback(0)},async.apply=_restParam(function(fn,args){return _restParam(function(callArgs){return fn.apply(null,args.concat(callArgs))})}),async.concat=doParallel(_concat),async.concatSeries=doSeries(_concat),async.whilst=function(test,iterator,callback){if(callback=callback||noop,test()){var next=_restParam(function(err,args){err?callback(err):test.apply(this,args)?iterator(next):callback.apply(null,[null].concat(args))});iterator(next)}else callback(null)},async.doWhilst=function(iterator,test,callback){var calls=0;return async.whilst(function(){return++calls<=1||test.apply(this,arguments)},iterator,callback)},async.until=function(test,iterator,callback){return async.whilst(function(){return!test.apply(this,arguments)},iterator,callback)},async.doUntil=function(iterator,test,callback){return async.doWhilst(iterator,function(){return!test.apply(this,arguments)},callback)},async.during=function(test,iterator,callback){callback=callback||noop;var next=_restParam(function(err,args){err?callback(err):(args.push(check),test.apply(this,args))}),check=function(err,truth){err?callback(err):truth?iterator(next):callback(null)};test(check)},async.doDuring=function(iterator,test,callback){var calls=0;async.during(function(next){calls++<1?next(null,!0):test.apply(this,arguments)},iterator,callback)},async.queue=function(worker,concurrency){var q=_queue(function(items,cb){worker(items[0],cb)},concurrency,1);return q},async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){for(var beg=-1,end=sequence.length-1;beg<end;){var mid=beg+(end-beg+1>>>1);compare(item,sequence[mid])>=0?beg=mid:end=mid-1}return beg}function _insert(q,data,priority,callback){if(null!=callback&&"function"!=typeof callback)throw new Error("task callback must be a function");return q.started=!0,_isArray(data)||(data=[data]),0===data.length?async.setImmediate(function(){q.drain()}):void _arrayEach(data,function(task){var item={data:task,priority:priority,callback:"function"==typeof callback?callback:noop};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item),q.tasks.length===q.concurrency&&q.saturated(),async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);return q.push=function(data,priority,callback){_insert(q,data,priority,callback)},delete q.unshift,q},async.cargo=function(worker,payload){return _queue(worker,1,payload)},async.log=_console_fn("log"),async.dir=_console_fn("dir"),async.memoize=function(fn,hasher){var memo={},queues={},has=Object.prototype.hasOwnProperty;hasher=hasher||identity;var memoized=_restParam(function(args){var callback=args.pop(),key=hasher.apply(null,args);has.call(memo,key)?async.setImmediate(function(){callback.apply(null,memo[key])}):has.call(queues,key)?queues[key].push(callback):(queues[key]=[callback],fn.apply(null,args.concat([_restParam(function(args){memo[key]=args;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++)q[i].apply(null,args)})])))});return memoized.memo=memo,memoized.unmemoized=fn,memoized},async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}},async.times=_times(async.map),async.timesSeries=_times(async.mapSeries),async.timesLimit=function(count,limit,iterator,callback){return async.mapLimit(_range(count),limit,iterator,callback)},async.seq=function(){var fns=arguments;return _restParam(function(args){var that=this,callback=args[args.length-1];"function"==typeof callback?args.pop():callback=noop,async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([_restParam(function(err,nextargs){cb(err,nextargs)})]))},function(err,results){callback.apply(that,[err].concat(results))})})},async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))},async.applyEach=_applyEach(async.eachOf),async.applyEachSeries=_applyEach(async.eachOfSeries),async.forever=function(fn,callback){function next(err){return err?done(err):void task(next)}var done=only_once(callback||noop),task=ensureAsync(fn);next()},async.ensureAsync=ensureAsync,async.constant=_restParam(function(values){var args=[null].concat(values);return function(callback){return callback.apply(this,args)}}),async.wrapSync=async.asyncify=function(func){return _restParam(function(args){var result,callback=args.pop();try{result=func.apply(this,args)}catch(e){return callback(e)}_isObject(result)&&"function"==typeof result.then?result.then(function(value){callback(null,value)})["catch"](function(err){callback(err.message?err:new Error(err))}):callback(null,result)})},"object"==typeof module&&module.exports?module.exports=async:"function"==typeof define&&define.amd?define([],function(){return async}):root.async=async}()}).call(this,require("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(require,module,exports){(function(process){function normalizeArray(parts,allowAboveRoot){for(var up=0,i=parts.length-1;i>=0;i--){var last=parts[i];"."===last?parts.splice(i,1):".."===last?(parts.splice(i,1),up++):up&&(parts.splice(i,1),up--)}if(allowAboveRoot)for(;up--;up)parts.unshift("..");return parts}function filter(xs,f){if(xs.filter)return xs.filter(f);for(var res=[],i=0;i<xs.length;i++)f(xs[i],i,xs)&&res.push(xs[i]);return res}var splitPathRe=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,splitPath=function(filename){return splitPathRe.exec(filename).slice(1)};exports.resolve=function(){for(var resolvedPath="",resolvedAbsolute=!1,i=arguments.length-1;i>=-1&&!resolvedAbsolute;i--){var path=i>=0?arguments[i]:process.cwd();if("string"!=typeof path)throw new TypeError("Arguments to path.resolve must be strings");path&&(resolvedPath=path+"/"+resolvedPath,resolvedAbsolute="/"===path.charAt(0))}return resolvedPath=normalizeArray(filter(resolvedPath.split("/"),function(p){return!!p}),!resolvedAbsolute).join("/"),(resolvedAbsolute?"/":"")+resolvedPath||"."},exports.normalize=function(path){var isAbsolute=exports.isAbsolute(path),trailingSlash="/"===substr(path,-1);return path=normalizeArray(filter(path.split("/"),function(p){return!!p}),!isAbsolute).join("/"),path||isAbsolute||(path="."),path&&trailingSlash&&(path+="/"),(isAbsolute?"/":"")+path},exports.isAbsolute=function(path){return"/"===path.charAt(0)},exports.join=function(){var paths=Array.prototype.slice.call(arguments,0);return exports.normalize(filter(paths,function(p,index){if("string"!=typeof p)throw new TypeError("Arguments to path.join must be strings");return p}).join("/"))},exports.relative=function(from,to){function trim(arr){for(var start=0;start<arr.length&&""===arr[start];start++);for(var end=arr.length-1;end>=0&&""===arr[end];end--);return start>end?[]:arr.slice(start,end-start+1)}from=exports.resolve(from).substr(1),to=exports.resolve(to).substr(1);for(var fromParts=trim(from.split("/")),toParts=trim(to.split("/")),length=Math.min(fromParts.length,toParts.length),samePartsLength=length,i=0;i<length;i++)if(fromParts[i]!==toParts[i]){samePartsLength=i;break}for(var outputParts=[],i=samePartsLength;i<fromParts.length;i++)outputParts.push("..");return outputParts=outputParts.concat(toParts.slice(samePartsLength)),outputParts.join("/")},exports.sep="/",exports.delimiter=":",exports.dirname=function(path){var result=splitPath(path),root=result[0],dir=result[1];return root||dir?(dir&&(dir=dir.substr(0,dir.length-1)),root+dir):"."},exports.basename=function(path,ext){var f=splitPath(path)[2];return ext&&f.substr(-1*ext.length)===ext&&(f=f.substr(0,f.length-ext.length)),f},exports.extname=function(path){return splitPath(path)[3]};var substr="b"==="ab".substr(-1)?function(str,start,len){return str.substr(start,len)}:function(str,start,len){return start<0&&(start=str.length+start),str.substr(start,len)}}).call(this,require("_process"))},{_process:3}],3:[function(require,module,exports){function cleanUpNextTick(){draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue()}function drainQueue(){if(!draining){var timeout=setTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,clearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var currentQueue,process=module.exports={},queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||setTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],4:[function(require,module,exports){(function(global){!function(root){function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split("@"),result="";parts.length>1&&(result=parts[0]+"@",string=parts[1]),string=string.replace(regexSeparators,".");var labels=string.split("."),encoded=map(labels,fn).join(".");return result+encoded}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)value=string.charCodeAt(counter++),value>=55296&&value<=56319&&counter<length?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--)):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output="";return value>65535&&(value-=65536,output+=stringFromCharCode(value>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join("")}function basicToDigit(codePoint){return codePoint-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for(basic=input.lastIndexOf(delimiter),basic<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error("not-basic"),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error("invalid-input"),digit=basicToDigit(input.charCodeAt(index++)),(digit>=base||digit>floor((maxInt-i)/w))&&error("overflow"),i+=digit*w,t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(digit<t);k+=base)baseMinusT=base-t,w>floor(maxInt/baseMinusT)&&error("overflow"),w*=baseMinusT;out=output.length+1,bias=adapt(i-oldi,out,0==oldi),floor(i/out)>maxInt-n&&error("overflow"),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(input=ucs2decode(input),inputLength=input.length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)currentValue=input[j],currentValue<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)currentValue=input[j],currentValue>=n&&currentValue<m&&(m=currentValue);for(handledCPCountPlusOne=handledCPCount+1,m-n>floor((maxInt-delta)/handledCPCountPlusOne)&&error("overflow"),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if(currentValue=input[j],currentValue<n&&++delta>maxInt&&error("overflow"),currentValue==n){for(q=delta,k=base;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias,!(q<t);k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join("")}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?"xn--"+encode(string):string})}var freeExports="object"==typeof exports&&exports&&!exports.nodeType&&exports,freeModule="object"==typeof module&&module&&!module.nodeType&&module,freeGlobal="object"==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter="-",regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;if(punycode={version:"1.3.2",ucs2:{decode:ucs2decode,encode:ucs2encode},decode:decode,encode:encode,toASCII:toASCII,toUnicode:toUnicode},"function"==typeof define&&"object"==typeof define.amd&&define.amd)define("punycode",function(){return punycode});else if(freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],5:[function(require,module,exports){
"use strict";function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||"&",eq=eq||"=";var obj={};if("string"!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&"number"==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,"%20"),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=""),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)}},{}],6:[function(require,module,exports){"use strict";function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var stringifyPrimitive=function(v){switch(typeof v){case"string":return v;case"boolean":return v?"true":"false";case"number":return isFinite(v)?v:"";default:return""}};module.exports=function(obj,sep,eq,name){return sep=sep||"&",eq=eq||"=",null===obj&&(obj=void 0),"object"==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):""};var isArray=Array.isArray||function(xs){return"[object Array]"===Object.prototype.toString.call(xs)},objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],7:[function(require,module,exports){"use strict";exports.decode=exports.parse=require("./decode"),exports.encode=exports.stringify=require("./encode")},{"./decode":5,"./encode":6}],8:[function(require,module,exports){function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}function urlFormat(obj){return isString(obj)&&(obj=urlParse(obj)),obj instanceof Url?obj.format():Url.prototype.format.call(obj)}function urlResolve(source,relative){return urlParse(source,!1,!0).resolve(relative)}function urlResolveObject(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative}function isString(arg){return"string"==typeof arg}function isObject(arg){return"object"==typeof arg&&null!==arg}function isNull(arg){return null===arg}function isNullOrUndefined(arg){return null==arg}var punycode=require("punycode");exports.parse=urlParse,exports.resolve=urlResolve,exports.resolveObject=urlResolveObject,exports.format=urlFormat,exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,delims=["<",">",'"',"`"," ","\r","\n","\t"],unwise=["{","}","|","\\","^","`"].concat(delims),autoEscape=["'"].concat(unwise),nonHostChars=["%","/","?",";","#"].concat(autoEscape),hostEndingChars=["/","?","#"],hostnameMaxLen=255,hostnamePartPattern=/^[a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={javascript:!0,"javascript:":!0},hostlessProtocol={javascript:!0,"javascript:":!0},slashedProtocol={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},querystring=require("querystring");Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var rest=url;rest=rest.trim();var proto=protocolPattern.exec(rest);if(proto){proto=proto[0];var lowerProto=proto.toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes="//"===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var hostEnd=-1,i=0;i<hostEndingChars.length;i++){var hec=rest.indexOf(hostEndingChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}var auth,atSign;atSign=hostEnd===-1?rest.lastIndexOf("@"):rest.lastIndexOf("@",hostEnd),atSign!==-1&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(var i=0;i<nonHostChars.length;i++){var hec=rest.indexOf(nonHostChars[i]);hec!==-1&&(hostEnd===-1||hec<hostEnd)&&(hostEnd=hec)}hostEnd===-1&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||"";var ipv6Hostname="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),i=0,l=hostparts.length;i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart="",j=0,k=part.length;j<k;j++)newpart+=part.charCodeAt(j)>127?"x":part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest="/"+notHost.join(".")+rest),this.hostname=validParts.join(".");break}}}if(this.hostname.length>hostnameMaxLen?this.hostname="":this.hostname=this.hostname.toLowerCase(),!ipv6Hostname){for(var domainArray=this.hostname.split("."),newOut=[],i=0;i<domainArray.length;++i){var s=domainArray[i];newOut.push(s.match(/[^A-Za-z0-9_-]/)?"xn--"+punycode.encode(s):s)}this.hostname=newOut.join(".")}var p=this.port?":"+this.port:"",h=this.hostname||"";this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==rest[0]&&(rest="/"+rest))}if(!unsafeProtocol[lowerProto])for(var i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i],esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}var hash=rest.indexOf("#");hash!==-1&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf("?");if(qm!==-1?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search="",this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var p=this.pathname||"",s=this.search||"";this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||"";auth&&(auth=encodeURIComponent(auth),auth=auth.replace(/%3A/i,":"),auth+="@");var protocol=this.protocol||"",pathname=this.pathname||"",hash=this.hash||"",host=!1,query="";this.host?host=auth+this.host:this.hostname&&(host=auth+(this.hostname.indexOf(":")===-1?this.hostname:"["+this.hostname+"]"),this.port&&(host+=":"+this.port)),this.query&&isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&"?"+query||"";return protocol&&":"!==protocol.substr(-1)&&(protocol+=":"),this.slashes||(!protocol||slashedProtocol[protocol])&&host!==!1?(host="//"+(host||""),pathname&&"/"!==pathname.charAt(0)&&(pathname="/"+pathname)):host||(host=""),hash&&"#"!==hash.charAt(0)&&(hash="#"+hash),search&&"?"!==search.charAt(0)&&(search="?"+search),pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}),search=search.replace("#","%23"),protocol+host+pathname+search+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}var result=new Url;if(Object.keys(this).forEach(function(k){result[k]=this[k]},this),result.hash=relative.hash,""===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol)return Object.keys(relative).forEach(function(k){"protocol"!==k&&(result[k]=relative[k])}),slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname="/"),result.href=result.format(),result;if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol])return Object.keys(relative).forEach(function(k){result[k]=relative[k]}),result.href=result.format(),result;if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||"").split("/");relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=""),relative.hostname||(relative.hostname=""),""!==relPath[0]&&relPath.unshift(""),relPath.length<2&&relPath.unshift(""),result.pathname=relPath.join("/")}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||"",result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||"",s=result.search||"";result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&"/"===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&"/"===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split("/")||[],relPath=relative.pathname&&relative.pathname.split("/")||[],psychotic=result.protocol&&!slashedProtocol[result.protocol];if(psychotic&&(result.hostname="",result.port=null,result.host&&(""===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host="",relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(""===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(""===relPath[0]||""===srcPath[0])),isRelAbs)result.host=relative.host||""===relative.host?relative.host:result.host,result.hostname=relative.hostname||""===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!isNullOrUndefined(relative.search)){if(psychotic){result.hostname=result.host=srcPath.shift();var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return result.search=relative.search,result.query=relative.query,isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path="/"+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host)&&("."===last||".."===last)||""===last,up=0,i=srcPath.length;i>=0;i--)last=srcPath[i],"."==last?srcPath.splice(i,1):".."===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift("..");!mustEndAbs||""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0)||srcPath.unshift(""),hasTrailingSlash&&"/"!==srcPath.join("/").substr(-1)&&srcPath.push("");var isAbsolute=""===srcPath[0]||srcPath[0]&&"/"===srcPath[0].charAt(0);if(psychotic){result.hostname=result.host=isAbsolute?"":srcPath.length?srcPath.shift():"";var authInHost=!!(result.host&&result.host.indexOf("@")>0)&&result.host.split("@");authInHost&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift())}return mustEndAbs=mustEndAbs||result.host&&srcPath.length,mustEndAbs&&!isAbsolute&&srcPath.unshift(""),srcPath.length?result.pathname=srcPath.join("/"):(result.pathname=null,result.path=null),isNull(result.pathname)&&isNull(result.search)||(result.path=(result.pathname?result.pathname:"")+(result.search?result.search:"")),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(port=port[0],":"!==port&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{punycode:4,querystring:7}],9:[function(require,module,exports){"use strict";function earcut(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,size;if(hasHoles&&(outerNode=eliminateHoles(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)x=data[i],y=data[i+1],x<minX&&(minX=x),y<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);size=Math.max(maxX-minX,maxY-minY)}return earcutLinked(outerNode,triangles,dim,minX,minY,size),triangles}function linkedList(data,start,end,dim,clockwise){var i,j,last,sum=0;for(i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;if(clockwise===sum>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),p=end=p.prev,p===p.next)return null;again=!0}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,size,pass){if(ear){!pass&&size&&indexCurve(ear,minX,minY,size);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,size?isEarHashed(ear,minX,minY,size):isEar(ear))triangles.push(prev.i/dim),triangles.push(ear.i/dim),triangles.push(next.i/dim),removeNode(ear),ear=next.next,stop=next.next;else if(ear=next,ear===stop){pass?1===pass?(ear=cureLocalIntersections(ear,triangles,dim),earcutLinked(ear,triangles,dim,minX,minY,size,2)):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,size):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,size,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var p=ear.next.next;p!==ear.prev;){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,size){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,size),maxZ=zOrder(maxTX,maxTY,minX,minY,size),p=ear.nextZ;p&&p.z<=maxZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(p=ear.prevZ;p&&p.z>=minZ;){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim),triangles.push(p.i/dim),triangles.push(b.i/dim),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,size){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,size),void earcutLinked(c,triangles,dim,minX,minY,size)}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var i,len,start,end,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)start=holeIndices[i]*dim,end=i<len-1?holeIndices[i+1]*dim:data.length,list=linkedList(data,start,end,dim,!1),list===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)eliminateHole(queue[i],outerNode),outerNode=filterPoints(outerNode,outerNode.next);return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){if(outerNode=findHoleBridge(hole,outerNode)){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-(1/0);do{if(hy<=p.y&&hy>=p.next.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next)}p=p.next}while(p!==outerNode);if(!m)return null;if(hole.x===m.x)return m.prev;var tan,stop=m,tanMin=1/0;for(p=m.next;p!==stop;)hx>=p.x&&p.x>=m.x&&pointInTriangle(hy<m.y?hx:qx,hy,m.x,m.y,hy<m.y?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),(tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)&&(m=p,tanMin=tan)),p=p.next;return m}function indexCurve(start,minX,minY,size){var p=start;do null===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,size)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next;while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ,q);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0===pSize?(e=q,q=q.nextZ,qSize--):0!==qSize&&q?p.z<=q.z?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--):(e=p,p=p.nextZ,pSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1);return list}function zOrder(x,y,minX,minY,size){return x=32767*(x-minX)/size,y=32767*(y-minY)/size,x=16711935&(x|x<<8),x=252645135&(x|x<<4),x=858993459&(x|x<<2),x=1431655765&(x|x<<1),y=16711935&(y|y<<8),y=252645135&(y|y<<4),y=858993459&(y|y<<2),y=1431655765&(y|y<<1),x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do p.x<leftmost.x&&(leftmost=p),p=p.next;while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)-(ax-px)*(cy-py)>=0&&(ax-px)*(by-py)-(bx-px)*(ay-py)>=0&&(bx-px)*(cy-py)-(cx-px)*(by-py)>=0}function isValidDiagonal(a,b){return equals(a,b)||a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){return area(p1,q1,p2)>0!=area(p1,q1,q2)>0&&area(p2,q2,p1)>0!=area(p2,q2,q1)>0}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do p.y>py!=p.next.y>py&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next;while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}module.exports=earcut},{}],10:[function(require,module,exports){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}var prefix="function"!=typeof Object.create&&"~";EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(event,exists){var evt=prefix?prefix+event:event,available=this._events&&this._events[evt];if(exists)return!!available;if(!available)return[];if(available.fn)return[available.fn];for(var i=0,l=available.length,ee=new Array(l);i<l;i++)ee[i]=available[i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return!1;var args,i,listeners=this._events[evt],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,void 0,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);i<len;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;i<length;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,void 0,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);j<len;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,(!0)),evt=prefix?prefix+event:event;return this._events||(this._events=prefix?{}:Object.create(null)),this._events[evt]?this._events[evt].fn?this._events[evt]=[this._events[evt],listener]:this._events[evt].push(listener):this._events[evt]=listener,this},EventEmitter.prototype.removeListener=function(event,fn,context,once){var evt=prefix?prefix+event:event;if(!this._events||!this._events[evt])return this;var listeners=this._events[evt],events=[];if(fn)if(listeners.fn)(listeners.fn!==fn||once&&!listeners.once||context&&listeners.context!==context)&&events.push(listeners);else for(var i=0,length=listeners.length;i<length;i++)(listeners[i].fn!==fn||once&&!listeners[i].once||context&&listeners[i].context!==context)&&events.push(listeners[i]);return events.length?this._events[evt]=1===events.length?events[0]:events:delete this._events[evt],this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?delete this._events[prefix?prefix+event:event]:this._events=prefix?{}:Object.create(null),this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.prefixed=prefix,"undefined"!=typeof module&&(module.exports=EventEmitter)},{}],11:[function(require,module,exports){"use strict";function toObject(val){if(null===val||void 0===val)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(val)}var hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;module.exports=Object.assign||function(target,source){for(var from,symbols,to=toObject(target),s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from)hasOwnProperty.call(from,key)&&(to[key]=from[key]);if(Object.getOwnPropertySymbols){symbols=Object.getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++)propIsEnumerable.call(from,symbols[i])&&(to[symbols[i]]=from[symbols[i]])}}return to}},{}],12:[function(require,module,exports){(function(process){!function(){function only_once(fn){var called=!1;return function(){if(called)throw new Error("Callback was already called.");called=!0,fn.apply(root,arguments)}}var root,previous_async,async={};root=this,null!=root&&(previous_async=root.async),async.noConflict=function(){return root.async=previous_async,async};var _toString=Object.prototype.toString,_isArray=Array.isArray||function(obj){return"[object Array]"===_toString.call(obj)},_each=function(arr,iterator){for(var i=0;i<arr.length;i+=1)iterator(arr[i],i,arr)},_map=function(arr,iterator){if(arr.map)return arr.map(iterator);var results=[];return _each(arr,function(x,i,a){results.push(iterator(x,i,a))}),results},_reduce=function(arr,iterator,memo){return arr.reduce?arr.reduce(iterator,memo):(_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)}),memo)},_keys=function(obj){if(Object.keys)return Object.keys(obj);var keys=[];for(var k in obj)obj.hasOwnProperty(k)&&keys.push(k);return keys};"undefined"!=typeof process&&process.nextTick?(async.nextTick=process.nextTick,"undefined"!=typeof setImmediate?async.setImmediate=function(fn){setImmediate(fn)}:async.setImmediate=async.nextTick):"function"==typeof setImmediate?(async.nextTick=function(fn){setImmediate(fn)},async.setImmediate=async.nextTick):(async.nextTick=function(fn){setTimeout(fn,0)},async.setImmediate=async.nextTick),async.each=function(arr,iterator,callback){function done(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length&&callback())}if(callback=callback||function(){},!arr.length)return callback();var completed=0;_each(arr,function(x){iterator(x,only_once(done))})},async.forEach=async.each,async.eachSeries=function(arr,iterator,callback){if(callback=callback||function(){},!arr.length)return callback();var completed=0,iterate=function(){iterator(arr[completed],function(err){err?(callback(err),callback=function(){}):(completed+=1,completed>=arr.length?callback():iterate())})};iterate()},async.forEachSeries=async.eachSeries,async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])},async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){if(callback=callback||function(){},!arr.length||limit<=0)return callback();var completed=0,started=0,running=0;!function replenish(){if(completed>=arr.length)return callback();for(;running<limit&&started<arr.length;)started+=1,running+=1,iterator(arr[started-1],function(err){err?(callback(err),callback=function(){}):(completed+=1,running-=1,completed>=arr.length?callback():replenish())})}()}},doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}},doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}},doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}},_asyncMap=function(eachfn,arr,iterator,callback){if(arr=_map(arr,function(x,i){return{index:i,value:x}}),callback){var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v,callback(err)})},function(err){callback(err,results)})}else eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})};async.map=doParallel(_asyncMap),async.mapSeries=doSeries(_asyncMap),async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v,callback(err)})},function(err){callback(err,memo)})},async.inject=async.reduce,async.foldl=async.reduce,async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)},async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v&&results.push(x),callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter),async.filterSeries=doSeries(_filter),async.select=async.filter,async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}}),eachfn(arr,function(x,callback){iterator(x.value,function(v){v||results.push(x),callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject),async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){result?(main_callback(x),main_callback=function(){}):callback()})},function(err){main_callback()})};async.detect=doParallel(_detect),async.detectSeries=doSeries(_detect),async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v&&(main_callback(!0),main_callback=function(){}),callback()})},function(err){main_callback(!1)})},async.any=async.some,async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){v||(main_callback(!1),main_callback=function(){}),callback()})},function(err){main_callback(!0)})},async.all=async.every,async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){err?callback(err):callback(null,{value:x,criteria:criteria})})},function(err,results){if(err)return callback(err);var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))})},async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks),remainingTasks=keys.length;if(!remainingTasks)return callback();var results={},listeners=[],addListener=function(fn){listeners.unshift(fn)},removeListener=function(fn){for(var i=0;i<listeners.length;i+=1)if(listeners[i]===fn)return void listeners.splice(i,1)},taskComplete=function(){remainingTasks--,_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){},theCallback(null,results)}}),_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]],taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1&&(args=args[0]),err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]}),safeResults[k]=args,callback(err,safeResults),callback=function(){}}else results[k]=args,async.setImmediate(taskComplete)},requires=task.slice(0,Math.abs(task.length-1))||[],ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},!0)&&!results.hasOwnProperty(k)};if(ready())task[task.length-1](taskCallback,results);else{var listener=function(){ready()&&(removeListener(listener),task[task.length-1](taskCallback,results))};
addListener(listener)}})},async.retry=function(times,task,callback){var DEFAULT_TIMES=5,attempts=[];"function"==typeof times&&(callback=task,task=times,times=DEFAULT_TIMES),times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){for(var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};times;)attempts.push(retryAttempt(task,!(times-=1)));async.series(attempts,function(done,data){data=data[data.length-1],(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask},async.waterfall=function(tasks,callback){if(callback=callback||function(){},!_isArray(tasks)){var err=new Error("First argument to waterfall must be an array of functions");return callback(err)}if(!tasks.length)return callback();var wrapIterator=function(iterator){return function(err){if(err)callback.apply(null,arguments),callback=function(){};else{var args=Array.prototype.slice.call(arguments,1),next=iterator.next();next?args.push(wrapIterator(next)):args.push(callback),async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){if(callback=callback||function(){},_isArray(tasks))eachfn.map(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)},async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)},async.series=function(tasks,callback){if(callback=callback||function(){},_isArray(tasks))async.mapSeries(tasks,function(fn,callback){fn&&fn(function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),callback.call(null,err,args)})},callback);else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);args.length<=1&&(args=args[0]),results[k]=args,callback(err)})},function(err){callback(err,results)})}},async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){return tasks.length&&tasks[index].apply(null,arguments),fn.next()};return fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null},fn};return makeCallback(0)},async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]),cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat),async.concatSeries=doSeries(_concat),async.whilst=function(test,iterator,callback){test()?iterator(function(err){return err?callback(err):void async.whilst(test,iterator,callback)}):callback()},async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err)return callback(err);var args=Array.prototype.slice.call(arguments,1);test.apply(null,args)?async.doWhilst(iterator,test,callback):callback()})},async.until=function(test,iterator,callback){test()?callback():iterator(function(err){return err?callback(err):void async.until(test,iterator,callback)})},async.doUntil=function(iterator,test,callback){iterator(function(err){if(err)return callback(err);var args=Array.prototype.slice.call(arguments,1);test.apply(null,args)?callback():async.doUntil(iterator,test,callback)})},async.queue=function(worker,concurrency){function _insert(q,data,pos,callback){return q.started||(q.started=!0),_isArray(data)||(data=[data]),0==data.length?async.setImmediate(function(){q.drain&&q.drain()}):void _each(data,function(task){var item={data:task,callback:"function"==typeof callback?callback:null};pos?q.tasks.unshift(item):q.tasks.push(item),q.saturated&&q.tasks.length===q.concurrency&&q.saturated(),async.setImmediate(q.process)})}void 0===concurrency&&(concurrency=1);var workers=0,q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:!1,paused:!1,push:function(data,callback){_insert(q,data,!1,callback)},kill:function(){q.drain=null,q.tasks=[]},unshift:function(data,callback){_insert(q,data,!0,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();q.empty&&0===q.tasks.length&&q.empty(),workers+=1;var next=function(){workers-=1,task.callback&&task.callback.apply(task,arguments),q.drain&&q.tasks.length+workers===0&&q.drain(),q.process()},cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){q.paused!==!0&&(q.paused=!0)},resume:function(){if(q.paused!==!1){q.paused=!1;for(var w=1;w<=q.concurrency;w++)async.setImmediate(q.process)}}};return q},async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority}function _binarySearch(sequence,item,compare){for(var beg=-1,end=sequence.length-1;beg<end;){var mid=beg+(end-beg+1>>>1);compare(item,sequence[mid])>=0?beg=mid:end=mid-1}return beg}function _insert(q,data,priority,callback){return q.started||(q.started=!0),_isArray(data)||(data=[data]),0==data.length?async.setImmediate(function(){q.drain&&q.drain()}):void _each(data,function(task){var item={data:task,priority:priority,callback:"function"==typeof callback?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item),q.saturated&&q.tasks.length===q.concurrency&&q.saturated(),async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);return q.push=function(data,priority,callback){_insert(q,data,priority,callback)},delete q.unshift,q},async.cargo=function(worker,payload){var working=!1,tasks=[],cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:!0,push:function(data,callback){_isArray(data)||(data=[data]),_each(data,function(task){tasks.push({data:task,callback:"function"==typeof callback?callback:null}),cargo.drained=!1,cargo.saturated&&tasks.length===payload&&cargo.saturated()}),async.setImmediate(cargo.process)},process:function process(){if(!working){if(0===tasks.length)return cargo.drain&&!cargo.drained&&cargo.drain(),void(cargo.drained=!0);var ts="number"==typeof payload?tasks.splice(0,payload):tasks.splice(0,tasks.length),ds=_map(ts,function(task){return task.data});cargo.empty&&cargo.empty(),working=!0,worker(ds,function(){working=!1;var args=arguments;_each(ts,function(data){data.callback&&data.callback.apply(null,args)}),process()})}},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(err?console.error&&console.error(err):console[name]&&_each(args,function(x){console[name](x)}))}]))}};async.log=_console_fn("log"),async.dir=_console_fn("dir"),async.memoize=function(fn,hasher){var memo={},queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments),callback=args.pop(),key=hasher.apply(null,args);key in memo?async.nextTick(function(){callback.apply(null,memo[key])}):key in queues?queues[key].push(callback):(queues[key]=[callback],fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++)q[i].apply(null,arguments)}])))};return memoized.memo=memo,memoized.unmemoized=fn,memoized},async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}},async.times=function(count,iterator,callback){for(var counter=[],i=0;i<count;i++)counter.push(i);return async.map(counter,iterator,callback)},async.timesSeries=function(count,iterator,callback){for(var counter=[],i=0;i<count;i++)counter.push(i);return async.mapSeries(counter,iterator,callback)},async.seq=function(){var fns=arguments;return function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0],nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}},async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this,args=Array.prototype.slice.call(arguments),callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}return go};async.applyEach=doParallel(_applyEach),async.applyEachSeries=doSeries(_applyEach),async.forever=function(fn,callback){function next(err){if(err){if(callback)return callback(err);throw err}fn(next)}next()},"undefined"!=typeof module&&module.exports?module.exports=async:"undefined"!=typeof define&&define.amd?define([],function(){return async}):root.async=async}()}).call(this,require("_process"))},{_process:3}],13:[function(require,module,exports){function Loader(baseUrl,concurrency){EventEmitter.call(this),concurrency=concurrency||10,this.baseUrl=baseUrl||"",this.progress=0,this.loading=!1,this._progressChunk=0,this._beforeMiddleware=[],this._afterMiddleware=[],this._boundLoadResource=this._loadResource.bind(this),this._boundOnLoad=this._onLoad.bind(this),this._buffer=[],this._numToLoad=0,this._queue=async.queue(this._boundLoadResource,concurrency),this.resources={}}var async=require("async"),urlParser=require("url"),Resource=require("./Resource"),EventEmitter=require("eventemitter3");Loader.prototype=Object.create(EventEmitter.prototype),Loader.prototype.constructor=Loader,module.exports=Loader,Loader.prototype.add=Loader.prototype.enqueue=function(name,url,options,cb){if(Array.isArray(name)){for(var i=0;i<name.length;++i)this.add(name[i]);return this}if("object"==typeof name&&(cb=url||name.callback||name.onComplete,options=name,url=name.url,name=name.name||name.key||name.url),"string"!=typeof url&&(cb=options,options=url,url=name),"string"!=typeof url)throw new Error("No url passed to add resource to loader.");if("function"==typeof options&&(cb=options,options=null),this.resources[name])throw new Error('Resource with name "'+name+'" already exists.');return url=this._handleBaseUrl(url),this.resources[name]=new Resource(name,url,options),"function"==typeof cb&&this.resources[name].once("afterMiddleware",cb),this._numToLoad++,this._queue.started?(this._queue.push(this.resources[name]),this._progressChunk=(100-this.progress)/(this._queue.length()+this._queue.running())):(this._buffer.push(this.resources[name]),this._progressChunk=100/this._buffer.length),this},Loader.prototype._handleBaseUrl=function(url){var parsedUrl=urlParser.parse(url);return parsedUrl.protocol||0===parsedUrl.pathname.indexOf("//")?url:this.baseUrl.length&&this.baseUrl.lastIndexOf("/")!==this.baseUrl.length-1&&"/"!==url.charAt(0)?this.baseUrl+"/"+url:this.baseUrl+url},Loader.prototype.before=Loader.prototype.pre=function(fn){return this._beforeMiddleware.push(fn),this},Loader.prototype.after=Loader.prototype.use=function(fn){return this._afterMiddleware.push(fn),this},Loader.prototype.reset=function(){this.progress=0,this.loading=!1,this._progressChunk=0,this._buffer.length=0,this._numToLoad=0,this._queue.kill(),this._queue.started=!1,this.resources={}},Loader.prototype.load=function(cb){if("function"==typeof cb&&this.once("complete",cb),this._queue.started)return this;this.emit("start",this);for(var i=0;i<this._buffer.length;++i)this._queue.push(this._buffer[i]);return this._buffer.length=0,this},Loader.prototype._loadResource=function(resource,dequeue){var self=this;resource._dequeue=dequeue,this._runMiddleware(resource,this._beforeMiddleware,function(){resource.load(self._boundOnLoad)})},Loader.prototype._onComplete=function(){this.emit("complete",this,this.resources)},Loader.prototype._onLoad=function(resource){this.progress+=this._progressChunk,this.emit("progress",this,resource),this._runMiddleware(resource,this._afterMiddleware,function(){resource.emit("afterMiddleware",resource),this._numToLoad--,0===this._numToLoad&&(this.progress=100,this._onComplete()),resource.error?this.emit("error",resource.error,this,resource):this.emit("load",this,resource)}),resource._dequeue()},Loader.prototype._runMiddleware=function(resource,fns,cb){var self=this;async.eachSeries(fns,function(fn,next){fn.call(self,resource,next)},cb.bind(this,resource))},Loader.LOAD_TYPE=Resource.LOAD_TYPE,Loader.XHR_READY_STATE=Resource.XHR_READY_STATE,Loader.XHR_RESPONSE_TYPE=Resource.XHR_RESPONSE_TYPE},{"./Resource":14,async:12,eventemitter3:10,url:8}],14:[function(require,module,exports){function Resource(name,url,options){if(EventEmitter.call(this),options=options||{},"string"!=typeof name||"string"!=typeof url)throw new Error("Both name and url are required for constructing a resource.");this.name=name,this.url=url,this.isDataUrl=0===this.url.indexOf("data:"),this.data=null,this.crossOrigin=options.crossOrigin===!0?"anonymous":options.crossOrigin,this.loadType=options.loadType||this._determineLoadType(),this.xhrType=options.xhrType,this.metadata=options.metadata||{},this.error=null,this.xhr=null,this.isJson=!1,this.isXml=!1,this.isImage=!1,this.isAudio=!1,this.isVideo=!1,this._dequeue=null,this._boundComplete=this.complete.bind(this),this._boundOnError=this._onError.bind(this),this._boundOnProgress=this._onProgress.bind(this),this._boundXhrOnError=this._xhrOnError.bind(this),this._boundXhrOnAbort=this._xhrOnAbort.bind(this),this._boundXhrOnLoad=this._xhrOnLoad.bind(this),this._boundXdrOnTimeout=this._xdrOnTimeout.bind(this)}function reqType(xhr){return xhr.toString().replace("object ","")}function setExtMap(map,extname,val){extname&&0===extname.indexOf(".")&&(extname=extname.substring(1)),extname&&(map[extname]=val)}var EventEmitter=require("eventemitter3"),_url=require("url"),useXdr=!(!window.XDomainRequest||"withCredentials"in new XMLHttpRequest),tempAnchor=null;Resource.prototype=Object.create(EventEmitter.prototype),Resource.prototype.constructor=Resource,module.exports=Resource,Resource.prototype.complete=function(){this.data&&this.data.removeEventListener&&(this.data.removeEventListener("error",this._boundOnError),this.data.removeEventListener("load",this._boundComplete),this.data.removeEventListener("progress",this._boundOnProgress),this.data.removeEventListener("canplaythrough",this._boundComplete)),this.xhr&&(this.xhr.removeEventListener?(this.xhr.removeEventListener("error",this._boundXhrOnError),this.xhr.removeEventListener("abort",this._boundXhrOnAbort),this.xhr.removeEventListener("progress",this._boundOnProgress),this.xhr.removeEventListener("load",this._boundXhrOnLoad)):(this.xhr.onerror=null,this.xhr.ontimeout=null,this.xhr.onprogress=null,this.xhr.onload=null)),this.emit("complete",this)},Resource.prototype.load=function(cb){switch(this.emit("start",this),cb&&this.once("complete",cb),this.crossOrigin!==!1&&"string"==typeof this.crossOrigin||(this.crossOrigin=this._determineCrossOrigin(this.url)),this.loadType){case Resource.LOAD_TYPE.IMAGE:this._loadImage();break;case Resource.LOAD_TYPE.AUDIO:this._loadElement("audio");break;case Resource.LOAD_TYPE.VIDEO:this._loadElement("video");break;case Resource.LOAD_TYPE.XHR:default:useXdr&&this.crossOrigin?this._loadXdr():this._loadXhr()}},Resource.prototype._loadImage=function(){this.data=new Image,this.crossOrigin&&(this.data.crossOrigin=this.crossOrigin),this.data.src=this.url,this.isImage=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1)},Resource.prototype._loadElement=function(type){if("audio"===type&&"undefined"!=typeof Audio?this.data=new Audio:this.data=document.createElement(type),null===this.data)return this.error=new Error("Unsupported element "+type),void this.complete();if(navigator.isCocoonJS)this.data.src=Array.isArray(this.url)?this.url[0]:this.url;else if(Array.isArray(this.url))for(var i=0;i<this.url.length;++i)this.data.appendChild(this._createSource(type,this.url[i]));else this.data.appendChild(this._createSource(type,this.url));this["is"+type[0].toUpperCase()+type.substring(1)]=!0,this.data.addEventListener("error",this._boundOnError,!1),this.data.addEventListener("load",this._boundComplete,!1),this.data.addEventListener("progress",this._boundOnProgress,!1),this.data.addEventListener("canplaythrough",this._boundComplete,!1),this.data.load()},Resource.prototype._loadXhr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xhr=this.xhr=new XMLHttpRequest;xhr.open("GET",this.url,!0),this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON||this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT?xhr.responseType=Resource.XHR_RESPONSE_TYPE.TEXT:xhr.responseType=this.xhrType,xhr.addEventListener("error",this._boundXhrOnError,!1),xhr.addEventListener("abort",this._boundXhrOnAbort,!1),xhr.addEventListener("progress",this._boundOnProgress,!1),xhr.addEventListener("load",this._boundXhrOnLoad,!1),xhr.send()},Resource.prototype._loadXdr=function(){"string"!=typeof this.xhrType&&(this.xhrType=this._determineXhrType());var xdr=this.xhr=new XDomainRequest;xdr.timeout=5e3,xdr.onerror=this._boundXhrOnError,xdr.ontimeout=this._boundXdrOnTimeout,xdr.onprogress=this._boundOnProgress,xdr.onload=this._boundXhrOnLoad,xdr.open("GET",this.url,!0),setTimeout(function(){xdr.send()},0)},Resource.prototype._createSource=function(type,url,mime){mime||(mime=type+"/"+url.substr(url.lastIndexOf(".")+1));var source=document.createElement("source");return source.src=url,source.type=mime,source},Resource.prototype._onError=function(event){this.error=new Error("Failed to load element using "+event.target.nodeName),this.complete()},Resource.prototype._onProgress=function(event){event&&event.lengthComputable&&this.emit("progress",this,event.loaded/event.total)},Resource.prototype._xhrOnError=function(){this.error=new Error(reqType(this.xhr)+" Request failed. Status: "+this.xhr.status+', text: "'+this.xhr.statusText+'"'),this.complete()},Resource.prototype._xhrOnAbort=function(){this.error=new Error(reqType(this.xhr)+" Request was aborted by the user."),this.complete()},Resource.prototype._xdrOnTimeout=function(){this.error=new Error(reqType(this.xhr)+" Request timed out."),this.complete()},Resource.prototype._xhrOnLoad=function(){var xhr=this.xhr,status=void 0!==xhr.status?xhr.status:200;if(200===status||204===status||0===status&&xhr.responseText.length>0)if(this.xhrType===Resource.XHR_RESPONSE_TYPE.TEXT)this.data=xhr.responseText;else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.JSON)try{this.data=JSON.parse(xhr.responseText),this.isJson=!0}catch(e){this.error=new Error("Error trying to parse loaded json:",e)}else if(this.xhrType===Resource.XHR_RESPONSE_TYPE.DOCUMENT)try{if(window.DOMParser){var domparser=new DOMParser;this.data=domparser.parseFromString(xhr.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=xhr.responseText,this.data=div}this.isXml=!0}catch(e){this.error=new Error("Error trying to parse loaded xml:",e)}else this.data=xhr.response||xhr.responseText;else this.error=new Error("["+xhr.status+"]"+xhr.statusText+":"+xhr.responseURL);this.complete()},Resource.prototype._determineCrossOrigin=function(url,loc){if(0===url.indexOf("data:"))return"";loc=loc||window.location,tempAnchor||(tempAnchor=document.createElement("a")),tempAnchor.href=url,url=_url.parse(tempAnchor.href);var samePort=!url.port&&""===loc.port||url.port===loc.port;return url.hostname===loc.hostname&&samePort&&url.protocol===loc.protocol?"":"anonymous"},Resource.prototype._determineXhrType=function(){return Resource._xhrTypeMap[this._getExtension()]||Resource.XHR_RESPONSE_TYPE.TEXT},Resource.prototype._determineLoadType=function(){return Resource._loadTypeMap[this._getExtension()]||Resource.LOAD_TYPE.XHR},Resource.prototype._getExtension=function(){var ext,url=this.url;if(this.isDataUrl){var slashIndex=url.indexOf("/");ext=url.substring(slashIndex+1,url.indexOf(";",slashIndex))}else{var queryStart=url.indexOf("?");queryStart!==-1&&(url=url.substring(0,queryStart)),ext=url.substring(url.lastIndexOf(".")+1)}return ext},Resource.prototype._getMimeFromXhrType=function(type){switch(type){case Resource.XHR_RESPONSE_TYPE.BUFFER:return"application/octet-binary";case Resource.XHR_RESPONSE_TYPE.BLOB:return"application/blob";case Resource.XHR_RESPONSE_TYPE.DOCUMENT:return"application/xml";case Resource.XHR_RESPONSE_TYPE.JSON:return"application/json";case Resource.XHR_RESPONSE_TYPE.DEFAULT:case Resource.XHR_RESPONSE_TYPE.TEXT:default:return"text/plain"}},Resource.LOAD_TYPE={XHR:1,IMAGE:2,AUDIO:3,VIDEO:4},Resource.XHR_READY_STATE={UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4},Resource.XHR_RESPONSE_TYPE={DEFAULT:"text",BUFFER:"arraybuffer",BLOB:"blob",DOCUMENT:"document",JSON:"json",TEXT:"text"},Resource._loadTypeMap={gif:Resource.LOAD_TYPE.IMAGE,png:Resource.LOAD_TYPE.IMAGE,bmp:Resource.LOAD_TYPE.IMAGE,jpg:Resource.LOAD_TYPE.IMAGE,jpeg:Resource.LOAD_TYPE.IMAGE,tif:Resource.LOAD_TYPE.IMAGE,tiff:Resource.LOAD_TYPE.IMAGE,webp:Resource.LOAD_TYPE.IMAGE,tga:Resource.LOAD_TYPE.IMAGE},Resource._xhrTypeMap={xhtml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,html:Resource.XHR_RESPONSE_TYPE.DOCUMENT,htm:Resource.XHR_RESPONSE_TYPE.DOCUMENT,xml:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tmx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,tsx:Resource.XHR_RESPONSE_TYPE.DOCUMENT,svg:Resource.XHR_RESPONSE_TYPE.DOCUMENT,gif:Resource.XHR_RESPONSE_TYPE.BLOB,png:Resource.XHR_RESPONSE_TYPE.BLOB,bmp:Resource.XHR_RESPONSE_TYPE.BLOB,jpg:Resource.XHR_RESPONSE_TYPE.BLOB,jpeg:Resource.XHR_RESPONSE_TYPE.BLOB,tif:Resource.XHR_RESPONSE_TYPE.BLOB,tiff:Resource.XHR_RESPONSE_TYPE.BLOB,webp:Resource.XHR_RESPONSE_TYPE.BLOB,tga:Resource.XHR_RESPONSE_TYPE.BLOB,json:Resource.XHR_RESPONSE_TYPE.JSON,text:Resource.XHR_RESPONSE_TYPE.TEXT,txt:Resource.XHR_RESPONSE_TYPE.TEXT},Resource.setExtensionLoadType=function(extname,loadType){setExtMap(Resource._loadTypeMap,extname,loadType)},Resource.setExtensionXhrType=function(extname,xhrType){setExtMap(Resource._xhrTypeMap,extname,xhrType)}},{eventemitter3:10,url:8}],15:[function(require,module,exports){module.exports={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encodeBinary:function(input){for(var bytebuffer,output="",encodedCharIndexes=new Array(4),inx=0,jnx=0,paddingBytes=0;inx<input.length;){for(bytebuffer=new Array(3),jnx=0;jnx<bytebuffer.length;jnx++)inx<input.length?bytebuffer[jnx]=255&input.charCodeAt(inx++):bytebuffer[jnx]=0;switch(encodedCharIndexes[0]=bytebuffer[0]>>2,encodedCharIndexes[1]=(3&bytebuffer[0])<<4|bytebuffer[1]>>4,encodedCharIndexes[2]=(15&bytebuffer[1])<<2|bytebuffer[2]>>6,encodedCharIndexes[3]=63&bytebuffer[2],paddingBytes=inx-(input.length-1)){case 2:encodedCharIndexes[3]=64,encodedCharIndexes[2]=64;break;case 1:encodedCharIndexes[3]=64}for(jnx=0;jnx<encodedCharIndexes.length;jnx++)output+=this._keyStr.charAt(encodedCharIndexes[jnx])}return output}}},{}],16:[function(require,module,exports){module.exports=require("./Loader"),module.exports.Resource=require("./Resource"),module.exports.middleware={caching:{memory:require("./middlewares/caching/memory")},parsing:{blob:require("./middlewares/parsing/blob")}}},{"./Loader":13,"./Resource":14,"./middlewares/caching/memory":17,"./middlewares/parsing/blob":18}],17:[function(require,module,exports){var cache={};module.exports=function(){return function(resource,next){cache[resource.url]?(resource.data=cache[resource.url],resource.complete()):resource.once("complete",function(){cache[this.url]=this.data}),next()}}},{}],18:[function(require,module,exports){var Resource=require("../../Resource"),b64=require("../../b64");window.URL=window.URL||window.webkitURL,module.exports=function(){return function(resource,next){if(!resource.data)return next();if(resource.xhr&&resource.xhrType===Resource.XHR_RESPONSE_TYPE.BLOB)if(window.Blob&&"string"!=typeof resource.data){if(0===resource.data.type.indexOf("image")){var src=URL.createObjectURL(resource.data);resource.blob=resource.data,resource.data=new Image,resource.data.src=src,resource.isImage=!0,resource.data.onload=function(){URL.revokeObjectURL(src),resource.data.onload=null,next()}}}else{var type=resource.xhr.getResponseHeader("content-type");type&&0===type.indexOf("image")&&(resource.data=new Image,resource.data.src="data:"+type+";base64,"+b64.encodeBinary(resource.xhr.responseText),resource.isImage=!0,resource.data.onload=function(){resource.data.onload=null,next()})}else next()}}},{"../../Resource":14,"../../b64":15}],19:[function(require,module,exports){function AccessibilityManager(renderer){var div=document.createElement("div");div.style.width="100px",div.style.height="100px",div.style.position="absolute",div.style.top=0,div.style.left=0,div.style.zIndex=2,this.div=div,this.pool=[],this.renderId=0,this.debug=!1,this.renderer=renderer,this.children=[],this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),this.isActive=!1,window.addEventListener("keydown",this._onKeyDown,!1)}var core=require("../core");Object.assign(core.DisplayObject.prototype,require("./accessibleTarget")),AccessibilityManager.prototype.constructor=AccessibilityManager,module.exports=AccessibilityManager,AccessibilityManager.prototype.activate=function(){this.isActive||(this.isActive=!0,window.document.addEventListener("mousemove",this._onMouseMove,!0),window.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),this.renderer.view.parentNode.appendChild(this.div))},AccessibilityManager.prototype.deactivate=function(){this.isActive&&(this.isActive=!1,window.document.removeEventListener("mousemove",this._onMouseMove),window.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),this.div.parentNode.removeChild(this.div))},AccessibilityManager.prototype.updateAccessibleObjects=function(displayObject){if(displayObject.visible&&(displayObject.accessible&&displayObject.interactive&&(displayObject._accessibleActive||this.addChild(displayObject),displayObject.renderId=this.renderId),displayObject.interactiveChildren))for(var children=displayObject.children,i=children.length-1;i>=0;i--)this.updateAccessibleObjects(children[i])},AccessibilityManager.prototype.update=function(){this.updateAccessibleObjects(this.renderer._lastObjectRendered);var rect=this.renderer.view.getBoundingClientRect(),sx=rect.width/this.renderer.width,sy=rect.height/this.renderer.height,div=this.div;div.style.left=rect.left+"px",div.style.top=rect.top+"px",div.style.width=this.renderer.width+"px",div.style.height=this.renderer.height+"px";for(var i=0;i<this.children.length;i++){var child=this.children[i];if(child.renderId!==this.renderId)child._accessibleActive=!1,core.utils.removeItems(this.children,i,1),this.div.removeChild(child._accessibleDiv),this.pool.push(child._accessibleDiv),child._accessibleDiv=null,i--,0===this.children.length&&this.deactivate();else{div=child._accessibleDiv;var hitArea=child.hitArea,wt=child.worldTransform;child.hitArea?(div.style.left=(wt.tx+hitArea.x*wt.a)*sx+"px",div.style.top=(wt.ty+hitArea.y*wt.d)*sy+"px",div.style.width=hitArea.width*wt.a*sx+"px",div.style.height=hitArea.height*wt.d*sy+"px"):(hitArea=child.getBounds(),this.capHitArea(hitArea),div.style.left=hitArea.x*sx+"px",div.style.top=hitArea.y*sy+"px",div.style.width=hitArea.width*sx+"px",div.style.height=hitArea.height*sy+"px")}}this.renderId++},AccessibilityManager.prototype.capHitArea=function(hitArea){hitArea.x<0&&(hitArea.width+=hitArea.x,hitArea.x=0),hitArea.y<0&&(hitArea.height+=hitArea.y,hitArea.y=0),hitArea.x+hitArea.width>this.renderer.width&&(hitArea.width=this.renderer.width-hitArea.x),hitArea.y+hitArea.height>this.renderer.height&&(hitArea.height=this.renderer.height-hitArea.y)},AccessibilityManager.prototype.addChild=function(displayObject){var div=this.pool.pop();div||(div=document.createElement("button"),div.style.width="100px",div.style.height="100px",div.style.backgroundColor=this.debug?"rgba(255,0,0,0.5)":"transparent",div.style.position="absolute",div.style.zIndex=2,div.style.borderStyle="none",div.addEventListener("click",this._onClick.bind(this)),div.addEventListener("focus",this._onFocus.bind(this)),div.addEventListener("focusout",this._onFocusOut.bind(this))),div.title=displayObject.accessibleTitle||"displayObject "+this.tabIndex,displayObject._accessibleActive=!0,displayObject._accessibleDiv=div,div.displayObject=displayObject,this.children.push(displayObject),this.div.appendChild(displayObject._accessibleDiv),displayObject._accessibleDiv.tabIndex=displayObject.tabIndex},AccessibilityManager.prototype._onClick=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"click",interactionManager.eventData)},AccessibilityManager.prototype._onFocus=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseover",interactionManager.eventData)},AccessibilityManager.prototype._onFocusOut=function(e){var interactionManager=this.renderer.plugins.interaction;interactionManager.dispatchEvent(e.target.displayObject,"mouseout",interactionManager.eventData)},AccessibilityManager.prototype._onKeyDown=function(e){9===e.keyCode&&this.activate()},AccessibilityManager.prototype._onMouseMove=function(){this.deactivate()},AccessibilityManager.prototype.destroy=function(){this.div=null;for(var i=0;i<this.children.length;i++)this.children[i].div=null;window.document.removeEventListener("mousemove",this._onMouseMove),window.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null},core.WebGLRenderer.registerPlugin("accessibility",AccessibilityManager),core.CanvasRenderer.registerPlugin("accessibility",AccessibilityManager)},{"../core":29,"./accessibleTarget":20}],20:[function(require,module,exports){var accessibleTarget={accessible:!1,accessibleTitle:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:!1};module.exports=accessibleTarget},{}],21:[function(require,module,exports){module.exports={accessibleTarget:require("./accessibleTarget"),AccessibilityManager:require("./AccessibilityManager")}},{"./AccessibilityManager":19,"./accessibleTarget":20}],22:[function(require,module,exports){var CONST={VERSION:"3.0.10",PI_2:2*Math.PI,RAD_TO_DEG:180/Math.PI,DEG_TO_RAD:Math.PI/180,TARGET_FPMS:.06,RENDERER_TYPE:{UNKNOWN:0,WEBGL:1,CANVAS:2},BLEND_MODES:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},DRAW_MODES:{POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},SCALE_MODES:{DEFAULT:0,LINEAR:0,NEAREST:1},RETINA_PREFIX:/@(.+)x/,RESOLUTION:1,FILTER_RESOLUTION:1,DEFAULT_RENDER_OPTIONS:{view:null,resolution:1,antialias:!1,forceFXAA:!1,autoResize:!1,transparent:!1,backgroundColor:0,clearBeforeRender:!0,preserveDrawingBuffer:!1,roundPixels:!1},SHAPES:{POLY:0,RECT:1,CIRC:2,ELIP:3,RREC:4},SPRITE_BATCH_SIZE:2e3};module.exports=CONST},{}],23:[function(require,module,exports){
function Container(){DisplayObject.call(this),this.children=[]}var math=require("../math"),utils=require("../utils"),DisplayObject=require("./DisplayObject"),RenderTexture=require("../textures/RenderTexture"),_tempMatrix=new math.Matrix;Container.prototype=Object.create(DisplayObject.prototype),Container.prototype.constructor=Container,module.exports=Container,Object.defineProperties(Container.prototype,{width:{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(value){var width=this.getLocalBounds().width;0!==width?this.scale.x=value/width:this.scale.x=1,this._width=value}},height:{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(value){var height=this.getLocalBounds().height;0!==height?this.scale.y=value/height:this.scale.y=1,this._height=value}}}),Container.prototype.onChildrenChange=function(){},Container.prototype.addChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1)for(var i=0;i<argumentsLength;i++)this.addChild(arguments[i]);else child.parent&&child.parent.removeChild(child),child.parent=this,this.children.push(child),this.onChildrenChange(this.children.length-1),child.emit("added",this);return child},Container.prototype.addChildAt=function(child,index){if(index>=0&&index<=this.children.length)return child.parent&&child.parent.removeChild(child),child.parent=this,this.children.splice(index,0,child),this.onChildrenChange(index),child.emit("added",this),child;throw new Error(child+"addChildAt: The index "+index+" supplied is out of bounds "+this.children.length)},Container.prototype.swapChildren=function(child,child2){if(child!==child2){var index1=this.getChildIndex(child),index2=this.getChildIndex(child2);if(index1<0||index2<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be children of the caller.");this.children[index1]=child2,this.children[index2]=child,this.onChildrenChange(index1<index2?index1:index2)}},Container.prototype.getChildIndex=function(child){var index=this.children.indexOf(child);if(index===-1)throw new Error("The supplied DisplayObject must be a child of the caller");return index},Container.prototype.setChildIndex=function(child,index){if(index<0||index>=this.children.length)throw new Error("The supplied index is out of bounds");var currentIndex=this.getChildIndex(child);utils.removeItems(this.children,currentIndex,1),this.children.splice(index,0,child),this.onChildrenChange(index)},Container.prototype.getChildAt=function(index){if(index<0||index>=this.children.length)throw new Error("getChildAt: Supplied index "+index+" does not exist in the child list, or the supplied DisplayObject is not a child of the caller");return this.children[index]},Container.prototype.removeChild=function(child){var argumentsLength=arguments.length;if(argumentsLength>1)for(var i=0;i<argumentsLength;i++)this.removeChild(arguments[i]);else{var index=this.children.indexOf(child);if(index===-1)return;child.parent=null,utils.removeItems(this.children,index,1),this.onChildrenChange(index),child.emit("removed",this)}return child},Container.prototype.removeChildAt=function(index){var child=this.getChildAt(index);return child.parent=null,utils.removeItems(this.children,index,1),this.onChildrenChange(index),child.emit("removed",this),child},Container.prototype.removeChildren=function(beginIndex,endIndex){var removed,i,begin=beginIndex||0,end="number"==typeof endIndex?endIndex:this.children.length,range=end-begin;if(range>0&&range<=end){for(removed=this.children.splice(begin,range),i=0;i<removed.length;++i)removed[i].parent=null;for(this.onChildrenChange(beginIndex),i=0;i<removed.length;++i)removed[i].emit("removed",this);return removed}if(0===range&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},Container.prototype.generateTexture=function(renderer,resolution,scaleMode){var bounds=this.getLocalBounds(),renderTexture=new RenderTexture(renderer,0|bounds.width,0|bounds.height,scaleMode,resolution);return _tempMatrix.tx=-bounds.x,_tempMatrix.ty=-bounds.y,renderTexture.render(this,_tempMatrix),renderTexture},Container.prototype.updateTransform=function(){if(this.visible){this.displayObjectUpdateTransform();for(var i=0,j=this.children.length;i<j;++i)this.children[i].updateTransform()}},Container.prototype.containerUpdateTransform=Container.prototype.updateTransform,Container.prototype.getBounds=function(){if(!this._currentBounds){if(0===this.children.length)return math.Rectangle.EMPTY;for(var childBounds,childMaxX,childMaxY,minX=1/0,minY=1/0,maxX=-(1/0),maxY=-(1/0),childVisible=!1,i=0,j=this.children.length;i<j;++i){var child=this.children[i];child.visible&&(childVisible=!0,childBounds=this.children[i].getBounds(),minX=minX<childBounds.x?minX:childBounds.x,minY=minY<childBounds.y?minY:childBounds.y,childMaxX=childBounds.width+childBounds.x,childMaxY=childBounds.height+childBounds.y,maxX=maxX>childMaxX?maxX:childMaxX,maxY=maxY>childMaxY?maxY:childMaxY)}if(!childVisible)return math.Rectangle.EMPTY;var bounds=this._bounds;bounds.x=minX,bounds.y=minY,bounds.width=maxX-minX,bounds.height=maxY-minY,this._currentBounds=bounds}return this._currentBounds},Container.prototype.containerGetBounds=Container.prototype.getBounds,Container.prototype.getLocalBounds=function(){var matrixCache=this.worldTransform;this.worldTransform=math.Matrix.IDENTITY;for(var i=0,j=this.children.length;i<j;++i)this.children[i].updateTransform();return this.worldTransform=matrixCache,this._currentBounds=null,this.getBounds(math.Matrix.IDENTITY)},Container.prototype.renderWebGL=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.renderable){var i,j;if(this._mask||this._filters){for(renderer.currentRenderer.flush(),this._filters&&this._filters.length&&renderer.filterManager.pushFilter(this,this._filters),this._mask&&renderer.maskManager.pushMask(this,this._mask),renderer.currentRenderer.start(),this._renderWebGL(renderer),i=0,j=this.children.length;i<j;i++)this.children[i].renderWebGL(renderer);renderer.currentRenderer.flush(),this._mask&&renderer.maskManager.popMask(this,this._mask),this._filters&&renderer.filterManager.popFilter(),renderer.currentRenderer.start()}else for(this._renderWebGL(renderer),i=0,j=this.children.length;i<j;++i)this.children[i].renderWebGL(renderer)}},Container.prototype._renderWebGL=function(renderer){},Container.prototype._renderCanvas=function(renderer){},Container.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.alpha<=0)&&this.renderable){this._mask&&renderer.maskManager.pushMask(this._mask,renderer),this._renderCanvas(renderer);for(var i=0,j=this.children.length;i<j;++i)this.children[i].renderCanvas(renderer);this._mask&&renderer.maskManager.popMask(renderer)}},Container.prototype.destroy=function(destroyChildren){if(DisplayObject.prototype.destroy.call(this),destroyChildren)for(var i=0,j=this.children.length;i<j;++i)this.children[i].destroy(destroyChildren);this.removeChildren(),this.children=null}},{"../math":33,"../textures/RenderTexture":71,"../utils":77,"./DisplayObject":24}],24:[function(require,module,exports){function DisplayObject(){EventEmitter.call(this),this.position=new math.Point,this.scale=new math.Point(1,1),this.pivot=new math.Point(0,0),this.skew=new math.Point(0,0),this.rotation=0,this.alpha=1,this.visible=!0,this.renderable=!0,this.parent=null,this.worldAlpha=1,this.worldTransform=new math.Matrix,this.filterArea=null,this._sr=0,this._cr=1,this._bounds=new math.Rectangle(0,0,1,1),this._currentBounds=null,this._mask=null}var math=require("../math"),RenderTexture=require("../textures/RenderTexture"),EventEmitter=require("eventemitter3"),CONST=require("../const"),_tempMatrix=new math.Matrix,_tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1,children:[]};DisplayObject.prototype=Object.create(EventEmitter.prototype),DisplayObject.prototype.constructor=DisplayObject,module.exports=DisplayObject,Object.defineProperties(DisplayObject.prototype,{x:{get:function(){return this.position.x},set:function(value){this.position.x=value}},y:{get:function(){return this.position.y},set:function(value){this.position.y=value}},worldVisible:{get:function(){var item=this;do{if(!item.visible)return!1;item=item.parent}while(item);return!0}},mask:{get:function(){return this._mask},set:function(value){this._mask&&(this._mask.renderable=!0),this._mask=value,this._mask&&(this._mask.renderable=!1)}},filters:{get:function(){return this._filters&&this._filters.slice()},set:function(value){this._filters=value&&value.slice()}}}),DisplayObject.prototype.updateTransform=function(){var a,b,c,d,tx,ty,pt=this.parent.worldTransform,wt=this.worldTransform;this.skew.x||this.skew.y?(_tempMatrix.setTransform(this.position.x,this.position.y,this.pivot.x,this.pivot.y,this.scale.x,this.scale.y,this.rotation,this.skew.x,this.skew.y),wt.a=_tempMatrix.a*pt.a+_tempMatrix.b*pt.c,wt.b=_tempMatrix.a*pt.b+_tempMatrix.b*pt.d,wt.c=_tempMatrix.c*pt.a+_tempMatrix.d*pt.c,wt.d=_tempMatrix.c*pt.b+_tempMatrix.d*pt.d,wt.tx=_tempMatrix.tx*pt.a+_tempMatrix.ty*pt.c+pt.tx,wt.ty=_tempMatrix.tx*pt.b+_tempMatrix.ty*pt.d+pt.ty):this.rotation%CONST.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),a=this._cr*this.scale.x,b=this._sr*this.scale.x,c=-this._sr*this.scale.y,d=this._cr*this.scale.y,tx=this.position.x,ty=this.position.y,(this.pivot.x||this.pivot.y)&&(tx-=this.pivot.x*a+this.pivot.y*c,ty-=this.pivot.x*b+this.pivot.y*d),wt.a=a*pt.a+b*pt.c,wt.b=a*pt.b+b*pt.d,wt.c=c*pt.a+d*pt.c,wt.d=c*pt.b+d*pt.d,wt.tx=tx*pt.a+ty*pt.c+pt.tx,wt.ty=tx*pt.b+ty*pt.d+pt.ty):(a=this.scale.x,d=this.scale.y,tx=this.position.x-this.pivot.x*a,ty=this.position.y-this.pivot.y*d,wt.a=a*pt.a,wt.b=a*pt.b,wt.c=d*pt.c,wt.d=d*pt.d,wt.tx=tx*pt.a+ty*pt.c+pt.tx,wt.ty=tx*pt.b+ty*pt.d+pt.ty),this.worldAlpha=this.alpha*this.parent.worldAlpha,this._currentBounds=null},DisplayObject.prototype.displayObjectUpdateTransform=DisplayObject.prototype.updateTransform,DisplayObject.prototype.getBounds=function(matrix){return math.Rectangle.EMPTY},DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(math.Matrix.IDENTITY)},DisplayObject.prototype.toGlobal=function(position){return this.parent?this.displayObjectUpdateTransform():(this.parent=_tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.apply(position)},DisplayObject.prototype.toLocal=function(position,from,point){return from&&(position=from.toGlobal(position)),this.parent?this.displayObjectUpdateTransform():(this.parent=_tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null),this.worldTransform.applyInverse(position,point)},DisplayObject.prototype.renderWebGL=function(renderer){},DisplayObject.prototype.renderCanvas=function(renderer){},DisplayObject.prototype.generateTexture=function(renderer,scaleMode,resolution){var bounds=this.getLocalBounds(),renderTexture=new RenderTexture(renderer,0|bounds.width,0|bounds.height,scaleMode,resolution);return _tempMatrix.tx=-bounds.x,_tempMatrix.ty=-bounds.y,renderTexture.render(this,_tempMatrix),renderTexture},DisplayObject.prototype.setParent=function(container){if(!container||!container.addChild)throw new Error("setParent: Argument must be a Container");return container.addChild(this),container},DisplayObject.prototype.setTransform=function(x,y,scaleX,scaleY,rotation,skewX,skewY,pivotX,pivotY){return this.position.x=x||0,this.position.y=y||0,this.scale.x=scaleX?scaleX:1,this.scale.y=scaleY?scaleY:1,this.rotation=rotation||0,this.skew.x=skewX||0,this.skew.y=skewY||0,this.pivot.x=pivotX||0,this.pivot.y=pivotY||0,this},DisplayObject.prototype.destroy=function(){this.position=null,this.scale=null,this.pivot=null,this.skew=null,this.parent=null,this._bounds=null,this._currentBounds=null,this._mask=null,this.worldTransform=null,this.filterArea=null}},{"../const":22,"../math":33,"../textures/RenderTexture":71,eventemitter3:10}],25:[function(require,module,exports){function Graphics(){Container.call(this),this.fillAlpha=1,this.lineWidth=0,this.lineColor=0,this.graphicsData=[],this.tint=16777215,this._prevTint=16777215,this.blendMode=CONST.BLEND_MODES.NORMAL,this.currentPath=null,this._webGL={},this.isMask=!1,this.boundsPadding=0,this._localBounds=new math.Rectangle(0,0,1,1),this.dirty=!0,this.glDirty=!1,this.boundsDirty=!0,this.cachedSpriteDirty=!1}var Container=require("../display/Container"),Texture=require("../textures/Texture"),CanvasBuffer=require("../renderers/canvas/utils/CanvasBuffer"),CanvasGraphics=require("../renderers/canvas/utils/CanvasGraphics"),GraphicsData=require("./GraphicsData"),math=require("../math"),CONST=require("../const"),tempPoint=new math.Point;Graphics.prototype=Object.create(Container.prototype),Graphics.prototype.constructor=Graphics,module.exports=Graphics,Graphics.prototype.clone=function(){var clone=new Graphics;clone.renderable=this.renderable,clone.fillAlpha=this.fillAlpha,clone.lineWidth=this.lineWidth,clone.lineColor=this.lineColor,clone.tint=this.tint,clone.blendMode=this.blendMode,clone.isMask=this.isMask,clone.boundsPadding=this.boundsPadding,clone.dirty=!0,clone.glDirty=!0,clone.cachedSpriteDirty=this.cachedSpriteDirty;for(var i=0;i<this.graphicsData.length;++i)clone.graphicsData.push(this.graphicsData[i].clone());return clone.currentPath=clone.graphicsData[clone.graphicsData.length-1],clone.updateLocalBounds(),clone},Graphics.prototype.lineStyle=function(lineWidth,color,alpha){if(this.lineWidth=lineWidth||0,this.lineColor=color||0,this.lineAlpha=void 0===alpha?1:alpha,this.currentPath)if(this.currentPath.shape.points.length){var shape=new math.Polygon(this.currentPath.shape.points.slice(-2));shape.closed=!1,this.drawShape(shape)}else this.currentPath.lineWidth=this.lineWidth,this.currentPath.lineColor=this.lineColor,this.currentPath.lineAlpha=this.lineAlpha;return this},Graphics.prototype.moveTo=function(x,y){var shape=new math.Polygon([x,y]);return shape.closed=!1,this.drawShape(shape),this},Graphics.prototype.lineTo=function(x,y){return this.currentPath.shape.points.push(x,y),this.dirty=!0,this},Graphics.prototype.quadraticCurveTo=function(cpX,cpY,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);var xa,ya,n=20,points=this.currentPath.shape.points;0===points.length&&this.moveTo(0,0);for(var fromX=points[points.length-2],fromY=points[points.length-1],j=0,i=1;i<=n;++i)j=i/n,xa=fromX+(cpX-fromX)*j,ya=fromY+(cpY-fromY)*j,points.push(xa+(cpX+(toX-cpX)*j-xa)*j,ya+(cpY+(toY-cpY)*j-ya)*j);return this.dirty=this.boundsDirty=!0,this},Graphics.prototype.bezierCurveTo=function(cpX,cpY,cpX2,cpY2,toX,toY){this.currentPath?0===this.currentPath.shape.points.length&&(this.currentPath.shape.points=[0,0]):this.moveTo(0,0);for(var dt,dt2,dt3,t2,t3,n=20,points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1],j=0,i=1;i<=n;++i)j=i/n,dt=1-j,dt2=dt*dt,dt3=dt2*dt,t2=j*j,t3=t2*j,points.push(dt3*fromX+3*dt2*j*cpX+3*dt*t2*cpX2+t3*toX,dt3*fromY+3*dt2*j*cpY+3*dt*t2*cpY2+t3*toY);return this.dirty=this.boundsDirty=!0,this},Graphics.prototype.arcTo=function(x1,y1,x2,y2,radius){this.currentPath?0===this.currentPath.shape.points.length&&this.currentPath.shape.points.push(x1,y1):this.moveTo(x1,y1);var points=this.currentPath.shape.points,fromX=points[points.length-2],fromY=points[points.length-1],a1=fromY-y1,b1=fromX-x1,a2=y2-y1,b2=x2-x1,mm=Math.abs(a1*b2-b1*a2);if(mm<1e-8||0===radius)points[points.length-2]===x1&&points[points.length-1]===y1||points.push(x1,y1);else{var dd=a1*a1+b1*b1,cc=a2*a2+b2*b2,tt=a1*a2+b1*b2,k1=radius*Math.sqrt(dd)/mm,k2=radius*Math.sqrt(cc)/mm,j1=k1*tt/dd,j2=k2*tt/cc,cx=k1*b2+k2*b1,cy=k1*a2+k2*a1,px=b1*(k2+j1),py=a1*(k2+j1),qx=b2*(k1+j2),qy=a2*(k1+j2),startAngle=Math.atan2(py-cy,px-cx),endAngle=Math.atan2(qy-cy,qx-cx);this.arc(cx+x1,cy+y1,radius,startAngle,endAngle,b1*a2>b2*a1)}return this.dirty=this.boundsDirty=!0,this},Graphics.prototype.arc=function(cx,cy,radius,startAngle,endAngle,anticlockwise){if(anticlockwise=anticlockwise||!1,startAngle===endAngle)return this;!anticlockwise&&endAngle<=startAngle?endAngle+=2*Math.PI:anticlockwise&&startAngle<=endAngle&&(startAngle+=2*Math.PI);var sweep=anticlockwise?(startAngle-endAngle)*-1:endAngle-startAngle,segs=40*Math.ceil(Math.abs(sweep)/(2*Math.PI));if(0===sweep)return this;var startX=cx+Math.cos(startAngle)*radius,startY=cy+Math.sin(startAngle)*radius;this.currentPath?this.currentPath.shape.points.push(startX,startY):this.moveTo(startX,startY);for(var points=this.currentPath.shape.points,theta=sweep/(2*segs),theta2=2*theta,cTheta=Math.cos(theta),sTheta=Math.sin(theta),segMinus=segs-1,remainder=segMinus%1/segMinus,i=0;i<=segMinus;i++){var real=i+remainder*i,angle=theta+startAngle+theta2*real,c=Math.cos(angle),s=-Math.sin(angle);points.push((cTheta*c+sTheta*s)*radius+cx,(cTheta*-s+sTheta*c)*radius+cy)}return this.dirty=this.boundsDirty=!0,this},Graphics.prototype.beginFill=function(color,alpha){return this.filling=!0,this.fillColor=color||0,this.fillAlpha=void 0===alpha?1:alpha,this.currentPath&&this.currentPath.shape.points.length<=2&&(this.currentPath.fill=this.filling,this.currentPath.fillColor=this.fillColor,this.currentPath.fillAlpha=this.fillAlpha),this},Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this},Graphics.prototype.drawRect=function(x,y,width,height){return this.drawShape(new math.Rectangle(x,y,width,height)),this},Graphics.prototype.drawRoundedRect=function(x,y,width,height,radius){return this.drawShape(new math.RoundedRectangle(x,y,width,height,radius)),this},Graphics.prototype.drawCircle=function(x,y,radius){return this.drawShape(new math.Circle(x,y,radius)),this},Graphics.prototype.drawEllipse=function(x,y,width,height){return this.drawShape(new math.Ellipse(x,y,width,height)),this},Graphics.prototype.drawPolygon=function(path){var points=path,closed=!0;if(points instanceof math.Polygon&&(closed=points.closed,points=points.points),!Array.isArray(points)){points=new Array(arguments.length);for(var i=0;i<points.length;++i)points[i]=arguments[i]}var shape=new math.Polygon(points);return shape.closed=closed,this.drawShape(shape),this},Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this},Graphics.prototype.generateTexture=function(renderer,resolution,scaleMode){resolution=resolution||1;var bounds=this.getLocalBounds(),canvasBuffer=new CanvasBuffer(bounds.width*resolution,bounds.height*resolution),texture=Texture.fromCanvas(canvasBuffer.canvas,scaleMode);return texture.baseTexture.resolution=resolution,canvasBuffer.context.scale(resolution,resolution),canvasBuffer.context.translate(-bounds.x,-bounds.y),CanvasGraphics.renderGraphics(this,canvasBuffer.context),texture},Graphics.prototype._renderWebGL=function(renderer){this.glDirty&&(this.dirty=!0,this.glDirty=!1),renderer.setObjectRenderer(renderer.plugins.graphics),renderer.plugins.graphics.render(this)},Graphics.prototype._renderCanvas=function(renderer){if(this.isMask!==!0){this._prevTint!==this.tint&&(this.dirty=!0);var context=renderer.context,transform=this.worldTransform,compositeOperation=renderer.blendModes[this.blendMode];compositeOperation!==context.globalCompositeOperation&&(context.globalCompositeOperation=compositeOperation);var resolution=renderer.resolution;context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),CanvasGraphics.renderGraphics(this,context)}},Graphics.prototype.getBounds=function(matrix){if(!this._currentBounds){if(!this.renderable)return math.Rectangle.EMPTY;this.boundsDirty&&(this.updateLocalBounds(),this.glDirty=!0,this.cachedSpriteDirty=!0,this.boundsDirty=!1);var bounds=this._localBounds,w0=bounds.x,w1=bounds.width+bounds.x,h0=bounds.y,h1=bounds.height+bounds.y,worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty,maxX=x1,maxY=y1,minX=x1,minY=y1;minX=x2<minX?x2:minX,minX=x3<minX?x3:minX,minX=x4<minX?x4:minX,minY=y2<minY?y2:minY,minY=y3<minY?y3:minY,minY=y4<minY?y4:minY,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY,this._bounds.x=minX,this._bounds.width=maxX-minX,this._bounds.y=minY,this._bounds.height=maxY-minY,this._currentBounds=this._bounds}return this._currentBounds},Graphics.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);for(var graphicsData=this.graphicsData,i=0;i<graphicsData.length;i++){var data=graphicsData[i];if(data.fill&&data.shape&&data.shape.contains(tempPoint.x,tempPoint.y))return!0}return!1},Graphics.prototype.updateLocalBounds=function(){var minX=1/0,maxX=-(1/0),minY=1/0,maxY=-(1/0);if(this.graphicsData.length)for(var shape,points,x,y,w,h,i=0;i<this.graphicsData.length;i++){var data=this.graphicsData[i],type=data.type,lineWidth=data.lineWidth;if(shape=data.shape,type===CONST.SHAPES.RECT||type===CONST.SHAPES.RREC)x=shape.x-lineWidth/2,y=shape.y-lineWidth/2,w=shape.width+lineWidth,h=shape.height+lineWidth,minX=x<minX?x:minX,maxX=x+w>maxX?x+w:maxX,minY=y<minY?y:minY,maxY=y+h>maxY?y+h:maxY;else if(type===CONST.SHAPES.CIRC)x=shape.x,y=shape.y,w=shape.radius+lineWidth/2,h=shape.radius+lineWidth/2,minX=x-w<minX?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=y-h<minY?y-h:minY,maxY=y+h>maxY?y+h:maxY;else if(type===CONST.SHAPES.ELIP)x=shape.x,y=shape.y,w=shape.width+lineWidth/2,h=shape.height+lineWidth/2,minX=x-w<minX?x-w:minX,maxX=x+w>maxX?x+w:maxX,minY=y-h<minY?y-h:minY,maxY=y+h>maxY?y+h:maxY;else{points=shape.points;for(var j=0;j<points.length;j+=2)x=points[j],y=points[j+1],minX=x-lineWidth<minX?x-lineWidth:minX,maxX=x+lineWidth>maxX?x+lineWidth:maxX,minY=y-lineWidth<minY?y-lineWidth:minY,maxY=y+lineWidth>maxY?y+lineWidth:maxY}}else minX=0,maxX=0,minY=0,maxY=0;var padding=this.boundsPadding;this._localBounds.x=minX-padding,this._localBounds.width=maxX-minX+2*padding,this._localBounds.y=minY-padding,this._localBounds.height=maxY-minY+2*padding},Graphics.prototype.drawShape=function(shape){this.currentPath&&this.currentPath.shape.points.length<=2&&this.graphicsData.pop(),this.currentPath=null;var data=new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.filling,shape);return this.graphicsData.push(data),data.type===CONST.SHAPES.POLY&&(data.shape.closed=data.shape.closed||this.filling,this.currentPath=data),this.dirty=this.boundsDirty=!0,data},Graphics.prototype.destroy=function(){Container.prototype.destroy.apply(this,arguments);for(var i=0;i<this.graphicsData.length;++i)this.graphicsData[i].destroy();for(var id in this._webgl)for(var j=0;j<this._webgl[id].data.length;++j)this._webgl[id].data[j].destroy();this.graphicsData=null,this.currentPath=null,this._webgl=null,this._localBounds=null}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/canvas/utils/CanvasGraphics":46,"../textures/Texture":72,"./GraphicsData":26}],26:[function(require,module,exports){function GraphicsData(lineWidth,lineColor,lineAlpha,fillColor,fillAlpha,fill,shape){this.lineWidth=lineWidth,this.lineColor=lineColor,this.lineAlpha=lineAlpha,this._lineTint=lineColor,this.fillColor=fillColor,this.fillAlpha=fillAlpha,this._fillTint=fillColor,this.fill=fill,this.shape=shape,this.type=shape.type}GraphicsData.prototype.constructor=GraphicsData,module.exports=GraphicsData,GraphicsData.prototype.clone=function(){return new GraphicsData(this.lineWidth,this.lineColor,this.lineAlpha,this.fillColor,this.fillAlpha,this.fill,this.shape)},GraphicsData.prototype.destroy=function(){this.shape=null}},{}],27:[function(require,module,exports){function GraphicsRenderer(renderer){ObjectRenderer.call(this,renderer),this.graphicsDataPool=[],this.primitiveShader=null,this.complexPrimitiveShader=null,this.maximumSimplePolySize=200}var utils=require("../../utils"),math=require("../../math"),CONST=require("../../const"),ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),WebGLGraphicsData=require("./WebGLGraphicsData"),earcut=require("earcut");GraphicsRenderer.prototype=Object.create(ObjectRenderer.prototype),GraphicsRenderer.prototype.constructor=GraphicsRenderer,module.exports=GraphicsRenderer,WebGLRenderer.registerPlugin("graphics",GraphicsRenderer),GraphicsRenderer.prototype.onContextChange=function(){},GraphicsRenderer.prototype.destroy=function(){ObjectRenderer.prototype.destroy.call(this);for(var i=0;i<this.graphicsDataPool.length;++i)this.graphicsDataPool[i].destroy();this.graphicsDataPool=null},GraphicsRenderer.prototype.render=function(graphics){var webGLData,renderer=this.renderer,gl=renderer.gl,shader=renderer.shaderManager.plugins.primitiveShader;!graphics.dirty&&graphics._webGL[gl.id]||this.updateGraphics(graphics);var webGL=graphics._webGL[gl.id];renderer.blendModeManager.setBlendMode(graphics.blendMode);for(var i=0,n=webGL.data.length;i<n;i++)webGLData=webGL.data[i],1===webGL.data[i].mode?(renderer.stencilManager.pushStencil(graphics,webGLData),gl.uniform1f(renderer.shaderManager.complexPrimitiveShader.uniforms.alpha._location,graphics.worldAlpha*webGLData.alpha),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),renderer.stencilManager.popStencil(graphics,webGLData)):(shader=renderer.shaderManager.primitiveShader,renderer.shaderManager.setShader(shader),gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,!1,graphics.worldTransform.toArray(!0)),gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,!1,renderer.currentRenderTarget.projectionMatrix.toArray(!0)),gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint)),gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(shader.attributes.aColor,4,gl.FLOAT,!1,24,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0)),renderer.drawCount++},GraphicsRenderer.prototype.updateGraphics=function(graphics){var gl=this.renderer.gl,webGL=graphics._webGL[gl.id];webGL||(webGL=graphics._webGL[gl.id]={lastIndex:0,data:[],gl:gl}),graphics.dirty=!1;var i;if(graphics.clearDirty){for(graphics.clearDirty=!1,i=0;i<webGL.data.length;i++){var graphicsData=webGL.data[i];graphicsData.reset(),this.graphicsDataPool.push(graphicsData)}webGL.data=[],webGL.lastIndex=0}var webGLData;for(i=webGL.lastIndex;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i];if(data.type===CONST.SHAPES.POLY){if(data.points=data.shape.points.slice(),data.shape.closed&&(data.points[0]===data.points[data.points.length-2]&&data.points[1]===data.points[data.points.length-1]||data.points.push(data.points[0],data.points[1])),data.fill&&data.points.length>=6)if(data.points.length<2*this.maximumSimplePolySize){webGLData=this.switchMode(webGL,0);var canDrawUsingSimple=this.buildPoly(data,webGLData);canDrawUsingSimple||(webGLData=this.switchMode(webGL,1),this.buildComplexPoly(data,webGLData))}else webGLData=this.switchMode(webGL,1),this.buildComplexPoly(data,webGLData);data.lineWidth>0&&(webGLData=this.switchMode(webGL,0),this.buildLine(data,webGLData))}else webGLData=this.switchMode(webGL,0),data.type===CONST.SHAPES.RECT?this.buildRectangle(data,webGLData):data.type===CONST.SHAPES.CIRC||data.type===CONST.SHAPES.ELIP?this.buildCircle(data,webGLData):data.type===CONST.SHAPES.RREC&&this.buildRoundedRectangle(data,webGLData);webGL.lastIndex++}for(i=0;i<webGL.data.length;i++)webGLData=webGL.data[i],webGLData.dirty&&webGLData.upload()},GraphicsRenderer.prototype.switchMode=function(webGL,type){var webGLData;return webGL.data.length?(webGLData=webGL.data[webGL.data.length-1],(webGLData.points.length>32e4||webGLData.mode!==type||1===type)&&(webGLData=this.graphicsDataPool.pop()||new WebGLGraphicsData(webGL.gl),webGLData.mode=type,webGL.data.push(webGLData))):(webGLData=this.graphicsDataPool.pop()||new WebGLGraphicsData(webGL.gl),webGLData.mode=type,webGL.data.push(webGLData)),webGLData.dirty=!0,webGLData},GraphicsRenderer.prototype.buildRectangle=function(graphicsData,webGLData){var rectData=graphicsData.shape,x=rectData.x,y=rectData.y,width=rectData.width,height=rectData.height;if(graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vertPos=verts.length/6;verts.push(x,y),verts.push(r,g,b,alpha),verts.push(x+width,y),verts.push(r,g,b,alpha),verts.push(x,y+height),verts.push(r,g,b,alpha),verts.push(x+width,y+height),verts.push(r,g,b,alpha),indices.push(vertPos,vertPos,vertPos+1,vertPos+2,vertPos+3,vertPos+3)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=[x,y,x+width,y,x+width,y+height,x,y+height,x,y],this.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},GraphicsRenderer.prototype.buildRoundedRectangle=function(graphicsData,webGLData){var rrectData=graphicsData.shape,x=rrectData.x,y=rrectData.y,width=rrectData.width,height=rrectData.height,radius=rrectData.radius,recPoints=[];if(recPoints.push(x,y+radius),this.quadraticBezierCurve(x,y+height-radius,x,y+height,x+radius,y+height,recPoints),this.quadraticBezierCurve(x+width-radius,y+height,x+width,y+height,x+width,y+height-radius,recPoints),this.quadraticBezierCurve(x+width,y+radius,x+width,y,x+width-radius,y,recPoints),this.quadraticBezierCurve(x+radius,y,x,y,x,y+radius+1e-10,recPoints),graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6,triangles=earcut(recPoints,null,2),i=0;for(i=0;i<triangles.length;i+=3)indices.push(triangles[i]+vecPos),indices.push(triangles[i]+vecPos),indices.push(triangles[i+1]+vecPos),indices.push(triangles[i+2]+vecPos),indices.push(triangles[i+2]+vecPos);for(i=0;i<recPoints.length;i++)verts.push(recPoints[i],recPoints[++i],r,g,b,alpha)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;graphicsData.points=recPoints,this.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},GraphicsRenderer.prototype.quadraticBezierCurve=function(fromX,fromY,cpX,cpY,toX,toY,out){function getPt(n1,n2,perc){var diff=n2-n1;return n1+diff*perc}for(var xa,ya,xb,yb,x,y,n=20,points=out||[],j=0,i=0;i<=n;i++)j=i/n,xa=getPt(fromX,cpX,j),ya=getPt(fromY,cpY,j),xb=getPt(cpX,toX,j),yb=getPt(cpY,toY,j),x=getPt(xa,xb,j),y=getPt(ya,yb,j),points.push(x,y);return points},GraphicsRenderer.prototype.buildCircle=function(graphicsData,webGLData){var width,height,circleData=graphicsData.shape,x=circleData.x,y=circleData.y;graphicsData.type===CONST.SHAPES.CIRC?(width=circleData.radius,height=circleData.radius):(width=circleData.width,height=circleData.height);var totalSegs=Math.floor(30*Math.sqrt(circleData.radius))||Math.floor(15*Math.sqrt(circleData.width+circleData.height)),seg=2*Math.PI/totalSegs,i=0;if(graphicsData.fill){var color=utils.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,verts=webGLData.points,indices=webGLData.indices,vecPos=verts.length/6;for(indices.push(vecPos),i=0;i<totalSegs+1;i++)verts.push(x,y,r,g,b,alpha),verts.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height,r,g,b,alpha),indices.push(vecPos++,vecPos++);
indices.push(vecPos-1)}if(graphicsData.lineWidth){var tempPoints=graphicsData.points;for(graphicsData.points=[],i=0;i<totalSegs+1;i++)graphicsData.points.push(x+Math.sin(seg*i)*width,y+Math.cos(seg*i)*height);this.buildLine(graphicsData,webGLData),graphicsData.points=tempPoints}},GraphicsRenderer.prototype.buildLine=function(graphicsData,webGLData){var i=0,points=graphicsData.points;if(0!==points.length){var firstPoint=new math.Point(points[0],points[1]),lastPoint=new math.Point(points[points.length-2],points[points.length-1]);if(firstPoint.x===lastPoint.x&&firstPoint.y===lastPoint.y){points=points.slice(),points.pop(),points.pop(),lastPoint=new math.Point(points[points.length-2],points[points.length-1]);var midPointX=lastPoint.x+.5*(firstPoint.x-lastPoint.x),midPointY=lastPoint.y+.5*(firstPoint.y-lastPoint.y);points.unshift(midPointX,midPointY),points.push(midPointX,midPointY)}var px,py,p1x,p1y,p2x,p2y,p3x,p3y,perpx,perpy,perp2x,perp2y,perp3x,perp3y,a1,b1,c1,a2,b2,c2,denom,pdist,dist,verts=webGLData.points,indices=webGLData.indices,length=points.length/2,indexCount=points.length,indexStart=verts.length/6,width=graphicsData.lineWidth/2,color=utils.hex2rgb(graphicsData.lineColor),alpha=graphicsData.lineAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha;for(p1x=points[0],p1y=points[1],p2x=points[2],p2y=points[3],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p1x-perpx,p1y-perpy,r,g,b,alpha),verts.push(p1x+perpx,p1y+perpy,r,g,b,alpha),i=1;i<length-1;i++)p1x=points[2*(i-1)],p1y=points[2*(i-1)+1],p2x=points[2*i],p2y=points[2*i+1],p3x=points[2*(i+1)],p3y=points[2*(i+1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,perp2x=-(p2y-p3y),perp2y=p2x-p3x,dist=Math.sqrt(perp2x*perp2x+perp2y*perp2y),perp2x/=dist,perp2y/=dist,perp2x*=width,perp2y*=width,a1=-perpy+p1y-(-perpy+p2y),b1=-perpx+p2x-(-perpx+p1x),c1=(-perpx+p1x)*(-perpy+p2y)-(-perpx+p2x)*(-perpy+p1y),a2=-perp2y+p3y-(-perp2y+p2y),b2=-perp2x+p2x-(-perp2x+p3x),c2=(-perp2x+p3x)*(-perp2y+p2y)-(-perp2x+p2x)*(-perp2y+p3y),denom=a1*b2-a2*b1,Math.abs(denom)<.1?(denom+=10.1,verts.push(p2x-perpx,p2y-perpy,r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy,r,g,b,alpha)):(px=(b1*c2-b2*c1)/denom,py=(a2*c1-a1*c2)/denom,pdist=(px-p2x)*(px-p2x)+(py-p2y)*(py-p2y),pdist>19600?(perp3x=perpx-perp2x,perp3y=perpy-perp2y,dist=Math.sqrt(perp3x*perp3x+perp3y*perp3y),perp3x/=dist,perp3y/=dist,perp3x*=width,perp3y*=width,verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),verts.push(p2x+perp3x,p2y+perp3y),verts.push(r,g,b,alpha),verts.push(p2x-perp3x,p2y-perp3y),verts.push(r,g,b,alpha),indexCount++):(verts.push(px,py),verts.push(r,g,b,alpha),verts.push(p2x-(px-p2x),p2y-(py-p2y)),verts.push(r,g,b,alpha)));for(p1x=points[2*(length-2)],p1y=points[2*(length-2)+1],p2x=points[2*(length-1)],p2y=points[2*(length-1)+1],perpx=-(p1y-p2y),perpy=p1x-p2x,dist=Math.sqrt(perpx*perpx+perpy*perpy),perpx/=dist,perpy/=dist,perpx*=width,perpy*=width,verts.push(p2x-perpx,p2y-perpy),verts.push(r,g,b,alpha),verts.push(p2x+perpx,p2y+perpy),verts.push(r,g,b,alpha),indices.push(indexStart),i=0;i<indexCount;i++)indices.push(indexStart++);indices.push(indexStart-1)}},GraphicsRenderer.prototype.buildComplexPoly=function(graphicsData,webGLData){var points=graphicsData.points.slice();if(!(points.length<6)){var indices=webGLData.indices;webGLData.points=points,webGLData.alpha=graphicsData.fillAlpha,webGLData.color=utils.hex2rgb(graphicsData.fillColor);for(var x,y,minX=1/0,maxX=-(1/0),minY=1/0,maxY=-(1/0),i=0;i<points.length;i+=2)x=points[i],y=points[i+1],minX=x<minX?x:minX,maxX=x>maxX?x:maxX,minY=y<minY?y:minY,maxY=y>maxY?y:maxY;points.push(minX,minY,maxX,minY,maxX,maxY,minX,maxY);var length=points.length/2;for(i=0;i<length;i++)indices.push(i)}},GraphicsRenderer.prototype.buildPoly=function(graphicsData,webGLData){var points=graphicsData.points;if(!(points.length<6)){var verts=webGLData.points,indices=webGLData.indices,length=points.length/2,color=utils.hex2rgb(graphicsData.fillColor),alpha=graphicsData.fillAlpha,r=color[0]*alpha,g=color[1]*alpha,b=color[2]*alpha,triangles=earcut(points,null,2);if(!triangles)return!1;var vertPos=verts.length/6,i=0;for(i=0;i<triangles.length;i+=3)indices.push(triangles[i]+vertPos),indices.push(triangles[i]+vertPos),indices.push(triangles[i+1]+vertPos),indices.push(triangles[i+2]+vertPos),indices.push(triangles[i+2]+vertPos);for(i=0;i<length;i++)verts.push(points[2*i],points[2*i+1],r,g,b,alpha);return!0}}},{"../../const":22,"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"../../utils":77,"./WebGLGraphicsData":28,earcut:9}],28:[function(require,module,exports){function WebGLGraphicsData(gl){this.gl=gl,this.color=[0,0,0],this.points=[],this.indices=[],this.buffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),this.mode=1,this.alpha=1,this.dirty=!0,this.glPoints=null,this.glIndices=null}WebGLGraphicsData.prototype.constructor=WebGLGraphicsData,module.exports=WebGLGraphicsData,WebGLGraphicsData.prototype.reset=function(){this.points.length=0,this.indices.length=0},WebGLGraphicsData.prototype.upload=function(){var gl=this.gl;this.glPoints=new Float32Array(this.points),gl.bindBuffer(gl.ARRAY_BUFFER,this.buffer),gl.bufferData(gl.ARRAY_BUFFER,this.glPoints,gl.STATIC_DRAW),this.glIndices=new Uint16Array(this.indices),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.glIndices,gl.STATIC_DRAW),this.dirty=!1},WebGLGraphicsData.prototype.destroy=function(){this.color=null,this.points=null,this.indices=null,this.gl.deleteBuffer(this.buffer),this.gl.deleteBuffer(this.indexBuffer),this.gl=null,this.buffer=null,this.indexBuffer=null,this.glPoints=null,this.glIndices=null}},{}],29:[function(require,module,exports){var core=module.exports=Object.assign(require("./const"),require("./math"),{utils:require("./utils"),ticker:require("./ticker"),DisplayObject:require("./display/DisplayObject"),Container:require("./display/Container"),Sprite:require("./sprites/Sprite"),ParticleContainer:require("./particles/ParticleContainer"),SpriteRenderer:require("./sprites/webgl/SpriteRenderer"),ParticleRenderer:require("./particles/webgl/ParticleRenderer"),Text:require("./text/Text"),Graphics:require("./graphics/Graphics"),GraphicsData:require("./graphics/GraphicsData"),GraphicsRenderer:require("./graphics/webgl/GraphicsRenderer"),Texture:require("./textures/Texture"),BaseTexture:require("./textures/BaseTexture"),RenderTexture:require("./textures/RenderTexture"),VideoBaseTexture:require("./textures/VideoBaseTexture"),TextureUvs:require("./textures/TextureUvs"),CanvasRenderer:require("./renderers/canvas/CanvasRenderer"),CanvasGraphics:require("./renderers/canvas/utils/CanvasGraphics"),CanvasBuffer:require("./renderers/canvas/utils/CanvasBuffer"),WebGLRenderer:require("./renderers/webgl/WebGLRenderer"),WebGLManager:require("./renderers/webgl/managers/WebGLManager"),ShaderManager:require("./renderers/webgl/managers/ShaderManager"),Shader:require("./renderers/webgl/shaders/Shader"),TextureShader:require("./renderers/webgl/shaders/TextureShader"),PrimitiveShader:require("./renderers/webgl/shaders/PrimitiveShader"),ComplexPrimitiveShader:require("./renderers/webgl/shaders/ComplexPrimitiveShader"),ObjectRenderer:require("./renderers/webgl/utils/ObjectRenderer"),RenderTarget:require("./renderers/webgl/utils/RenderTarget"),AbstractFilter:require("./renderers/webgl/filters/AbstractFilter"),FXAAFilter:require("./renderers/webgl/filters/FXAAFilter"),SpriteMaskFilter:require("./renderers/webgl/filters/SpriteMaskFilter"),autoDetectRenderer:function(width,height,options,noWebGL){return width=width||800,height=height||600,!noWebGL&&core.utils.isWebGLSupported()?new core.WebGLRenderer(width,height,options):new core.CanvasRenderer(width,height,options)}})},{"./const":22,"./display/Container":23,"./display/DisplayObject":24,"./graphics/Graphics":25,"./graphics/GraphicsData":26,"./graphics/webgl/GraphicsRenderer":27,"./math":33,"./particles/ParticleContainer":39,"./particles/webgl/ParticleRenderer":41,"./renderers/canvas/CanvasRenderer":44,"./renderers/canvas/utils/CanvasBuffer":45,"./renderers/canvas/utils/CanvasGraphics":46,"./renderers/webgl/WebGLRenderer":49,"./renderers/webgl/filters/AbstractFilter":50,"./renderers/webgl/filters/FXAAFilter":51,"./renderers/webgl/filters/SpriteMaskFilter":52,"./renderers/webgl/managers/ShaderManager":56,"./renderers/webgl/managers/WebGLManager":58,"./renderers/webgl/shaders/ComplexPrimitiveShader":59,"./renderers/webgl/shaders/PrimitiveShader":60,"./renderers/webgl/shaders/Shader":61,"./renderers/webgl/shaders/TextureShader":62,"./renderers/webgl/utils/ObjectRenderer":63,"./renderers/webgl/utils/RenderTarget":65,"./sprites/Sprite":67,"./sprites/webgl/SpriteRenderer":68,"./text/Text":69,"./textures/BaseTexture":70,"./textures/RenderTexture":71,"./textures/Texture":72,"./textures/TextureUvs":73,"./textures/VideoBaseTexture":74,"./ticker":76,"./utils":77}],30:[function(require,module,exports){function signum(x){return x<0?-1:x>0?1:0}function init(){for(var i=0;i<16;i++){var row=[];mul.push(row);for(var j=0;j<16;j++)for(var _ux=signum(ux[i]*ux[j]+vx[i]*uy[j]),_uy=signum(uy[i]*ux[j]+vy[i]*uy[j]),_vx=signum(ux[i]*vx[j]+vx[i]*vy[j]),_vy=signum(uy[i]*vx[j]+vy[i]*vy[j]),k=0;k<16;k++)if(ux[k]===_ux&&uy[k]===_uy&&vx[k]===_vx&&vy[k]===_vy){row.push(k);break}}for(i=0;i<16;i++){var mat=new Matrix;mat.set(ux[i],uy[i],vx[i],vy[i],0,0),tempMatrices.push(mat)}}var ux=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],uy=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],vx=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],vy=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],tempMatrices=[],Matrix=require("./Matrix"),mul=[];init();var GroupD8={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MIRROR_HORIZONTAL:12,uX:function(ind){return ux[ind]},uY:function(ind){return uy[ind]},vX:function(ind){return vx[ind]},vY:function(ind){return vy[ind]},inv:function(rotation){return 8&rotation?15&rotation:7&-rotation},add:function(rotationSecond,rotationFirst){return mul[rotationSecond][rotationFirst]},sub:function(rotationSecond,rotationFirst){return mul[rotationSecond][GroupD8.inv(rotationFirst)]},rotate180:function(rotation){return 4^rotation},isSwapWidthHeight:function(rotation){return 2===(3&rotation)},byDirection:function(dx,dy){return 2*Math.abs(dx)<=Math.abs(dy)?dy>=0?GroupD8.S:GroupD8.N:2*Math.abs(dy)<=Math.abs(dx)?dx>0?GroupD8.E:GroupD8.W:dy>0?dx>0?GroupD8.SE:GroupD8.SW:dx>0?GroupD8.NE:GroupD8.NW},matrixAppendRotationInv:function(matrix,rotation,tx,ty){var mat=tempMatrices[GroupD8.inv(rotation)];tx=tx||0,ty=ty||0,mat.tx=tx,mat.ty=ty,matrix.append(mat)}};module.exports=GroupD8},{"./Matrix":31}],31:[function(require,module,exports){function Matrix(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}var Point=require("./Point");Matrix.prototype.constructor=Matrix,module.exports=Matrix,Matrix.prototype.fromArray=function(array){this.a=array[0],this.b=array[1],this.c=array[3],this.d=array[4],this.tx=array[2],this.ty=array[5]},Matrix.prototype.set=function(a,b,c,d,tx,ty){return this.a=a,this.b=b,this.c=c,this.d=d,this.tx=tx,this.ty=ty,this},Matrix.prototype.toArray=function(transpose,out){this.array||(this.array=new Float32Array(9));var array=out||this.array;return transpose?(array[0]=this.a,array[1]=this.b,array[2]=0,array[3]=this.c,array[4]=this.d,array[5]=0,array[6]=this.tx,array[7]=this.ty,array[8]=1):(array[0]=this.a,array[1]=this.c,array[2]=this.tx,array[3]=this.b,array[4]=this.d,array[5]=this.ty,array[6]=0,array[7]=0,array[8]=1),array},Matrix.prototype.apply=function(pos,newPos){newPos=newPos||new Point;var x=pos.x,y=pos.y;return newPos.x=this.a*x+this.c*y+this.tx,newPos.y=this.b*x+this.d*y+this.ty,newPos},Matrix.prototype.applyInverse=function(pos,newPos){newPos=newPos||new Point;var id=1/(this.a*this.d+this.c*-this.b),x=pos.x,y=pos.y;return newPos.x=this.d*id*x+-this.c*id*y+(this.ty*this.c-this.tx*this.d)*id,newPos.y=this.a*id*y+-this.b*id*x+(-this.ty*this.a+this.tx*this.b)*id,newPos},Matrix.prototype.translate=function(x,y){return this.tx+=x,this.ty+=y,this},Matrix.prototype.scale=function(x,y){return this.a*=x,this.d*=y,this.c*=x,this.b*=y,this.tx*=x,this.ty*=y,this},Matrix.prototype.rotate=function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),a1=this.a,c1=this.c,tx1=this.tx;return this.a=a1*cos-this.b*sin,this.b=a1*sin+this.b*cos,this.c=c1*cos-this.d*sin,this.d=c1*sin+this.d*cos,this.tx=tx1*cos-this.ty*sin,this.ty=tx1*sin+this.ty*cos,this},Matrix.prototype.append=function(matrix){var a1=this.a,b1=this.b,c1=this.c,d1=this.d;return this.a=matrix.a*a1+matrix.b*c1,this.b=matrix.a*b1+matrix.b*d1,this.c=matrix.c*a1+matrix.d*c1,this.d=matrix.c*b1+matrix.d*d1,this.tx=matrix.tx*a1+matrix.ty*c1+this.tx,this.ty=matrix.tx*b1+matrix.ty*d1+this.ty,this},Matrix.prototype.setTransform=function(x,y,pivotX,pivotY,scaleX,scaleY,rotation,skewX,skewY){var a,b,c,d,sr,cr,cy,sy,nsx,cx;return sr=Math.sin(rotation),cr=Math.cos(rotation),cy=Math.cos(skewY),sy=Math.sin(skewY),nsx=-Math.sin(skewX),cx=Math.cos(skewX),a=cr*scaleX,b=sr*scaleX,c=-sr*scaleY,d=cr*scaleY,this.a=cy*a+sy*c,this.b=cy*b+sy*d,this.c=nsx*a+cx*c,this.d=nsx*b+cx*d,this.tx=x+(pivotX*a+pivotY*c),this.ty=y+(pivotX*b+pivotY*d),this},Matrix.prototype.prepend=function(matrix){var tx1=this.tx;if(1!==matrix.a||0!==matrix.b||0!==matrix.c||1!==matrix.d){var a1=this.a,c1=this.c;this.a=a1*matrix.a+this.b*matrix.c,this.b=a1*matrix.b+this.b*matrix.d,this.c=c1*matrix.a+this.d*matrix.c,this.d=c1*matrix.b+this.d*matrix.d}return this.tx=tx1*matrix.a+this.ty*matrix.c+matrix.tx,this.ty=tx1*matrix.b+this.ty*matrix.d+matrix.ty,this},Matrix.prototype.invert=function(){var a1=this.a,b1=this.b,c1=this.c,d1=this.d,tx1=this.tx,n=a1*d1-b1*c1;return this.a=d1/n,this.b=-b1/n,this.c=-c1/n,this.d=a1/n,this.tx=(c1*this.ty-d1*tx1)/n,this.ty=-(a1*this.ty-b1*tx1)/n,this},Matrix.prototype.identity=function(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this},Matrix.prototype.clone=function(){var matrix=new Matrix;return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.prototype.copy=function(matrix){return matrix.a=this.a,matrix.b=this.b,matrix.c=this.c,matrix.d=this.d,matrix.tx=this.tx,matrix.ty=this.ty,matrix},Matrix.IDENTITY=new Matrix,Matrix.TEMP_MATRIX=new Matrix},{"./Point":32}],32:[function(require,module,exports){function Point(x,y){this.x=x||0,this.y=y||0}Point.prototype.constructor=Point,module.exports=Point,Point.prototype.clone=function(){return new Point(this.x,this.y)},Point.prototype.copy=function(p){this.set(p.x,p.y)},Point.prototype.equals=function(p){return p.x===this.x&&p.y===this.y},Point.prototype.set=function(x,y){this.x=x||0,this.y=y||(0!==y?this.x:0)}},{}],33:[function(require,module,exports){module.exports={Point:require("./Point"),Matrix:require("./Matrix"),GroupD8:require("./GroupD8"),Circle:require("./shapes/Circle"),Ellipse:require("./shapes/Ellipse"),Polygon:require("./shapes/Polygon"),Rectangle:require("./shapes/Rectangle"),RoundedRectangle:require("./shapes/RoundedRectangle")}},{"./GroupD8":30,"./Matrix":31,"./Point":32,"./shapes/Circle":34,"./shapes/Ellipse":35,"./shapes/Polygon":36,"./shapes/Rectangle":37,"./shapes/RoundedRectangle":38}],34:[function(require,module,exports){function Circle(x,y,radius){this.x=x||0,this.y=y||0,this.radius=radius||0,this.type=CONST.SHAPES.CIRC}var Rectangle=require("./Rectangle"),CONST=require("../../const");Circle.prototype.constructor=Circle,module.exports=Circle,Circle.prototype.clone=function(){return new Circle(this.x,this.y,this.radius)},Circle.prototype.contains=function(x,y){if(this.radius<=0)return!1;var dx=this.x-x,dy=this.y-y,r2=this.radius*this.radius;return dx*=dx,dy*=dy,dx+dy<=r2},Circle.prototype.getBounds=function(){return new Rectangle(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}},{"../../const":22,"./Rectangle":37}],35:[function(require,module,exports){function Ellipse(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0,this.type=CONST.SHAPES.ELIP}var Rectangle=require("./Rectangle"),CONST=require("../../const");Ellipse.prototype.constructor=Ellipse,module.exports=Ellipse,Ellipse.prototype.clone=function(){return new Ellipse(this.x,this.y,this.width,this.height)},Ellipse.prototype.contains=function(x,y){if(this.width<=0||this.height<=0)return!1;var normx=(x-this.x)/this.width,normy=(y-this.y)/this.height;return normx*=normx,normy*=normy,normx+normy<=1},Ellipse.prototype.getBounds=function(){return new Rectangle(this.x-this.width,this.y-this.height,this.width,this.height)}},{"../../const":22,"./Rectangle":37}],36:[function(require,module,exports){function Polygon(points_){var points=points_;if(!Array.isArray(points)){points=new Array(arguments.length);for(var a=0;a<points.length;++a)points[a]=arguments[a]}if(points[0]instanceof Point){for(var p=[],i=0,il=points.length;i<il;i++)p.push(points[i].x,points[i].y);points=p}this.closed=!0,this.points=points,this.type=CONST.SHAPES.POLY}var Point=require("../Point"),CONST=require("../../const");Polygon.prototype.constructor=Polygon,module.exports=Polygon,Polygon.prototype.clone=function(){return new Polygon(this.points.slice())},Polygon.prototype.contains=function(x,y){for(var inside=!1,length=this.points.length/2,i=0,j=length-1;i<length;j=i++){var xi=this.points[2*i],yi=this.points[2*i+1],xj=this.points[2*j],yj=this.points[2*j+1],intersect=yi>y!=yj>y&&x<(xj-xi)*(y-yi)/(yj-yi)+xi;intersect&&(inside=!inside)}return inside}},{"../../const":22,"../Point":32}],37:[function(require,module,exports){function Rectangle(x,y,width,height){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0,this.type=CONST.SHAPES.RECT}var CONST=require("../../const");Rectangle.prototype.constructor=Rectangle,module.exports=Rectangle,Rectangle.EMPTY=new Rectangle(0,0,0,0),Rectangle.prototype.clone=function(){return new Rectangle(this.x,this.y,this.width,this.height)},Rectangle.prototype.contains=function(x,y){return!(this.width<=0||this.height<=0)&&(x>=this.x&&x<this.x+this.width&&y>=this.y&&y<this.y+this.height)}},{"../../const":22}],38:[function(require,module,exports){function RoundedRectangle(x,y,width,height,radius){this.x=x||0,this.y=y||0,this.width=width||0,this.height=height||0,this.radius=radius||20,this.type=CONST.SHAPES.RREC}var CONST=require("../../const");RoundedRectangle.prototype.constructor=RoundedRectangle,module.exports=RoundedRectangle,RoundedRectangle.prototype.clone=function(){return new RoundedRectangle(this.x,this.y,this.width,this.height,this.radius)},RoundedRectangle.prototype.contains=function(x,y){return!(this.width<=0||this.height<=0)&&(x>=this.x&&x<=this.x+this.width&&y>=this.y&&y<=this.y+this.height)}},{"../../const":22}],39:[function(require,module,exports){function ParticleContainer(maxSize,properties,batchSize){Container.call(this),batchSize=batchSize||15e3,maxSize=maxSize||15e3;var maxBatchSize=16384;batchSize>maxBatchSize&&(batchSize=maxBatchSize),batchSize>maxSize&&(batchSize=maxSize),this._properties=[!1,!0,!1,!1,!1],this._maxSize=maxSize,this._batchSize=batchSize,this._buffers=null,this._bufferToUpdate=0,this.interactiveChildren=!1,this.blendMode=CONST.BLEND_MODES.NORMAL,this.roundPixels=!0,this.setProperties(properties)}var Container=require("../display/Container"),CONST=require("../const");ParticleContainer.prototype=Object.create(Container.prototype),ParticleContainer.prototype.constructor=ParticleContainer,module.exports=ParticleContainer,ParticleContainer.prototype.setProperties=function(properties){properties&&(this._properties[0]="scale"in properties?!!properties.scale:this._properties[0],this._properties[1]="position"in properties?!!properties.position:this._properties[1],this._properties[2]="rotation"in properties?!!properties.rotation:this._properties[2],this._properties[3]="uvs"in properties?!!properties.uvs:this._properties[3],this._properties[4]="alpha"in properties?!!properties.alpha:this._properties[4])},ParticleContainer.prototype.updateTransform=function(){this.displayObjectUpdateTransform()},ParticleContainer.prototype.renderWebGL=function(renderer){this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable&&(renderer.setObjectRenderer(renderer.plugins.particle),renderer.plugins.particle.render(this))},ParticleContainer.prototype.onChildrenChange=function(smallestChildIndex){var bufferIndex=Math.floor(smallestChildIndex/this._batchSize);bufferIndex<this._bufferToUpdate&&(this._bufferToUpdate=bufferIndex)},ParticleContainer.prototype.renderCanvas=function(renderer){if(this.visible&&!(this.worldAlpha<=0)&&this.children.length&&this.renderable){var context=renderer.context,transform=this.worldTransform,isRotated=!0,positionX=0,positionY=0,finalWidth=0,finalHeight=0,compositeOperation=renderer.blendModes[this.blendMode];compositeOperation!==context.globalCompositeOperation&&(context.globalCompositeOperation=compositeOperation),context.globalAlpha=this.worldAlpha,this.displayObjectUpdateTransform();for(var i=0;i<this.children.length;++i){var child=this.children[i];if(child.visible){var frame=child.texture.frame;if(context.globalAlpha=this.worldAlpha*child.alpha,child.rotation%(2*Math.PI)===0)isRotated&&(context.setTransform(transform.a,transform.b,transform.c,transform.d,transform.tx,transform.ty),isRotated=!1),positionX=child.anchor.x*(-frame.width*child.scale.x)+child.position.x+.5,positionY=child.anchor.y*(-frame.height*child.scale.y)+child.position.y+.5,finalWidth=frame.width*child.scale.x,finalHeight=frame.height*child.scale.y;else{isRotated||(isRotated=!0),child.displayObjectUpdateTransform();var childTransform=child.worldTransform;renderer.roundPixels?context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,0|childTransform.tx,0|childTransform.ty):context.setTransform(childTransform.a,childTransform.b,childTransform.c,childTransform.d,childTransform.tx,childTransform.ty),positionX=child.anchor.x*-frame.width+.5,positionY=child.anchor.y*-frame.height+.5,finalWidth=frame.width,finalHeight=frame.height}context.drawImage(child.texture.baseTexture.source,frame.x,frame.y,frame.width,frame.height,positionX,positionY,finalWidth,finalHeight)}}}},ParticleContainer.prototype.destroy=function(){if(Container.prototype.destroy.apply(this,arguments),this._buffers)for(var i=0;i<this._buffers.length;++i)this._buffers[i].destroy();this._properties=null,this._buffers=null}},{"../const":22,"../display/Container":23}],40:[function(require,module,exports){function ParticleBuffer(gl,properties,dynamicPropertyFlags,size){this.gl=gl,this.vertSize=2,this.vertByteSize=4*this.vertSize,this.size=size,this.dynamicProperties=[],this.staticProperties=[];for(var i=0;i<properties.length;i++){var property=properties[i];dynamicPropertyFlags[i]?this.dynamicProperties.push(property):this.staticProperties.push(property)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.initBuffers()}ParticleBuffer.prototype.constructor=ParticleBuffer,module.exports=ParticleBuffer,ParticleBuffer.prototype.initBuffers=function(){var i,property,gl=this.gl,dynamicOffset=0;for(this.dynamicStride=0,i=0;i<this.dynamicProperties.length;i++)property=this.dynamicProperties[i],property.offset=dynamicOffset,dynamicOffset+=property.size,this.dynamicStride+=property.size;this.dynamicData=new Float32Array(this.size*this.dynamicStride*4),this.dynamicBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.dynamicData,gl.DYNAMIC_DRAW);var staticOffset=0;for(this.staticStride=0,i=0;i<this.staticProperties.length;i++)property=this.staticProperties[i],property.offset=staticOffset,staticOffset+=property.size,this.staticStride+=property.size;this.staticData=new Float32Array(this.size*this.staticStride*4),this.staticBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.staticData,gl.DYNAMIC_DRAW)},ParticleBuffer.prototype.uploadDynamic=function(children,startIndex,amount){for(var gl=this.gl,i=0;i<this.dynamicProperties.length;i++){var property=this.dynamicProperties[i];property.uploadFunction(children,startIndex,amount,this.dynamicData,this.dynamicStride,property.offset)}gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,this.dynamicData)},ParticleBuffer.prototype.uploadStatic=function(children,startIndex,amount){for(var gl=this.gl,i=0;i<this.staticProperties.length;i++){var property=this.staticProperties[i];property.uploadFunction(children,startIndex,amount,this.staticData,this.staticStride,property.offset)}gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,this.staticData)},ParticleBuffer.prototype.bind=function(){var i,property,gl=this.gl;for(gl.bindBuffer(gl.ARRAY_BUFFER,this.dynamicBuffer),i=0;i<this.dynamicProperties.length;i++)property=this.dynamicProperties[i],gl.vertexAttribPointer(property.attribute,property.size,gl.FLOAT,!1,4*this.dynamicStride,4*property.offset);for(gl.bindBuffer(gl.ARRAY_BUFFER,this.staticBuffer),i=0;i<this.staticProperties.length;i++)property=this.staticProperties[i],gl.vertexAttribPointer(property.attribute,property.size,gl.FLOAT,!1,4*this.staticStride,4*property.offset)},ParticleBuffer.prototype.destroy=function(){this.dynamicProperties=null,this.dynamicData=null,this.gl.deleteBuffer(this.dynamicBuffer),this.staticProperties=null,this.staticData=null,this.gl.deleteBuffer(this.staticBuffer)}},{}],41:[function(require,module,exports){function ParticleRenderer(renderer){ObjectRenderer.call(this,renderer);var numIndices=98304;this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4)this.indices[i+0]=j+0,this.indices[i+1]=j+1,this.indices[i+2]=j+2,this.indices[i+3]=j+0,this.indices[i+4]=j+2,this.indices[i+5]=j+3;this.shader=null,this.indexBuffer=null,this.properties=null,this.tempMatrix=new math.Matrix}var ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),ParticleShader=require("./ParticleShader"),ParticleBuffer=require("./ParticleBuffer"),math=require("../../math");ParticleRenderer.prototype=Object.create(ObjectRenderer.prototype),ParticleRenderer.prototype.constructor=ParticleRenderer,module.exports=ParticleRenderer,WebGLRenderer.registerPlugin("particle",ParticleRenderer),ParticleRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=new ParticleShader(this.renderer.shaderManager),this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW),this.properties=[{attribute:this.shader.attributes.aVertexPosition,size:2,uploadFunction:this.uploadVertices,offset:0},{attribute:this.shader.attributes.aPositionCoord,size:2,uploadFunction:this.uploadPosition,offset:0},{attribute:this.shader.attributes.aRotation,size:1,uploadFunction:this.uploadRotation,offset:0},{attribute:this.shader.attributes.aTextureCoord,size:2,uploadFunction:this.uploadUvs,offset:0},{attribute:this.shader.attributes.aColor,size:1,uploadFunction:this.uploadAlpha,offset:0}]},ParticleRenderer.prototype.start=function(){var gl=this.renderer.gl;gl.activeTexture(gl.TEXTURE0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var shader=this.shader;this.renderer.shaderManager.setShader(shader)},ParticleRenderer.prototype.render=function(container){var children=container.children,totalChildren=children.length,maxSize=container._maxSize,batchSize=container._batchSize;if(0!==totalChildren){totalChildren>maxSize&&(totalChildren=maxSize),container._buffers||(container._buffers=this.generateBuffers(container)),this.renderer.blendModeManager.setBlendMode(container.blendMode);var gl=this.renderer.gl,m=container.worldTransform.copy(this.tempMatrix);m.prepend(this.renderer.currentRenderTarget.projectionMatrix),gl.uniformMatrix3fv(this.shader.uniforms.projectionMatrix._location,!1,m.toArray(!0)),gl.uniform1f(this.shader.uniforms.uAlpha._location,container.worldAlpha);var baseTexture=children[0]._texture.baseTexture;if(baseTexture._glTextures[gl.id])gl.bindTexture(gl.TEXTURE_2D,baseTexture._glTextures[gl.id]);else{if(!this.renderer.updateTexture(baseTexture))return;container._properties[0]&&container._properties[3]||(container._bufferToUpdate=0)}for(var i=0,j=0;i<totalChildren;i+=batchSize,j+=1){var amount=totalChildren-i;amount>batchSize&&(amount=batchSize);var buffer=container._buffers[j];buffer.uploadDynamic(children,i,amount),container._bufferToUpdate===j&&(buffer.uploadStatic(children,i,amount),container._bufferToUpdate=j+1),buffer.bind(this.shader),gl.drawElements(gl.TRIANGLES,6*amount,gl.UNSIGNED_SHORT,0),this.renderer.drawCount++}}},ParticleRenderer.prototype.generateBuffers=function(container){var i,gl=this.renderer.gl,buffers=[],size=container._maxSize,batchSize=container._batchSize,dynamicPropertyFlags=container._properties;for(i=0;i<size;i+=batchSize)buffers.push(new ParticleBuffer(gl,this.properties,dynamicPropertyFlags,batchSize));return buffers},ParticleRenderer.prototype.uploadVertices=function(children,startIndex,amount,array,stride,offset){for(var sprite,texture,trim,sx,sy,w0,w1,h0,h1,i=0;i<amount;i++)sprite=children[startIndex+i],texture=sprite._texture,sx=sprite.scale.x,sy=sprite.scale.y,texture.trim?(trim=texture.trim,w1=trim.x-sprite.anchor.x*trim.width,w0=w1+texture.crop.width,h1=trim.y-sprite.anchor.y*trim.height,h0=h1+texture.crop.height):(w0=texture._frame.width*(1-sprite.anchor.x),w1=texture._frame.width*-sprite.anchor.x,h0=texture._frame.height*(1-sprite.anchor.y),h1=texture._frame.height*-sprite.anchor.y),array[offset]=w1*sx,array[offset+1]=h1*sy,array[offset+stride]=w0*sx,array[offset+stride+1]=h1*sy,array[offset+2*stride]=w0*sx,array[offset+2*stride+1]=h0*sy,array[offset+3*stride]=w1*sx,array[offset+3*stride+1]=h0*sy,offset+=4*stride},ParticleRenderer.prototype.uploadPosition=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spritePosition=children[startIndex+i].position;array[offset]=spritePosition.x,array[offset+1]=spritePosition.y,array[offset+stride]=spritePosition.x,array[offset+stride+1]=spritePosition.y,array[offset+2*stride]=spritePosition.x,array[offset+2*stride+1]=spritePosition.y,array[offset+3*stride]=spritePosition.x,array[offset+3*stride+1]=spritePosition.y,offset+=4*stride}},ParticleRenderer.prototype.uploadRotation=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteRotation=children[startIndex+i].rotation;array[offset]=spriteRotation,array[offset+stride]=spriteRotation,array[offset+2*stride]=spriteRotation,array[offset+3*stride]=spriteRotation,offset+=4*stride}},ParticleRenderer.prototype.uploadUvs=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var textureUvs=children[startIndex+i]._texture._uvs;textureUvs?(array[offset]=textureUvs.x0,array[offset+1]=textureUvs.y0,array[offset+stride]=textureUvs.x1,array[offset+stride+1]=textureUvs.y1,array[offset+2*stride]=textureUvs.x2,array[offset+2*stride+1]=textureUvs.y2,array[offset+3*stride]=textureUvs.x3,array[offset+3*stride+1]=textureUvs.y3,offset+=4*stride):(array[offset]=0,array[offset+1]=0,array[offset+stride]=0,array[offset+stride+1]=0,array[offset+2*stride]=0,array[offset+2*stride+1]=0,array[offset+3*stride]=0,array[offset+3*stride+1]=0,offset+=4*stride)}},ParticleRenderer.prototype.uploadAlpha=function(children,startIndex,amount,array,stride,offset){for(var i=0;i<amount;i++){var spriteAlpha=children[startIndex+i].alpha;array[offset]=spriteAlpha,array[offset+stride]=spriteAlpha,array[offset+2*stride]=spriteAlpha,array[offset+3*stride]=spriteAlpha,offset+=4*stride}},ParticleRenderer.prototype.destroy=function(){
this.renderer.gl&&this.renderer.gl.deleteBuffer(this.indexBuffer),ObjectRenderer.prototype.destroy.apply(this,arguments),this.shader.destroy(),this.indices=null,this.tempMatrix=null}},{"../../math":33,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63,"./ParticleBuffer":40,"./ParticleShader":42}],42:[function(require,module,exports){function ParticleShader(shaderManager){TextureShader.call(this,shaderManager,["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute float aColor;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying float vColor;","void main(void){","   vec2 v = aVertexPosition;","   v.x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);","   v.y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);","   v = v + aPositionCoord;","   gl_Position = vec4((projectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","uniform float uAlpha;","void main(void){","  vec4 color = texture2D(uSampler, vTextureCoord) * vColor * uAlpha;","  if (color.a == 0.0) discard;","  gl_FragColor = color;","}"].join("\n"),{uAlpha:{type:"1f",value:1}},{aPositionCoord:0,aRotation:0})}var TextureShader=require("../../renderers/webgl/shaders/TextureShader");ParticleShader.prototype=Object.create(TextureShader.prototype),ParticleShader.prototype.constructor=ParticleShader,module.exports=ParticleShader},{"../../renderers/webgl/shaders/TextureShader":62}],43:[function(require,module,exports){function SystemRenderer(system,width,height,options){if(EventEmitter.call(this),utils.sayHello(system),options)for(var i in CONST.DEFAULT_RENDER_OPTIONS)"undefined"==typeof options[i]&&(options[i]=CONST.DEFAULT_RENDER_OPTIONS[i]);else options=CONST.DEFAULT_RENDER_OPTIONS;this.type=CONST.RENDERER_TYPE.UNKNOWN,this.width=width||800,this.height=height||600,this.view=options.view||document.createElement("canvas"),this.resolution=options.resolution,this.transparent=options.transparent,this.autoResize=options.autoResize||!1,this.blendModes=null,this.preserveDrawingBuffer=options.preserveDrawingBuffer,this.clearBeforeRender=options.clearBeforeRender,this.roundPixels=options.roundPixels,this._backgroundColor=0,this._backgroundColorRgb=[0,0,0],this._backgroundColorString="#000000",this.backgroundColor=options.backgroundColor||this._backgroundColor,this._tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1,children:[]},this._lastObjectRendered=this._tempDisplayObjectParent}var utils=require("../utils"),math=require("../math"),CONST=require("../const"),EventEmitter=require("eventemitter3");SystemRenderer.prototype=Object.create(EventEmitter.prototype),SystemRenderer.prototype.constructor=SystemRenderer,module.exports=SystemRenderer,Object.defineProperties(SystemRenderer.prototype,{backgroundColor:{get:function(){return this._backgroundColor},set:function(val){this._backgroundColor=val,this._backgroundColorString=utils.hex2string(val),utils.hex2rgb(val,this._backgroundColorRgb)}}}),SystemRenderer.prototype.resize=function(width,height){this.width=width*this.resolution,this.height=height*this.resolution,this.view.width=this.width,this.view.height=this.height,this.autoResize&&(this.view.style.width=this.width/this.resolution+"px",this.view.style.height=this.height/this.resolution+"px")},SystemRenderer.prototype.destroy=function(removeView){removeView&&this.view.parentNode&&this.view.parentNode.removeChild(this.view),this.type=CONST.RENDERER_TYPE.UNKNOWN,this.width=0,this.height=0,this.view=null,this.resolution=0,this.transparent=!1,this.autoResize=!1,this.blendModes=null,this.preserveDrawingBuffer=!1,this.clearBeforeRender=!1,this.roundPixels=!1,this._backgroundColor=0,this._backgroundColorRgb=null,this._backgroundColorString=null}},{"../const":22,"../math":33,"../utils":77,eventemitter3:10}],44:[function(require,module,exports){function CanvasRenderer(width,height,options){options=options||{},SystemRenderer.call(this,"Canvas",width,height,options),this.type=CONST.RENDERER_TYPE.CANVAS,this.context=this.view.getContext("2d",{alpha:this.transparent}),this.refresh=!0,this.maskManager=new CanvasMaskManager,this.smoothProperty="imageSmoothingEnabled",this.context.imageSmoothingEnabled||(this.context.webkitImageSmoothingEnabled?this.smoothProperty="webkitImageSmoothingEnabled":this.context.mozImageSmoothingEnabled?this.smoothProperty="mozImageSmoothingEnabled":this.context.oImageSmoothingEnabled?this.smoothProperty="oImageSmoothingEnabled":this.context.msImageSmoothingEnabled&&(this.smoothProperty="msImageSmoothingEnabled")),this.initPlugins(),this._mapBlendModes(),this._tempDisplayObjectParent={worldTransform:new math.Matrix,worldAlpha:1},this.resize(width,height)}var SystemRenderer=require("../SystemRenderer"),CanvasMaskManager=require("./utils/CanvasMaskManager"),utils=require("../../utils"),math=require("../../math"),CONST=require("../../const");CanvasRenderer.prototype=Object.create(SystemRenderer.prototype),CanvasRenderer.prototype.constructor=CanvasRenderer,module.exports=CanvasRenderer,utils.pluginTarget.mixin(CanvasRenderer),CanvasRenderer.prototype.render=function(object){this.emit("prerender");var cacheParent=object.parent;this._lastObjectRendered=object,object.parent=this._tempDisplayObjectParent,object.updateTransform(),object.parent=cacheParent,this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.context.globalCompositeOperation=this.blendModes[CONST.BLEND_MODES.NORMAL],navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear()),this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=this._backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(object,this.context),this.emit("postrender")},CanvasRenderer.prototype.destroy=function(removeView){this.destroyPlugins(),SystemRenderer.prototype.destroy.call(this,removeView),this.context=null,this.refresh=!0,this.maskManager.destroy(),this.maskManager=null,this.smoothProperty=null},CanvasRenderer.prototype.renderDisplayObject=function(displayObject,context){var tempContext=this.context;this.context=context,displayObject.renderCanvas(this),this.context=tempContext},CanvasRenderer.prototype.resize=function(w,h){SystemRenderer.prototype.resize.call(this,w,h),this.smoothProperty&&(this.context[this.smoothProperty]=CONST.SCALE_MODES.DEFAULT===CONST.SCALE_MODES.LINEAR)},CanvasRenderer.prototype._mapBlendModes=function(){this.blendModes||(this.blendModes={},utils.canUseNewCanvasBlendModes()?(this.blendModes[CONST.BLEND_MODES.NORMAL]="source-over",this.blendModes[CONST.BLEND_MODES.ADD]="lighter",this.blendModes[CONST.BLEND_MODES.MULTIPLY]="multiply",this.blendModes[CONST.BLEND_MODES.SCREEN]="screen",this.blendModes[CONST.BLEND_MODES.OVERLAY]="overlay",this.blendModes[CONST.BLEND_MODES.DARKEN]="darken",this.blendModes[CONST.BLEND_MODES.LIGHTEN]="lighten",this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]="color-dodge",this.blendModes[CONST.BLEND_MODES.COLOR_BURN]="color-burn",this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]="hard-light",this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]="soft-light",this.blendModes[CONST.BLEND_MODES.DIFFERENCE]="difference",this.blendModes[CONST.BLEND_MODES.EXCLUSION]="exclusion",this.blendModes[CONST.BLEND_MODES.HUE]="hue",this.blendModes[CONST.BLEND_MODES.SATURATION]="saturate",this.blendModes[CONST.BLEND_MODES.COLOR]="color",this.blendModes[CONST.BLEND_MODES.LUMINOSITY]="luminosity"):(this.blendModes[CONST.BLEND_MODES.NORMAL]="source-over",this.blendModes[CONST.BLEND_MODES.ADD]="lighter",this.blendModes[CONST.BLEND_MODES.MULTIPLY]="source-over",this.blendModes[CONST.BLEND_MODES.SCREEN]="source-over",this.blendModes[CONST.BLEND_MODES.OVERLAY]="source-over",this.blendModes[CONST.BLEND_MODES.DARKEN]="source-over",this.blendModes[CONST.BLEND_MODES.LIGHTEN]="source-over",this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]="source-over",this.blendModes[CONST.BLEND_MODES.COLOR_BURN]="source-over",this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]="source-over",this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]="source-over",this.blendModes[CONST.BLEND_MODES.DIFFERENCE]="source-over",this.blendModes[CONST.BLEND_MODES.EXCLUSION]="source-over",this.blendModes[CONST.BLEND_MODES.HUE]="source-over",this.blendModes[CONST.BLEND_MODES.SATURATION]="source-over",this.blendModes[CONST.BLEND_MODES.COLOR]="source-over",this.blendModes[CONST.BLEND_MODES.LUMINOSITY]="source-over"))}},{"../../const":22,"../../math":33,"../../utils":77,"../SystemRenderer":43,"./utils/CanvasMaskManager":47}],45:[function(require,module,exports){function CanvasBuffer(width,height){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.canvas.width=width,this.canvas.height=height}CanvasBuffer.prototype.constructor=CanvasBuffer,module.exports=CanvasBuffer,Object.defineProperties(CanvasBuffer.prototype,{width:{get:function(){return this.canvas.width},set:function(val){this.canvas.width=val}},height:{get:function(){return this.canvas.height},set:function(val){this.canvas.height=val}}}),CanvasBuffer.prototype.clear=function(){this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.canvas.width,this.canvas.height)},CanvasBuffer.prototype.resize=function(width,height){this.canvas.width=width,this.canvas.height=height},CanvasBuffer.prototype.destroy=function(){this.context=null,this.canvas=null}},{}],46:[function(require,module,exports){var CONST=require("../../../const"),CanvasGraphics={};module.exports=CanvasGraphics,CanvasGraphics.renderGraphics=function(graphics,context){var worldAlpha=graphics.worldAlpha;graphics.dirty&&(this.updateGraphicsTint(graphics),graphics.dirty=!1);for(var i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i],shape=data.shape,fillColor=data._fillTint,lineColor=data._lineTint;if(context.lineWidth=data.lineWidth,data.type===CONST.SHAPES.POLY){context.beginPath();var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);shape.closed&&context.lineTo(points[0],points[1]),points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===CONST.SHAPES.RECT)(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fillRect(shape.x,shape.y,shape.width,shape.height)),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.strokeRect(shape.x,shape.y,shape.width,shape.height));else if(data.type===CONST.SHAPES.CIRC)context.beginPath(),context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke());else if(data.type===CONST.SHAPES.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2;context.beginPath();var kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath(),data.fill&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}else if(data.type===CONST.SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.beginPath(),context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath(),(data.fillColor||0===data.fillColor)&&(context.globalAlpha=data.fillAlpha*worldAlpha,context.fillStyle="#"+("00000"+(0|fillColor).toString(16)).substr(-6),context.fill()),data.lineWidth&&(context.globalAlpha=data.lineAlpha*worldAlpha,context.strokeStyle="#"+("00000"+(0|lineColor).toString(16)).substr(-6),context.stroke())}}},CanvasGraphics.renderGraphicsMask=function(graphics,context){var len=graphics.graphicsData.length;if(0!==len){context.beginPath();for(var i=0;i<len;i++){var data=graphics.graphicsData[i],shape=data.shape;if(data.type===CONST.SHAPES.POLY){var points=shape.points;context.moveTo(points[0],points[1]);for(var j=1;j<points.length/2;j++)context.lineTo(points[2*j],points[2*j+1]);points[0]===points[points.length-2]&&points[1]===points[points.length-1]&&context.closePath()}else if(data.type===CONST.SHAPES.RECT)context.rect(shape.x,shape.y,shape.width,shape.height),context.closePath();else if(data.type===CONST.SHAPES.CIRC)context.arc(shape.x,shape.y,shape.radius,0,2*Math.PI),context.closePath();else if(data.type===CONST.SHAPES.ELIP){var w=2*shape.width,h=2*shape.height,x=shape.x-w/2,y=shape.y-h/2,kappa=.5522848,ox=w/2*kappa,oy=h/2*kappa,xe=x+w,ye=y+h,xm=x+w/2,ym=y+h/2;context.moveTo(x,ym),context.bezierCurveTo(x,ym-oy,xm-ox,y,xm,y),context.bezierCurveTo(xm+ox,y,xe,ym-oy,xe,ym),context.bezierCurveTo(xe,ym+oy,xm+ox,ye,xm,ye),context.bezierCurveTo(xm-ox,ye,x,ym+oy,x,ym),context.closePath()}else if(data.type===CONST.SHAPES.RREC){var rx=shape.x,ry=shape.y,width=shape.width,height=shape.height,radius=shape.radius,maxRadius=Math.min(width,height)/2|0;radius=radius>maxRadius?maxRadius:radius,context.moveTo(rx,ry+radius),context.lineTo(rx,ry+height-radius),context.quadraticCurveTo(rx,ry+height,rx+radius,ry+height),context.lineTo(rx+width-radius,ry+height),context.quadraticCurveTo(rx+width,ry+height,rx+width,ry+height-radius),context.lineTo(rx+width,ry+radius),context.quadraticCurveTo(rx+width,ry,rx+width-radius,ry),context.lineTo(rx+radius,ry),context.quadraticCurveTo(rx,ry,rx,ry+radius),context.closePath()}}}},CanvasGraphics.updateGraphicsTint=function(graphics){if(16777215!==graphics.tint||graphics._prevTint!==graphics.tint){graphics._prevTint=graphics.tint;for(var tintR=(graphics.tint>>16&255)/255,tintG=(graphics.tint>>8&255)/255,tintB=(255&graphics.tint)/255,i=0;i<graphics.graphicsData.length;i++){var data=graphics.graphicsData[i],fillColor=0|data.fillColor,lineColor=0|data.lineColor;data._fillTint=((fillColor>>16&255)/255*tintR*255<<16)+((fillColor>>8&255)/255*tintG*255<<8)+(255&fillColor)/255*tintB*255,data._lineTint=((lineColor>>16&255)/255*tintR*255<<16)+((lineColor>>8&255)/255*tintG*255<<8)+(255&lineColor)/255*tintB*255}}}},{"../../../const":22}],47:[function(require,module,exports){function CanvasMaskManager(){}var CanvasGraphics=require("./CanvasGraphics");CanvasMaskManager.prototype.constructor=CanvasMaskManager,module.exports=CanvasMaskManager,CanvasMaskManager.prototype.pushMask=function(maskData,renderer){renderer.context.save();var cacheAlpha=maskData.alpha,transform=maskData.worldTransform,resolution=renderer.resolution;renderer.context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),maskData.texture||(CanvasGraphics.renderGraphicsMask(maskData,renderer.context),renderer.context.clip()),maskData.worldAlpha=cacheAlpha},CanvasMaskManager.prototype.popMask=function(renderer){renderer.context.restore()},CanvasMaskManager.prototype.destroy=function(){}},{"./CanvasGraphics":46}],48:[function(require,module,exports){var utils=require("../../../utils"),CanvasTinter={};module.exports=CanvasTinter,CanvasTinter.getTintedTexture=function(sprite,color){var texture=sprite.texture;color=CanvasTinter.roundColor(color);var stringColor="#"+("00000"+(0|color).toString(16)).substr(-6);if(texture.tintCache=texture.tintCache||{},texture.tintCache[stringColor])return texture.tintCache[stringColor];var canvas=CanvasTinter.canvas||document.createElement("canvas");if(CanvasTinter.tintMethod(texture,color,canvas),CanvasTinter.convertTintToImage){var tintImage=new Image;tintImage.src=canvas.toDataURL(),texture.tintCache[stringColor]=tintImage}else texture.tintCache[stringColor]=canvas,CanvasTinter.canvas=null;return canvas},CanvasTinter.tintWithMultiply=function(texture,color,canvas){var context=canvas.getContext("2d"),resolution=texture.baseTexture.resolution,crop=texture.crop.clone();crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=crop.width,canvas.height=crop.height,context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="multiply",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)},CanvasTinter.tintWithOverlay=function(texture,color,canvas){var context=canvas.getContext("2d"),resolution=texture.baseTexture.resolution,crop=texture.crop.clone();crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=crop.width,canvas.height=crop.height,context.globalCompositeOperation="copy",context.fillStyle="#"+("00000"+(0|color).toString(16)).substr(-6),context.fillRect(0,0,crop.width,crop.height),context.globalCompositeOperation="destination-atop",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height)},CanvasTinter.tintWithPerPixel=function(texture,color,canvas){var context=canvas.getContext("2d"),resolution=texture.baseTexture.resolution,crop=texture.crop.clone();crop.x*=resolution,crop.y*=resolution,crop.width*=resolution,crop.height*=resolution,canvas.width=crop.width,canvas.height=crop.height,context.globalCompositeOperation="copy",context.drawImage(texture.baseTexture.source,crop.x,crop.y,crop.width,crop.height,0,0,crop.width,crop.height);for(var rgbValues=utils.hex2rgb(color),r=rgbValues[0],g=rgbValues[1],b=rgbValues[2],pixelData=context.getImageData(0,0,crop.width,crop.height),pixels=pixelData.data,i=0;i<pixels.length;i+=4)pixels[i+0]*=r,pixels[i+1]*=g,pixels[i+2]*=b;context.putImageData(pixelData,0,0)},CanvasTinter.roundColor=function(color){var step=CanvasTinter.cacheStepsPerColorChannel,rgbValues=utils.hex2rgb(color);return rgbValues[0]=Math.min(255,rgbValues[0]/step*step),rgbValues[1]=Math.min(255,rgbValues[1]/step*step),rgbValues[2]=Math.min(255,rgbValues[2]/step*step),utils.rgb2hex(rgbValues)},CanvasTinter.cacheStepsPerColorChannel=8,CanvasTinter.convertTintToImage=!1,CanvasTinter.canUseMultiply=utils.canUseNewCanvasBlendModes(),CanvasTinter.tintMethod=CanvasTinter.canUseMultiply?CanvasTinter.tintWithMultiply:CanvasTinter.tintWithPerPixel},{"../../../utils":77}],49:[function(require,module,exports){function WebGLRenderer(width,height,options){options=options||{},SystemRenderer.call(this,"WebGL",width,height,options),this.type=CONST.RENDERER_TYPE.WEBGL,this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this),this.view.addEventListener("webglcontextlost",this.handleContextLost,!1),this.view.addEventListener("webglcontextrestored",this.handleContextRestored,!1),this._useFXAA=!!options.forceFXAA&&options.antialias,this._FXAAFilter=null,this._contextOptions={alpha:this.transparent,antialias:options.antialias,premultipliedAlpha:this.transparent&&"notMultiplied"!==this.transparent,stencil:!0,preserveDrawingBuffer:options.preserveDrawingBuffer},this.drawCount=0,this.shaderManager=new ShaderManager(this),this.maskManager=new MaskManager(this),this.stencilManager=new StencilManager(this),this.filterManager=new FilterManager(this),this.blendModeManager=new BlendModeManager(this),this.currentRenderTarget=null,this.currentRenderer=new ObjectRenderer(this),this.initPlugins(),this._createContext(),this._initContext(),this._mapGlModes(),this._managedTextures=[],this._renderTargetStack=[]}var SystemRenderer=require("../SystemRenderer"),ShaderManager=require("./managers/ShaderManager"),MaskManager=require("./managers/MaskManager"),StencilManager=require("./managers/StencilManager"),FilterManager=require("./managers/FilterManager"),BlendModeManager=require("./managers/BlendModeManager"),RenderTarget=require("./utils/RenderTarget"),ObjectRenderer=require("./utils/ObjectRenderer"),FXAAFilter=require("./filters/FXAAFilter"),utils=require("../../utils"),CONST=require("../../const");WebGLRenderer.prototype=Object.create(SystemRenderer.prototype),WebGLRenderer.prototype.constructor=WebGLRenderer,module.exports=WebGLRenderer,utils.pluginTarget.mixin(WebGLRenderer),WebGLRenderer.glContextId=0,WebGLRenderer.prototype._createContext=function(){var gl=this.view.getContext("webgl",this._contextOptions)||this.view.getContext("experimental-webgl",this._contextOptions);if(this.gl=gl,!gl)throw new Error("This browser does not support webGL. Try using the canvas renderer");this.glContextId=WebGLRenderer.glContextId++,gl.id=this.glContextId,gl.renderer=this},WebGLRenderer.prototype._initContext=function(){var gl=this.gl;gl.disable(gl.DEPTH_TEST),gl.disable(gl.CULL_FACE),gl.enable(gl.BLEND),this.renderTarget=new RenderTarget(gl,this.width,this.height,null,this.resolution,(!0)),this.setRenderTarget(this.renderTarget),this.emit("context",gl),this.resize(this.width,this.height),this._useFXAA||(this._useFXAA=this._contextOptions.antialias&&!gl.getContextAttributes().antialias),this._useFXAA&&(window.console.warn("FXAA antialiasing being used instead of native antialiasing"),this._FXAAFilter=[new FXAAFilter])},WebGLRenderer.prototype.render=function(object){if(this.emit("prerender"),!this.gl.isContextLost()){this.drawCount=0,this._lastObjectRendered=object,this._useFXAA&&(this._FXAAFilter[0].uniforms.resolution.value.x=this.width,this._FXAAFilter[0].uniforms.resolution.value.y=this.height,object.filterArea=this.renderTarget.size,object.filters=this._FXAAFilter);var cacheParent=object.parent;object.parent=this._tempDisplayObjectParent,object.updateTransform(),object.parent=cacheParent;var gl=this.gl;this.setRenderTarget(this.renderTarget),this.clearBeforeRender&&(this.transparent?gl.clearColor(0,0,0,0):gl.clearColor(this._backgroundColorRgb[0],this._backgroundColorRgb[1],this._backgroundColorRgb[2],1),gl.clear(gl.COLOR_BUFFER_BIT)),this.renderDisplayObject(object,this.renderTarget),this.emit("postrender")}},WebGLRenderer.prototype.renderDisplayObject=function(displayObject,renderTarget,clear){this.setRenderTarget(renderTarget),clear&&renderTarget.clear(),this.filterManager.setFilterStack(renderTarget.filterStack),displayObject.renderWebGL(this),this.currentRenderer.flush()},WebGLRenderer.prototype.setObjectRenderer=function(objectRenderer){this.currentRenderer!==objectRenderer&&(this.currentRenderer.stop(),this.currentRenderer=objectRenderer,this.currentRenderer.start())},WebGLRenderer.prototype.setRenderTarget=function(renderTarget){this.currentRenderTarget!==renderTarget&&(this.currentRenderTarget=renderTarget,this.currentRenderTarget.activate(),this.stencilManager.setMaskStack(renderTarget.stencilMaskStack))},WebGLRenderer.prototype.resize=function(width,height){SystemRenderer.prototype.resize.call(this,width,height),this.filterManager.resize(width,height),this.renderTarget.resize(width,height),this.currentRenderTarget===this.renderTarget&&(this.renderTarget.activate(),this.gl.viewport(0,0,this.width,this.height))},WebGLRenderer.prototype.updateTexture=function(texture){if(texture=texture.baseTexture||texture,texture.hasLoaded){var gl=this.gl;return texture._glTextures[gl.id]||(texture._glTextures[gl.id]=gl.createTexture(),texture.on("update",this.updateTexture,this),texture.on("dispose",this.destroyTexture,this),this._managedTextures.push(texture)),gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultipliedAlpha),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST),texture.mipmap&&texture.isPowerOfTwo?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR_MIPMAP_LINEAR:gl.NEAREST_MIPMAP_NEAREST),gl.generateMipmap(gl.TEXTURE_2D)):gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,texture.scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST),texture.isPowerOfTwo?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),texture._glTextures[gl.id]}},WebGLRenderer.prototype.destroyTexture=function(texture,_skipRemove){if(texture=texture.baseTexture||texture,texture.hasLoaded&&texture._glTextures[this.gl.id]&&(this.gl.deleteTexture(texture._glTextures[this.gl.id]),delete texture._glTextures[this.gl.id],!_skipRemove)){var i=this._managedTextures.indexOf(texture);i!==-1&&utils.removeItems(this._managedTextures,i,1)}},WebGLRenderer.prototype.handleContextLost=function(event){event.preventDefault()},WebGLRenderer.prototype.handleContextRestored=function(){this._initContext();for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];texture._glTextures[this.gl.id]&&delete texture._glTextures[this.gl.id]}},WebGLRenderer.prototype.destroy=function(removeView){this.destroyPlugins(),this.view.removeEventListener("webglcontextlost",this.handleContextLost),this.view.removeEventListener("webglcontextrestored",this.handleContextRestored);for(var i=0;i<this._managedTextures.length;++i){var texture=this._managedTextures[i];this.destroyTexture(texture,!0),texture.off("update",this.updateTexture,this),texture.off("dispose",this.destroyTexture,this)}SystemRenderer.prototype.destroy.call(this,removeView),this.uid=0,this.shaderManager.destroy(),this.maskManager.destroy(),this.stencilManager.destroy(),this.filterManager.destroy(),this.blendModeManager.destroy(),this.shaderManager=null,this.maskManager=null,this.filterManager=null,this.blendModeManager=null,this.currentRenderer=null,this.handleContextLost=null,this.handleContextRestored=null,this._contextOptions=null,this._managedTextures=null,this.drawCount=0,this.gl.useProgram(null),this.gl.flush(),this.gl=null},WebGLRenderer.prototype._mapGlModes=function(){var gl=this.gl;this.blendModes||(this.blendModes={},this.blendModes[CONST.BLEND_MODES.NORMAL]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.ADD]=[gl.ONE,gl.DST_ALPHA],this.blendModes[CONST.BLEND_MODES.MULTIPLY]=[gl.DST_COLOR,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SCREEN]=[gl.ONE,gl.ONE_MINUS_SRC_COLOR],this.blendModes[CONST.BLEND_MODES.OVERLAY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.DARKEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.LIGHTEN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR_DODGE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR_BURN]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.HARD_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SOFT_LIGHT]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.DIFFERENCE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.EXCLUSION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.HUE]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.SATURATION]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.COLOR]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA],this.blendModes[CONST.BLEND_MODES.LUMINOSITY]=[gl.ONE,gl.ONE_MINUS_SRC_ALPHA]),this.drawModes||(this.drawModes={},this.drawModes[CONST.DRAW_MODES.POINTS]=gl.POINTS,this.drawModes[CONST.DRAW_MODES.LINES]=gl.LINES,this.drawModes[CONST.DRAW_MODES.LINE_LOOP]=gl.LINE_LOOP,this.drawModes[CONST.DRAW_MODES.LINE_STRIP]=gl.LINE_STRIP,this.drawModes[CONST.DRAW_MODES.TRIANGLES]=gl.TRIANGLES,this.drawModes[CONST.DRAW_MODES.TRIANGLE_STRIP]=gl.TRIANGLE_STRIP,this.drawModes[CONST.DRAW_MODES.TRIANGLE_FAN]=gl.TRIANGLE_FAN)}},{"../../const":22,"../../utils":77,"../SystemRenderer":43,"./filters/FXAAFilter":51,"./managers/BlendModeManager":53,"./managers/FilterManager":54,"./managers/MaskManager":55,"./managers/ShaderManager":56,"./managers/StencilManager":57,"./utils/ObjectRenderer":63,"./utils/RenderTarget":65}],50:[function(require,module,exports){function AbstractFilter(vertexSrc,fragmentSrc,uniforms){this.shaders=[],this.padding=0,this.uniforms=uniforms||{},this.vertexSrc=vertexSrc||DefaultShader.defaultVertexSrc,this.fragmentSrc=fragmentSrc||DefaultShader.defaultFragmentSrc}var DefaultShader=require("../shaders/TextureShader");AbstractFilter.prototype.constructor=AbstractFilter,module.exports=AbstractFilter,AbstractFilter.prototype.getShader=function(renderer){var gl=renderer.gl,shader=this.shaders[gl.id];return shader||(shader=new DefaultShader(renderer.shaderManager,this.vertexSrc,this.fragmentSrc,this.uniforms,this.attributes),this.shaders[gl.id]=shader),shader},AbstractFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);renderer.filterManager.applyFilter(shader,input,output,clear)},AbstractFilter.prototype.syncUniform=function(uniform){for(var i=0,j=this.shaders.length;i<j;++i)this.shaders[i].syncUniform(uniform)}},{"../shaders/TextureShader":62}],51:[function(require,module,exports){function FXAAFilter(){AbstractFilter.call(this,"\nprecision mediump float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform vec2 resolution;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\n\nvoid texcoords(vec2 fragCoord, vec2 resolution,\n            out vec2 v_rgbNW, out vec2 v_rgbNE,\n            out vec2 v_rgbSW, out vec2 v_rgbSE,\n            out vec2 v_rgbM) {\n    vec2 inverseVP = 1.0 / resolution.xy;\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n   vResolution = resolution;\n\n   //compute the texture coords and send them to varyings\n   texcoords(aTextureCoord * resolution, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'precision lowp float;\n\n\n/**\nBasic FXAA implementation based on the code on geeks3d.com with the\nmodification that the texture2DLod stuff was removed since it\'s\nunsupported by WebGL.\n\n--\n\nFrom:\nhttps://github.com/mitsuhiko/webgl-meincraft\n\nCopyright (c) 2011 by Armin Ronacher.\n\nSome rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are\nmet:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n\n    * Redistributions in binary form must reproduce the above\n      copyright notice, this list of conditions and the following\n      disclaimer in the documentation and/or other materials provided\n      with the distribution.\n\n    * The names of the contributors may not be used to endorse or\n      promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\nLIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\nA PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\nOWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\nSPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\nLIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\nDATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\nTHEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\nOF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n*/\n\n#ifndef FXAA_REDUCE_MIN\n    #define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n    #define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n    #define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\n            vec2 v_rgbNW, vec2 v_rgbNE,\n            vec2 v_rgbSW, vec2 v_rgbSE,\n            vec2 v_rgbM) {\n    vec4 color;\n    mediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n              dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n        texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n        texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n        texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vResolution;\n\n//texcoords computed in vertex step\n//to avoid dependent texture reads\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nuniform sampler2D uSampler;\n\n\nvoid main(void){\n\n    gl_FragColor = fxaa(uSampler, vTextureCoord * vResolution, vResolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n}\n',{
resolution:{type:"v2",value:{x:1,y:1}}})}var AbstractFilter=require("./AbstractFilter");FXAAFilter.prototype=Object.create(AbstractFilter.prototype),FXAAFilter.prototype.constructor=FXAAFilter,module.exports=FXAAFilter,FXAAFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager,shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)}},{"./AbstractFilter":50}],52:[function(require,module,exports){function SpriteMaskFilter(sprite){var maskMatrix=new math.Matrix;AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float alpha;\nuniform sampler2D mask;\n\nvoid main(void)\n{\n    // check clip! this will stop the mask bleeding out from the edges\n    vec2 text = abs( vMaskCoord - 0.5 );\n    text = step(0.5, text);\n    float clip = 1.0 - max(text.y, text.x);\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    original *= (masky.r * masky.a * alpha * clip);\n    gl_FragColor = original;\n}\n",{mask:{type:"sampler2D",value:sprite._texture},alpha:{type:"f",value:1},otherMatrix:{type:"mat3",value:maskMatrix.toArray(!0)}}),this.maskSprite=sprite,this.maskMatrix=maskMatrix}var AbstractFilter=require("./AbstractFilter"),math=require("../../../math");SpriteMaskFilter.prototype=Object.create(AbstractFilter.prototype),SpriteMaskFilter.prototype.constructor=SpriteMaskFilter,module.exports=SpriteMaskFilter,SpriteMaskFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager;this.uniforms.mask.value=this.maskSprite._texture,filterManager.calculateMappedMatrix(input.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.alpha.value=this.maskSprite.worldAlpha;var shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)},Object.defineProperties(SpriteMaskFilter.prototype,{map:{get:function(){return this.uniforms.mask.value},set:function(value){this.uniforms.mask.value=value}},offset:{get:function(){return this.uniforms.offset.value},set:function(value){this.uniforms.offset.value=value}}})},{"../../../math":33,"./AbstractFilter":50}],53:[function(require,module,exports){function BlendModeManager(renderer){WebGLManager.call(this,renderer),this.currentBlendMode=99999}var WebGLManager=require("./WebGLManager");BlendModeManager.prototype=Object.create(WebGLManager.prototype),BlendModeManager.prototype.constructor=BlendModeManager,module.exports=BlendModeManager,BlendModeManager.prototype.setBlendMode=function(blendMode){if(this.currentBlendMode===blendMode)return!1;this.currentBlendMode=blendMode;var mode=this.renderer.blendModes[this.currentBlendMode];return this.renderer.gl.blendFunc(mode[0],mode[1]),!0}},{"./WebGLManager":58}],54:[function(require,module,exports){function FilterManager(renderer){WebGLManager.call(this,renderer),this.filterStack=[],this.filterStack.push({renderTarget:renderer.currentRenderTarget,filter:[],bounds:null}),this.texturePool=[],this.textureSize=new math.Rectangle(0,0,renderer.width,renderer.height),this.currentFrame=null}var WebGLManager=require("./WebGLManager"),RenderTarget=require("../utils/RenderTarget"),CONST=require("../../../const"),Quad=require("../utils/Quad"),math=require("../../../math");FilterManager.prototype=Object.create(WebGLManager.prototype),FilterManager.prototype.constructor=FilterManager,module.exports=FilterManager,FilterManager.prototype.onContextChange=function(){this.texturePool.length=0;var gl=this.renderer.gl;this.quad=new Quad(gl)},FilterManager.prototype.setFilterStack=function(filterStack){this.filterStack=filterStack},FilterManager.prototype.pushFilter=function(target,filters){var bounds=target.filterArea?target.filterArea.clone():target.getBounds();bounds.x=0|bounds.x,bounds.y=0|bounds.y,bounds.width=0|bounds.width,bounds.height=0|bounds.height;var padding=0|filters[0].padding;if(bounds.x-=padding,bounds.y-=padding,bounds.width+=2*padding,bounds.height+=2*padding,this.renderer.currentRenderTarget.transform){var transform=this.renderer.currentRenderTarget.transform;bounds.x+=transform.tx,bounds.y+=transform.ty,this.capFilterArea(bounds),bounds.x-=transform.tx,bounds.y-=transform.ty}else this.capFilterArea(bounds);if(bounds.width>0&&bounds.height>0){this.currentFrame=bounds;var texture=this.getRenderTarget();this.renderer.setRenderTarget(texture),texture.clear(),this.filterStack.push({renderTarget:texture,filter:filters})}else this.filterStack.push({renderTarget:null,filter:filters})},FilterManager.prototype.popFilter=function(){var filterData=this.filterStack.pop(),previousFilterData=this.filterStack[this.filterStack.length-1],input=filterData.renderTarget;if(filterData.renderTarget){var output=previousFilterData.renderTarget,gl=this.renderer.gl;this.currentFrame=input.frame,this.quad.map(this.textureSize,input.frame),gl.bindBuffer(gl.ARRAY_BUFFER,this.quad.vertexBuffer),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.quad.indexBuffer);var filters=filterData.filter;if(gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aTextureCoord,2,gl.FLOAT,!1,0,32),gl.vertexAttribPointer(this.renderer.shaderManager.defaultShader.attributes.aColor,4,gl.FLOAT,!1,0,64),this.renderer.blendModeManager.setBlendMode(CONST.BLEND_MODES.NORMAL),1===filters.length)filters[0].uniforms.dimensions&&(filters[0].uniforms.dimensions.value[0]=this.renderer.width,filters[0].uniforms.dimensions.value[1]=this.renderer.height,filters[0].uniforms.dimensions.value[2]=this.quad.vertices[0],filters[0].uniforms.dimensions.value[3]=this.quad.vertices[5]),filters[0].applyFilter(this.renderer,input,output),this.returnRenderTarget(input);else{for(var flipTexture=input,flopTexture=this.getRenderTarget(!0),i=0;i<filters.length-1;i++){var filter=filters[i];filter.uniforms.dimensions&&(filter.uniforms.dimensions.value[0]=this.renderer.width,filter.uniforms.dimensions.value[1]=this.renderer.height,filter.uniforms.dimensions.value[2]=this.quad.vertices[0],filter.uniforms.dimensions.value[3]=this.quad.vertices[5]),filter.applyFilter(this.renderer,flipTexture,flopTexture);var temp=flipTexture;flipTexture=flopTexture,flopTexture=temp}filters[filters.length-1].applyFilter(this.renderer,flipTexture,output),this.returnRenderTarget(flipTexture),this.returnRenderTarget(flopTexture)}return filterData.filter}},FilterManager.prototype.getRenderTarget=function(clear){var renderTarget=this.texturePool.pop()||new RenderTarget(this.renderer.gl,this.textureSize.width,this.textureSize.height,CONST.SCALE_MODES.LINEAR,this.renderer.resolution*CONST.FILTER_RESOLUTION);return renderTarget.frame=this.currentFrame,clear&&renderTarget.clear(!0),renderTarget},FilterManager.prototype.returnRenderTarget=function(renderTarget){this.texturePool.push(renderTarget)},FilterManager.prototype.applyFilter=function(shader,inputTarget,outputTarget,clear){var gl=this.renderer.gl;this.renderer.setRenderTarget(outputTarget),clear&&outputTarget.clear(),this.renderer.shaderManager.setShader(shader),shader.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),shader.syncUniforms(),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,inputTarget.texture),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),this.renderer.drawCount++},FilterManager.prototype.calculateMappedMatrix=function(filterArea,sprite,outputMatrix){var worldTransform=sprite.worldTransform.copy(math.Matrix.TEMP_MATRIX),texture=sprite._texture.baseTexture,mappedMatrix=outputMatrix.identity(),ratio=this.textureSize.height/this.textureSize.width;mappedMatrix.translate(filterArea.x/this.textureSize.width,filterArea.y/this.textureSize.height),mappedMatrix.scale(1,ratio);var translateScaleX=this.textureSize.width/texture.width,translateScaleY=this.textureSize.height/texture.height;return worldTransform.tx/=texture.width*translateScaleX,worldTransform.ty/=texture.width*translateScaleX,worldTransform.invert(),mappedMatrix.prepend(worldTransform),mappedMatrix.scale(1,1/ratio),mappedMatrix.scale(translateScaleX,translateScaleY),mappedMatrix.translate(sprite.anchor.x,sprite.anchor.y),mappedMatrix},FilterManager.prototype.capFilterArea=function(filterArea){filterArea.x<0&&(filterArea.width+=filterArea.x,filterArea.x=0),filterArea.y<0&&(filterArea.height+=filterArea.y,filterArea.y=0),filterArea.x+filterArea.width>this.textureSize.width&&(filterArea.width=this.textureSize.width-filterArea.x),filterArea.y+filterArea.height>this.textureSize.height&&(filterArea.height=this.textureSize.height-filterArea.y)},FilterManager.prototype.resize=function(width,height){this.textureSize.width=width,this.textureSize.height=height;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].resize(width,height)},FilterManager.prototype.destroy=function(){this.quad.destroy(),WebGLManager.prototype.destroy.call(this),this.filterStack=null,this.offsetY=0;for(var i=0;i<this.texturePool.length;i++)this.texturePool[i].destroy();this.texturePool=null}},{"../../../const":22,"../../../math":33,"../utils/Quad":64,"../utils/RenderTarget":65,"./WebGLManager":58}],55:[function(require,module,exports){function MaskManager(renderer){WebGLManager.call(this,renderer),this.stencilStack=[],this.reverse=!0,this.count=0,this.alphaMaskPool=[]}var WebGLManager=require("./WebGLManager"),AlphaMaskFilter=require("../filters/SpriteMaskFilter");MaskManager.prototype=Object.create(WebGLManager.prototype),MaskManager.prototype.constructor=MaskManager,module.exports=MaskManager,MaskManager.prototype.pushMask=function(target,maskData){maskData.texture?this.pushSpriteMask(target,maskData):this.pushStencilMask(target,maskData)},MaskManager.prototype.popMask=function(target,maskData){maskData.texture?this.popSpriteMask(target,maskData):this.popStencilMask(target,maskData)},MaskManager.prototype.pushSpriteMask=function(target,maskData){var alphaMaskFilter=this.alphaMaskPool.pop();alphaMaskFilter||(alphaMaskFilter=[new AlphaMaskFilter(maskData)]),alphaMaskFilter[0].maskSprite=maskData,this.renderer.filterManager.pushFilter(target,alphaMaskFilter)},MaskManager.prototype.popSpriteMask=function(){var filters=this.renderer.filterManager.popFilter();this.alphaMaskPool.push(filters)},MaskManager.prototype.pushStencilMask=function(target,maskData){this.renderer.stencilManager.pushMask(maskData)},MaskManager.prototype.popStencilMask=function(target,maskData){this.renderer.stencilManager.popMask(maskData)}},{"../filters/SpriteMaskFilter":52,"./WebGLManager":58}],56:[function(require,module,exports){function ShaderManager(renderer){WebGLManager.call(this,renderer),this.maxAttibs=10,this.attribState=[],this.tempAttribState=[];for(var i=0;i<this.maxAttibs;i++)this.attribState[i]=!1;this.stack=[],this._currentId=-1,this.currentShader=null}var WebGLManager=require("./WebGLManager"),TextureShader=require("../shaders/TextureShader"),ComplexPrimitiveShader=require("../shaders/ComplexPrimitiveShader"),PrimitiveShader=require("../shaders/PrimitiveShader"),utils=require("../../../utils");ShaderManager.prototype=Object.create(WebGLManager.prototype),ShaderManager.prototype.constructor=ShaderManager,utils.pluginTarget.mixin(ShaderManager),module.exports=ShaderManager,ShaderManager.prototype.onContextChange=function(){this.initPlugins();var gl=this.renderer.gl;this.maxAttibs=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),this.attribState=[];for(var i=0;i<this.maxAttibs;i++)this.attribState[i]=!1;this.defaultShader=new TextureShader(this),this.primitiveShader=new PrimitiveShader(this),this.complexPrimitiveShader=new ComplexPrimitiveShader(this)},ShaderManager.prototype.setAttribs=function(attribs){var i;for(i=0;i<this.tempAttribState.length;i++)this.tempAttribState[i]=!1;for(var a in attribs)this.tempAttribState[attribs[a]]=!0;var gl=this.renderer.gl;for(i=0;i<this.attribState.length;i++)this.attribState[i]!==this.tempAttribState[i]&&(this.attribState[i]=this.tempAttribState[i],this.attribState[i]?gl.enableVertexAttribArray(i):gl.disableVertexAttribArray(i))},ShaderManager.prototype.setShader=function(shader){return this._currentId!==shader.uid&&(this._currentId=shader.uid,this.currentShader=shader,this.renderer.gl.useProgram(shader.program),this.setAttribs(shader.attributes),!0)},ShaderManager.prototype.destroy=function(){this.primitiveShader.destroy(),this.complexPrimitiveShader.destroy(),WebGLManager.prototype.destroy.call(this),this.destroyPlugins(),this.attribState=null,this.tempAttribState=null}},{"../../../utils":77,"../shaders/ComplexPrimitiveShader":59,"../shaders/PrimitiveShader":60,"../shaders/TextureShader":62,"./WebGLManager":58}],57:[function(require,module,exports){function WebGLMaskManager(renderer){WebGLManager.call(this,renderer),this.stencilMaskStack=null}var WebGLManager=require("./WebGLManager"),utils=require("../../../utils");WebGLMaskManager.prototype=Object.create(WebGLManager.prototype),WebGLMaskManager.prototype.constructor=WebGLMaskManager,module.exports=WebGLMaskManager,WebGLMaskManager.prototype.setMaskStack=function(stencilMaskStack){this.stencilMaskStack=stencilMaskStack;var gl=this.renderer.gl;0===stencilMaskStack.stencilStack.length?gl.disable(gl.STENCIL_TEST):gl.enable(gl.STENCIL_TEST)},WebGLMaskManager.prototype.pushStencil=function(graphics,webGLData){this.renderer.currentRenderTarget.attachStencilBuffer();var gl=this.renderer.gl,sms=this.stencilMaskStack;this.bindGraphics(graphics,webGLData),0===sms.stencilStack.length&&(gl.enable(gl.STENCIL_TEST),gl.clear(gl.STENCIL_BUFFER_BIT),sms.reverse=!0,sms.count=0),sms.stencilStack.push(webGLData);var level=sms.count;gl.colorMask(!1,!1,!1,!1),gl.stencilFunc(gl.ALWAYS,0,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT),1===webGLData.mode?(gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0),sms.reverse?(gl.stencilFunc(gl.EQUAL,255-level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)):(gl.stencilFunc(gl.EQUAL,level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),sms.reverse?gl.stencilFunc(gl.EQUAL,255-(level+1),255):gl.stencilFunc(gl.EQUAL,level+1,255),sms.reverse=!sms.reverse):(sms.reverse?(gl.stencilFunc(gl.EQUAL,level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)):(gl.stencilFunc(gl.EQUAL,255-level,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0),sms.reverse?gl.stencilFunc(gl.EQUAL,level+1,255):gl.stencilFunc(gl.EQUAL,255-(level+1),255)),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP),sms.count++},WebGLMaskManager.prototype.bindGraphics=function(graphics,webGLData){var shader,gl=this.renderer.gl;1===webGLData.mode?(shader=this.renderer.shaderManager.complexPrimitiveShader,this.renderer.shaderManager.setShader(shader),gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,!1,graphics.worldTransform.toArray(!0)),gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint)),gl.uniform3fv(shader.uniforms.color._location,webGLData.color),gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,!1,8,0),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer)):(shader=this.renderer.shaderManager.primitiveShader,this.renderer.shaderManager.setShader(shader),gl.uniformMatrix3fv(shader.uniforms.translationMatrix._location,!1,graphics.worldTransform.toArray(!0)),gl.uniformMatrix3fv(shader.uniforms.projectionMatrix._location,!1,this.renderer.currentRenderTarget.projectionMatrix.toArray(!0)),gl.uniform3fv(shader.uniforms.tint._location,utils.hex2rgb(graphics.tint)),gl.uniform1f(shader.uniforms.alpha._location,graphics.worldAlpha),gl.bindBuffer(gl.ARRAY_BUFFER,webGLData.buffer),gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,!1,24,0),gl.vertexAttribPointer(shader.attributes.aColor,4,gl.FLOAT,!1,24,8),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,webGLData.indexBuffer))},WebGLMaskManager.prototype.popStencil=function(graphics,webGLData){var gl=this.renderer.gl,sms=this.stencilMaskStack;if(sms.stencilStack.pop(),sms.count--,0===sms.stencilStack.length)gl.disable(gl.STENCIL_TEST);else{var level=sms.count;this.bindGraphics(graphics,webGLData),gl.colorMask(!1,!1,!1,!1),1===webGLData.mode?(sms.reverse=!sms.reverse,sms.reverse?(gl.stencilFunc(gl.EQUAL,255-(level+1),255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)):(gl.stencilFunc(gl.EQUAL,level+1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)),gl.drawElements(gl.TRIANGLE_FAN,4,gl.UNSIGNED_SHORT,2*(webGLData.indices.length-4)),gl.stencilFunc(gl.ALWAYS,0,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INVERT),gl.drawElements(gl.TRIANGLE_FAN,webGLData.indices.length-4,gl.UNSIGNED_SHORT,0),this.renderer.drawCount+=2,sms.reverse?gl.stencilFunc(gl.EQUAL,level,255):gl.stencilFunc(gl.EQUAL,255-level,255)):(sms.reverse?(gl.stencilFunc(gl.EQUAL,level+1,255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.DECR)):(gl.stencilFunc(gl.EQUAL,255-(level+1),255),gl.stencilOp(gl.KEEP,gl.KEEP,gl.INCR)),gl.drawElements(gl.TRIANGLE_STRIP,webGLData.indices.length,gl.UNSIGNED_SHORT,0),this.renderer.drawCount++,sms.reverse?gl.stencilFunc(gl.EQUAL,level,255):gl.stencilFunc(gl.EQUAL,255-level,255)),gl.colorMask(!0,!0,!0,!0),gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP)}},WebGLMaskManager.prototype.destroy=function(){WebGLManager.prototype.destroy.call(this),this.stencilMaskStack.stencilStack=null},WebGLMaskManager.prototype.pushMask=function(maskData){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),maskData.dirty&&this.renderer.plugins.graphics.updateGraphics(maskData,this.renderer.gl),maskData._webGL[this.renderer.gl.id].data.length&&this.pushStencil(maskData,maskData._webGL[this.renderer.gl.id].data[0])},WebGLMaskManager.prototype.popMask=function(maskData){this.renderer.setObjectRenderer(this.renderer.plugins.graphics),this.popStencil(maskData,maskData._webGL[this.renderer.gl.id].data[0])}},{"../../../utils":77,"./WebGLManager":58}],58:[function(require,module,exports){function WebGLManager(renderer){this.renderer=renderer,this.renderer.on("context",this.onContextChange,this)}WebGLManager.prototype.constructor=WebGLManager,module.exports=WebGLManager,WebGLManager.prototype.onContextChange=function(){},WebGLManager.prototype.destroy=function(){this.renderer.off("context",this.onContextChange,this),this.renderer=null}},{}],59:[function(require,module,exports){function ComplexPrimitiveShader(shaderManager){Shader.call(this,shaderManager,["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},color:{type:"3f",value:[0,0,0]},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0})}var Shader=require("./Shader");ComplexPrimitiveShader.prototype=Object.create(Shader.prototype),ComplexPrimitiveShader.prototype.constructor=ComplexPrimitiveShader,module.exports=ComplexPrimitiveShader},{"./Shader":61}],60:[function(require,module,exports){function PrimitiveShader(shaderManager){Shader.call(this,shaderManager,["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","uniform float alpha;","uniform float flipY;","uniform vec3 tint;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"].join("\n"),["precision mediump float;","varying vec4 vColor;","void main(void){","   gl_FragColor = vColor;","}"].join("\n"),{tint:{type:"3f",value:[0,0,0]},alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aColor:0})}var Shader=require("./Shader");PrimitiveShader.prototype=Object.create(Shader.prototype),PrimitiveShader.prototype.constructor=PrimitiveShader,module.exports=PrimitiveShader},{"./Shader":61}],61:[function(require,module,exports){function Shader(shaderManager,vertexSrc,fragmentSrc,uniforms,attributes){if(!vertexSrc||!fragmentSrc)throw new Error("Pixi.js Error. Shader requires vertexSrc and fragmentSrc");this.uid=utils.uid(),this.gl=shaderManager.renderer.gl,this.shaderManager=shaderManager,this.program=null,this.uniforms=uniforms||{},this.attributes=attributes||{},this.textureCount=1,this.vertexSrc=vertexSrc,this.fragmentSrc=fragmentSrc,this.init()}var utils=require("../../../utils");Shader.prototype.constructor=Shader,module.exports=Shader,Shader.prototype.init=function(){this.compile(),this.gl.useProgram(this.program),this.cacheUniformLocations(Object.keys(this.uniforms)),this.cacheAttributeLocations(Object.keys(this.attributes))},Shader.prototype.cacheUniformLocations=function(keys){for(var i=0;i<keys.length;++i)this.uniforms[keys[i]]._location=this.gl.getUniformLocation(this.program,keys[i])},Shader.prototype.cacheAttributeLocations=function(keys){for(var i=0;i<keys.length;++i)this.attributes[keys[i]]=this.gl.getAttribLocation(this.program,keys[i])},Shader.prototype.compile=function(){var gl=this.gl,glVertShader=this._glCompile(gl.VERTEX_SHADER,this.vertexSrc),glFragShader=this._glCompile(gl.FRAGMENT_SHADER,this.fragmentSrc),program=gl.createProgram();return gl.attachShader(program,glVertShader),gl.attachShader(program,glFragShader),gl.linkProgram(program),gl.getProgramParameter(program,gl.LINK_STATUS)||(console.error("Pixi.js Error: Could not initialize shader."),console.error("gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS)),console.error("gl.getError()",gl.getError()),""!==gl.getProgramInfoLog(program)&&console.warn("Pixi.js Warning: gl.getProgramInfoLog()",gl.getProgramInfoLog(program)),gl.deleteProgram(program),program=null),gl.deleteShader(glVertShader),gl.deleteShader(glFragShader),this.program=program},Shader.prototype.syncUniform=function(uniform){var i,il,location=uniform._location,value=uniform.value,gl=this.gl;switch(uniform.type){case"b":case"bool":case"boolean":gl.uniform1i(location,value?1:0);break;case"i":case"1i":gl.uniform1i(location,value);break;case"f":case"1f":gl.uniform1f(location,value);break;case"2f":gl.uniform2f(location,value[0],value[1]);break;case"3f":gl.uniform3f(location,value[0],value[1],value[2]);break;case"4f":gl.uniform4f(location,value[0],value[1],value[2],value[3]);break;case"v2":gl.uniform2f(location,value.x,value.y);break;case"v3":gl.uniform3f(location,value.x,value.y,value.z);break;case"v4":gl.uniform4f(location,value.x,value.y,value.z,value.w);break;case"1iv":gl.uniform1iv(location,value);break;case"2iv":gl.uniform2iv(location,value);break;case"3iv":gl.uniform3iv(location,value);break;case"4iv":gl.uniform4iv(location,value);break;case"1fv":gl.uniform1fv(location,value);break;case"2fv":gl.uniform2fv(location,value);break;case"3fv":gl.uniform3fv(location,value);break;case"4fv":gl.uniform4fv(location,value);break;case"m2":case"mat2":case"Matrix2fv":gl.uniformMatrix2fv(location,uniform.transpose,value);break;case"m3":case"mat3":case"Matrix3fv":gl.uniformMatrix3fv(location,uniform.transpose,value);break;case"m4":case"mat4":case"Matrix4fv":gl.uniformMatrix4fv(location,uniform.transpose,value);break;case"c":"number"==typeof value&&(value=utils.hex2rgb(value)),gl.uniform3f(location,value[0],value[1],value[2]);break;case"iv1":gl.uniform1iv(location,value);break;case"iv":gl.uniform3iv(location,value);break;case"fv1":gl.uniform1fv(location,value);break;case"fv":gl.uniform3fv(location,value);break;case"v2v":for(uniform._array||(uniform._array=new Float32Array(2*value.length)),i=0,il=value.length;i<il;++i)uniform._array[2*i]=value[i].x,uniform._array[2*i+1]=value[i].y;gl.uniform2fv(location,uniform._array);break;case"v3v":for(uniform._array||(uniform._array=new Float32Array(3*value.length)),i=0,il=value.length;i<il;++i)uniform._array[3*i]=value[i].x,uniform._array[3*i+1]=value[i].y,uniform._array[3*i+2]=value[i].z;gl.uniform3fv(location,uniform._array);break;case"v4v":for(uniform._array||(uniform._array=new Float32Array(4*value.length)),i=0,il=value.length;i<il;++i)uniform._array[4*i]=value[i].x,uniform._array[4*i+1]=value[i].y,uniform._array[4*i+2]=value[i].z,uniform._array[4*i+3]=value[i].w;gl.uniform4fv(location,uniform._array);break;case"t":case"sampler2D":if(!uniform.value||!uniform.value.baseTexture.hasLoaded)break;gl.activeTexture(gl["TEXTURE"+this.textureCount]);var texture=uniform.value.baseTexture._glTextures[gl.id];texture||(this.initSampler2D(uniform),texture=uniform.value.baseTexture._glTextures[gl.id]),gl.bindTexture(gl.TEXTURE_2D,texture),gl.uniform1i(uniform._location,this.textureCount),this.textureCount++;break;default:console.warn("Pixi.js Shader Warning: Unknown uniform type: "+uniform.type)}},Shader.prototype.syncUniforms=function(){this.textureCount=1;for(var key in this.uniforms)this.syncUniform(this.uniforms[key])},Shader.prototype.initSampler2D=function(uniform){var gl=this.gl,texture=uniform.value.baseTexture;if(texture.hasLoaded)if(uniform.textureData){var data=uniform.textureData;texture._glTextures[gl.id]=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultipliedAlpha),gl.texImage2D(gl.TEXTURE_2D,0,data.luminance?gl.LUMINANCE:gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,texture.source),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,data.magFilter?data.magFilter:gl.LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,data.wrapS?data.wrapS:gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,data.wrapS?data.wrapS:gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,data.wrapT?data.wrapT:gl.CLAMP_TO_EDGE)}else this.shaderManager.renderer.updateTexture(texture)},Shader.prototype.destroy=function(){this.gl.deleteProgram(this.program),this.gl=null,this.uniforms=null,this.attributes=null,this.vertexSrc=null,this.fragmentSrc=null},Shader.prototype._glCompile=function(type,src){var shader=this.gl.createShader(type);return this.gl.shaderSource(shader,src),this.gl.compileShader(shader),this.gl.getShaderParameter(shader,this.gl.COMPILE_STATUS)?shader:(console.log(this.gl.getShaderInfoLog(shader)),null)}},{"../../../utils":77}],62:[function(require,module,exports){function TextureShader(shaderManager,vertexSrc,fragmentSrc,customUniforms,customAttributes){var uniforms={uSampler:{type:"sampler2D",value:0},projectionMatrix:{type:"mat3",value:new Float32Array([1,0,0,0,1,0,0,0,1])}};if(customUniforms)for(var u in customUniforms)uniforms[u]=customUniforms[u];var attributes={aVertexPosition:0,aTextureCoord:0,aColor:0};if(customAttributes)for(var a in customAttributes)attributes[a]=customAttributes[a];vertexSrc=vertexSrc||TextureShader.defaultVertexSrc,fragmentSrc=fragmentSrc||TextureShader.defaultFragmentSrc,Shader.call(this,shaderManager,vertexSrc,fragmentSrc,uniforms,attributes)}var Shader=require("./Shader");TextureShader.prototype=Object.create(Shader.prototype),TextureShader.prototype.constructor=TextureShader,module.exports=TextureShader,TextureShader.defaultVertexSrc=["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),TextureShader.defaultFragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"].join("\n")},{"./Shader":61}],63:[function(require,module,exports){function ObjectRenderer(renderer){WebGLManager.call(this,renderer)}var WebGLManager=require("../managers/WebGLManager");ObjectRenderer.prototype=Object.create(WebGLManager.prototype),ObjectRenderer.prototype.constructor=ObjectRenderer,module.exports=ObjectRenderer,ObjectRenderer.prototype.start=function(){},ObjectRenderer.prototype.stop=function(){this.flush()},ObjectRenderer.prototype.flush=function(){},ObjectRenderer.prototype.render=function(object){}},{"../managers/WebGLManager":58}],64:[function(require,module,exports){function Quad(gl){this.gl=gl,this.vertices=new Float32Array([0,0,200,0,200,200,0,200]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.colors=new Float32Array([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]),this.indices=new Uint16Array([0,1,2,0,3,2]),this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,128,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW),this.upload()}Quad.prototype.constructor=Quad,Quad.prototype.map=function(rect,rect2){var x=0,y=0;this.uvs[0]=x,this.uvs[1]=y,this.uvs[2]=x+rect2.width/rect.width,this.uvs[3]=y,this.uvs[4]=x+rect2.width/rect.width,this.uvs[5]=y+rect2.height/rect.height,this.uvs[6]=x,this.uvs[7]=y+rect2.height/rect.height,x=rect2.x,y=rect2.y,this.vertices[0]=x,this.vertices[1]=y,this.vertices[2]=x+rect2.width,this.vertices[3]=y,this.vertices[4]=x+rect2.width,this.vertices[5]=y+rect2.height,this.vertices[6]=x,this.vertices[7]=y+rect2.height,this.upload()},Quad.prototype.upload=function(){var gl=this.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices),gl.bufferSubData(gl.ARRAY_BUFFER,32,this.uvs),gl.bufferSubData(gl.ARRAY_BUFFER,64,this.colors)},Quad.prototype.destroy=function(){var gl=this.gl;gl.deleteBuffer(this.vertexBuffer),gl.deleteBuffer(this.indexBuffer)},module.exports=Quad},{}],65:[function(require,module,exports){var math=require("../../../math"),utils=require("../../../utils"),CONST=require("../../../const"),StencilMaskStack=require("./StencilMaskStack"),RenderTarget=function(gl,width,height,scaleMode,resolution,root){if(this.gl=gl,this.frameBuffer=null,this.texture=null,this.size=new math.Rectangle(0,0,1,1),this.resolution=resolution||CONST.RESOLUTION,this.projectionMatrix=new math.Matrix,this.transform=null,this.frame=null,this.stencilBuffer=null,this.stencilMaskStack=new StencilMaskStack,this.filterStack=[{renderTarget:this,filter:[],bounds:this.size}],this.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT,this.root=root,!this.root){this.frameBuffer=gl.createFramebuffer(),this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST),
gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,scaleMode===CONST.SCALE_MODES.LINEAR?gl.LINEAR:gl.NEAREST);var isPowerOfTwo=utils.isPowerOfTwo(width,height);isPowerOfTwo?(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.REPEAT),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.REPEAT)):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE)),gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,this.texture,0)}this.resize(width,height)};RenderTarget.prototype.constructor=RenderTarget,module.exports=RenderTarget,RenderTarget.prototype.clear=function(bind){var gl=this.gl;bind&&gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer),gl.clearColor(0,0,0,0),gl.clear(gl.COLOR_BUFFER_BIT)},RenderTarget.prototype.attachStencilBuffer=function(){if(!this.stencilBuffer&&!this.root){var gl=this.gl;this.stencilBuffer=gl.createRenderbuffer(),gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencilBuffer),gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,this.stencilBuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,this.size.width*this.resolution,this.size.height*this.resolution)}},RenderTarget.prototype.activate=function(){var gl=this.gl;gl.bindFramebuffer(gl.FRAMEBUFFER,this.frameBuffer);var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame),this.transform&&this.projectionMatrix.append(this.transform),gl.viewport(0,0,projectionFrame.width*this.resolution,projectionFrame.height*this.resolution)},RenderTarget.prototype.calculateProjection=function(projectionFrame){var pm=this.projectionMatrix;pm.identity(),this.root?(pm.a=1/projectionFrame.width*2,pm.d=-1/projectionFrame.height*2,pm.tx=-1-projectionFrame.x*pm.a,pm.ty=1-projectionFrame.y*pm.d):(pm.a=1/projectionFrame.width*2,pm.d=1/projectionFrame.height*2,pm.tx=-1-projectionFrame.x*pm.a,pm.ty=-1-projectionFrame.y*pm.d)},RenderTarget.prototype.resize=function(width,height){if(width=0|width,height=0|height,this.size.width!==width||this.size.height!==height){if(this.size.width=width,this.size.height=height,!this.root){var gl=this.gl;gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,width*this.resolution,height*this.resolution,0,gl.RGBA,gl.UNSIGNED_BYTE,null),this.stencilBuffer&&(gl.bindRenderbuffer(gl.RENDERBUFFER,this.stencilBuffer),gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,width*this.resolution,height*this.resolution))}var projectionFrame=this.frame||this.size;this.calculateProjection(projectionFrame)}},RenderTarget.prototype.destroy=function(){var gl=this.gl;gl.deleteRenderbuffer(this.stencilBuffer),gl.deleteFramebuffer(this.frameBuffer),gl.deleteTexture(this.texture),this.frameBuffer=null,this.texture=null}},{"../../../const":22,"../../../math":33,"../../../utils":77,"./StencilMaskStack":66}],66:[function(require,module,exports){function StencilMaskStack(){this.stencilStack=[],this.reverse=!0,this.count=0}StencilMaskStack.prototype.constructor=StencilMaskStack,module.exports=StencilMaskStack},{}],67:[function(require,module,exports){function Sprite(texture){Container.call(this),this.anchor=new math.Point,this._texture=null,this._width=0,this._height=0,this.tint=16777215,this.blendMode=CONST.BLEND_MODES.NORMAL,this.shader=null,this.cachedTint=16777215,this.texture=texture||Texture.EMPTY}var math=require("../math"),Texture=require("../textures/Texture"),Container=require("../display/Container"),CanvasTinter=require("../renderers/canvas/utils/CanvasTinter"),utils=require("../utils"),CONST=require("../const"),tempPoint=new math.Point,GroupD8=math.GroupD8,canvasRenderWorldTransform=new math.Matrix;Sprite.prototype=Object.create(Container.prototype),Sprite.prototype.constructor=Sprite,module.exports=Sprite,Object.defineProperties(Sprite.prototype,{width:{get:function(){return Math.abs(this.scale.x)*this.texture._frame.width},set:function(value){var sign=utils.sign(this.scale.x)||1;this.scale.x=sign*value/this.texture._frame.width,this._width=value}},height:{get:function(){return Math.abs(this.scale.y)*this.texture._frame.height},set:function(value){var sign=utils.sign(this.scale.y)||1;this.scale.y=sign*value/this.texture._frame.height,this._height=value}},texture:{get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture=value,this.cachedTint=16777215,value&&(value.baseTexture.hasLoaded?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))}}}),Sprite.prototype._onTextureUpdate=function(){this._width&&(this.scale.x=utils.sign(this.scale.x)*this._width/this.texture.frame.width),this._height&&(this.scale.y=utils.sign(this.scale.y)*this._height/this.texture.frame.height)},Sprite.prototype._renderWebGL=function(renderer){renderer.setObjectRenderer(renderer.plugins.sprite),renderer.plugins.sprite.render(this)},Sprite.prototype.getBounds=function(matrix){if(!this._currentBounds){var minX,maxX,minY,maxY,width=this._texture._frame.width,height=this._texture._frame.height,w0=width*(1-this.anchor.x),w1=width*-this.anchor.x,h0=height*(1-this.anchor.y),h1=height*-this.anchor.y,worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty;if(minX=x1,minX=x2<minX?x2:minX,minX=x3<minX?x3:minX,minX=x4<minX?x4:minX,minY=y1,minY=y2<minY?y2:minY,minY=y3<minY?y3:minY,minY=y4<minY?y4:minY,maxX=x1,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y1,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY,this.children.length){var childBounds=this.containerGetBounds();w0=childBounds.x,w1=childBounds.x+childBounds.width,h0=childBounds.y,h1=childBounds.y+childBounds.height,minX=minX<w0?minX:w0,minY=minY<h0?minY:h0,maxX=maxX>w1?maxX:w1,maxY=maxY>h1?maxY:h1}var bounds=this._bounds;bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds}return this._currentBounds},Sprite.prototype.getLocalBounds=function(){return this._bounds.x=-this._texture._frame.width*this.anchor.x,this._bounds.y=-this._texture._frame.height*this.anchor.y,this._bounds.width=this._texture._frame.width,this._bounds.height=this._texture._frame.height,this._bounds},Sprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var y1,width=this._texture._frame.width,height=this._texture._frame.height,x1=-width*this.anchor.x;return tempPoint.x>x1&&tempPoint.x<x1+width&&(y1=-height*this.anchor.y,tempPoint.y>y1&&tempPoint.y<y1+height)},Sprite.prototype._renderCanvas=function(renderer){if(!(this.texture.crop.width<=0||this.texture.crop.height<=0)){var compositeOperation=renderer.blendModes[this.blendMode];if(compositeOperation!==renderer.context.globalCompositeOperation&&(renderer.context.globalCompositeOperation=compositeOperation),this.texture.valid){var dx,dy,texture=this._texture,wt=this.worldTransform,width=texture.crop.width,height=texture.crop.height;renderer.context.globalAlpha=this.worldAlpha;var smoothingEnabled=texture.baseTexture.scaleMode===CONST.SCALE_MODES.LINEAR;renderer.smoothProperty&&renderer.context[renderer.smoothProperty]!==smoothingEnabled&&(renderer.context[renderer.smoothProperty]=smoothingEnabled),2===(3&texture.rotate)&&(width=texture.crop.height,height=texture.crop.width),texture.trim?(dx=texture.crop.width/2+texture.trim.x-this.anchor.x*texture.trim.width,dy=texture.crop.height/2+texture.trim.y-this.anchor.y*texture.trim.height):(dx=(.5-this.anchor.x)*texture._frame.width,dy=(.5-this.anchor.y)*texture._frame.height),texture.rotate&&(wt.copy(canvasRenderWorldTransform),wt=canvasRenderWorldTransform,GroupD8.matrixAppendRotationInv(wt,texture.rotate,dx,dy),dx=0,dy=0),dx-=width/2,dy-=height/2,renderer.roundPixels?(renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution|0,wt.ty*renderer.resolution|0),dx=0|dx,dy=0|dy):renderer.context.setTransform(wt.a,wt.b,wt.c,wt.d,wt.tx*renderer.resolution,wt.ty*renderer.resolution);var resolution=texture.baseTexture.resolution;16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=CanvasTinter.getTintedTexture(this,this.tint)),renderer.context.drawImage(this.tintedTexture,0,0,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)):renderer.context.drawImage(texture.baseTexture.source,texture.crop.x*resolution,texture.crop.y*resolution,width*resolution,height*resolution,dx*renderer.resolution,dy*renderer.resolution,width*renderer.resolution,height*renderer.resolution)}}},Sprite.prototype.destroy=function(destroyTexture,destroyBaseTexture){Container.prototype.destroy.call(this),this.anchor=null,destroyTexture&&this._texture.destroy(destroyBaseTexture),this._texture=null,this.shader=null},Sprite.fromFrame=function(frameId){var texture=utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache');return new Sprite(texture)},Sprite.fromImage=function(imageId,crossorigin,scaleMode){return new Sprite(Texture.fromImage(imageId,crossorigin,scaleMode))}},{"../const":22,"../display/Container":23,"../math":33,"../renderers/canvas/utils/CanvasTinter":48,"../textures/Texture":72,"../utils":77}],68:[function(require,module,exports){function SpriteRenderer(renderer){ObjectRenderer.call(this,renderer),this.vertSize=5,this.vertByteSize=4*this.vertSize,this.size=CONST.SPRITE_BATCH_SIZE;var numVerts=4*this.size*this.vertByteSize,numIndices=6*this.size;this.vertices=new ArrayBuffer(numVerts),this.positions=new Float32Array(this.vertices),this.colors=new Uint32Array(this.vertices),this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4)this.indices[i+0]=j+0,this.indices[i+1]=j+1,this.indices[i+2]=j+2,this.indices[i+3]=j+0,this.indices[i+4]=j+2,this.indices[i+5]=j+3;this.currentBatchSize=0,this.sprites=[],this.shader=null}var ObjectRenderer=require("../../renderers/webgl/utils/ObjectRenderer"),WebGLRenderer=require("../../renderers/webgl/WebGLRenderer"),CONST=require("../../const");SpriteRenderer.prototype=Object.create(ObjectRenderer.prototype),SpriteRenderer.prototype.constructor=SpriteRenderer,module.exports=SpriteRenderer,WebGLRenderer.registerPlugin("sprite",SpriteRenderer),SpriteRenderer.prototype.onContextChange=function(){var gl=this.renderer.gl;this.shader=this.renderer.shaderManager.defaultShader,this.vertexBuffer=gl.createBuffer(),this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,gl.STATIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,this.vertices,gl.DYNAMIC_DRAW),this.currentBlendMode=99999},SpriteRenderer.prototype.render=function(sprite){var texture=sprite._texture;this.currentBatchSize>=this.size&&this.flush();var uvs=texture._uvs;if(uvs){var w0,w1,h0,h1,aX=sprite.anchor.x,aY=sprite.anchor.y;if(texture.trim&&void 0===sprite.tileScale){var trim=texture.trim;w1=trim.x-aX*trim.width,w0=w1+texture.crop.width,h1=trim.y-aY*trim.height,h0=h1+texture.crop.height}else w0=texture._frame.width*(1-aX),w1=texture._frame.width*-aX,h0=texture._frame.height*(1-aY),h1=texture._frame.height*-aY;var index=this.currentBatchSize*this.vertByteSize,worldTransform=sprite.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,colors=this.colors,positions=this.positions;if(this.renderer.roundPixels){var resolution=this.renderer.resolution;positions[index]=((a*w1+c*h1+tx)*resolution|0)/resolution,positions[index+1]=((d*h1+b*w1+ty)*resolution|0)/resolution,positions[index+5]=((a*w0+c*h1+tx)*resolution|0)/resolution,positions[index+6]=((d*h1+b*w0+ty)*resolution|0)/resolution,positions[index+10]=((a*w0+c*h0+tx)*resolution|0)/resolution,positions[index+11]=((d*h0+b*w0+ty)*resolution|0)/resolution,positions[index+15]=((a*w1+c*h0+tx)*resolution|0)/resolution,positions[index+16]=((d*h0+b*w1+ty)*resolution|0)/resolution}else positions[index]=a*w1+c*h1+tx,positions[index+1]=d*h1+b*w1+ty,positions[index+5]=a*w0+c*h1+tx,positions[index+6]=d*h1+b*w0+ty,positions[index+10]=a*w0+c*h0+tx,positions[index+11]=d*h0+b*w0+ty,positions[index+15]=a*w1+c*h0+tx,positions[index+16]=d*h0+b*w1+ty;positions[index+2]=uvs.x0,positions[index+3]=uvs.y0,positions[index+7]=uvs.x1,positions[index+8]=uvs.y1,positions[index+12]=uvs.x2,positions[index+13]=uvs.y2,positions[index+17]=uvs.x3,positions[index+18]=uvs.y3;var tint=sprite.tint;colors[index+4]=colors[index+9]=colors[index+14]=colors[index+19]=(tint>>16)+(65280&tint)+((255&tint)<<16)+(255*sprite.worldAlpha<<24),this.sprites[this.currentBatchSize++]=sprite}},SpriteRenderer.prototype.flush=function(){if(0!==this.currentBatchSize){var shader,gl=this.renderer.gl;if(this.currentBatchSize>.5*this.size)gl.bufferSubData(gl.ARRAY_BUFFER,0,this.vertices);else{var view=this.positions.subarray(0,this.currentBatchSize*this.vertByteSize);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}for(var nextTexture,nextBlendMode,nextShader,sprite,batchSize=0,start=0,currentBaseTexture=null,currentBlendMode=this.renderer.blendModeManager.currentBlendMode,currentShader=null,blendSwap=!1,shaderSwap=!1,i=0,j=this.currentBatchSize;i<j;i++)sprite=this.sprites[i],nextTexture=sprite._texture.baseTexture,nextBlendMode=sprite.blendMode,nextShader=sprite.shader||this.shader,blendSwap=currentBlendMode!==nextBlendMode,shaderSwap=currentShader!==nextShader,(currentBaseTexture!==nextTexture||blendSwap||shaderSwap)&&(this.renderBatch(currentBaseTexture,batchSize,start),start=i,batchSize=0,currentBaseTexture=nextTexture,blendSwap&&(currentBlendMode=nextBlendMode,this.renderer.blendModeManager.setBlendMode(currentBlendMode)),shaderSwap&&(currentShader=nextShader,shader=currentShader.shaders?currentShader.shaders[gl.id]:currentShader,shader||(shader=currentShader.getShader(this.renderer)),this.renderer.shaderManager.setShader(shader),shader.uniforms.projectionMatrix.value=this.renderer.currentRenderTarget.projectionMatrix.toArray(!0),shader.syncUniforms(),gl.activeTexture(gl.TEXTURE0))),batchSize++;this.renderBatch(currentBaseTexture,batchSize,start),this.currentBatchSize=0}},SpriteRenderer.prototype.renderBatch=function(texture,size,startIndex){if(0!==size){var gl=this.renderer.gl;texture._glTextures[gl.id]?gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]):this.renderer.updateTexture(texture),gl.drawElements(gl.TRIANGLES,6*size,gl.UNSIGNED_SHORT,6*startIndex*2),this.renderer.drawCount++}},SpriteRenderer.prototype.start=function(){var gl=this.renderer.gl;gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);var stride=this.vertByteSize;gl.vertexAttribPointer(this.shader.attributes.aVertexPosition,2,gl.FLOAT,!1,stride,0),gl.vertexAttribPointer(this.shader.attributes.aTextureCoord,2,gl.FLOAT,!1,stride,8),gl.vertexAttribPointer(this.shader.attributes.aColor,4,gl.UNSIGNED_BYTE,!0,stride,16)},SpriteRenderer.prototype.destroy=function(){this.renderer.gl.deleteBuffer(this.vertexBuffer),this.renderer.gl.deleteBuffer(this.indexBuffer),ObjectRenderer.prototype.destroy.call(this),this.shader.destroy(),this.renderer=null,this.vertices=null,this.positions=null,this.colors=null,this.indices=null,this.vertexBuffer=null,this.indexBuffer=null,this.sprites=null,this.shader=null}},{"../../const":22,"../../renderers/webgl/WebGLRenderer":49,"../../renderers/webgl/utils/ObjectRenderer":63}],69:[function(require,module,exports){function Text(text,style,resolution){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.resolution=resolution||CONST.RESOLUTION,this._text=null,this._style=null;var texture=Texture.fromCanvas(this.canvas);texture.trim=new math.Rectangle,Sprite.call(this,texture),this.text=text,this.style=style}var Sprite=require("../sprites/Sprite"),Texture=require("../textures/Texture"),math=require("../math"),utils=require("../utils"),CONST=require("../const");Text.prototype=Object.create(Sprite.prototype),Text.prototype.constructor=Text,module.exports=Text,Text.fontPropertiesCache={},Text.fontPropertiesCanvas=document.createElement("canvas"),Text.fontPropertiesContext=Text.fontPropertiesCanvas.getContext("2d"),Object.defineProperties(Text.prototype,{width:{get:function(){return this.dirty&&this.updateText(),this.scale.x*this._texture._frame.width},set:function(value){this.scale.x=value/this._texture._frame.width,this._width=value}},height:{get:function(){return this.dirty&&this.updateText(),this.scale.y*this._texture._frame.height},set:function(value){this.scale.y=value/this._texture._frame.height,this._height=value}},style:{get:function(){return this._style},set:function(style){style=style||{},"number"==typeof style.fill&&(style.fill=utils.hex2string(style.fill)),"number"==typeof style.stroke&&(style.stroke=utils.hex2string(style.stroke)),"number"==typeof style.dropShadowColor&&(style.dropShadowColor=utils.hex2string(style.dropShadowColor)),style.font=style.font||"bold 20pt Arial",style.fill=style.fill||"black",style.align=style.align||"left",style.stroke=style.stroke||"black",style.strokeThickness=style.strokeThickness||0,style.wordWrap=style.wordWrap||!1,style.wordWrapWidth=style.wordWrapWidth||100,style.breakWords=style.breakWords||!1,style.letterSpacing=style.letterSpacing||0,style.dropShadow=style.dropShadow||!1,style.dropShadowColor=style.dropShadowColor||"#000000",style.dropShadowAngle=void 0!==style.dropShadowAngle?style.dropShadowAngle:Math.PI/6,style.dropShadowDistance=void 0!==style.dropShadowDistance?style.dropShadowDistance:5,style.dropShadowBlur=void 0!==style.dropShadowBlur?style.dropShadowBlur:0,style.padding=style.padding||0,style.textBaseline=style.textBaseline||"alphabetic",style.lineJoin=style.lineJoin||"miter",style.miterLimit=style.miterLimit||10,this._style=style,this.dirty=!0}},text:{get:function(){return this._text},set:function(text){text=text.toString()||" ",this._text!==text&&(this._text=text,this.dirty=!0)}}}),Text.prototype.updateText=function(){var style=this._style;this.context.font=style.font;for(var outputText=style.wordWrap?this.wordWrap(this._text):this._text,lines=outputText.split(/(?:\r\n|\r|\n)/),lineWidths=new Array(lines.length),maxLineWidth=0,fontProperties=this.determineFontProperties(style.font),i=0;i<lines.length;i++){var lineWidth=this.context.measureText(lines[i]).width+(lines[i].length-1)*style.letterSpacing;lineWidths[i]=lineWidth,maxLineWidth=Math.max(maxLineWidth,lineWidth)}var width=maxLineWidth+style.strokeThickness;style.dropShadow&&(width+=style.dropShadowDistance),this.canvas.width=Math.ceil((width+this.context.lineWidth)*this.resolution);var lineHeight=this.style.lineHeight||fontProperties.fontSize+style.strokeThickness,height=lineHeight*lines.length;style.dropShadow&&(height+=style.dropShadowDistance),this.canvas.height=Math.ceil((height+2*this._style.padding)*this.resolution),this.context.scale(this.resolution,this.resolution),navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=style.font,this.context.strokeStyle=style.stroke,this.context.lineWidth=style.strokeThickness,this.context.textBaseline=style.textBaseline,this.context.lineJoin=style.lineJoin,this.context.miterLimit=style.miterLimit;var linePositionX,linePositionY;if(style.dropShadow){style.dropShadowBlur>0?(this.context.shadowColor=style.dropShadowColor,this.context.shadowBlur=style.dropShadowBlur):this.context.fillStyle=style.dropShadowColor;var xShadowOffset=Math.cos(style.dropShadowAngle)*style.dropShadowDistance,yShadowOffset=Math.sin(style.dropShadowAngle)*style.dropShadowDistance;for(i=0;i<lines.length;i++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent,"right"===style.align?linePositionX+=maxLineWidth-lineWidths[i]:"center"===style.align&&(linePositionX+=(maxLineWidth-lineWidths[i])/2),style.fill&&this.drawLetterSpacing(lines[i],linePositionX+xShadowOffset,linePositionY+yShadowOffset+style.padding)}for(this.context.fillStyle=style.fill,i=0;i<lines.length;i++)linePositionX=style.strokeThickness/2,linePositionY=style.strokeThickness/2+i*lineHeight+fontProperties.ascent,"right"===style.align?linePositionX+=maxLineWidth-lineWidths[i]:"center"===style.align&&(linePositionX+=(maxLineWidth-lineWidths[i])/2),style.stroke&&style.strokeThickness&&this.drawLetterSpacing(lines[i],linePositionX,linePositionY+style.padding,!0),style.fill&&this.drawLetterSpacing(lines[i],linePositionX,linePositionY+style.padding);this.updateTexture()},Text.prototype.drawLetterSpacing=function(text,x,y,isStroke){var style=this._style,letterSpacing=style.letterSpacing;if(0===letterSpacing)return void(isStroke?this.context.strokeText(text,x,y):this.context.fillText(text,x,y));for(var current,characters=String.prototype.split.call(text,""),index=0,currentPosition=x;index<text.length;)current=characters[index++],isStroke?this.context.strokeText(current,currentPosition,y):this.context.fillText(current,currentPosition,y),currentPosition+=this.context.measureText(current).width+letterSpacing},Text.prototype.updateTexture=function(){var texture=this._texture,style=this._style;texture.baseTexture.hasLoaded=!0,texture.baseTexture.resolution=this.resolution,texture.baseTexture.width=this.canvas.width/this.resolution,texture.baseTexture.height=this.canvas.height/this.resolution,texture.crop.width=texture._frame.width=this.canvas.width/this.resolution,texture.crop.height=texture._frame.height=this.canvas.height/this.resolution,texture.trim.x=0,texture.trim.y=-style.padding,texture.trim.width=texture._frame.width,texture.trim.height=texture._frame.height-2*style.padding,this._width=this.canvas.width/this.resolution,this._height=this.canvas.height/this.resolution,texture.baseTexture.emit("update",texture.baseTexture),this.dirty=!1},Text.prototype.renderWebGL=function(renderer){this.dirty&&this.updateText(),Sprite.prototype.renderWebGL.call(this,renderer)},Text.prototype._renderCanvas=function(renderer){this.dirty&&this.updateText(),Sprite.prototype._renderCanvas.call(this,renderer)},Text.prototype.determineFontProperties=function(fontStyle){var properties=Text.fontPropertiesCache[fontStyle];if(!properties){properties={};var canvas=Text.fontPropertiesCanvas,context=Text.fontPropertiesContext;context.font=fontStyle;var width=Math.ceil(context.measureText("|MÉq").width),baseline=Math.ceil(context.measureText("M").width),height=2*baseline;baseline=1.4*baseline|0,canvas.width=width,canvas.height=height,context.fillStyle="#f00",context.fillRect(0,0,width,height),context.font=fontStyle,context.textBaseline="alphabetic",context.fillStyle="#000",context.fillText("|MÉq",0,baseline);var i,j,imagedata=context.getImageData(0,0,width,height).data,pixels=imagedata.length,line=4*width,idx=0,stop=!1;for(i=0;i<baseline;i++){for(j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx+=line}for(properties.ascent=baseline-i,idx=pixels-line,stop=!1,i=height;i>baseline;i--){for(j=0;j<line;j+=4)if(255!==imagedata[idx+j]){stop=!0;break}if(stop)break;idx-=line}properties.descent=i-baseline,properties.fontSize=properties.ascent+properties.descent,Text.fontPropertiesCache[fontStyle]=properties}return properties},Text.prototype.wordWrap=function(text){for(var result="",lines=text.split("\n"),wordWrapWidth=this._style.wordWrapWidth,i=0;i<lines.length;i++){for(var spaceLeft=wordWrapWidth,words=lines[i].split(" "),j=0;j<words.length;j++){var wordWidth=this.context.measureText(words[j]).width;if(this._style.breakWords&&wordWidth>wordWrapWidth)for(var characters=words[j].split(""),c=0;c<characters.length;c++){var characterWidth=this.context.measureText(characters[c]).width;characterWidth>spaceLeft?(result+="\n"+characters[c],spaceLeft=wordWrapWidth-characterWidth):(0===c&&(result+=" "),result+=characters[c],spaceLeft-=characterWidth)}else{var wordWidthWithSpace=wordWidth+this.context.measureText(" ").width;0===j||wordWidthWithSpace>spaceLeft?(j>0&&(result+="\n"),result+=words[j],spaceLeft=wordWrapWidth-wordWidth):(spaceLeft-=wordWidthWithSpace,result+=" "+words[j])}}i<lines.length-1&&(result+="\n")}return result},Text.prototype.getBounds=function(matrix){return this.dirty&&this.updateText(),Sprite.prototype.getBounds.call(this,matrix)},Text.prototype.destroy=function(destroyBaseTexture){this.context=null,this.canvas=null,this._style=null,this._texture.destroy(void 0===destroyBaseTexture||destroyBaseTexture)}},{"../const":22,"../math":33,"../sprites/Sprite":67,"../textures/Texture":72,"../utils":77}],70:[function(require,module,exports){function BaseTexture(source,scaleMode,resolution){EventEmitter.call(this),this.uid=utils.uid(),this.resolution=resolution||1,this.width=100,this.height=100,this.realWidth=100,this.realHeight=100,this.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT,this.hasLoaded=!1,this.isLoading=!1,this.source=null,this.premultipliedAlpha=!0,this.imageUrl=null,this.isPowerOfTwo=!1,this.mipmap=!1,this._glTextures={},source&&this.loadSource(source)}var utils=require("../utils"),CONST=require("../const"),EventEmitter=require("eventemitter3");BaseTexture.prototype=Object.create(EventEmitter.prototype),BaseTexture.prototype.constructor=BaseTexture,module.exports=BaseTexture,BaseTexture.prototype.update=function(){this.realWidth=this.source.naturalWidth||this.source.width,this.realHeight=this.source.naturalHeight||this.source.height,this.width=this.realWidth/this.resolution,this.height=this.realHeight/this.resolution,this.isPowerOfTwo=utils.isPowerOfTwo(this.realWidth,this.realHeight),this.emit("update",this)},BaseTexture.prototype.loadSource=function(source){var wasLoading=this.isLoading;if(this.hasLoaded=!1,this.isLoading=!1,wasLoading&&this.source&&(this.source.onload=null,this.source.onerror=null),this.source=source,(this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this._sourceLoaded();else if(!source.getContext){this.isLoading=!0;var scope=this;source.onload=function(){source.onload=null,source.onerror=null,scope.isLoading&&(scope.isLoading=!1,scope._sourceLoaded(),scope.emit("loaded",scope))},source.onerror=function(){source.onload=null,source.onerror=null,scope.isLoading&&(scope.isLoading=!1,scope.emit("error",scope))},source.complete&&source.src&&(this.isLoading=!1,source.onload=null,source.onerror=null,source.width&&source.height?(this._sourceLoaded(),wasLoading&&this.emit("loaded",this)):wasLoading&&this.emit("error",this))}},BaseTexture.prototype._sourceLoaded=function(){this.hasLoaded=!0,this.update()},BaseTexture.prototype.destroy=function(){this.imageUrl?(delete utils.BaseTextureCache[this.imageUrl],delete utils.TextureCache[this.imageUrl],this.imageUrl=null,navigator.isCocoonJS||(this.source.src="")):this.source&&this.source._pixiId&&delete utils.BaseTextureCache[this.source._pixiId],this.source=null,this.dispose()},BaseTexture.prototype.dispose=function(){this.emit("dispose",this)},BaseTexture.prototype.updateSourceImage=function(newSrc){this.source.src=newSrc,this.loadSource(this.source)},BaseTexture.fromImage=function(imageUrl,crossorigin,scaleMode){var baseTexture=utils.BaseTextureCache[imageUrl];if(void 0===crossorigin&&0!==imageUrl.indexOf("data:")&&(crossorigin=!0),!baseTexture){var image=new Image;crossorigin&&(image.crossOrigin=""),baseTexture=new BaseTexture(image,scaleMode),baseTexture.imageUrl=imageUrl,image.src=imageUrl,utils.BaseTextureCache[imageUrl]=baseTexture,baseTexture.resolution=utils.getResolutionOfUrl(imageUrl)}return baseTexture},BaseTexture.fromCanvas=function(canvas,scaleMode){canvas._pixiId||(canvas._pixiId="canvas_"+utils.uid());var baseTexture=utils.BaseTextureCache[canvas._pixiId];return baseTexture||(baseTexture=new BaseTexture(canvas,scaleMode),utils.BaseTextureCache[canvas._pixiId]=baseTexture),baseTexture}},{"../const":22,"../utils":77,eventemitter3:10}],71:[function(require,module,exports){function RenderTexture(renderer,width,height,scaleMode,resolution){if(!renderer)throw new Error("Unable to create RenderTexture, you must pass a renderer into the constructor.");width=width||100,height=height||100,resolution=resolution||CONST.RESOLUTION;var baseTexture=new BaseTexture;if(baseTexture.width=width,baseTexture.height=height,baseTexture.resolution=resolution,baseTexture.scaleMode=scaleMode||CONST.SCALE_MODES.DEFAULT,baseTexture.hasLoaded=!0,Texture.call(this,baseTexture,new math.Rectangle(0,0,width,height)),this.width=width,this.height=height,this.resolution=resolution,this.render=null,this.renderer=renderer,this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;this.textureBuffer=new RenderTarget(gl,this.width,this.height,baseTexture.scaleMode,this.resolution),this.baseTexture._glTextures[gl.id]=this.textureBuffer.texture,this.filterManager=new FilterManager(this.renderer),this.filterManager.onContextChange(),this.filterManager.resize(width,height),this.render=this.renderWebGL,this.renderer.currentRenderer.start(),this.renderer.currentRenderTarget.activate()}else this.render=this.renderCanvas,this.textureBuffer=new CanvasBuffer(this.width*this.resolution,this.height*this.resolution),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0,this._updateUvs()}var BaseTexture=require("./BaseTexture"),Texture=require("./Texture"),RenderTarget=require("../renderers/webgl/utils/RenderTarget"),FilterManager=require("../renderers/webgl/managers/FilterManager"),CanvasBuffer=require("../renderers/canvas/utils/CanvasBuffer"),math=require("../math"),CONST=require("../const"),tempMatrix=new math.Matrix;RenderTexture.prototype=Object.create(Texture.prototype),RenderTexture.prototype.constructor=RenderTexture,module.exports=RenderTexture,RenderTexture.prototype.resize=function(width,height,updateBase){width===this.width&&height===this.height||(this.valid=width>0&&height>0,this.width=this._frame.width=this.crop.width=width,this.height=this._frame.height=this.crop.height=height,updateBase&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.valid&&(this.textureBuffer.resize(this.width,this.height),this.filterManager&&this.filterManager.resize(this.width,this.height)))},RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===CONST.RENDERER_TYPE.WEBGL&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())},RenderTexture.prototype.renderWebGL=function(displayObject,matrix,clear,updateTransform){if(this.valid){if(updateTransform=void 0===updateTransform||updateTransform,this.textureBuffer.transform=matrix,this.textureBuffer.activate(),displayObject.worldAlpha=1,updateTransform){displayObject.worldTransform.identity(),displayObject.currentBounds=null;var i,j,children=displayObject.children;for(i=0,j=children.length;i<j;++i)children[i].updateTransform()}var temp=this.renderer.filterManager;this.renderer.filterManager=this.filterManager,this.renderer.renderDisplayObject(displayObject,this.textureBuffer,clear),this.renderer.filterManager=temp}},RenderTexture.prototype.renderCanvas=function(displayObject,matrix,clear,updateTransform){if(this.valid){updateTransform=!!updateTransform;var wt=tempMatrix;wt.identity(),matrix&&wt.append(matrix);var cachedWt=displayObject.worldTransform;displayObject.worldTransform=wt,displayObject.worldAlpha=1;var i,j,children=displayObject.children;for(i=0,j=children.length;i<j;++i)children[i].updateTransform();clear&&this.textureBuffer.clear();var context=this.textureBuffer.context,realResolution=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(displayObject,context),this.renderer.resolution=realResolution,
displayObject.worldTransform===wt&&(displayObject.worldTransform=cachedWt)}},RenderTexture.prototype.destroy=function(){Texture.prototype.destroy.call(this,!0),this.textureBuffer.destroy(),this.filterManager&&this.filterManager.destroy(),this.renderer=null},RenderTexture.prototype.getImage=function(){var image=new Image;return image.src=this.getBase64(),image},RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()},RenderTexture.prototype.getCanvas=function(){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl,width=this.textureBuffer.size.width,height=this.textureBuffer.size.height,webGLPixels=new Uint8Array(4*width*height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels),gl.bindFramebuffer(gl.FRAMEBUFFER,null);var tempCanvas=new CanvasBuffer(width,height),canvasData=tempCanvas.context.getImageData(0,0,width,height);return canvasData.data.set(webGLPixels),tempCanvas.context.putImageData(canvasData,0,0),tempCanvas.canvas}return this.textureBuffer.canvas},RenderTexture.prototype.getPixels=function(){var width,height;if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl;width=this.textureBuffer.size.width,height=this.textureBuffer.size.height;var webGLPixels=new Uint8Array(4*width*height);return gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),gl.readPixels(0,0,width,height,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels),gl.bindFramebuffer(gl.FRAMEBUFFER,null),webGLPixels}return width=this.textureBuffer.canvas.width,height=this.textureBuffer.canvas.height,this.textureBuffer.canvas.getContext("2d").getImageData(0,0,width,height).data},RenderTexture.prototype.getPixel=function(x,y){if(this.renderer.type===CONST.RENDERER_TYPE.WEBGL){var gl=this.renderer.gl,webGLPixels=new Uint8Array(4);return gl.bindFramebuffer(gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),gl.readPixels(x,y,1,1,gl.RGBA,gl.UNSIGNED_BYTE,webGLPixels),gl.bindFramebuffer(gl.FRAMEBUFFER,null),webGLPixels}return this.textureBuffer.canvas.getContext("2d").getImageData(x,y,1,1).data}},{"../const":22,"../math":33,"../renderers/canvas/utils/CanvasBuffer":45,"../renderers/webgl/managers/FilterManager":54,"../renderers/webgl/utils/RenderTarget":65,"./BaseTexture":70,"./Texture":72}],72:[function(require,module,exports){function Texture(baseTexture,frame,crop,trim,rotate){if(EventEmitter.call(this),this.noFrame=!1,frame||(this.noFrame=!0,frame=new math.Rectangle(0,0,1,1)),baseTexture instanceof Texture&&(baseTexture=baseTexture.baseTexture),this.baseTexture=baseTexture,this._frame=frame,this.trim=trim,this.valid=!1,this.requiresUpdate=!1,this._uvs=null,this.width=0,this.height=0,this.crop=crop||frame,this._rotate=+(rotate||0),rotate===!0)this._rotate=2;else if(this._rotate%2!==0)throw"attempt to use diamond-shaped UVs. If you are sure, set rotation manually";baseTexture.hasLoaded?(this.noFrame&&(frame=new math.Rectangle(0,0,baseTexture.width,baseTexture.height),baseTexture.on("update",this.onBaseTextureUpdated,this)),this.frame=frame):baseTexture.once("loaded",this.onBaseTextureLoaded,this)}var BaseTexture=require("./BaseTexture"),VideoBaseTexture=require("./VideoBaseTexture"),TextureUvs=require("./TextureUvs"),EventEmitter=require("eventemitter3"),math=require("../math"),utils=require("../utils");Texture.prototype=Object.create(EventEmitter.prototype),Texture.prototype.constructor=Texture,module.exports=Texture,Object.defineProperties(Texture.prototype,{frame:{get:function(){return this._frame},set:function(frame){if(this._frame=frame,this.noFrame=!1,this.width=frame.width,this.height=frame.height,!this.trim&&!this.rotate&&(frame.x+frame.width>this.baseTexture.width||frame.y+frame.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=frame&&frame.width&&frame.height&&this.baseTexture.hasLoaded,this.trim?(this.width=this.trim.width,this.height=this.trim.height,this._frame.width=this.trim.width,this._frame.height=this.trim.height):this.crop=frame,this.valid&&this._updateUvs()}},rotate:{get:function(){return this._rotate},set:function(rotate){this._rotate=rotate,this.valid&&this._updateUvs()}}}),Texture.prototype.update=function(){this.baseTexture.update()},Texture.prototype.onBaseTextureLoaded=function(baseTexture){this.noFrame?this.frame=new math.Rectangle(0,0,baseTexture.width,baseTexture.height):this.frame=this._frame,this.emit("update",this)},Texture.prototype.onBaseTextureUpdated=function(baseTexture){this._frame.width=baseTexture.width,this._frame.height=baseTexture.height,this.emit("update",this)},Texture.prototype.destroy=function(destroyBase){this.baseTexture&&(destroyBase&&this.baseTexture.destroy(),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture.off("loaded",this.onBaseTextureLoaded,this),this.baseTexture=null),this._frame=null,this._uvs=null,this.trim=null,this.crop=null,this.valid=!1,this.off("dispose",this.dispose,this),this.off("update",this.update,this)},Texture.prototype.clone=function(){return new Texture(this.baseTexture,this.frame,this.crop,this.trim,this.rotate)},Texture.prototype._updateUvs=function(){this._uvs||(this._uvs=new TextureUvs),this._uvs.set(this.crop,this.baseTexture,this.rotate)},Texture.fromImage=function(imageUrl,crossorigin,scaleMode){var texture=utils.TextureCache[imageUrl];return texture||(texture=new Texture(BaseTexture.fromImage(imageUrl,crossorigin,scaleMode)),utils.TextureCache[imageUrl]=texture),texture},Texture.fromFrame=function(frameId){var texture=utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache');return texture},Texture.fromCanvas=function(canvas,scaleMode){return new Texture(BaseTexture.fromCanvas(canvas,scaleMode))},Texture.fromVideo=function(video,scaleMode){return"string"==typeof video?Texture.fromVideoUrl(video,scaleMode):new Texture(VideoBaseTexture.fromVideo(video,scaleMode))},Texture.fromVideoUrl=function(videoUrl,scaleMode){return new Texture(VideoBaseTexture.fromUrl(videoUrl,scaleMode))},Texture.addTextureToCache=function(texture,id){utils.TextureCache[id]=texture},Texture.removeTextureFromCache=function(id){var texture=utils.TextureCache[id];return delete utils.TextureCache[id],delete utils.BaseTextureCache[id],texture},Texture.EMPTY=new Texture(new BaseTexture)},{"../math":33,"../utils":77,"./BaseTexture":70,"./TextureUvs":73,"./VideoBaseTexture":74,eventemitter3:10}],73:[function(require,module,exports){function TextureUvs(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1}module.exports=TextureUvs;var GroupD8=require("../math/GroupD8");TextureUvs.prototype.set=function(frame,baseFrame,rotate){var tw=baseFrame.width,th=baseFrame.height;if(rotate){var swapWidthHeight=GroupD8.isSwapWidthHeight(rotate),w2=(swapWidthHeight?frame.height:frame.width)/2/tw,h2=(swapWidthHeight?frame.width:frame.height)/2/th,cX=frame.x/tw+w2,cY=frame.y/th+h2;rotate=GroupD8.add(rotate,GroupD8.NW),this.x0=cX+w2*GroupD8.uX(rotate),this.y0=cY+h2*GroupD8.uY(rotate),rotate=GroupD8.add(rotate,2),this.x1=cX+w2*GroupD8.uX(rotate),this.y1=cY+h2*GroupD8.uY(rotate),rotate=GroupD8.add(rotate,2),this.x2=cX+w2*GroupD8.uX(rotate),this.y2=cY+h2*GroupD8.uY(rotate),rotate=GroupD8.add(rotate,2),this.x3=cX+w2*GroupD8.uX(rotate),this.y3=cY+h2*GroupD8.uY(rotate)}else this.x0=frame.x/tw,this.y0=frame.y/th,this.x1=(frame.x+frame.width)/tw,this.y1=frame.y/th,this.x2=(frame.x+frame.width)/tw,this.y2=(frame.y+frame.height)/th,this.x3=frame.x/tw,this.y3=(frame.y+frame.height)/th}},{"../math/GroupD8":30}],74:[function(require,module,exports){function VideoBaseTexture(source,scaleMode){if(!source)throw new Error("No video source element specified.");(source.readyState===source.HAVE_ENOUGH_DATA||source.readyState===source.HAVE_FUTURE_DATA)&&source.width&&source.height&&(source.complete=!0),BaseTexture.call(this,source,scaleMode),this.autoUpdate=!1,this._onUpdate=this._onUpdate.bind(this),this._onCanPlay=this._onCanPlay.bind(this),source.complete||(source.addEventListener("canplay",this._onCanPlay),source.addEventListener("canplaythrough",this._onCanPlay),source.addEventListener("play",this._onPlayStart.bind(this)),source.addEventListener("pause",this._onPlayStop.bind(this))),this.__loaded=!1}function createSource(path,type){type||(type="video/"+path.substr(path.lastIndexOf(".")+1));var source=document.createElement("source");return source.src=path,source.type=type,source}var BaseTexture=require("./BaseTexture"),utils=require("../utils");VideoBaseTexture.prototype=Object.create(BaseTexture.prototype),VideoBaseTexture.prototype.constructor=VideoBaseTexture,module.exports=VideoBaseTexture,VideoBaseTexture.prototype._onUpdate=function(){this.autoUpdate&&(window.requestAnimationFrame(this._onUpdate),this.update())},VideoBaseTexture.prototype._onPlayStart=function(){this.autoUpdate||(window.requestAnimationFrame(this._onUpdate),this.autoUpdate=!0)},VideoBaseTexture.prototype._onPlayStop=function(){this.autoUpdate=!1},VideoBaseTexture.prototype._onCanPlay=function(){this.hasLoaded=!0,this.source&&(this.source.removeEventListener("canplay",this._onCanPlay),this.source.removeEventListener("canplaythrough",this._onCanPlay),this.width=this.source.videoWidth,this.height=this.source.videoHeight,this.source.play(),this.__loaded||(this.__loaded=!0,this.emit("loaded",this)))},VideoBaseTexture.prototype.destroy=function(){this.source&&this.source._pixiId&&(delete utils.BaseTextureCache[this.source._pixiId],delete this.source._pixiId),BaseTexture.prototype.destroy.call(this)},VideoBaseTexture.fromVideo=function(video,scaleMode){video._pixiId||(video._pixiId="video_"+utils.uid());var baseTexture=utils.BaseTextureCache[video._pixiId];return baseTexture||(baseTexture=new VideoBaseTexture(video,scaleMode),utils.BaseTextureCache[video._pixiId]=baseTexture),baseTexture},VideoBaseTexture.fromUrl=function(videoSrc,scaleMode){var video=document.createElement("video");if(Array.isArray(videoSrc))for(var i=0;i<videoSrc.length;++i)video.appendChild(createSource(videoSrc[i].src||videoSrc[i],videoSrc[i].mime));else video.appendChild(createSource(videoSrc.src||videoSrc,videoSrc.mime));return video.load(),video.play(),VideoBaseTexture.fromVideo(video,scaleMode)},VideoBaseTexture.fromUrls=VideoBaseTexture.fromUrl},{"../utils":77,"./BaseTexture":70}],75:[function(require,module,exports){function Ticker(){var _this=this;this._tick=function(time){_this._requestId=null,_this.started&&(_this.update(time),_this.started&&null===_this._requestId&&_this._emitter.listeners(TICK,!0)&&(_this._requestId=requestAnimationFrame(_this._tick)))},this._emitter=new EventEmitter,this._requestId=null,this._maxElapsedMS=100,this.autoStart=!1,this.deltaTime=1,this.elapsedMS=1/CONST.TARGET_FPMS,this.lastTime=0,this.speed=1,this.started=!1}var CONST=require("../const"),EventEmitter=require("eventemitter3"),TICK="tick";Object.defineProperties(Ticker.prototype,{FPS:{get:function(){return 1e3/this.elapsedMS}},minFPS:{get:function(){return 1e3/this._maxElapsedMS},set:function(fps){var minFPMS=Math.min(Math.max(0,fps)/1e3,CONST.TARGET_FPMS);this._maxElapsedMS=1/minFPMS}}}),Ticker.prototype._requestIfNeeded=function(){null===this._requestId&&this._emitter.listeners(TICK,!0)&&(this.lastTime=performance.now(),this._requestId=requestAnimationFrame(this._tick))},Ticker.prototype._cancelIfNeeded=function(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)},Ticker.prototype._startIfPossible=function(){this.started?this._requestIfNeeded():this.autoStart&&this.start()},Ticker.prototype.add=function(fn,context){return this._emitter.on(TICK,fn,context),this._startIfPossible(),this},Ticker.prototype.addOnce=function(fn,context){return this._emitter.once(TICK,fn,context),this._startIfPossible(),this},Ticker.prototype.remove=function(fn,context){return this._emitter.off(TICK,fn,context),this._emitter.listeners(TICK,!0)||this._cancelIfNeeded(),this},Ticker.prototype.start=function(){this.started||(this.started=!0,this._requestIfNeeded())},Ticker.prototype.stop=function(){this.started&&(this.started=!1,this._cancelIfNeeded())},Ticker.prototype.update=function(currentTime){var elapsedMS;currentTime=currentTime||performance.now(),elapsedMS=this.elapsedMS=currentTime-this.lastTime,elapsedMS>this._maxElapsedMS&&(elapsedMS=this._maxElapsedMS),this.deltaTime=elapsedMS*CONST.TARGET_FPMS*this.speed,this._emitter.emit(TICK,this.deltaTime),this.lastTime=currentTime},module.exports=Ticker},{"../const":22,eventemitter3:10}],76:[function(require,module,exports){var Ticker=require("./Ticker"),shared=new Ticker;shared.autoStart=!0,module.exports={shared:shared,Ticker:Ticker}},{"./Ticker":75}],77:[function(require,module,exports){var CONST=require("../const"),utils=module.exports={_uid:0,_saidHello:!1,EventEmitter:require("eventemitter3"),pluginTarget:require("./pluginTarget"),async:require("async"),uid:function(){return++utils._uid},hex2rgb:function(hex,out){return out=out||[],out[0]=(hex>>16&255)/255,out[1]=(hex>>8&255)/255,out[2]=(255&hex)/255,out},hex2string:function(hex){return hex=hex.toString(16),hex="000000".substr(0,6-hex.length)+hex,"#"+hex},rgb2hex:function(rgb){return(255*rgb[0]<<16)+(255*rgb[1]<<8)+255*rgb[2]},canUseNewCanvasBlendModes:function(){if("undefined"==typeof document)return!1;var pngHead="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAABAQMAAADD8p2OAAAAA1BMVEX/",pngEnd="AAAACklEQVQI12NgAAAAAgAB4iG8MwAAAABJRU5ErkJggg==",magenta=new Image;magenta.src=pngHead+"AP804Oa6"+pngEnd;var yellow=new Image;yellow.src=pngHead+"/wCKxvRF"+pngEnd;var canvas=document.createElement("canvas");canvas.width=6,canvas.height=1;var context=canvas.getContext("2d");context.globalCompositeOperation="multiply",context.drawImage(magenta,0,0),context.drawImage(yellow,2,0);var data=context.getImageData(2,0,1,1).data;return 255===data[0]&&0===data[1]&&0===data[2]},getNextPowerOfTwo:function(number){if(number>0&&0===(number&number-1))return number;for(var result=1;result<number;)result<<=1;return result},isPowerOfTwo:function(width,height){return width>0&&0===(width&width-1)&&height>0&&0===(height&height-1)},getResolutionOfUrl:function(url){var resolution=CONST.RETINA_PREFIX.exec(url);return resolution?parseFloat(resolution[1]):1},sayHello:function(type){if(!utils._saidHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var args=["\n %c %c %c Pixi.js "+CONST.VERSION+" - ✰ "+type+" ✰  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ \n\n","background: #ff66a5; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff66a5; background: #030307; padding:5px 0;","background: #ff66a5; padding:5px 0;","background: #ffc3dc; padding:5px 0;","background: #ff66a5; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;","color: #ff2424; background: #fff; padding:5px 0;"];window.console.log.apply(console,args)}else window.console&&window.console.log("Pixi.js "+CONST.VERSION+" - "+type+" - http://www.pixijs.com/");utils._saidHello=!0}},isWebGLSupported:function(){var contextOptions={stencil:!0};try{if(!window.WebGLRenderingContext)return!1;var canvas=document.createElement("canvas"),gl=canvas.getContext("webgl",contextOptions)||canvas.getContext("experimental-webgl",contextOptions);return!(!gl||!gl.getContextAttributes().stencil)}catch(e){return!1}},sign:function(n){return n?n<0?-1:1:0},removeItems:function(arr,startIdx,removeCount){var length=arr.length;if(!(startIdx>=length||0===removeCount)){removeCount=startIdx+removeCount>length?length-startIdx:removeCount;for(var i=startIdx,len=length-removeCount;i<len;++i)arr[i]=arr[i+removeCount];arr.length=len}},TextureCache:{},BaseTextureCache:{}}},{"../const":22,"./pluginTarget":78,async:1,eventemitter3:10}],78:[function(require,module,exports){function pluginTarget(obj){obj.__plugins={},obj.registerPlugin=function(pluginName,ctor){obj.__plugins[pluginName]=ctor},obj.prototype.initPlugins=function(){this.plugins=this.plugins||{};for(var o in obj.__plugins)this.plugins[o]=new obj.__plugins[o](this)},obj.prototype.destroyPlugins=function(){for(var o in this.plugins)this.plugins[o].destroy(),this.plugins[o]=null;this.plugins=null}}module.exports={mixin:function(obj){pluginTarget(obj)}}},{}],79:[function(require,module,exports){var core=require("./core"),mesh=require("./mesh"),extras=require("./extras"),filters=require("./filters");core.SpriteBatch=function(){throw new ReferenceError("SpriteBatch does not exist any more, please use the new ParticleContainer instead.")},core.AssetLoader=function(){throw new ReferenceError("The loader system was overhauled in pixi v3, please see the new PIXI.loaders.Loader class.")},Object.defineProperties(core,{Stage:{get:function(){return console.warn("You do not need to use a PIXI Stage any more, you can simply render any container."),core.Container}},DisplayObjectContainer:{get:function(){return console.warn("DisplayObjectContainer has been shortened to Container, please use Container from now on."),core.Container}},Strip:{get:function(){return console.warn("The Strip class has been renamed to Mesh and moved to mesh.Mesh, please use mesh.Mesh from now on."),mesh.Mesh}},Rope:{get:function(){return console.warn("The Rope class has been moved to mesh.Rope, please use mesh.Rope from now on."),mesh.Rope}},MovieClip:{get:function(){return console.warn("The MovieClip class has been moved to extras.MovieClip, please use extras.MovieClip from now on."),extras.MovieClip}},TilingSprite:{get:function(){return console.warn("The TilingSprite class has been moved to extras.TilingSprite, please use extras.TilingSprite from now on."),extras.TilingSprite}},BitmapText:{get:function(){return console.warn("The BitmapText class has been moved to extras.BitmapText, please use extras.BitmapText from now on."),extras.BitmapText}},blendModes:{get:function(){return console.warn("The blendModes has been moved to BLEND_MODES, please use BLEND_MODES from now on."),core.BLEND_MODES}},scaleModes:{get:function(){return console.warn("The scaleModes has been moved to SCALE_MODES, please use SCALE_MODES from now on."),core.SCALE_MODES}},BaseTextureCache:{get:function(){return console.warn("The BaseTextureCache class has been moved to utils.BaseTextureCache, please use utils.BaseTextureCache from now on."),core.utils.BaseTextureCache}},TextureCache:{get:function(){return console.warn("The TextureCache class has been moved to utils.TextureCache, please use utils.TextureCache from now on."),core.utils.TextureCache}},math:{get:function(){return console.warn("The math namespace is deprecated, please access members already accessible on PIXI."),core}}}),core.Sprite.prototype.setTexture=function(texture){this.texture=texture,console.warn("setTexture is now deprecated, please use the texture property, e.g : sprite.texture = texture;")},extras.BitmapText.prototype.setText=function(text){this.text=text,console.warn("setText is now deprecated, please use the text property, e.g : myBitmapText.text = 'my text';")},core.Text.prototype.setText=function(text){this.text=text,console.warn("setText is now deprecated, please use the text property, e.g : myText.text = 'my text';")},core.Text.prototype.setStyle=function(style){this.style=style,console.warn("setStyle is now deprecated, please use the style property, e.g : myText.style = style;")},core.Texture.prototype.setFrame=function(frame){this.frame=frame,console.warn("setFrame is now deprecated, please use the frame property, e.g : myTexture.frame = frame;")},Object.defineProperties(filters,{AbstractFilter:{get:function(){return console.warn("filters.AbstractFilter is an undocumented alias, please use AbstractFilter from now on."),core.AbstractFilter}},FXAAFilter:{get:function(){return console.warn("filters.FXAAFilter is an undocumented alias, please use FXAAFilter from now on."),core.FXAAFilter}},SpriteMaskFilter:{get:function(){return console.warn("filters.SpriteMaskFilter is an undocumented alias, please use SpriteMaskFilter from now on."),core.SpriteMaskFilter}}}),core.utils.uuid=function(){return console.warn("utils.uuid() is deprecated, please use utils.uid() from now on."),core.utils.uid()}},{"./core":29,"./extras":86,"./filters":103,"./mesh":128}],80:[function(require,module,exports){function BitmapText(text,style){core.Container.call(this),style=style||{},this.textWidth=0,this.textHeight=0,this._glyphs=[],this._font={tint:void 0!==style.tint?style.tint:16777215,align:style.align||"left",name:null,size:0},this.font=style.font,this._text=text,this.maxWidth=0,this.maxLineHeight=0,this.dirty=!1,this.updateText()}var core=require("../core");BitmapText.prototype=Object.create(core.Container.prototype),BitmapText.prototype.constructor=BitmapText,module.exports=BitmapText,Object.defineProperties(BitmapText.prototype,{tint:{get:function(){return this._font.tint},set:function(value){this._font.tint="number"==typeof value&&value>=0?value:16777215,this.dirty=!0}},align:{get:function(){return this._font.align},set:function(value){this._font.align=value||"left",this.dirty=!0}},font:{get:function(){return this._font},set:function(value){value&&("string"==typeof value?(value=value.split(" "),this._font.name=1===value.length?value[0]:value.slice(1).join(" "),this._font.size=value.length>=2?parseInt(value[0],10):BitmapText.fonts[this._font.name].size):(this._font.name=value.name,this._font.size="number"==typeof value.size?value.size:parseInt(value.size,10)),this.dirty=!0)}},text:{get:function(){return this._text},set:function(value){value=value.toString()||" ",this._text!==value&&(this._text=value,this.dirty=!0)}}}),BitmapText.prototype.updateText=function(){for(var data=BitmapText.fonts[this._font.name],pos=new core.Point,prevCharCode=null,chars=[],lastLineWidth=0,maxLineWidth=0,lineWidths=[],line=0,scale=this._font.size/data.size,lastSpace=-1,maxLineHeight=0,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(lastSpace=/(\s)/.test(this.text.charAt(i))?i:lastSpace,/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else if(lastSpace!==-1&&this.maxWidth>0&&pos.x*scale>this.maxWidth)core.utils.removeItems(chars,lastSpace,i-lastSpace),i=lastSpace,lastSpace=-1,lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new core.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),lastLineWidth=pos.x+(charData.texture.width+charData.xOffset),pos.x+=charData.xAdvance,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode)}}lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth);var lineAlignOffsets=[];for(i=0;i<=line;i++){var alignOffset=0;"right"===this._font.align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this._font.align&&(alignOffset=(maxLineWidth-lineWidths[i])/2),lineAlignOffsets.push(alignOffset)}var lenChars=chars.length,tint=this.tint;for(i=0;i<lenChars;i++){var c=this._glyphs[i];c?c.texture=chars[i].texture:(c=new core.Sprite(chars[i].texture),this._glyphs.push(c)),c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale,c.position.y=chars[i].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c)}for(i=lenChars;i<this._glyphs.length;++i)this.removeChild(this._glyphs[i]);this.textWidth=maxLineWidth*scale,this.textHeight=(pos.y+data.lineHeight)*scale,this.maxLineHeight=maxLineHeight*scale},BitmapText.prototype.updateTransform=function(){this.validate(),this.containerUpdateTransform()},BitmapText.prototype.getLocalBounds=function(){return this.validate(),core.Container.prototype.getLocalBounds.call(this)},BitmapText.prototype.validate=function(){this.dirty&&(this.updateText(),this.dirty=!1)},BitmapText.fonts={}},{"../core":29}],81:[function(require,module,exports){function MovieClip(textures){core.Sprite.call(this,textures[0]instanceof core.Texture?textures[0]:textures[0].texture),this._textures=null,this._durations=null,this.textures=textures,this.animationSpeed=1,this.loop=!0,this.onComplete=null,this._currentTime=0,this.playing=!1}var core=require("../core");MovieClip.prototype=Object.create(core.Sprite.prototype),MovieClip.prototype.constructor=MovieClip,module.exports=MovieClip,Object.defineProperties(MovieClip.prototype,{totalFrames:{get:function(){return this._textures.length}},textures:{get:function(){return this._textures},set:function(value){if(value[0]instanceof core.Texture)this._textures=value,this._durations=null;else{this._textures=[],this._durations=[];for(var i=0;i<value.length;i++)this._textures.push(value[i].texture),this._durations.push(value[i].time)}}},currentFrame:{get:function(){var currentFrame=Math.floor(this._currentTime)%this._textures.length;return currentFrame<0&&(currentFrame+=this._textures.length),currentFrame}}}),MovieClip.prototype.stop=function(){this.playing&&(this.playing=!1,core.ticker.shared.remove(this.update,this))},MovieClip.prototype.play=function(){this.playing||(this.playing=!0,core.ticker.shared.add(this.update,this))},MovieClip.prototype.gotoAndStop=function(frameNumber){this.stop(),this._currentTime=frameNumber,this._texture=this._textures[this.currentFrame]},MovieClip.prototype.gotoAndPlay=function(frameNumber){this._currentTime=frameNumber,this.play()},MovieClip.prototype.update=function(deltaTime){var elapsed=this.animationSpeed*deltaTime;if(null!==this._durations){var lag=this._currentTime%1*this._durations[this.currentFrame];for(lag+=elapsed/60*1e3;lag<0;)this._currentTime--,lag+=this._durations[this.currentFrame];var sign=Math.sign(this.animationSpeed*deltaTime);for(this._currentTime=Math.floor(this._currentTime);lag>=this._durations[this.currentFrame];)lag-=this._durations[this.currentFrame]*sign,this._currentTime+=sign;this._currentTime+=lag/this._durations[this.currentFrame]}else this._currentTime+=elapsed;this._currentTime<0&&!this.loop?(this.gotoAndStop(0),this.onComplete&&this.onComplete()):this._currentTime>=this._textures.length&&!this.loop?(this.gotoAndStop(this._textures.length-1),this.onComplete&&this.onComplete()):this._texture=this._textures[this.currentFrame]},MovieClip.prototype.destroy=function(){this.stop(),core.Sprite.prototype.destroy.call(this)},MovieClip.fromFrames=function(frames){for(var textures=[],i=0;i<frames.length;++i)textures.push(new core.Texture.fromFrame(frames[i]));return new MovieClip(textures)},MovieClip.fromImages=function(images){for(var textures=[],i=0;i<images.length;++i)textures.push(new core.Texture.fromImage(images[i]));return new MovieClip(textures)}},{"../core":29}],82:[function(require,module,exports){function TilingSprite(texture,width,height){core.Sprite.call(this,texture),this.tileScale=new core.Point(1,1),this.tilePosition=new core.Point(0,0),this._width=width||100,this._height=height||100,this._uvs=new core.TextureUvs,this._canvasPattern=null,this.shader=new core.AbstractFilter(["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform mat3 projectionMatrix;","uniform vec4 uFrame;","uniform vec4 uTransform;","varying vec2 vTextureCoord;","varying vec4 vColor;","void main(void){","   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vec2 coord = aTextureCoord;","   coord -= uTransform.xy;","   coord /= uTransform.zw;","   vTextureCoord = coord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform vec4 uFrame;","uniform vec2 uPixelSize;","void main(void){","   vec2 coord = mod(vTextureCoord, uFrame.zw);","   coord = clamp(coord, uPixelSize, uFrame.zw - uPixelSize);","   coord += uFrame.xy;","   gl_FragColor =  texture2D(uSampler, coord) * vColor ;","}"].join("\n"),{uFrame:{type:"4fv",value:[0,0,1,1]},uTransform:{type:"4fv",value:[0,0,1,1]},uPixelSize:{type:"2fv",value:[1,1]}})}var core=require("../core"),tempPoint=new core.Point,CanvasTinter=require("../core/renderers/canvas/utils/CanvasTinter");TilingSprite.prototype=Object.create(core.Sprite.prototype),TilingSprite.prototype.constructor=TilingSprite,module.exports=TilingSprite,Object.defineProperties(TilingSprite.prototype,{width:{get:function(){return this._width},set:function(value){this._width=value}},height:{get:function(){return this._height},set:function(value){this._height=value}}}),TilingSprite.prototype._onTextureUpdate=function(){},TilingSprite.prototype._renderWebGL=function(renderer){var texture=this._texture;if(texture&&texture._uvs){var tempUvs=texture._uvs,tempWidth=texture._frame.width,tempHeight=texture._frame.height,tw=texture.baseTexture.width,th=texture.baseTexture.height;texture._uvs=this._uvs,texture._frame.width=this.width,texture._frame.height=this.height,this.shader.uniforms.uPixelSize.value[0]=1/tw,this.shader.uniforms.uPixelSize.value[1]=1/th,this.shader.uniforms.uFrame.value[0]=tempUvs.x0,this.shader.uniforms.uFrame.value[1]=tempUvs.y0,this.shader.uniforms.uFrame.value[2]=tempUvs.x1-tempUvs.x0,this.shader.uniforms.uFrame.value[3]=tempUvs.y2-tempUvs.y0,this.shader.uniforms.uTransform.value[0]=this.tilePosition.x%(tempWidth*this.tileScale.x)/this._width,this.shader.uniforms.uTransform.value[1]=this.tilePosition.y%(tempHeight*this.tileScale.y)/this._height,this.shader.uniforms.uTransform.value[2]=tw/this._width*this.tileScale.x,this.shader.uniforms.uTransform.value[3]=th/this._height*this.tileScale.y,renderer.setObjectRenderer(renderer.plugins.sprite),renderer.plugins.sprite.render(this),texture._uvs=tempUvs,texture._frame.width=tempWidth,texture._frame.height=tempHeight}},TilingSprite.prototype._renderCanvas=function(renderer){var texture=this._texture;if(texture.baseTexture.hasLoaded){var context=renderer.context,transform=this.worldTransform,resolution=renderer.resolution,baseTexture=texture.baseTexture,modX=this.tilePosition.x/this.tileScale.x%texture._frame.width,modY=this.tilePosition.y/this.tileScale.y%texture._frame.height;if(!this._canvasPattern){var tempCanvas=new core.CanvasBuffer(texture._frame.width*resolution,texture._frame.height*resolution);16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=CanvasTinter.getTintedTexture(this,this.tint)),tempCanvas.context.drawImage(this.tintedTexture,0,0)):tempCanvas.context.drawImage(baseTexture.source,-texture._frame.x*resolution,-texture._frame.y*resolution),this._canvasPattern=tempCanvas.context.createPattern(tempCanvas.canvas,"repeat")}context.globalAlpha=this.worldAlpha,context.setTransform(transform.a*resolution,transform.b*resolution,transform.c*resolution,transform.d*resolution,transform.tx*resolution,transform.ty*resolution),context.scale(this.tileScale.x/resolution,this.tileScale.y/resolution),context.translate(modX+this.anchor.x*-this._width,modY+this.anchor.y*-this._height);var compositeOperation=renderer.blendModes[this.blendMode];compositeOperation!==renderer.context.globalCompositeOperation&&(context.globalCompositeOperation=compositeOperation),context.fillStyle=this._canvasPattern,context.fillRect(-modX,-modY,this._width*resolution/this.tileScale.x,this._height*resolution/this.tileScale.y)}},TilingSprite.prototype.getBounds=function(){var minX,maxX,minY,maxY,width=this._width,height=this._height,w0=width*(1-this.anchor.x),w1=width*-this.anchor.x,h0=height*(1-this.anchor.y),h1=height*-this.anchor.y,worldTransform=this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,x1=a*w1+c*h1+tx,y1=d*h1+b*w1+ty,x2=a*w0+c*h1+tx,y2=d*h1+b*w0+ty,x3=a*w0+c*h0+tx,y3=d*h0+b*w0+ty,x4=a*w1+c*h0+tx,y4=d*h0+b*w1+ty;
minX=x1,minX=x2<minX?x2:minX,minX=x3<minX?x3:minX,minX=x4<minX?x4:minX,minY=y1,minY=y2<minY?y2:minY,minY=y3<minY?y3:minY,minY=y4<minY?y4:minY,maxX=x1,maxX=x2>maxX?x2:maxX,maxX=x3>maxX?x3:maxX,maxX=x4>maxX?x4:maxX,maxY=y1,maxY=y2>maxY?y2:maxY,maxY=y3>maxY?y3:maxY,maxY=y4>maxY?y4:maxY;var bounds=this._bounds;return bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds,bounds},TilingSprite.prototype.containsPoint=function(point){this.worldTransform.applyInverse(point,tempPoint);var y1,width=this._width,height=this._height,x1=-width*this.anchor.x;return tempPoint.x>x1&&tempPoint.x<x1+width&&(y1=-height*this.anchor.y,tempPoint.y>y1&&tempPoint.y<y1+height)},TilingSprite.prototype.destroy=function(){core.Sprite.prototype.destroy.call(this),this.tileScale=null,this._tileScaleOffset=null,this.tilePosition=null,this._uvs=null},TilingSprite.fromFrame=function(frameId,width,height){var texture=core.utils.TextureCache[frameId];if(!texture)throw new Error('The frameId "'+frameId+'" does not exist in the texture cache '+this);return new TilingSprite(texture,width,height)},TilingSprite.fromImage=function(imageId,width,height,crossorigin,scaleMode){return new TilingSprite(core.Texture.fromImage(imageId,crossorigin,scaleMode),width,height)}},{"../core":29,"../core/renderers/canvas/utils/CanvasTinter":48}],83:[function(require,module,exports){var core=require("../core"),DisplayObject=core.DisplayObject,_tempMatrix=new core.Matrix;DisplayObject.prototype._cacheAsBitmap=!1,DisplayObject.prototype._originalRenderWebGL=null,DisplayObject.prototype._originalRenderCanvas=null,DisplayObject.prototype._originalUpdateTransform=null,DisplayObject.prototype._originalHitTest=null,DisplayObject.prototype._originalDestroy=null,DisplayObject.prototype._cachedSprite=null,Object.defineProperties(DisplayObject.prototype,{cacheAsBitmap:{get:function(){return this._cacheAsBitmap},set:function(value){this._cacheAsBitmap!==value&&(this._cacheAsBitmap=value,value?(this._originalRenderWebGL=this.renderWebGL,this._originalRenderCanvas=this.renderCanvas,this._originalUpdateTransform=this.updateTransform,this._originalGetBounds=this.getBounds,this._originalDestroy=this.destroy,this._originalContainsPoint=this.containsPoint,this.renderWebGL=this._renderCachedWebGL,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(this._cachedSprite&&this._destroyCachedDisplayObject(),this.renderWebGL=this._originalRenderWebGL,this.renderCanvas=this._originalRenderCanvas,this.getBounds=this._originalGetBounds,this.destroy=this._originalDestroy,this.updateTransform=this._originalUpdateTransform,this.containsPoint=this._originalContainsPoint))}}}),DisplayObject.prototype._renderCachedWebGL=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(renderer),this._cachedSprite.worldAlpha=this.worldAlpha,renderer.setObjectRenderer(renderer.plugins.sprite),renderer.plugins.sprite.render(this._cachedSprite))},DisplayObject.prototype._initCachedDisplayObject=function(renderer){if(!this._cachedSprite){renderer.currentRenderer.flush();var bounds=this.getLocalBounds().clone();if(this._filters){var padding=this._filters[0].padding;bounds.x-=padding,bounds.y-=padding,bounds.width+=2*padding,bounds.height+=2*padding}var cachedRenderTarget=renderer.currentRenderTarget,stack=renderer.filterManager.filterStack,renderTexture=new core.RenderTexture(renderer,0|bounds.width,0|bounds.height),m=_tempMatrix;m.tx=-bounds.x,m.ty=-bounds.y,this.renderWebGL=this._originalRenderWebGL,renderTexture.render(this,m,!0,!0),renderer.setRenderTarget(cachedRenderTarget),renderer.filterManager.filterStack=stack,this.renderWebGL=this._renderCachedWebGL,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new core.Sprite(renderTexture),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(bounds.x/bounds.width),this._cachedSprite.anchor.y=-(bounds.y/bounds.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},DisplayObject.prototype._renderCachedCanvas=function(renderer){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(renderer),this._cachedSprite.worldAlpha=this.worldAlpha,this._cachedSprite.renderCanvas(renderer))},DisplayObject.prototype._initCachedDisplayObjectCanvas=function(renderer){if(!this._cachedSprite){var bounds=this.getLocalBounds(),cachedRenderTarget=renderer.context,renderTexture=new core.RenderTexture(renderer,0|bounds.width,0|bounds.height),m=_tempMatrix;m.tx=-bounds.x,m.ty=-bounds.y,this.renderCanvas=this._originalRenderCanvas,renderTexture.render(this,m,!0),renderer.context=cachedRenderTarget,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.getBounds=this._getCachedBounds,this._cachedSprite=new core.Sprite(renderTexture),this._cachedSprite.worldTransform=this.worldTransform,this._cachedSprite.anchor.x=-(bounds.x/bounds.width),this._cachedSprite.anchor.y=-(bounds.y/bounds.height),this.updateTransform(),this.containsPoint=this._cachedSprite.containsPoint.bind(this._cachedSprite)}},DisplayObject.prototype._getCachedBounds=function(){return this._cachedSprite._currentBounds=null,this._cachedSprite.getBounds()},DisplayObject.prototype._destroyCachedDisplayObject=function(){this._cachedSprite._texture.destroy(),this._cachedSprite=null},DisplayObject.prototype._cacheAsBitmapDestroy=function(){this.cacheAsBitmap=!1,this._originalDestroy()}},{"../core":29}],84:[function(require,module,exports){var core=require("../core");core.DisplayObject.prototype.name=null,core.Container.prototype.getChildByName=function(name){for(var i=0;i<this.children.length;i++)if(this.children[i].name===name)return this.children[i];return null}},{"../core":29}],85:[function(require,module,exports){var core=require("../core");core.DisplayObject.prototype.getGlobalPosition=function(point){return point=point||new core.Point,this.parent?(this.displayObjectUpdateTransform(),point.x=this.worldTransform.tx,point.y=this.worldTransform.ty):(point.x=this.position.x,point.y=this.position.y),point}},{"../core":29}],86:[function(require,module,exports){require("./cacheAsBitmap"),require("./getChildByName"),require("./getGlobalPosition"),module.exports={MovieClip:require("./MovieClip"),TilingSprite:require("./TilingSprite"),BitmapText:require("./BitmapText")}},{"./BitmapText":80,"./MovieClip":81,"./TilingSprite":82,"./cacheAsBitmap":83,"./getChildByName":84,"./getGlobalPosition":85}],87:[function(require,module,exports){function AsciiFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nuniform vec4 dimensions;\nuniform float pixelSize;\nuniform sampler2D uSampler;\n\nfloat character(float n, vec2 p)\n{\n    p = floor(p*vec2(4.0, -4.0) + 2.5);\n    if (clamp(p.x, 0.0, 4.0) == p.x && clamp(p.y, 0.0, 4.0) == p.y)\n    {\n        if (int(mod(n/exp2(p.x + 5.0*p.y), 2.0)) == 1) return 1.0;\n    }\n    return 0.0;\n}\n\nvoid main()\n{\n    vec2 uv = gl_FragCoord.xy;\n\n    vec3 col = texture2D(uSampler, floor( uv / pixelSize ) * pixelSize / dimensions.xy).rgb;\n\n    float gray = (col.r + col.g + col.b) / 3.0;\n\n    float n =  65536.0;             // .\n    if (gray > 0.2) n = 65600.0;    // :\n    if (gray > 0.3) n = 332772.0;   // *\n    if (gray > 0.4) n = 15255086.0; // o\n    if (gray > 0.5) n = 23385164.0; // &\n    if (gray > 0.6) n = 15252014.0; // 8\n    if (gray > 0.7) n = 13199452.0; // @\n    if (gray > 0.8) n = 11512810.0; // #\n\n    vec2 p = mod( uv / ( pixelSize * 0.5 ), 2.0) - vec2(1.0);\n    col = col * character(n, p);\n\n    gl_FragColor = vec4(col, 1.0);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"1f",value:8}})}var core=require("../../core");AsciiFilter.prototype=Object.create(core.AbstractFilter.prototype),AsciiFilter.prototype.constructor=AsciiFilter,module.exports=AsciiFilter,Object.defineProperties(AsciiFilter.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(value){this.uniforms.pixelSize.value=value}}})},{"../../core":29}],88:[function(require,module,exports){function BloomFilter(){core.AbstractFilter.call(this),this.blurXFilter=new BlurXFilter,this.blurYFilter=new BlurYFilter,this.defaultFilter=new core.AbstractFilter}var core=require("../../core"),BlurXFilter=require("../blur/BlurXFilter"),BlurYFilter=require("../blur/BlurYFilter");BloomFilter.prototype=Object.create(core.AbstractFilter.prototype),BloomFilter.prototype.constructor=BloomFilter,module.exports=BloomFilter,BloomFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(!0);this.defaultFilter.applyFilter(renderer,input,output),this.blurXFilter.applyFilter(renderer,input,renderTarget),renderer.blendModeManager.setBlendMode(core.BLEND_MODES.SCREEN),this.blurYFilter.applyFilter(renderer,renderTarget,output),renderer.blendModeManager.setBlendMode(core.BLEND_MODES.NORMAL),renderer.filterManager.returnRenderTarget(renderTarget)},Object.defineProperties(BloomFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYFilter.blur=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value}}})},{"../../core":29,"../blur/BlurXFilter":91,"../blur/BlurYFilter":92}],89:[function(require,module,exports){function BlurDirFilter(dirX,dirY){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform float dirX;\nuniform float dirY;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[3];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[0] = aTextureCoord + vec2( (0.004 * strength) * dirX, (0.004 * strength) * dirY );\n    vBlurTexCoords[1] = aTextureCoord + vec2( (0.008 * strength) * dirX, (0.008 * strength) * dirY );\n    vBlurTexCoords[2] = aTextureCoord + vec2( (0.012 * strength) * dirX, (0.012 * strength) * dirY );\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[3];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vTextureCoord     ) * 0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0]) * 0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1]) * 0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2]) * 0.004431848411938341;\n}\n",{strength:{type:"1f",value:1},dirX:{type:"1f",value:dirX||0},dirY:{type:"1f",value:dirY||0}}),this.defaultFilter=new core.AbstractFilter,this.passes=1,this.dirX=dirX||0,this.dirY=dirY||0,this.strength=4}var core=require("../../core");BlurDirFilter.prototype=Object.create(core.AbstractFilter.prototype),BlurDirFilter.prototype.constructor=BlurDirFilter,module.exports=BlurDirFilter,BlurDirFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);if(this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.width/input.size.width),1===this.passes)renderer.filterManager.applyFilter(shader,input,output,clear);else{var renderTarget=renderer.filterManager.getRenderTarget(!0);renderer.filterManager.applyFilter(shader,input,renderTarget,clear);for(var i=0;i<this.passes-2;i++)renderer.filterManager.applyFilter(shader,renderTarget,renderTarget,clear);renderer.filterManager.applyFilter(shader,renderTarget,output,clear),renderer.filterManager.returnRenderTarget(renderTarget)}},Object.defineProperties(BlurDirFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=.5*value,this.strength=value}},dirX:{get:function(){return this.dirX},set:function(value){this.uniforms.dirX.value=value}},dirY:{get:function(){return this.dirY},set:function(value){this.uniforms.dirY.value=value}}})},{"../../core":29}],90:[function(require,module,exports){function BlurFilter(){core.AbstractFilter.call(this),this.blurXFilter=new BlurXFilter,this.blurYFilter=new BlurYFilter}var core=require("../../core"),BlurXFilter=require("./BlurXFilter"),BlurYFilter=require("./BlurYFilter");BlurFilter.prototype=Object.create(core.AbstractFilter.prototype),BlurFilter.prototype.constructor=BlurFilter,module.exports=BlurFilter,BlurFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(!0);this.blurXFilter.applyFilter(renderer,input,renderTarget),this.blurYFilter.applyFilter(renderer,renderTarget,output),renderer.filterManager.returnRenderTarget(renderTarget)},Object.defineProperties(BlurFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.padding=.5*Math.abs(value),this.blurXFilter.blur=this.blurYFilter.blur=value}},passes:{get:function(){return this.blurXFilter.passes},set:function(value){this.blurXFilter.passes=this.blurYFilter.passes=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYFilter.blur},set:function(value){this.blurYFilter.blur=value}}})},{"../../core":29,"./BlurXFilter":91,"./BlurYFilter":92}],91:[function(require,module,exports){function BlurXFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(-0.012 * strength, 0.0);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(-0.008 * strength, 0.0);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(-0.004 * strength, 0.0);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2( 0.004 * strength, 0.0);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2( 0.008 * strength, 0.0);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2( 0.012 * strength, 0.0);\n\n    vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var core=require("../../core");BlurXFilter.prototype=Object.create(core.AbstractFilter.prototype),BlurXFilter.prototype.constructor=BlurXFilter,module.exports=BlurXFilter,BlurXFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);if(this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.width/input.size.width),1===this.passes)renderer.filterManager.applyFilter(shader,input,output,clear);else{for(var renderTarget=renderer.filterManager.getRenderTarget(!0),flip=input,flop=renderTarget,i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,!0);var temp=flop;flop=flip,flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear),renderer.filterManager.returnRenderTarget(renderTarget)}},Object.defineProperties(BlurXFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=.5*Math.abs(value),this.strength=value}}})},{"../../core":29}],92:[function(require,module,exports){function BlurYFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = vec4(0.0);\n\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    gl_FragColor += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n}\n",{strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var core=require("../../core");BlurYFilter.prototype=Object.create(core.AbstractFilter.prototype),BlurYFilter.prototype.constructor=BlurYFilter,module.exports=BlurYFilter,BlurYFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);if(this.uniforms.strength.value=Math.abs(this.strength)/4/this.passes*(input.frame.height/input.size.height),1===this.passes)renderer.filterManager.applyFilter(shader,input,output,clear);else{for(var renderTarget=renderer.filterManager.getRenderTarget(!0),flip=input,flop=renderTarget,i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,!0);var temp=flop;flop=flip,flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear),renderer.filterManager.returnRenderTarget(renderTarget)}},Object.defineProperties(BlurYFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=.5*Math.abs(value),this.strength=value}}})},{"../../core":29}],93:[function(require,module,exports){function SmartBlurFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 delta;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta * percent);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{delta:{type:"v2",value:{x:.1,y:0}}})}var core=require("../../core");SmartBlurFilter.prototype=Object.create(core.AbstractFilter.prototype),SmartBlurFilter.prototype.constructor=SmartBlurFilter,module.exports=SmartBlurFilter},{"../../core":29}],94:[function(require,module,exports){function ColorMatrixFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[25];\n\nvoid main(void)\n{\n\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.r = (m[0] * c.r);\n        gl_FragColor.r += (m[1] * c.g);\n        gl_FragColor.r += (m[2] * c.b);\n        gl_FragColor.r += (m[3] * c.a);\n        gl_FragColor.r += m[4] * c.a;\n\n    gl_FragColor.g = (m[5] * c.r);\n        gl_FragColor.g += (m[6] * c.g);\n        gl_FragColor.g += (m[7] * c.b);\n        gl_FragColor.g += (m[8] * c.a);\n        gl_FragColor.g += m[9] * c.a;\n\n     gl_FragColor.b = (m[10] * c.r);\n        gl_FragColor.b += (m[11] * c.g);\n        gl_FragColor.b += (m[12] * c.b);\n        gl_FragColor.b += (m[13] * c.a);\n        gl_FragColor.b += m[14] * c.a;\n\n     gl_FragColor.a = (m[15] * c.r);\n        gl_FragColor.a += (m[16] * c.g);\n        gl_FragColor.a += (m[17] * c.b);\n        gl_FragColor.a += (m[18] * c.a);\n        gl_FragColor.a += m[19] * c.a;\n\n}\n",{m:{type:"1fv",value:[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]}})}var core=require("../../core");ColorMatrixFilter.prototype=Object.create(core.AbstractFilter.prototype),ColorMatrixFilter.prototype.constructor=ColorMatrixFilter,module.exports=ColorMatrixFilter,ColorMatrixFilter.prototype._loadMatrix=function(matrix,multiply){multiply=!!multiply;var newMatrix=matrix;multiply&&(this._multiply(newMatrix,this.uniforms.m.value,matrix),newMatrix=this._colorMatrix(newMatrix)),this.uniforms.m.value=newMatrix},ColorMatrixFilter.prototype._multiply=function(out,a,b){return out[0]=a[0]*b[0]+a[1]*b[5]+a[2]*b[10]+a[3]*b[15],out[1]=a[0]*b[1]+a[1]*b[6]+a[2]*b[11]+a[3]*b[16],out[2]=a[0]*b[2]+a[1]*b[7]+a[2]*b[12]+a[3]*b[17],out[3]=a[0]*b[3]+a[1]*b[8]+a[2]*b[13]+a[3]*b[18],out[4]=a[0]*b[4]+a[1]*b[9]+a[2]*b[14]+a[3]*b[19],out[5]=a[5]*b[0]+a[6]*b[5]+a[7]*b[10]+a[8]*b[15],out[6]=a[5]*b[1]+a[6]*b[6]+a[7]*b[11]+a[8]*b[16],out[7]=a[5]*b[2]+a[6]*b[7]+a[7]*b[12]+a[8]*b[17],out[8]=a[5]*b[3]+a[6]*b[8]+a[7]*b[13]+a[8]*b[18],out[9]=a[5]*b[4]+a[6]*b[9]+a[7]*b[14]+a[8]*b[19],out[10]=a[10]*b[0]+a[11]*b[5]+a[12]*b[10]+a[13]*b[15],out[11]=a[10]*b[1]+a[11]*b[6]+a[12]*b[11]+a[13]*b[16],out[12]=a[10]*b[2]+a[11]*b[7]+a[12]*b[12]+a[13]*b[17],out[13]=a[10]*b[3]+a[11]*b[8]+a[12]*b[13]+a[13]*b[18],out[14]=a[10]*b[4]+a[11]*b[9]+a[12]*b[14]+a[13]*b[19],out[15]=a[15]*b[0]+a[16]*b[5]+a[17]*b[10]+a[18]*b[15],out[16]=a[15]*b[1]+a[16]*b[6]+a[17]*b[11]+a[18]*b[16],out[17]=a[15]*b[2]+a[16]*b[7]+a[17]*b[12]+a[18]*b[17],out[18]=a[15]*b[3]+a[16]*b[8]+a[17]*b[13]+a[18]*b[18],out[19]=a[15]*b[4]+a[16]*b[9]+a[17]*b[14]+a[18]*b[19],out},ColorMatrixFilter.prototype._colorMatrix=function(matrix){var m=new Float32Array(matrix);return m[4]/=255,m[9]/=255,m[14]/=255,m[19]/=255,m},ColorMatrixFilter.prototype.brightness=function(b,multiply){var matrix=[b,0,0,0,0,0,b,0,0,0,0,0,b,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.greyscale=function(scale,multiply){var matrix=[scale,scale,scale,0,0,scale,scale,scale,0,0,scale,scale,scale,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.grayscale=ColorMatrixFilter.prototype.greyscale,ColorMatrixFilter.prototype.blackAndWhite=function(multiply){var matrix=[.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.hue=function(rotation,multiply){rotation=(rotation||0)/180*Math.PI;var cos=Math.cos(rotation),sin=Math.sin(rotation),lumR=.213,lumG=.715,lumB=.072,matrix=[lumR+cos*(1-lumR)+sin*-lumR,lumG+cos*-lumG+sin*-lumG,lumB+cos*-lumB+sin*(1-lumB),0,0,lumR+cos*-lumR+.143*sin,lumG+cos*(1-lumG)+.14*sin,lumB+cos*-lumB+sin*-.283,0,0,lumR+cos*-lumR+sin*-(1-lumR),lumG+cos*-lumG+sin*lumG,lumB+cos*(1-lumB)+sin*lumB,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.contrast=function(amount,multiply){var v=(amount||0)+1,o=-128*(v-1),matrix=[v,0,0,0,o,0,v,0,0,o,0,0,v,0,o,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.saturate=function(amount,multiply){var x=2*(amount||0)/3+1,y=(x-1)*-.5,matrix=[x,y,y,0,0,y,x,y,0,0,y,y,x,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.desaturate=function(multiply){this.saturate(-1)},ColorMatrixFilter.prototype.negative=function(multiply){var matrix=[0,1,1,0,0,1,0,1,0,0,1,1,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.sepia=function(multiply){var matrix=[.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.technicolor=function(multiply){var matrix=[1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.polaroid=function(multiply){var matrix=[1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.toBGR=function(multiply){var matrix=[0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.kodachrome=function(multiply){var matrix=[1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.browni=function(multiply){var matrix=[.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.vintage=function(multiply){var matrix=[.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.colorTone=function(desaturation,toned,lightColor,darkColor,multiply){desaturation=desaturation||.2,toned=toned||.15,lightColor=lightColor||16770432,darkColor=darkColor||3375104;var lR=(lightColor>>16&255)/255,lG=(lightColor>>8&255)/255,lB=(255&lightColor)/255,dR=(darkColor>>16&255)/255,dG=(darkColor>>8&255)/255,dB=(255&darkColor)/255,matrix=[.3,.59,.11,0,0,lR,lG,lB,desaturation,0,dR,dG,dB,toned,0,lR-dR,lG-dG,lB-dB,0,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.night=function(intensity,multiply){intensity=intensity||.1;var matrix=[intensity*-2,-intensity,0,0,0,-intensity,0,intensity,0,0,0,intensity,2*intensity,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.predator=function(amount,multiply){var matrix=[11.224130630493164*amount,-4.794486999511719*amount,-2.8746118545532227*amount,0*amount,.40342438220977783*amount,-3.6330697536468506*amount,9.193157196044922*amount,-2.951810836791992*amount,0*amount,-1.316135048866272*amount,-3.2184197902679443*amount,-4.2375030517578125*amount,7.476448059082031*amount,0*amount,.8044459223747253*amount,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.lsd=function(multiply){var matrix=[2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0];this._loadMatrix(matrix,multiply)},ColorMatrixFilter.prototype.reset=function(){var matrix=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0];this._loadMatrix(matrix,!1)},Object.defineProperties(ColorMatrixFilter.prototype,{matrix:{get:function(){return this.uniforms.m.value},set:function(value){this.uniforms.m.value=value}}})},{"../../core":29}],95:[function(require,module,exports){function ColorStepFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float step;\n\nvoid main(void)\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    color = floor(color * step) / step;\n\n    gl_FragColor = color;\n}\n",{step:{type:"1f",value:5}})}var core=require("../../core");ColorStepFilter.prototype=Object.create(core.AbstractFilter.prototype),ColorStepFilter.prototype.constructor=ColorStepFilter,module.exports=ColorStepFilter,Object.defineProperties(ColorStepFilter.prototype,{step:{get:function(){return this.uniforms.step.value},set:function(value){this.uniforms.step.value=value}}})},{"../../core":29}],96:[function(require,module,exports){function ConvolutionFilter(matrix,width,height){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying mediump vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec2 texelSize;\nuniform float matrix[9];\n\nvoid main(void)\n{\n   vec4 c11 = texture2D(uSampler, vTextureCoord - texelSize); // top left\n   vec4 c12 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - texelSize.y)); // top center\n   vec4 c13 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y - texelSize.y)); // top right\n\n   vec4 c21 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y)); // mid left\n   vec4 c22 = texture2D(uSampler, vTextureCoord); // mid center\n   vec4 c23 = texture2D(uSampler, vec2(vTextureCoord.x + texelSize.x, vTextureCoord.y)); // mid right\n\n   vec4 c31 = texture2D(uSampler, vec2(vTextureCoord.x - texelSize.x, vTextureCoord.y + texelSize.y)); // bottom left\n   vec4 c32 = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + texelSize.y)); // bottom center\n   vec4 c33 = texture2D(uSampler, vTextureCoord + texelSize); // bottom right\n\n   gl_FragColor =\n       c11 * matrix[0] + c12 * matrix[1] + c13 * matrix[2] +\n       c21 * matrix[3] + c22 * matrix[4] + c23 * matrix[5] +\n       c31 * matrix[6] + c32 * matrix[7] + c33 * matrix[8];\n\n   gl_FragColor.a = c22.a;\n}\n",{matrix:{type:"1fv",value:new Float32Array(matrix)},texelSize:{type:"v2",value:{x:1/width,y:1/height}}})}var core=require("../../core");ConvolutionFilter.prototype=Object.create(core.AbstractFilter.prototype),ConvolutionFilter.prototype.constructor=ConvolutionFilter,module.exports=ConvolutionFilter,Object.defineProperties(ConvolutionFilter.prototype,{matrix:{get:function(){return this.uniforms.matrix.value},set:function(value){this.uniforms.matrix.value=new Float32Array(value)}},width:{get:function(){return 1/this.uniforms.texelSize.value.x},set:function(value){this.uniforms.texelSize.value.x=1/value}},height:{get:function(){return 1/this.uniforms.texelSize.value.y},set:function(value){this.uniforms.texelSize.value.y=1/value}}})},{"../../core":29}],97:[function(require,module,exports){function CrossHatchFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    float lum = length(texture2D(uSampler, vTextureCoord.xy).rgb);\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, 1.0);\n\n    if (lum < 1.00)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.75)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.50)\n    {\n        if (mod(gl_FragCoord.x + gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n\n    if (lum < 0.3)\n    {\n        if (mod(gl_FragCoord.x - gl_FragCoord.y - 5.0, 10.0) == 0.0)\n        {\n            gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        }\n    }\n}\n");
}var core=require("../../core");CrossHatchFilter.prototype=Object.create(core.AbstractFilter.prototype),CrossHatchFilter.prototype.constructor=CrossHatchFilter,module.exports=CrossHatchFilter},{"../../core":29}],98:[function(require,module,exports){function DisplacementFilter(sprite,scale){var maskMatrix=new core.Matrix;sprite.renderable=!1,core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void)\n{\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n   vMapCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision mediump float;\n\nvarying vec2 vMapCoord;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec2 scale;\n\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nvoid main(void)\n{\n   vec4 map =  texture2D(mapSampler, vMapCoord);\n\n   map -= 0.5;\n   map.xy *= scale;\n\n   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y));\n}\n",{mapSampler:{type:"sampler2D",value:sprite.texture},otherMatrix:{type:"mat3",value:maskMatrix.toArray(!0)},scale:{type:"v2",value:{x:1,y:1}}}),this.maskSprite=sprite,this.maskMatrix=maskMatrix,null!==scale&&void 0!==scale||(scale=20),this.scale=new core.Point(scale,scale)}var core=require("../../core");DisplacementFilter.prototype=Object.create(core.AbstractFilter.prototype),DisplacementFilter.prototype.constructor=DisplacementFilter,module.exports=DisplacementFilter,DisplacementFilter.prototype.applyFilter=function(renderer,input,output){var filterManager=renderer.filterManager;filterManager.calculateMappedMatrix(input.frame,this.maskSprite,this.maskMatrix),this.uniforms.otherMatrix.value=this.maskMatrix.toArray(!0),this.uniforms.scale.value.x=this.scale.x*(1/input.frame.width),this.uniforms.scale.value.y=this.scale.y*(1/input.frame.height);var shader=this.getShader(renderer);filterManager.applyFilter(shader,input,output)},Object.defineProperties(DisplacementFilter.prototype,{map:{get:function(){return this.uniforms.mapSampler.value},set:function(value){this.uniforms.mapSampler.value=value}}})},{"../../core":29}],99:[function(require,module,exports){function DotScreenFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform vec4 dimensions;\nuniform sampler2D uSampler;\n\nuniform float angle;\nuniform float scale;\n\nfloat pattern()\n{\n   float s = sin(angle), c = cos(angle);\n   vec2 tex = vTextureCoord * dimensions.xy;\n   vec2 point = vec2(\n       c * tex.x - s * tex.y,\n       s * tex.x + c * tex.y\n   ) * scale;\n   return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\nvoid main()\n{\n   vec4 color = texture2D(uSampler, vTextureCoord);\n   float average = (color.r + color.g + color.b) / 3.0;\n   gl_FragColor = vec4(vec3(average * 10.0 - 5.0 + pattern()), color.a);\n}\n",{scale:{type:"1f",value:1},angle:{type:"1f",value:5},dimensions:{type:"4fv",value:[0,0,0,0]}})}var core=require("../../core");DotScreenFilter.prototype=Object.create(core.AbstractFilter.prototype),DotScreenFilter.prototype.constructor=DotScreenFilter,module.exports=DotScreenFilter,Object.defineProperties(DotScreenFilter.prototype,{scale:{get:function(){return this.uniforms.scale.value},set:function(value){this.uniforms.scale.value=value}},angle:{get:function(){return this.uniforms.angle.value},set:function(value){this.uniforms.angle.value=value}}})},{"../../core":29}],100:[function(require,module,exports){function BlurYTintFilter(){core.AbstractFilter.call(this,"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nuniform float strength;\nuniform vec2 offset;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec2 vBlurTexCoords[6];\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3((aVertexPosition+offset), 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n\n    vBlurTexCoords[ 0] = aTextureCoord + vec2(0.0, -0.012 * strength);\n    vBlurTexCoords[ 1] = aTextureCoord + vec2(0.0, -0.008 * strength);\n    vBlurTexCoords[ 2] = aTextureCoord + vec2(0.0, -0.004 * strength);\n    vBlurTexCoords[ 3] = aTextureCoord + vec2(0.0,  0.004 * strength);\n    vBlurTexCoords[ 4] = aTextureCoord + vec2(0.0,  0.008 * strength);\n    vBlurTexCoords[ 5] = aTextureCoord + vec2(0.0,  0.012 * strength);\n\n   vColor = vec4(aColor.rgb * aColor.a, aColor.a);\n}\n","precision lowp float;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vBlurTexCoords[6];\nvarying vec4 vColor;\n\nuniform vec3 color;\nuniform float alpha;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec4 sum = vec4(0.0);\n\n    sum += texture2D(uSampler, vBlurTexCoords[ 0])*0.004431848411938341;\n    sum += texture2D(uSampler, vBlurTexCoords[ 1])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 2])*0.2419707245191454;\n    sum += texture2D(uSampler, vTextureCoord     )*0.3989422804014327;\n    sum += texture2D(uSampler, vBlurTexCoords[ 3])*0.2419707245191454;\n    sum += texture2D(uSampler, vBlurTexCoords[ 4])*0.05399096651318985;\n    sum += texture2D(uSampler, vBlurTexCoords[ 5])*0.004431848411938341;\n\n    gl_FragColor = vec4( color.rgb * sum.a * alpha, sum.a * alpha );\n}\n",{blur:{type:"1f",value:1/512},color:{type:"c",value:[0,0,0]},alpha:{type:"1f",value:.7},offset:{type:"2f",value:[5,5]},strength:{type:"1f",value:1}}),this.passes=1,this.strength=4}var core=require("../../core");BlurYTintFilter.prototype=Object.create(core.AbstractFilter.prototype),BlurYTintFilter.prototype.constructor=BlurYTintFilter,module.exports=BlurYTintFilter,BlurYTintFilter.prototype.applyFilter=function(renderer,input,output,clear){var shader=this.getShader(renderer);if(this.uniforms.strength.value=this.strength/4/this.passes*(input.frame.height/input.size.height),1===this.passes)renderer.filterManager.applyFilter(shader,input,output,clear);else{for(var renderTarget=renderer.filterManager.getRenderTarget(!0),flip=input,flop=renderTarget,i=0;i<this.passes-1;i++){renderer.filterManager.applyFilter(shader,flip,flop,clear);var temp=flop;flop=flip,flip=temp}renderer.filterManager.applyFilter(shader,flip,output,clear),renderer.filterManager.returnRenderTarget(renderTarget)}},Object.defineProperties(BlurYTintFilter.prototype,{blur:{get:function(){return this.strength},set:function(value){this.padding=.5*value,this.strength=value}}})},{"../../core":29}],101:[function(require,module,exports){function DropShadowFilter(){core.AbstractFilter.call(this),this.blurXFilter=new BlurXFilter,this.blurYTintFilter=new BlurYTintFilter,this.defaultFilter=new core.AbstractFilter,this.padding=30,this._dirtyPosition=!0,this._angle=45*Math.PI/180,this._distance=10,this.alpha=.75,this.hideObject=!1,this.blendMode=core.BLEND_MODES.MULTIPLY}var core=require("../../core"),BlurXFilter=require("../blur/BlurXFilter"),BlurYTintFilter=require("./BlurYTintFilter");DropShadowFilter.prototype=Object.create(core.AbstractFilter.prototype),DropShadowFilter.prototype.constructor=DropShadowFilter,module.exports=DropShadowFilter,DropShadowFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(!0);this._dirtyPosition&&(this._dirtyPosition=!1,this.blurYTintFilter.uniforms.offset.value[0]=Math.sin(this._angle)*this._distance,this.blurYTintFilter.uniforms.offset.value[1]=Math.cos(this._angle)*this._distance),this.blurXFilter.applyFilter(renderer,input,renderTarget),renderer.blendModeManager.setBlendMode(this.blendMode),this.blurYTintFilter.applyFilter(renderer,renderTarget,output),renderer.blendModeManager.setBlendMode(core.BLEND_MODES.NORMAL),this.hideObject||this.defaultFilter.applyFilter(renderer,input,output),renderer.filterManager.returnRenderTarget(renderTarget)},Object.defineProperties(DropShadowFilter.prototype,{blur:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=this.blurYTintFilter.blur=value}},blurX:{get:function(){return this.blurXFilter.blur},set:function(value){this.blurXFilter.blur=value}},blurY:{get:function(){return this.blurYTintFilter.blur},set:function(value){this.blurYTintFilter.blur=value}},color:{get:function(){return core.utils.rgb2hex(this.blurYTintFilter.uniforms.color.value)},set:function(value){this.blurYTintFilter.uniforms.color.value=core.utils.hex2rgb(value)}},alpha:{get:function(){return this.blurYTintFilter.uniforms.alpha.value},set:function(value){this.blurYTintFilter.uniforms.alpha.value=value}},distance:{get:function(){return this._distance},set:function(value){this._dirtyPosition=!0,this._distance=value}},angle:{get:function(){return this._angle},set:function(value){this._dirtyPosition=!0,this._angle=value}}})},{"../../core":29,"../blur/BlurXFilter":91,"./BlurYTintFilter":100}],102:[function(require,module,exports){function GrayFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\nuniform float gray;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix(gl_FragColor.rgb, vec3(0.2126*gl_FragColor.r + 0.7152*gl_FragColor.g + 0.0722*gl_FragColor.b), gray);\n}\n",{gray:{type:"1f",value:1}})}var core=require("../../core");GrayFilter.prototype=Object.create(core.AbstractFilter.prototype),GrayFilter.prototype.constructor=GrayFilter,module.exports=GrayFilter,Object.defineProperties(GrayFilter.prototype,{gray:{get:function(){return this.uniforms.gray.value},set:function(value){this.uniforms.gray.value=value}}})},{"../../core":29}],103:[function(require,module,exports){module.exports={AsciiFilter:require("./ascii/AsciiFilter"),BloomFilter:require("./bloom/BloomFilter"),BlurFilter:require("./blur/BlurFilter"),BlurXFilter:require("./blur/BlurXFilter"),BlurYFilter:require("./blur/BlurYFilter"),BlurDirFilter:require("./blur/BlurDirFilter"),ColorMatrixFilter:require("./color/ColorMatrixFilter"),ColorStepFilter:require("./color/ColorStepFilter"),ConvolutionFilter:require("./convolution/ConvolutionFilter"),CrossHatchFilter:require("./crosshatch/CrossHatchFilter"),DisplacementFilter:require("./displacement/DisplacementFilter"),DotScreenFilter:require("./dot/DotScreenFilter"),GrayFilter:require("./gray/GrayFilter"),DropShadowFilter:require("./dropshadow/DropShadowFilter"),InvertFilter:require("./invert/InvertFilter"),NoiseFilter:require("./noise/NoiseFilter"),PixelateFilter:require("./pixelate/PixelateFilter"),RGBSplitFilter:require("./rgb/RGBSplitFilter"),ShockwaveFilter:require("./shockwave/ShockwaveFilter"),SepiaFilter:require("./sepia/SepiaFilter"),SmartBlurFilter:require("./blur/SmartBlurFilter"),TiltShiftFilter:require("./tiltshift/TiltShiftFilter"),TiltShiftXFilter:require("./tiltshift/TiltShiftXFilter"),TiltShiftYFilter:require("./tiltshift/TiltShiftYFilter"),TwistFilter:require("./twist/TwistFilter")}},{"./ascii/AsciiFilter":87,"./bloom/BloomFilter":88,"./blur/BlurDirFilter":89,"./blur/BlurFilter":90,"./blur/BlurXFilter":91,"./blur/BlurYFilter":92,"./blur/SmartBlurFilter":93,"./color/ColorMatrixFilter":94,"./color/ColorStepFilter":95,"./convolution/ConvolutionFilter":96,"./crosshatch/CrossHatchFilter":97,"./displacement/DisplacementFilter":98,"./dot/DotScreenFilter":99,"./dropshadow/DropShadowFilter":101,"./gray/GrayFilter":102,"./invert/InvertFilter":104,"./noise/NoiseFilter":105,"./pixelate/PixelateFilter":106,"./rgb/RGBSplitFilter":107,"./sepia/SepiaFilter":108,"./shockwave/ShockwaveFilter":109,"./tiltshift/TiltShiftFilter":111,"./tiltshift/TiltShiftXFilter":112,"./tiltshift/TiltShiftYFilter":113,"./twist/TwistFilter":114}],104:[function(require,module,exports){function InvertFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform float invert;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord);\n\n    gl_FragColor.rgb = mix( (vec3(1)-gl_FragColor.rgb) * gl_FragColor.a, gl_FragColor.rgb, 1.0 - invert);\n}\n",{invert:{type:"1f",value:1}})}var core=require("../../core");InvertFilter.prototype=Object.create(core.AbstractFilter.prototype),InvertFilter.prototype.constructor=InvertFilter,module.exports=InvertFilter,Object.defineProperties(InvertFilter.prototype,{invert:{get:function(){return this.uniforms.invert.value},set:function(value){this.uniforms.invert.value=value}}})},{"../../core":29}],105:[function(require,module,exports){function NoiseFilter(){core.AbstractFilter.call(this,null,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float noise;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n\n    float diff = (rand(vTextureCoord) - 0.5) * noise;\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    gl_FragColor = color;\n}\n",{noise:{type:"1f",value:.5}})}var core=require("../../core");NoiseFilter.prototype=Object.create(core.AbstractFilter.prototype),NoiseFilter.prototype.constructor=NoiseFilter,module.exports=NoiseFilter,Object.defineProperties(NoiseFilter.prototype,{noise:{get:function(){return this.uniforms.noise.value},set:function(value){this.uniforms.noise.value=value}}})},{"../../core":29}],106:[function(require,module,exports){function PixelateFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 dimensions;\nuniform vec2 pixelSize;\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord;\n\n    vec2 size = dimensions.xy / pixelSize;\n\n    vec2 color = floor( ( vTextureCoord * size ) ) / size + pixelSize/dimensions.xy * 0.5;\n\n    gl_FragColor = texture2D(uSampler, color);\n}\n",{dimensions:{type:"4fv",value:new Float32Array([0,0,0,0])},pixelSize:{type:"v2",value:{x:10,y:10}}})}var core=require("../../core");PixelateFilter.prototype=Object.create(core.AbstractFilter.prototype),PixelateFilter.prototype.constructor=PixelateFilter,module.exports=PixelateFilter,Object.defineProperties(PixelateFilter.prototype,{size:{get:function(){return this.uniforms.pixelSize.value},set:function(value){this.uniforms.pixelSize.value=value}}})},{"../../core":29}],107:[function(require,module,exports){function RGBSplitFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 dimensions;\nuniform vec2 red;\nuniform vec2 green;\nuniform vec2 blue;\n\nvoid main(void)\n{\n   gl_FragColor.r = texture2D(uSampler, vTextureCoord + red/dimensions.xy).r;\n   gl_FragColor.g = texture2D(uSampler, vTextureCoord + green/dimensions.xy).g;\n   gl_FragColor.b = texture2D(uSampler, vTextureCoord + blue/dimensions.xy).b;\n   gl_FragColor.a = texture2D(uSampler, vTextureCoord).a;\n}\n",{red:{type:"v2",value:{x:20,y:20}},green:{type:"v2",value:{x:-20,y:20}},blue:{type:"v2",value:{x:20,y:-20}},dimensions:{type:"4fv",value:[0,0,0,0]}})}var core=require("../../core");RGBSplitFilter.prototype=Object.create(core.AbstractFilter.prototype),RGBSplitFilter.prototype.constructor=RGBSplitFilter,module.exports=RGBSplitFilter,Object.defineProperties(RGBSplitFilter.prototype,{red:{get:function(){return this.uniforms.red.value},set:function(value){this.uniforms.red.value=value}},green:{get:function(){return this.uniforms.green.value},set:function(value){this.uniforms.green.value=value}},blue:{get:function(){return this.uniforms.blue.value},set:function(value){this.uniforms.blue.value=value}}})},{"../../core":29}],108:[function(require,module,exports){function SepiaFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float sepia;\n\nconst mat3 sepiaMatrix = mat3(0.3588, 0.7044, 0.1368, 0.2990, 0.5870, 0.1140, 0.2392, 0.4696, 0.0912);\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n   gl_FragColor.rgb = mix( gl_FragColor.rgb, gl_FragColor.rgb * sepiaMatrix, sepia);\n}\n",{sepia:{type:"1f",value:1}})}var core=require("../../core");SepiaFilter.prototype=Object.create(core.AbstractFilter.prototype),SepiaFilter.prototype.constructor=SepiaFilter,module.exports=SepiaFilter,Object.defineProperties(SepiaFilter.prototype,{sepia:{get:function(){return this.uniforms.sepia.value},set:function(value){this.uniforms.sepia.value=value}}})},{"../../core":29}],109:[function(require,module,exports){function ShockwaveFilter(){core.AbstractFilter.call(this,null,"precision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nuniform vec2 center;\nuniform vec3 params; // 10.0, 0.8, 0.1\nuniform float time;\n\nvoid main()\n{\n    vec2 uv = vTextureCoord;\n    vec2 texCoord = uv;\n\n    float dist = distance(uv, center);\n\n    if ( (dist <= (time + params.z)) && (dist >= (time - params.z)) )\n    {\n        float diff = (dist - time);\n        float powDiff = 1.0 - pow(abs(diff*params.x), params.y);\n\n        float diffTime = diff  * powDiff;\n        vec2 diffUV = normalize(uv - center);\n        texCoord = uv + (diffUV * diffTime);\n    }\n\n    gl_FragColor = texture2D(uSampler, texCoord);\n}\n",{center:{type:"v2",value:{x:.5,y:.5}},params:{type:"v3",value:{x:10,y:.8,z:.1}},time:{type:"1f",value:0}})}var core=require("../../core");ShockwaveFilter.prototype=Object.create(core.AbstractFilter.prototype),ShockwaveFilter.prototype.constructor=ShockwaveFilter,module.exports=ShockwaveFilter,Object.defineProperties(ShockwaveFilter.prototype,{center:{get:function(){return this.uniforms.center.value},set:function(value){this.uniforms.center.value=value}},params:{get:function(){return this.uniforms.params.value},set:function(value){this.uniforms.params.value=value}},time:{get:function(){return this.uniforms.time.value},set:function(value){this.uniforms.time.value=value}}})},{"../../core":29}],110:[function(require,module,exports){function TiltShiftAxisFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float blur;\nuniform float gradientBlur;\nuniform vec2 start;\nuniform vec2 end;\nuniform vec2 delta;\nuniform vec2 texSize;\n\nfloat random(vec3 scale, float seed)\n{\n    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n}\n\nvoid main(void)\n{\n    vec4 color = vec4(0.0);\n    float total = 0.0;\n\n    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n    vec2 normal = normalize(vec2(start.y - end.y, end.x - start.x));\n    float radius = smoothstep(0.0, 1.0, abs(dot(vTextureCoord * texSize - start, normal)) / gradientBlur) * blur;\n\n    for (float t = -30.0; t <= 30.0; t++)\n    {\n        float percent = (t + offset - 0.5) / 30.0;\n        float weight = 1.0 - abs(percent);\n        vec4 sample = texture2D(uSampler, vTextureCoord + delta / texSize * percent * radius);\n        sample.rgb *= sample.a;\n        color += sample * weight;\n        total += weight;\n    }\n\n    gl_FragColor = color / total;\n    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n}\n",{blur:{type:"1f",value:100},gradientBlur:{type:"1f",value:600},start:{type:"v2",value:{x:0,y:window.innerHeight/2}},end:{type:"v2",value:{x:600,y:window.innerHeight/2}},delta:{type:"v2",value:{x:30,y:30}},texSize:{type:"v2",value:{x:window.innerWidth,y:window.innerHeight}}}),this.updateDelta()}var core=require("../../core");TiltShiftAxisFilter.prototype=Object.create(core.AbstractFilter.prototype),TiltShiftAxisFilter.prototype.constructor=TiltShiftAxisFilter,module.exports=TiltShiftAxisFilter,TiltShiftAxisFilter.prototype.updateDelta=function(){this.uniforms.delta.value.x=0,this.uniforms.delta.value.y=0},Object.defineProperties(TiltShiftAxisFilter.prototype,{blur:{get:function(){return this.uniforms.blur.value},set:function(value){this.uniforms.blur.value=value}},gradientBlur:{get:function(){return this.uniforms.gradientBlur.value},set:function(value){this.uniforms.gradientBlur.value=value}},start:{get:function(){return this.uniforms.start.value},set:function(value){this.uniforms.start.value=value,this.updateDelta()}},end:{get:function(){return this.uniforms.end.value},set:function(value){this.uniforms.end.value=value,this.updateDelta()}}})},{"../../core":29}],111:[function(require,module,exports){function TiltShiftFilter(){core.AbstractFilter.call(this),this.tiltShiftXFilter=new TiltShiftXFilter,this.tiltShiftYFilter=new TiltShiftYFilter}var core=require("../../core"),TiltShiftXFilter=require("./TiltShiftXFilter"),TiltShiftYFilter=require("./TiltShiftYFilter");TiltShiftFilter.prototype=Object.create(core.AbstractFilter.prototype),TiltShiftFilter.prototype.constructor=TiltShiftFilter,module.exports=TiltShiftFilter,TiltShiftFilter.prototype.applyFilter=function(renderer,input,output){var renderTarget=renderer.filterManager.getRenderTarget(!0);this.tiltShiftXFilter.applyFilter(renderer,input,renderTarget),this.tiltShiftYFilter.applyFilter(renderer,renderTarget,output),renderer.filterManager.returnRenderTarget(renderTarget)},Object.defineProperties(TiltShiftFilter.prototype,{blur:{get:function(){return this.tiltShiftXFilter.blur},set:function(value){this.tiltShiftXFilter.blur=this.tiltShiftYFilter.blur=value}},gradientBlur:{get:function(){return this.tiltShiftXFilter.gradientBlur},set:function(value){this.tiltShiftXFilter.gradientBlur=this.tiltShiftYFilter.gradientBlur=value}},start:{get:function(){return this.tiltShiftXFilter.start},set:function(value){this.tiltShiftXFilter.start=this.tiltShiftYFilter.start=value}},end:{get:function(){return this.tiltShiftXFilter.end},set:function(value){this.tiltShiftXFilter.end=this.tiltShiftYFilter.end=value}}})},{"../../core":29,"./TiltShiftXFilter":112,"./TiltShiftYFilter":113}],112:[function(require,module,exports){function TiltShiftXFilter(){TiltShiftAxisFilter.call(this)}var TiltShiftAxisFilter=require("./TiltShiftAxisFilter");TiltShiftXFilter.prototype=Object.create(TiltShiftAxisFilter.prototype),TiltShiftXFilter.prototype.constructor=TiltShiftXFilter,module.exports=TiltShiftXFilter,TiltShiftXFilter.prototype.updateDelta=function(){var dx=this.uniforms.end.value.x-this.uniforms.start.value.x,dy=this.uniforms.end.value.y-this.uniforms.start.value.y,d=Math.sqrt(dx*dx+dy*dy);this.uniforms.delta.value.x=dx/d,this.uniforms.delta.value.y=dy/d}},{"./TiltShiftAxisFilter":110}],113:[function(require,module,exports){function TiltShiftYFilter(){TiltShiftAxisFilter.call(this)}var TiltShiftAxisFilter=require("./TiltShiftAxisFilter");TiltShiftYFilter.prototype=Object.create(TiltShiftAxisFilter.prototype),TiltShiftYFilter.prototype.constructor=TiltShiftYFilter,module.exports=TiltShiftYFilter,TiltShiftYFilter.prototype.updateDelta=function(){var dx=this.uniforms.end.value.x-this.uniforms.start.value.x,dy=this.uniforms.end.value.y-this.uniforms.start.value.y,d=Math.sqrt(dx*dx+dy*dy);this.uniforms.delta.value.x=-dy/d,this.uniforms.delta.value.y=dx/d}},{"./TiltShiftAxisFilter":110}],114:[function(require,module,exports){function TwistFilter(){core.AbstractFilter.call(this,null,"precision mediump float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\n\nvoid main(void)\n{\n   vec2 coord = vTextureCoord - offset;\n   float dist = length(coord);\n\n   if (dist < radius)\n   {\n       float ratio = (radius - dist) / radius;\n       float angleMod = ratio * ratio * angle;\n       float s = sin(angleMod);\n       float c = cos(angleMod);\n       coord = vec2(coord.x * c - coord.y * s, coord.x * s + coord.y * c);\n   }\n\n   gl_FragColor = texture2D(uSampler, coord+offset);\n}\n",{radius:{type:"1f",value:.5},angle:{type:"1f",value:5},offset:{type:"v2",value:{x:.5,y:.5}}})}var core=require("../../core");TwistFilter.prototype=Object.create(core.AbstractFilter.prototype),TwistFilter.prototype.constructor=TwistFilter,module.exports=TwistFilter,Object.defineProperties(TwistFilter.prototype,{offset:{get:function(){return this.uniforms.offset.value},set:function(value){this.uniforms.offset.value=value}},radius:{get:function(){return this.uniforms.radius.value},set:function(value){this.uniforms.radius.value=value}},angle:{get:function(){return this.uniforms.angle.value},set:function(value){this.uniforms.angle.value=value}}})},{"../../core":29}],115:[function(require,module,exports){(function(global){require("./polyfill");var core=module.exports=require("./core");core.extras=require("./extras"),core.filters=require("./filters"),core.interaction=require("./interaction"),core.loaders=require("./loaders"),core.mesh=require("./mesh"),core.accessibility=require("./accessibility"),core.loader=new core.loaders.Loader,Object.assign(core,require("./deprecation")),global.PIXI=core}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./accessibility":21,"./core":29,"./deprecation":79,"./extras":86,"./filters":103,"./interaction":118,"./loaders":121,"./mesh":128,"./polyfill":133}],116:[function(require,module,exports){function InteractionData(){this.global=new core.Point,this.target=null,this.originalEvent=null}var core=require("../core");InteractionData.prototype.constructor=InteractionData,module.exports=InteractionData,InteractionData.prototype.getLocalPosition=function(displayObject,point,globalPos){return displayObject.worldTransform.applyInverse(globalPos||this.global,point)}},{"../core":29}],117:[function(require,module,exports){function InteractionManager(renderer,options){options=options||{},this.renderer=renderer,this.autoPreventDefault=void 0===options.autoPreventDefault||options.autoPreventDefault,this.interactionFrequency=options.interactionFrequency||10,this.mouse=new InteractionData,this.eventData={stopped:!1,target:null,type:null,data:this.mouse,stopPropagation:function(){this.stopped=!0}},this.interactiveDataPool=[],this.interactionDOMElement=null,this.moveWhenInside=!1,this.eventsAdded=!1,this.onMouseUp=this.onMouseUp.bind(this),this.processMouseUp=this.processMouseUp.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.processMouseDown=this.processMouseDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.processMouseMove=this.processMouseMove.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.processMouseOverOut=this.processMouseOverOut.bind(this),this.onTouchStart=this.onTouchStart.bind(this),this.processTouchStart=this.processTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.processTouchEnd=this.processTouchEnd.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.processTouchMove=this.processTouchMove.bind(this),this.last=0,this.currentCursorStyle="inherit",this._tempPoint=new core.Point,this.resolution=1,this.setTargetElement(this.renderer.view,this.renderer.resolution)}var core=require("../core"),InteractionData=require("./InteractionData");Object.assign(core.DisplayObject.prototype,require("./interactiveTarget")),InteractionManager.prototype.constructor=InteractionManager,module.exports=InteractionManager,InteractionManager.prototype.setTargetElement=function(element,resolution){this.removeEvents(),this.interactionDOMElement=element,this.resolution=resolution||1,this.addEvents()},InteractionManager.prototype.addEvents=function(){this.interactionDOMElement&&(core.ticker.shared.add(this.update,this),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="none",this.interactionDOMElement.style["-ms-touch-action"]="none"),window.document.addEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.addEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.addEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.addEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.addEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.addEventListener("touchmove",this.onTouchMove,!0),window.addEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!0)},InteractionManager.prototype.removeEvents=function(){this.interactionDOMElement&&(core.ticker.shared.remove(this.update),window.navigator.msPointerEnabled&&(this.interactionDOMElement.style["-ms-content-zooming"]="",this.interactionDOMElement.style["-ms-touch-action"]=""),window.document.removeEventListener("mousemove",this.onMouseMove,!0),this.interactionDOMElement.removeEventListener("mousedown",this.onMouseDown,!0),this.interactionDOMElement.removeEventListener("mouseout",this.onMouseOut,!0),this.interactionDOMElement.removeEventListener("touchstart",this.onTouchStart,!0),this.interactionDOMElement.removeEventListener("touchend",this.onTouchEnd,!0),this.interactionDOMElement.removeEventListener("touchmove",this.onTouchMove,!0),this.interactionDOMElement=null,window.removeEventListener("mouseup",this.onMouseUp,!0),this.eventsAdded=!1)},InteractionManager.prototype.update=function(deltaTime){if(this._deltaTime+=deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this.interactionDOMElement)){if(this.didMove)return void(this.didMove=!1);this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)}},InteractionManager.prototype.dispatchEvent=function(displayObject,eventString,eventData){eventData.stopped||(eventData.target=displayObject,eventData.type=eventString,displayObject.emit(eventString,eventData),displayObject[eventString]&&displayObject[eventString](eventData))},InteractionManager.prototype.mapPositionToPoint=function(point,x,y){var rect=this.interactionDOMElement.getBoundingClientRect();point.x=(x-rect.left)*(this.interactionDOMElement.width/rect.width)/this.resolution,point.y=(y-rect.top)*(this.interactionDOMElement.height/rect.height)/this.resolution},InteractionManager.prototype.processInteractive=function(point,displayObject,func,hitTest,interactive){if(!displayObject||!displayObject.visible)return!1;var hit=!1,interactiveParent=interactive=displayObject.interactive||interactive;if(displayObject.hitArea&&(interactiveParent=!1),displayObject.interactiveChildren)for(var children=displayObject.children,i=children.length-1;i>=0;i--){var child=children[i];if(this.processInteractive(point,child,func,hitTest,interactiveParent)){if(!child.parent)continue;hit=!0,interactiveParent=!1,hitTest=!1}}return interactive&&(hitTest&&!hit&&(displayObject.hitArea?(displayObject.worldTransform.applyInverse(point,this._tempPoint),hit=displayObject.hitArea.contains(this._tempPoint.x,this._tempPoint.y)):displayObject.containsPoint&&(hit=displayObject.containsPoint(point))),displayObject.interactive&&func(displayObject,hit)),hit},InteractionManager.prototype.onMouseDown=function(event){this.mouse.originalEvent=event,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY),this.autoPreventDefault&&this.mouse.originalEvent.preventDefault(),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseDown,!0)},InteractionManager.prototype.processMouseDown=function(displayObject,hit){var e=this.mouse.originalEvent,isRightButton=2===e.button||3===e.which;hit&&(displayObject[isRightButton?"_isRightDown":"_isLeftDown"]=!0,this.dispatchEvent(displayObject,isRightButton?"rightdown":"mousedown",this.eventData))},InteractionManager.prototype.onMouseUp=function(event){this.mouse.originalEvent=event,
this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseUp,!0)},InteractionManager.prototype.processMouseUp=function(displayObject,hit){var e=this.mouse.originalEvent,isRightButton=2===e.button||3===e.which,isDown=isRightButton?"_isRightDown":"_isLeftDown";hit?(this.dispatchEvent(displayObject,isRightButton?"rightup":"mouseup",this.eventData),displayObject[isDown]&&(displayObject[isDown]=!1,this.dispatchEvent(displayObject,isRightButton?"rightclick":"click",this.eventData))):displayObject[isDown]&&(displayObject[isDown]=!1,this.dispatchEvent(displayObject,isRightButton?"rightupoutside":"mouseupoutside",this.eventData))},InteractionManager.prototype.onMouseMove=function(event){this.mouse.originalEvent=event,this.eventData.data=this.mouse,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY),this.didMove=!0,this.cursor="inherit",this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseMove,!0),this.currentCursorStyle!==this.cursor&&(this.currentCursorStyle=this.cursor,this.interactionDOMElement.style.cursor=this.cursor)},InteractionManager.prototype.processMouseMove=function(displayObject,hit){this.processMouseOverOut(displayObject,hit),this.moveWhenInside&&!hit||this.dispatchEvent(displayObject,"mousemove",this.eventData)},InteractionManager.prototype.onMouseOut=function(event){this.mouse.originalEvent=event,this.eventData.stopped=!1,this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY),this.interactionDOMElement.style.cursor="inherit",this.mapPositionToPoint(this.mouse.global,event.clientX,event.clientY),this.processInteractive(this.mouse.global,this.renderer._lastObjectRendered,this.processMouseOverOut,!1)},InteractionManager.prototype.processMouseOverOut=function(displayObject,hit){hit?(displayObject._over||(displayObject._over=!0,this.dispatchEvent(displayObject,"mouseover",this.eventData)),displayObject.buttonMode&&(this.cursor=displayObject.defaultCursor)):displayObject._over&&(displayObject._over=!1,this.dispatchEvent(displayObject,"mouseout",this.eventData))},InteractionManager.prototype.onTouchStart=function(event){this.autoPreventDefault&&event.preventDefault();for(var changedTouches=event.changedTouches,cLength=changedTouches.length,i=0;i<cLength;i++){var touchEvent=changedTouches[i],touchData=this.getTouchData(touchEvent);touchData.originalEvent=event,this.eventData.data=touchData,this.eventData.stopped=!1,this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchStart,!0),this.returnTouchData(touchData)}},InteractionManager.prototype.processTouchStart=function(displayObject,hit){hit&&(displayObject._touchDown=!0,this.dispatchEvent(displayObject,"touchstart",this.eventData))},InteractionManager.prototype.onTouchEnd=function(event){this.autoPreventDefault&&event.preventDefault();for(var changedTouches=event.changedTouches,cLength=changedTouches.length,i=0;i<cLength;i++){var touchEvent=changedTouches[i],touchData=this.getTouchData(touchEvent);touchData.originalEvent=event,this.eventData.data=touchData,this.eventData.stopped=!1,this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchEnd,!0),this.returnTouchData(touchData)}},InteractionManager.prototype.processTouchEnd=function(displayObject,hit){hit?(this.dispatchEvent(displayObject,"touchend",this.eventData),displayObject._touchDown&&(displayObject._touchDown=!1,this.dispatchEvent(displayObject,"tap",this.eventData))):displayObject._touchDown&&(displayObject._touchDown=!1,this.dispatchEvent(displayObject,"touchendoutside",this.eventData))},InteractionManager.prototype.onTouchMove=function(event){this.autoPreventDefault&&event.preventDefault();for(var changedTouches=event.changedTouches,cLength=changedTouches.length,i=0;i<cLength;i++){var touchEvent=changedTouches[i],touchData=this.getTouchData(touchEvent);touchData.originalEvent=event,this.eventData.data=touchData,this.eventData.stopped=!1,this.processInteractive(touchData.global,this.renderer._lastObjectRendered,this.processTouchMove,this.moveWhenInside),this.returnTouchData(touchData)}},InteractionManager.prototype.processTouchMove=function(displayObject,hit){this.moveWhenInside&&!hit||this.dispatchEvent(displayObject,"touchmove",this.eventData)},InteractionManager.prototype.getTouchData=function(touchEvent){var touchData=this.interactiveDataPool.pop();return touchData||(touchData=new InteractionData),touchData.identifier=touchEvent.identifier,this.mapPositionToPoint(touchData.global,touchEvent.clientX,touchEvent.clientY),navigator.isCocoonJS&&(touchData.global.x=touchData.global.x/this.resolution,touchData.global.y=touchData.global.y/this.resolution),touchEvent.globalX=touchData.global.x,touchEvent.globalY=touchData.global.y,touchData},InteractionManager.prototype.returnTouchData=function(touchData){this.interactiveDataPool.push(touchData)},InteractionManager.prototype.destroy=function(){this.removeEvents(),this.renderer=null,this.mouse=null,this.eventData=null,this.interactiveDataPool=null,this.interactionDOMElement=null,this.onMouseUp=null,this.processMouseUp=null,this.onMouseDown=null,this.processMouseDown=null,this.onMouseMove=null,this.processMouseMove=null,this.onMouseOut=null,this.processMouseOverOut=null,this.onTouchStart=null,this.processTouchStart=null,this.onTouchEnd=null,this.processTouchEnd=null,this.onTouchMove=null,this.processTouchMove=null,this._tempPoint=null},core.WebGLRenderer.registerPlugin("interaction",InteractionManager),core.CanvasRenderer.registerPlugin("interaction",InteractionManager)},{"../core":29,"./InteractionData":116,"./interactiveTarget":119}],118:[function(require,module,exports){module.exports={InteractionData:require("./InteractionData"),InteractionManager:require("./InteractionManager"),interactiveTarget:require("./interactiveTarget")}},{"./InteractionData":116,"./InteractionManager":117,"./interactiveTarget":119}],119:[function(require,module,exports){var interactiveTarget={interactive:!1,buttonMode:!1,interactiveChildren:!0,defaultCursor:"pointer",_over:!1,_touchDown:!1};module.exports=interactiveTarget},{}],120:[function(require,module,exports){function parse(resource,texture){var data={},info=resource.data.getElementsByTagName("info")[0],common=resource.data.getElementsByTagName("common")[0];data.font=info.getAttribute("face"),data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10),data.chars={};for(var letters=resource.data.getElementsByTagName("char"),i=0;i<letters.length;i++){var charCode=parseInt(letters[i].getAttribute("id"),10),textureRect=new core.Rectangle(parseInt(letters[i].getAttribute("x"),10)+texture.frame.x,parseInt(letters[i].getAttribute("y"),10)+texture.frame.y,parseInt(letters[i].getAttribute("width"),10),parseInt(letters[i].getAttribute("height"),10));data.chars[charCode]={xOffset:parseInt(letters[i].getAttribute("xoffset"),10),yOffset:parseInt(letters[i].getAttribute("yoffset"),10),xAdvance:parseInt(letters[i].getAttribute("xadvance"),10),kerning:{},texture:new core.Texture(texture.baseTexture,textureRect)}}var kernings=resource.data.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=parseInt(kernings[i].getAttribute("first"),10),second=parseInt(kernings[i].getAttribute("second"),10),amount=parseInt(kernings[i].getAttribute("amount"),10);data.chars[second]&&(data.chars[second].kerning[first]=amount)}resource.bitmapFont=data,extras.BitmapText.fonts[data.font]=data}var Resource=require("resource-loader").Resource,core=require("../core"),extras=require("../extras"),path=require("path");module.exports=function(){return function(resource,next){if(!resource.data||!resource.isXml)return next();if(0===resource.data.getElementsByTagName("page").length||0===resource.data.getElementsByTagName("info").length||null===resource.data.getElementsByTagName("info")[0].getAttribute("face"))return next();var xmlUrl=path.dirname(resource.url);"."===xmlUrl&&(xmlUrl=""),this.baseUrl&&xmlUrl&&("/"===this.baseUrl.charAt(this.baseUrl.length-1)&&(xmlUrl+="/"),xmlUrl=xmlUrl.replace(this.baseUrl,"")),xmlUrl&&"/"!==xmlUrl.charAt(xmlUrl.length-1)&&(xmlUrl+="/");var textureUrl=xmlUrl+resource.data.getElementsByTagName("page")[0].getAttribute("file");if(core.utils.TextureCache[textureUrl])parse(resource,core.utils.TextureCache[textureUrl]),next();else{var loadOptions={crossOrigin:resource.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata};this.add(resource.name+"_image",textureUrl,loadOptions,function(res){parse(resource,res.texture),next()})}}}},{"../core":29,"../extras":86,path:2,"resource-loader":16}],121:[function(require,module,exports){module.exports={Loader:require("./loader"),bitmapFontParser:require("./bitmapFontParser"),spritesheetParser:require("./spritesheetParser"),textureParser:require("./textureParser"),Resource:require("resource-loader").Resource}},{"./bitmapFontParser":120,"./loader":122,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],122:[function(require,module,exports){function Loader(baseUrl,concurrency){ResourceLoader.call(this,baseUrl,concurrency);for(var i=0;i<Loader._pixiMiddleware.length;++i)this.use(Loader._pixiMiddleware[i]())}var ResourceLoader=require("resource-loader"),textureParser=require("./textureParser"),spritesheetParser=require("./spritesheetParser"),bitmapFontParser=require("./bitmapFontParser");Loader.prototype=Object.create(ResourceLoader.prototype),Loader.prototype.constructor=Loader,module.exports=Loader,Loader._pixiMiddleware=[ResourceLoader.middleware.parsing.blob,textureParser,spritesheetParser,bitmapFontParser],Loader.addPixiMiddleware=function(fn){Loader._pixiMiddleware.push(fn)};var Resource=ResourceLoader.Resource;Resource.setExtensionXhrType("fnt",Resource.XHR_RESPONSE_TYPE.DOCUMENT)},{"./bitmapFontParser":120,"./spritesheetParser":123,"./textureParser":124,"resource-loader":16}],123:[function(require,module,exports){var Resource=require("resource-loader").Resource,path=require("path"),core=require("../core"),async=require("async"),BATCH_SIZE=1e3;module.exports=function(){return function(resource,next){var imageResourceName=resource.name+"_image";if(!resource.data||!resource.isJson||!resource.data.frames||this.resources[imageResourceName])return next();var loadOptions={crossOrigin:resource.crossOrigin,loadType:Resource.LOAD_TYPE.IMAGE,metadata:resource.metadata.imageMetadata},route=path.dirname(resource.url.replace(this.baseUrl,""));this.add(imageResourceName,route+"/"+resource.data.meta.image,loadOptions,function(res){function processFrames(initialFrameIndex,maxFrames){for(var frameIndex=initialFrameIndex;frameIndex-initialFrameIndex<maxFrames&&frameIndex<frameKeys.length;){var frame=frames[frameKeys[frameIndex]],rect=frame.frame;if(rect){var size=null,trim=null;if(size=frame.rotated?new core.Rectangle(rect.x,rect.y,rect.h,rect.w):new core.Rectangle(rect.x,rect.y,rect.w,rect.h),frame.trimmed&&(trim=new core.Rectangle(frame.spriteSourceSize.x/resolution,frame.spriteSourceSize.y/resolution,frame.sourceSize.w/resolution,frame.sourceSize.h/resolution)),frame.rotated){var temp=size.width;size.width=size.height,size.height=temp}size.x/=resolution,size.y/=resolution,size.width/=resolution,size.height/=resolution,resource.textures[frameKeys[frameIndex]]=new core.Texture(res.texture.baseTexture,size,size.clone(),trim,frame.rotated),core.utils.TextureCache[frameKeys[frameIndex]]=resource.textures[frameKeys[frameIndex]]}frameIndex++}}function shouldProcessNextBatch(){return batchIndex*BATCH_SIZE<frameKeys.length}function processNextBatch(done){processFrames(batchIndex*BATCH_SIZE,BATCH_SIZE),batchIndex++,setTimeout(done,0)}resource.textures={};var frames=resource.data.frames,frameKeys=Object.keys(frames),resolution=core.utils.getResolutionOfUrl(resource.url),batchIndex=0;frameKeys.length<=BATCH_SIZE?(processFrames(0,BATCH_SIZE),next()):async.whilst(shouldProcessNextBatch,processNextBatch,next)})}}},{"../core":29,async:1,path:2,"resource-loader":16}],124:[function(require,module,exports){var core=require("../core");module.exports=function(){return function(resource,next){if(resource.data&&resource.isImage){var baseTexture=new core.BaseTexture(resource.data,null,core.utils.getResolutionOfUrl(resource.url));baseTexture.imageUrl=resource.url,resource.texture=new core.Texture(baseTexture),core.utils.BaseTextureCache[resource.url]=baseTexture,core.utils.TextureCache[resource.url]=resource.texture}next()}}},{"../core":29}],125:[function(require,module,exports){function Mesh(texture,vertices,uvs,indices,drawMode){core.Container.call(this),this._texture=null,this.uvs=uvs||new Float32Array([0,0,1,0,1,1,0,1]),this.vertices=vertices||new Float32Array([0,0,100,0,100,100,0,100]),this.indices=indices||new Uint16Array([0,1,3,2]),this.dirty=!0,this.blendMode=core.BLEND_MODES.NORMAL,this.canvasPadding=0,this.drawMode=drawMode||Mesh.DRAW_MODES.TRIANGLE_MESH,this.texture=texture,this.shader=null}var core=require("../core"),tempPoint=new core.Point,tempPolygon=new core.Polygon;Mesh.prototype=Object.create(core.Container.prototype),Mesh.prototype.constructor=Mesh,module.exports=Mesh,Object.defineProperties(Mesh.prototype,{texture:{get:function(){return this._texture},set:function(value){this._texture!==value&&(this._texture=value,value&&(value.baseTexture.hasLoaded?this._onTextureUpdate():value.once("update",this._onTextureUpdate,this)))}}}),Mesh.prototype._renderWebGL=function(renderer){renderer.setObjectRenderer(renderer.plugins.mesh),renderer.plugins.mesh.render(this)},Mesh.prototype._renderCanvas=function(renderer){var context=renderer.context,transform=this.worldTransform,res=renderer.resolution;renderer.roundPixels?context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res|0,transform.ty*res|0):context.setTransform(transform.a*res,transform.b*res,transform.c*res,transform.d*res,transform.tx*res,transform.ty*res),this.drawMode===Mesh.DRAW_MODES.TRIANGLE_MESH?this._renderCanvasTriangleMesh(context):this._renderCanvasTriangles(context)},Mesh.prototype._renderCanvasTriangleMesh=function(context){for(var vertices=this.vertices,uvs=this.uvs,length=vertices.length/2,i=0;i<length-2;i++){var index=2*i;this._renderCanvasDrawTriangle(context,vertices,uvs,index,index+2,index+4)}},Mesh.prototype._renderCanvasTriangles=function(context){for(var vertices=this.vertices,uvs=this.uvs,indices=this.indices,length=indices.length,i=0;i<length;i+=3){var index0=2*indices[i],index1=2*indices[i+1],index2=2*indices[i+2];this._renderCanvasDrawTriangle(context,vertices,uvs,index0,index1,index2)}},Mesh.prototype._renderCanvasDrawTriangle=function(context,vertices,uvs,index0,index1,index2){var base=this._texture.baseTexture,textureSource=base.source,textureWidth=base.width,textureHeight=base.height,x0=vertices[index0],x1=vertices[index1],x2=vertices[index2],y0=vertices[index0+1],y1=vertices[index1+1],y2=vertices[index2+1],u0=uvs[index0]*base.width,u1=uvs[index1]*base.width,u2=uvs[index2]*base.width,v0=uvs[index0+1]*base.height,v1=uvs[index1+1]*base.height,v2=uvs[index2+1]*base.height;if(this.canvasPadding>0){var paddingX=this.canvasPadding/this.worldTransform.a,paddingY=this.canvasPadding/this.worldTransform.d,centerX=(x0+x1+x2)/3,centerY=(y0+y1+y2)/3,normX=x0-centerX,normY=y0-centerY,dist=Math.sqrt(normX*normX+normY*normY);x0=centerX+normX/dist*(dist+paddingX),y0=centerY+normY/dist*(dist+paddingY),normX=x1-centerX,normY=y1-centerY,dist=Math.sqrt(normX*normX+normY*normY),x1=centerX+normX/dist*(dist+paddingX),y1=centerY+normY/dist*(dist+paddingY),normX=x2-centerX,normY=y2-centerY,dist=Math.sqrt(normX*normX+normY*normY),x2=centerX+normX/dist*(dist+paddingX),y2=centerY+normY/dist*(dist+paddingY)}context.save(),context.beginPath(),context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2),context.closePath(),context.clip();var delta=u0*v1+v0*u2+u1*v2-v1*u2-v0*u1-u0*v2,deltaA=x0*v1+v0*x2+x1*v2-v1*x2-v0*x1-x0*v2,deltaB=u0*x1+x0*u2+u1*x2-x1*u2-x0*u1-u0*x2,deltaC=u0*v1*x2+v0*x1*u2+x0*u1*v2-x0*v1*u2-v0*u1*x2-u0*x1*v2,deltaD=y0*v1+v0*y2+y1*v2-v1*y2-v0*y1-y0*v2,deltaE=u0*y1+y0*u2+u1*y2-y1*u2-y0*u1-u0*y2,deltaF=u0*v1*y2+v0*y1*u2+y0*u1*v2-y0*v1*u2-v0*u1*y2-u0*y1*v2;context.transform(deltaA/delta,deltaD/delta,deltaB/delta,deltaE/delta,deltaC/delta,deltaF/delta),context.drawImage(textureSource,0,0,textureWidth*base.resolution,textureHeight*base.resolution,0,0,textureWidth,textureHeight),context.restore()},Mesh.prototype.renderMeshFlat=function(Mesh){var context=this.context,vertices=Mesh.vertices,length=vertices.length/2;context.beginPath();for(var i=1;i<length-2;i++){var index=2*i,x0=vertices[index],x1=vertices[index+2],x2=vertices[index+4],y0=vertices[index+1],y1=vertices[index+3],y2=vertices[index+5];context.moveTo(x0,y0),context.lineTo(x1,y1),context.lineTo(x2,y2)}context.fillStyle="#FF0000",context.fill(),context.closePath()},Mesh.prototype._onTextureUpdate=function(){this.updateFrame=!0},Mesh.prototype.getBounds=function(matrix){if(!this._currentBounds){for(var worldTransform=matrix||this.worldTransform,a=worldTransform.a,b=worldTransform.b,c=worldTransform.c,d=worldTransform.d,tx=worldTransform.tx,ty=worldTransform.ty,maxX=-(1/0),maxY=-(1/0),minX=1/0,minY=1/0,vertices=this.vertices,i=0,n=vertices.length;i<n;i+=2){var rawX=vertices[i],rawY=vertices[i+1],x=a*rawX+c*rawY+tx,y=d*rawY+b*rawX+ty;minX=x<minX?x:minX,minY=y<minY?y:minY,maxX=x>maxX?x:maxX,maxY=y>maxY?y:maxY}if(minX===-(1/0)||maxY===1/0)return core.Rectangle.EMPTY;var bounds=this._bounds;bounds.x=minX,bounds.width=maxX-minX,bounds.y=minY,bounds.height=maxY-minY,this._currentBounds=bounds}return this._currentBounds},Mesh.prototype.containsPoint=function(point){if(!this.getBounds().contains(point.x,point.y))return!1;this.worldTransform.applyInverse(point,tempPoint);var i,len,vertices=this.vertices,points=tempPolygon.points;if(this.drawMode===Mesh.DRAW_MODES.TRIANGLES){var indices=this.indices;for(len=this.indices.length,i=0;i<len;i+=3){var ind0=2*indices[i],ind1=2*indices[i+1],ind2=2*indices[i+2];if(points[0]=vertices[ind0],points[1]=vertices[ind0+1],points[2]=vertices[ind1],points[3]=vertices[ind1+1],points[4]=vertices[ind2],points[5]=vertices[ind2+1],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0}}else for(len=vertices.length,i=0;i<len;i+=6)if(points[0]=vertices[i],points[1]=vertices[i+1],points[2]=vertices[i+2],points[3]=vertices[i+3],points[4]=vertices[i+4],points[5]=vertices[i+5],tempPolygon.contains(tempPoint.x,tempPoint.y))return!0;return!1},Mesh.DRAW_MODES={TRIANGLE_MESH:0,TRIANGLES:1}},{"../core":29}],126:[function(require,module,exports){function Plane(texture,segmentsX,segmentsY){Mesh.call(this,texture),this._ready=!0,this.segmentsX=segmentsX||10,this.segmentsY=segmentsY||10,this.drawMode=Mesh.DRAW_MODES.TRIANGLES,this.refresh()}var Mesh=require("./Mesh");Plane.prototype=Object.create(Mesh.prototype),Plane.prototype.constructor=Plane,module.exports=Plane,Plane.prototype.refresh=function(){var total=this.segmentsX*this.segmentsY,verts=[],colors=[],uvs=[],indices=[],texture=this.texture,segmentsXSub=this.segmentsX-1,segmentsYSub=this.segmentsY-1,i=0,sizeX=texture.width/segmentsXSub,sizeY=texture.height/segmentsYSub;for(i=0;i<total;i++){var x=i%this.segmentsX,y=i/this.segmentsX|0;verts.push(x*sizeX,y*sizeY),uvs.push(texture._uvs.x0+(texture._uvs.x1-texture._uvs.x0)*(x/(this.segmentsX-1)),texture._uvs.y0+(texture._uvs.y3-texture._uvs.y0)*(y/(this.segmentsY-1)))}var totalSub=segmentsXSub*segmentsYSub;for(i=0;i<totalSub;i++){var xpos=i%segmentsXSub,ypos=i/segmentsXSub|0,value=ypos*this.segmentsX+xpos,value2=ypos*this.segmentsX+xpos+1,value3=(ypos+1)*this.segmentsX+xpos,value4=(ypos+1)*this.segmentsX+xpos+1;indices.push(value,value2,value3),indices.push(value2,value4,value3)}this.vertices=new Float32Array(verts),this.uvs=new Float32Array(uvs),this.colors=new Float32Array(colors),this.indices=new Uint16Array(indices)},Plane.prototype._onTextureUpdate=function(){Mesh.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()}},{"./Mesh":125}],127:[function(require,module,exports){function Rope(texture,points){Mesh.call(this,texture),this.points=points,this.vertices=new Float32Array(4*points.length),this.uvs=new Float32Array(4*points.length),this.colors=new Float32Array(2*points.length),this.indices=new Uint16Array(2*points.length),this._ready=!0,this.refresh()}var Mesh=require("./Mesh"),core=require("../core");Rope.prototype=Object.create(Mesh.prototype),Rope.prototype.constructor=Rope,module.exports=Rope,Rope.prototype.refresh=function(){var points=this.points;if(!(points.length<1)&&this._texture._uvs){var uvs=this.uvs,indices=this.indices,colors=this.colors,textureUvs=this._texture._uvs,offset=new core.Point(textureUvs.x0,textureUvs.y0),factor=new core.Point(textureUvs.x2-textureUvs.x0,textureUvs.y2-textureUvs.y0);uvs[0]=0+offset.x,uvs[1]=0+offset.y,uvs[2]=0+offset.x,uvs[3]=1*factor.y+offset.y,colors[0]=1,colors[1]=1,indices[0]=0,indices[1]=1;for(var point,index,amount,total=points.length,i=1;i<total;i++)point=points[i],index=4*i,amount=i/(total-1),uvs[index]=amount*factor.x+offset.x,uvs[index+1]=0+offset.y,uvs[index+2]=amount*factor.x+offset.x,uvs[index+3]=1*factor.y+offset.y,index=2*i,colors[index]=1,colors[index+1]=1,index=2*i,indices[index]=index,indices[index+1]=index+1;this.dirty=!0}},Rope.prototype._onTextureUpdate=function(){Mesh.prototype._onTextureUpdate.call(this),this._ready&&this.refresh()},Rope.prototype.updateTransform=function(){var points=this.points;if(!(points.length<1)){for(var nextPoint,point,index,ratio,perpLength,num,lastPoint=points[0],perpX=0,perpY=0,vertices=this.vertices,total=points.length,i=0;i<total;i++)point=points[i],index=4*i,nextPoint=i<points.length-1?points[i+1]:point,perpY=-(nextPoint.x-lastPoint.x),perpX=nextPoint.y-lastPoint.y,ratio=10*(1-i/(total-1)),ratio>1&&(ratio=1),perpLength=Math.sqrt(perpX*perpX+perpY*perpY),num=this._texture.height/2,perpX/=perpLength,perpY/=perpLength,perpX*=num,perpY*=num,vertices[index]=point.x+perpX,vertices[index+1]=point.y+perpY,vertices[index+2]=point.x-perpX,vertices[index+3]=point.y-perpY,lastPoint=point;this.containerUpdateTransform()}}},{"../core":29,"./Mesh":125}],128:[function(require,module,exports){module.exports={Mesh:require("./Mesh"),Plane:require("./Plane"),Rope:require("./Rope"),MeshRenderer:require("./webgl/MeshRenderer"),MeshShader:require("./webgl/MeshShader")}},{"./Mesh":125,"./Plane":126,"./Rope":127,"./webgl/MeshRenderer":129,"./webgl/MeshShader":130}],129:[function(require,module,exports){function MeshRenderer(renderer){core.ObjectRenderer.call(this,renderer),this.indices=new Uint16Array(15e3);for(var i=0,j=0;i<15e3;i+=6,j+=4)this.indices[i+0]=j+0,this.indices[i+1]=j+1,this.indices[i+2]=j+2,this.indices[i+3]=j+0,this.indices[i+4]=j+2,this.indices[i+5]=j+3;this.currentShader=null}var core=require("../../core"),Mesh=require("../Mesh");MeshRenderer.prototype=Object.create(core.ObjectRenderer.prototype),MeshRenderer.prototype.constructor=MeshRenderer,module.exports=MeshRenderer,core.WebGLRenderer.registerPlugin("mesh",MeshRenderer),MeshRenderer.prototype.onContextChange=function(){},MeshRenderer.prototype.render=function(mesh){mesh._vertexBuffer||this._initWebGL(mesh);var renderer=this.renderer,gl=renderer.gl,texture=mesh._texture.baseTexture,shader=mesh.shader,drawMode=mesh.drawMode===Mesh.DRAW_MODES.TRIANGLE_MESH?gl.TRIANGLE_STRIP:gl.TRIANGLES;renderer.blendModeManager.setBlendMode(mesh.blendMode),shader=shader?shader.shaders[gl.id]||shader.getShader(renderer):renderer.shaderManager.plugins.meshShader,this.renderer.shaderManager.setShader(shader),shader.uniforms.translationMatrix.value=mesh.worldTransform.toArray(!0),shader.uniforms.projectionMatrix.value=renderer.currentRenderTarget.projectionMatrix.toArray(!0),shader.uniforms.alpha.value=mesh.worldAlpha,shader.syncUniforms(),mesh.dirty?(mesh.dirty=!1,gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,mesh.vertices,gl.STATIC_DRAW),gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,mesh.uvs,gl.STATIC_DRAW),gl.vertexAttribPointer(shader.attributes.aTextureCoord,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),texture._glTextures[gl.id]?gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]):this.renderer.updateTexture(texture),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,mesh.indices,gl.STATIC_DRAW)):(gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer),gl.bufferSubData(gl.ARRAY_BUFFER,0,mesh.vertices),gl.vertexAttribPointer(shader.attributes.aVertexPosition,2,gl.FLOAT,!1,0,0),gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer),gl.vertexAttribPointer(shader.attributes.aTextureCoord,2,gl.FLOAT,!1,0,0),gl.activeTexture(gl.TEXTURE0),texture._glTextures[gl.id]?gl.bindTexture(gl.TEXTURE_2D,texture._glTextures[gl.id]):this.renderer.updateTexture(texture),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer),gl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER,0,mesh.indices)),gl.drawElements(drawMode,mesh.indices.length,gl.UNSIGNED_SHORT,0)},MeshRenderer.prototype._initWebGL=function(mesh){var gl=this.renderer.gl;mesh._vertexBuffer=gl.createBuffer(),mesh._indexBuffer=gl.createBuffer(),mesh._uvBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,mesh._vertexBuffer),gl.bufferData(gl.ARRAY_BUFFER,mesh.vertices,gl.DYNAMIC_DRAW),gl.bindBuffer(gl.ARRAY_BUFFER,mesh._uvBuffer),gl.bufferData(gl.ARRAY_BUFFER,mesh.uvs,gl.STATIC_DRAW),mesh.colors&&(mesh._colorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,mesh._colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,mesh.colors,gl.STATIC_DRAW)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,mesh._indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,mesh.indices,gl.STATIC_DRAW)},MeshRenderer.prototype.flush=function(){},MeshRenderer.prototype.start=function(){this.currentShader=null},MeshRenderer.prototype.destroy=function(){core.ObjectRenderer.prototype.destroy.call(this)}},{"../../core":29,"../Mesh":125}],130:[function(require,module,exports){function MeshShader(shaderManager){core.Shader.call(this,shaderManager,["precision lowp float;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform mat3 projectionMatrix;","varying vec2 vTextureCoord;","void main(void){","   gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"].join("\n"),["precision lowp float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void){","   gl_FragColor = texture2D(uSampler, vTextureCoord) * alpha ;","}"].join("\n"),{alpha:{type:"1f",value:0},translationMatrix:{type:"mat3",value:new Float32Array(9)},projectionMatrix:{type:"mat3",value:new Float32Array(9)}},{aVertexPosition:0,aTextureCoord:0})}var core=require("../../core");MeshShader.prototype=Object.create(core.Shader.prototype),MeshShader.prototype.constructor=MeshShader,module.exports=MeshShader,core.ShaderManager.registerPlugin("meshShader",MeshShader)},{"../../core":29}],131:[function(require,module,exports){Math.sign||(Math.sign=function(x){return x=+x,0===x||isNaN(x)?x:x>0?1:-1})},{}],132:[function(require,module,exports){Object.assign||(Object.assign=require("object-assign"))},{"object-assign":11}],133:[function(require,module,exports){require("./Object.assign"),require("./requestAnimationFrame"),require("./Math.sign")},{"./Math.sign":131,"./Object.assign":132,"./requestAnimationFrame":134}],134:[function(require,module,exports){(function(global){if(Date.now&&Date.prototype.getTime||(Date.now=function(){return(new Date).getTime()}),!global.performance||!global.performance.now){var startTime=Date.now();global.performance||(global.performance={}),global.performance.now=function(){return Date.now()-startTime}}for(var lastTime=Date.now(),vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!global.requestAnimationFrame;++x)global.requestAnimationFrame=global[vendors[x]+"RequestAnimationFrame"],global.cancelAnimationFrame=global[vendors[x]+"CancelAnimationFrame"]||global[vendors[x]+"CancelRequestAnimationFrame"];global.requestAnimationFrame||(global.requestAnimationFrame=function(callback){if("function"!=typeof callback)throw new TypeError(callback+"is not a function");var currentTime=Date.now(),delay=16+lastTime-currentTime;return delay<0&&(delay=0),lastTime=currentTime,setTimeout(function(){lastTime=Date.now(),callback(performance.now())},delay)}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(id){clearTimeout(id)})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[115])(115)}),function(window,undefined){function Proton(proParticleCount,integrationType){this.proParticleCount=Proton.Util.initValue(proParticleCount,Proton.POOL_MAX),this.integrationType=Proton.Util.initValue(integrationType,Proton.EULER),this.emitters=[],this.renderers=[],this.time=0,this.oldTime=0,Proton.pool=new Proton.ParticlePool(this.proParticleCount),Proton.integrator=new Proton.NumericalIntegration(this.integrationType)}function EventDispatcher(){this.initialize()}function Event(pObj){this.type=pObj.type,this.particle=pObj.particle,this.emitter=pObj.emitter}function MStack(){this.mats=[],this.size=0;for(var i=0;i<20;i++)this.mats.push(Proton.Mat3.create([0,0,0,0,0,0,0,0,0]))}function Particle(pOBJ){this.id="particle_"+Particle.ID++,this.reset(!0),Proton.Util.setPrototypeByObject(this,pOBJ)}function ParticlePool(num,releaseTime){this.proParticleCount=Proton.Util.initValue(num,0),this.releaseTime=Proton.Util.initValue(releaseTime,-1),this.poolList=[],this.timeoutID=0;for(var i=0;i<this.proParticleCount;i++)this.add();this.releaseTime>0&&(this.timeoutID=setTimeout(this.release,this.releaseTime/1e3))}function Span(a,b,center){this.isArray=!1,Proton.Util.isArray(a)?(this.isArray=!0,this.a=a):(this.a=Proton.Util.initValue(a,1),this.b=Proton.Util.initValue(b,this.a),this.center=Proton.Util.initValue(center,!1))}function ColorSpan(color){Proton.Util.isArray(color)?this.colorArr=color:this.colorArr=[color]}function Rectangle(x,y,w,h){this.x=x,this.y=y,this.width=w,this.height=h,this.bottom=this.y+this.height,this.right=this.x+this.width}function Behaviour(life,easing){this.id="Behaviour_"+Behaviour.id++,this.life=Proton.Util.initValue(life,1/0),this.easing=Proton.ease.setEasingByName(easing),this.age=0,this.energy=1,this.dead=!1,this.parents=[],this.name="Behaviour"}function Rate(numpan,timepan){this.numPan=Proton.Util.initValue(numpan,1),this.timePan=Proton.Util.initValue(timepan,1),this.numPan=Proton.Util.setSpanValue(this.numPan),this.timePan=Proton.Util.setSpanValue(this.timePan),this.startTime=0,this.nextTime=0,this.init()}function Initialize(){}function Life(a,b,c){Life._super_.call(this),this.lifePan=Proton.Util.setSpanValue(a,b,c)}function Position(zone){Position._super_.call(this),this.zone=Proton.Util.initValue(zone,new Proton.PointZone)}function Velocity(rpan,thapan,type){Velocity._super_.call(this),this.rPan=Proton.Util.setSpanValue(rpan),this.thaPan=Proton.Util.setSpanValue(thapan),this.type=Proton.Util.initValue(type,"vector")}function Mass(a,b,c){Mass._super_.call(this),this.massPan=Proton.Util.setSpanValue(a,b,c)}function Radius(a,b,c){Radius._super_.call(this),this.radius=Proton.Util.setSpanValue(a,b,c)}function ImageTarget(image,w,h){ImageTarget._super_.call(this),this.image=this.setSpanValue(image),this.w=Proton.Util.initValue(w,20),this.h=Proton.Util.initValue(h,this.w)}function Force(fx,fy,life,easing){Force._super_.call(this,life,easing),this.force=this.normalizeForce(new Proton.Vector2D(fx,fy)),this.name="Force"}function Attraction(targetPosition,force,radius,life,easing){
Attraction._super_.call(this,life,easing),this.targetPosition=Proton.Util.initValue(targetPosition,new Proton.Vector2D),this.radius=Proton.Util.initValue(radius,1e3),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new Proton.Vector2D,this.lengthSq=0,this.name="Attraction"}function RandomDrift(driftX,driftY,delay,life,easing){RandomDrift._super_.call(this,life,easing),this.reset(driftX,driftY,delay),this.time=0,this.name="RandomDrift"}function Repulsion(targetPosition,force,radius,life,easing){Repulsion._super_.call(this,targetPosition,force,radius,life,easing),this.force*=-1,this.name="Repulsion"}function Gravity(g,life,easing){Gravity._super_.call(this,0,g,life,easing),this.name="Gravity"}function Collision(emitter,mass,callback,life,easing){Collision._super_.call(this,life,easing),this.reset(emitter,mass,callback),this.name="Collision"}function CrossZone(zone,crossType,life,easing){CrossZone._super_.call(this,life,easing),this.reset(zone,crossType),this.name="CrossZone"}function Alpha(a,b,life,easing){Alpha._super_.call(this,life,easing),this.reset(a,b),this.name="Alpha"}function Scale(a,b,life,easing){Scale._super_.call(this,life,easing),this.reset(a,b),this.name="Scale"}function Rotate(a,b,style,life,easing){Rotate._super_.call(this,life,easing),this.reset(a,b,style),this.name="Rotate"}function Color(color1,color2,life,easing){Color._super_.call(this,life,easing),this.reset(color1,color2),this.name="Color"}function GravityWell(centerPoint,force,life,easing){GravityWell._super_.call(this,life,easing),this.distanceVec=new Proton.Vector2D,this.centerPoint=Proton.Util.initValue(centerPoint,new Proton.Vector2D),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.name="GravityWell"}function Emitter(pObj){this.initializes=[],this.particles=[],this.behaviours=[],this.emitTime=0,this.emitTotalTimes=-1,this.damping=.006,this.bindEmitter=!0,this.rate=new Proton.Rate(1,.1),Emitter._super_.call(this,pObj),this.id="emitter_"+Emitter.ID++}function BehaviourEmitter(pObj){this.selfBehaviours=[],BehaviourEmitter._super_.call(this,pObj)}function FollowEmitter(mouseTarget,ease,pObj){this.mouseTarget=Proton.Util.initValue(mouseTarget,window),this.ease=Proton.Util.initValue(ease,.7),this._allowEmitting=!1,this.initEventHandler(),FollowEmitter._super_.call(this,pObj)}function Renderer(type,proton,element){this.element=element,this.type=Proton.Util.initValue(type,"canvas"),this.proton=proton,this.renderer=this.getRenderer()}function BaseRender(proton,element,stroke){this.proton=proton,this.element=element,this.stroke=stroke}function DomRender(proton,element){DomRender._super_.call(this,proton,element),this.stroke=null}function EaselRender(proton,element,stroke){EaselRender._super_.call(this,proton,element),this.stroke=stroke}function CanvasRender(proton,element){CanvasRender._super_.call(this,proton,element),this.stroke=null,this.context=this.element.getContext("2d"),this.bufferCache={}}function PixelRender(proton,element,rectangle){PixelRender._super_.call(this,proton,element),this.context=this.element.getContext("2d"),this.imageData=null,this.rectangle=null,this.rectangle=rectangle,this.createImageData(rectangle)}function WebGLRender(proton,element){WebGLRender._super_.call(this,proton,element),this.gl=this.element.getContext("experimental-webgl",{antialias:!0,stencil:!1,depth:!1}),this.gl||alert("Sorry your browser do not suppest WebGL!"),this.initVar(),this.setMaxRadius(),this.initShaders(),this.initBuffers(),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND)}function Zone(){this.vector=new Proton.Vector2D(0,0),this.random=0,this.crossType="dead",this.alert=!0}function LineZone(x1,y1,x2,y2,direction){LineZone._super_.call(this),x2-x1>=0?(this.x1=x1,this.y1=y1,this.x2=x2,this.y2=y2):(this.x1=x2,this.y1=y2,this.x2=x1,this.y2=y1),this.dx=this.x2-this.x1,this.dy=this.y2-this.y1,this.minx=Math.min(this.x1,this.x2),this.miny=Math.min(this.y1,this.y2),this.maxx=Math.max(this.x1,this.x2),this.maxy=Math.max(this.y1,this.y2),this.dot=this.x2*this.y1-this.x1*this.y2,this.xxyy=this.dx*this.dx+this.dy*this.dy,this.gradient=this.getGradient(),this.length=this.getLength(),this.direction=Proton.Util.initValue(direction,">")}function CircleZone(x,y,radius){CircleZone._super_.call(this),this.x=x,this.y=y,this.radius=radius,this.angle=0,this.center={x:this.x,y:this.y}}function PointZone(x,y){PointZone._super_.call(this),this.x=x,this.y=y}function RectZone(x,y,width,height){RectZone._super_.call(this),this.x=x,this.y=y,this.width=width,this.height=height}function ImageZone(imageData,x,y,d){ImageZone._super_.call(this),this.reset(imageData,x,y,d)}Proton.POOL_MAX=1e3,Proton.TIME_STEP=60,Proton.MEASURE=100,Proton.EULER="euler",Proton.RK2="runge-kutta2",Proton.RK4="runge-kutta4",Proton.VERLET="verlet",Proton.PARTICLE_CREATED="partilcleCreated",Proton.PARTICLE_UPDATE="partilcleUpdate",Proton.PARTICLE_SLEEP="particleSleep",Proton.PARTICLE_DEAD="partilcleDead",Proton.PROTON_UPDATE="protonUpdate",Proton.PROTON_UPDATE_AFTER="protonUpdateAfter",Proton.EMITTER_ADDED="emitterAdded",Proton.EMITTER_REMOVED="emitterRemoved",Proton.amendChangeTabsBug=!0,Proton.TextureBuffer={},Proton.TextureCanvasBuffer={},Proton.prototype={addRender:function(render){render.proton=this,this.renderers.push(render.proton)},addEmitter:function(emitter){this.emitters.push(emitter),emitter.parent=this,this.dispatchEvent(new Proton.Event({type:Proton.EMITTER_ADDED,emitter:emitter}))},removeEmitter:function(emitter){var index=this.emitters.indexOf(emitter);this.emitters.splice(index,1),emitter.parent=null,this.dispatchEvent(new Proton.Event({type:Proton.EMITTER_REMOVED,emitter:emitter}))},update:function(delta){if(this.dispatchEvent(new Proton.Event({type:Proton.PROTON_UPDATE})),delta)this.elapsed=delta/1e3;else{this.oldTime||(this.oldTime=(new Date).getTime());var time=(new Date).getTime();this.elapsed=(time-this.oldTime)/1e3,Proton.amendChangeTabsBug&&this.amendChangeTabsBug(),this.oldTime=time}if(this.elapsed>0)for(var i=0;i<this.emitters.length;i++)this.emitters[i].update(this.elapsed);this.dispatchEvent(new Proton.Event({type:Proton.PROTON_UPDATE_AFTER}))},amendChangeTabsBug:function(){this.elapsed>.5&&(this.oldTime=(new Date).getTime(),this.elapsed=0)},getCount:function(){for(var total=0,length=this.emitters.length,i=0;i<length;i++)total+=this.emitters[i].particles.length;return total},destroy:function(){for(var length=this.emitters.length,i=0;i<length;i++)this.emitters[i].destory(),delete this.emitters[i];this.emitters=[],this.time=0,this.oldTime=0,Proton.pool.release()}},window.Proton=Proton;var p=EventDispatcher.prototype;EventDispatcher.initialize=function(target){target.addEventListener=p.addEventListener,target.removeEventListener=p.removeEventListener,target.removeAllEventListeners=p.removeAllEventListeners,target.hasEventListener=p.hasEventListener,target.dispatchEvent=p.dispatchEvent},p._listeners=null,p.initialize=function(){},p.addEventListener=function(type,listener){var listeners=this._listeners;listeners?this.removeEventListener(type,listener):listeners=this._listeners={};var arr=listeners[type];return arr||(arr=listeners[type]=[]),arr.push(listener),listener},p.removeEventListener=function(type,listener){var listeners=this._listeners;if(listeners){var arr=listeners[type];if(arr)for(var i=0,l=arr.length;i<l;i++)if(arr[i]==listener){1==l?delete listeners[type]:arr.splice(i,1);break}}},p.removeAllEventListeners=function(type){type?this._listeners&&delete this._listeners[type]:this._listeners=null},p.dispatchEvent=function(eventObj,target){var ret=!1,listeners=this._listeners;if(eventObj&&listeners){"string"==typeof eventObj&&(eventObj={type:eventObj});var arr=listeners[eventObj.type];if(!arr)return ret;eventObj.target=target||this,arr=arr.slice();for(var i=0,l=arr.length;i<l;i++){var o=arr[i];ret=o.handleEvent?ret||o.handleEvent(eventObj):ret||o(eventObj)}}return!!ret},p.hasEventListener=function(type){var listeners=this._listeners;return!(!listeners||!listeners[type])},Proton.EventDispatcher=EventDispatcher,Proton.EventDispatcher.initialize(Proton.prototype),Event.PARTICLE_CREATED=Proton.PARTICLE_CREATED,Event.PARTICLE_UPDATA=Proton.PARTICLE_UPDATA,Event.PARTICLE_SLEEP=Proton.PARTICLE_SLEEP,Event.PARTICLE_DEAD=Proton.PARTICLE_DEAD,Proton.Event=Event;var Util=Util||{initValue:function(value,defaults){var value=null!=value&&value!=undefined?value:defaults;return value},isArray:function(value){return"object"==typeof value&&value.hasOwnProperty("length")},destroyArray:function(array){array.length=0},destroyObject:function(obj){for(var o in obj)delete obj[o]},getVector2D:function(postionOrX,y){if("object"==typeof postionOrX)return postionOrX;var vector2d=new Proton.Vector2D(postionOrX,y);return vector2d},judgeVector2D:function(pOBJ){var result="";return(pOBJ.hasOwnProperty("x")||pOBJ.hasOwnProperty("y")||pOBJ.hasOwnProperty("p")||pOBJ.hasOwnProperty("position"))&&(result+="p"),(pOBJ.hasOwnProperty("vx")||pOBJ.hasOwnProperty("vx")||pOBJ.hasOwnProperty("v")||pOBJ.hasOwnProperty("velocity"))&&(result+="v"),(pOBJ.hasOwnProperty("ax")||pOBJ.hasOwnProperty("ax")||pOBJ.hasOwnProperty("a")||pOBJ.hasOwnProperty("accelerate"))&&(result+="a"),result},setVector2DByObject:function(target,pOBJ){pOBJ.hasOwnProperty("x")&&(target.p.x=pOBJ.x),pOBJ.hasOwnProperty("y")&&(target.p.y=pOBJ.y),pOBJ.hasOwnProperty("vx")&&(target.v.x=pOBJ.vx),pOBJ.hasOwnProperty("vy")&&(target.v.y=pOBJ.vy),pOBJ.hasOwnProperty("ax")&&(target.a.x=pOBJ.ax),pOBJ.hasOwnProperty("ay")&&(target.a.y=pOBJ.ay),pOBJ.hasOwnProperty("p")&&particle.p.copy(pOBJ.p),pOBJ.hasOwnProperty("v")&&particle.v.copy(pOBJ.v),pOBJ.hasOwnProperty("a")&&particle.a.copy(pOBJ.a),pOBJ.hasOwnProperty("position")&&particle.p.copy(pOBJ.position),pOBJ.hasOwnProperty("velocity")&&particle.v.copy(pOBJ.velocity),pOBJ.hasOwnProperty("accelerate")&&particle.a.copy(pOBJ.accelerate)},addPrototypeByObject:function(target,prototypeObject,filters){for(var singlePrototype in prototypeObject)filters?filters.indexOf(singlePrototype)<0&&(target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype])):target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype]);return target},setPrototypeByObject:function(target,prototypeObject,filters){for(var singlePrototype in prototypeObject)target.hasOwnProperty(singlePrototype)&&(filters?filters.indexOf(singlePrototype)<0&&(target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype])):target[singlePrototype]=Proton.Util.getSpanValue(prototypeObject[singlePrototype]));return target},setSpanValue:function(a,b,c){return a instanceof Proton.Span?a:b?c?new Proton.Span(a,b,c):new Proton.Span(a,b):new Proton.Span(a)},getSpanValue:function(pan){return pan instanceof Proton.Span?pan.getValue():pan},inherits:function(subClass,superClass){if(subClass._super_=superClass,Object.create)subClass.prototype=Object.create(superClass.prototype,{constructor:{value:superClass}});else{var F=function(){};F.prototype=superClass.prototype,subClass.prototype=new F,subClass.prototype.constructor=subClass}},getImageData:function(context,image,rect){context.drawImage(image,rect.x,rect.y);var imagedata=context.getImageData(rect.x,rect.y,rect.width,rect.height);return context.clearRect(rect.x,rect.y,rect.width,rect.height),imagedata},getImage:function(img,particle,drawCanvas,fun){"string"==typeof img?this.loadAndSetImage(img,particle,drawCanvas,fun):"object"==typeof img?this.loadAndSetImage(img.src,particle,drawCanvas,fun):img instanceof Image&&this.loadedImage(img.src,particle,drawCanvas,fun,img)},loadedImage:function(src,particle,drawCanvas,fun,target){if(particle.target=target,particle.transform.src=src,Proton.TextureBuffer[src]||(Proton.TextureBuffer[src]=particle.target),drawCanvas)if(Proton.TextureCanvasBuffer[src])particle.transform.canvas=Proton.TextureCanvasBuffer[src];else{var _width=Proton.WebGLUtil.nhpot(particle.target.width),_height=Proton.WebGLUtil.nhpot(particle.target.height);particle.transform.canvas=Proton.DomUtil.createCanvas("canvas"+src,_width,_height);var context=particle.transform.canvas.getContext("2d");context.drawImage(particle.target,0,0,particle.target.width,particle.target.height),Proton.TextureCanvasBuffer[src]=particle.transform.canvas}fun&&fun(particle)},loadAndSetImage:function(src,particle,drawCanvas,fun){if(Proton.TextureBuffer[src])this.loadedImage(src,particle,drawCanvas,fun,Proton.TextureBuffer[src]);else{var self=this,myImage=new Image;myImage.onload=function(e){self.loadedImage(src,particle,drawCanvas,fun,e.target)},myImage.src=src}},hexToRGB:function(h){var hex16="#"==h.charAt(0)?h.substring(1,7):h,r=parseInt(hex16.substring(0,2),16),g=parseInt(hex16.substring(2,4),16),b=parseInt(hex16.substring(4,6),16);return{r:r,g:g,b:b}},rgbToHex:function(rbg){return"rgb("+rbg.r+", "+rbg.g+", "+rbg.b+")"}};Proton.Util=Util;var WebGLUtil=WebGLUtil||{ipot:function(length){return 0==(length&length-1)},nhpot:function(length){--length;for(var i=1;i<32;i<<=1)length|=length>>i;return length+1},makeTranslation:function(tx,ty){return[1,0,0,0,1,0,tx,ty,1]},makeRotation:function(angleInRadians){var c=Math.cos(angleInRadians),s=Math.sin(angleInRadians);return[c,-s,0,s,c,0,0,0,1]},makeScale:function(sx,sy){return[sx,0,0,0,sy,0,0,0,1]},matrixMultiply:function(a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return[a00*b00+a01*b10+a02*b20,a00*b01+a01*b11+a02*b21,a00*b02+a01*b12+a02*b22,a10*b00+a11*b10+a12*b20,a10*b01+a11*b11+a12*b21,a10*b02+a11*b12+a12*b22,a20*b00+a21*b10+a22*b20,a20*b01+a21*b11+a22*b21,a20*b02+a21*b12+a22*b22]}};Proton.WebGLUtil=WebGLUtil;var DomUtil=DomUtil||{createCanvas:function($id,$width,$height,$position){var element=document.createElement("canvas"),position=$position?$position:"absolute";return element.id=$id,element.width=$width,element.height=$height,element.style.position=position,element.style.opacity=0,this.transformDom(element,-500,-500,0,0),element},transformDom:function($div,$x,$y,$scale,$rotate){$div.style.WebkitTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.MozTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.OTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.msTransform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)",$div.style.transform="translate("+$x+"px, "+$y+"px) scale("+$scale+") rotate("+$rotate+"deg)"}};Proton.DomUtil=DomUtil,MStack.prototype.set=function(m,i){0==i?Proton.Mat3.set(m,this.mats[0]):Proton.Mat3.multiply(this.mats[i-1],m,this.mats[i]),this.size=Math.max(this.size,i+1)},MStack.prototype.push=function(m){0==this.size?Proton.Mat3.set(m,this.mats[0]):Proton.Mat3.multiply(this.mats[this.size-1],m,this.mats[this.size]),this.size++},MStack.prototype.pop=function(){this.size>0&&this.size--},MStack.prototype.top=function(){return this.mats[this.size-1]},Proton.MStack=MStack,Particle.ID=0,Particle.prototype={getDirection:function(){return Math.atan2(this.v.x,-this.v.y)*(180/Math.PI)},reset:function(init){return this.life=1/0,this.age=0,this.energy=1,this.dead=!1,this.sleep=!1,this.target=null,this.sprite=null,this.parent=null,this.mass=1,this.radius=10,this.alpha=1,this.scale=1,this.rotation=0,this.color=null,this.easing=Proton.ease.setEasingByName(Proton.easeLinear),init?(this.transform={},this.p=new Proton.Vector2D,this.v=new Proton.Vector2D,this.a=new Proton.Vector2D,this.old={p:new Proton.Vector2D,v:new Proton.Vector2D,a:new Proton.Vector2D},this.behaviours=[]):(Proton.Util.destroyObject(this.transform),this.p.set(0,0),this.v.set(0,0),this.a.set(0,0),this.old.p.set(0,0),this.old.v.set(0,0),this.old.a.set(0,0),this.removeAllBehaviours()),this.transform.rgb={r:255,g:255,b:255},this},update:function(time,index){if(!this.sleep){this.age+=time;var i,length=this.behaviours.length;for(i=0;i<length;i++)this.behaviours[i]&&this.behaviours[i].applyBehaviour(this,time,index)}if(this.age>=this.life)this.destory();else{var scale=this.easing(this.age/this.life);this.energy=Math.max(1-scale,0)}},addBehaviour:function(behaviour){this.behaviours.push(behaviour),behaviour.hasOwnProperty("parents")&&behaviour.parents.push(this),behaviour.initialize(this)},addBehaviours:function(behaviours){var i,length=behaviours.length;for(i=0;i<length;i++)this.addBehaviour(behaviours[i])},removeBehaviour:function(behaviour){var index=this.behaviours.indexOf(behaviour);if(index>-1){var behaviour=this.behaviours.splice(index,1);behaviour.parents=null}},removeAllBehaviours:function(){Proton.Util.destroyArray(this.behaviours)},destory:function(){this.removeAllBehaviours(),this.energy=0,this.dead=!0,this.parent=null}},Proton.Particle=Particle,ParticlePool.prototype={create:function(newTypeParticleClass){return newTypeParticleClass?new newTypeParticle:new Proton.Particle},getCount:function(){return this.poolList.length},add:function(){return this.poolList.push(this.create())},get:function(){return 0===this.poolList.length?this.create():this.poolList.pop().reset()},set:function(particle){if(this.poolList.length<Proton.POOL_MAX)return this.poolList.push(particle)},release:function(){for(var i=0;i<this.poolList.length;i++)this.poolList[i].destory&&this.poolList[i].destory(),delete this.poolList[i];this.poolList=[]}},Proton.ParticlePool=ParticlePool;var MathUtils={randomAToB:function(a,b,INT){return INT?Math.floor(Math.random()*(b-a))+a:a+Math.random()*(b-a)},randomFloating:function(center,f,INT){return MathUtils.randomAToB(center-f,center+f,INT)},randomZone:function(display){},degreeTransform:function(a){return a*Math.PI/180},toColor16:function(num){return"#"+num.toString(16)},randomColor:function(){return"#"+("00000"+(16777216*Math.random()<<0).toString(16)).slice(-6)}};Proton.MathUtils=MathUtils;var NumericalIntegration=function(type){this.type=Proton.Util.initValue(type,Proton.EULER)};NumericalIntegration.prototype={integrate:function(particles,time,damping){this.eulerIntegrate(particles,time,damping)},eulerIntegrate:function(particle,time,damping){particle.sleep||(particle.old.p.copy(particle.p),particle.old.v.copy(particle.v),particle.a.multiplyScalar(1/particle.mass),particle.v.add(particle.a.multiplyScalar(time)),particle.p.add(particle.old.v.multiplyScalar(time)),damping&&particle.v.multiplyScalar(damping),particle.a.clear())}},Proton.NumericalIntegration=NumericalIntegration;var Vector2D=function(x,y){this.x=x||0,this.y=y||0};Vector2D.prototype={set:function(x,y){return this.x=x,this.y=y,this},setX:function(x){return this.x=x,this},setY:function(y){return this.y=y,this},setComponent:function(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index)}},getGradient:function(){return 0!=this.x?Math.atan2(this.y,this.x):this.y>0?Math.PI/2:this.y<0?-Math.PI/2:void 0},getComponent:function(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index)}},copy:function(v){return this.x=v.x,this.y=v.y,this},add:function(v,w){return w!==undefined?this.addVectors(v,w):(this.x+=v.x,this.y+=v.y,this)},addXY:function(a,b){return this.x+=a,this.y+=b,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScalar:function(s){return this.x+=s,this.y+=s,this},sub:function(v,w){return w!==undefined?this.subVectors(v,w):(this.x-=v.x,this.y-=v.y,this)},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiplyScalar:function(s){return this.x*=s,this.y*=s,this},divideScalar:function(s){return 0!==s?(this.x/=s,this.y/=s):this.set(0,0),this},min:function(v){return this.x>v.x&&(this.x=v.x),this.y>v.y&&(this.y=v.y),this},max:function(v){return this.x<v.x&&(this.x=v.x),this.y<v.y&&(this.y=v.y),this},clamp:function(min,max){return this.x<min.x?this.x=min.x:this.x>max.x&&(this.x=max.x),this.y<min.y?this.y=min.y:this.y>max.y&&(this.y=max.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(v){return this.x*v.x+this.y*v.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(v){return Math.sqrt(this.distanceToSquared(v))},rotate:function(tha){var x=this.x,y=this.y;return this.x=x*Math.cos(tha)+y*Math.sin(tha),this.y=-x*Math.sin(tha)+y*Math.cos(tha),this},distanceToSquared:function(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},setLength:function(l){var oldLength=this.length();return 0!==oldLength&&l!==oldLength&&this.multiplyScalar(l/oldLength),this},lerp:function(v,alpha){return this.x+=(v.x-this.x)*alpha,this.y+=(v.y-this.y)*alpha,this},equals:function(v){return v.x===this.x&&v.y===this.y},toArray:function(){return[this.x,this.y]},clear:function(){return this.x=0,this.y=0,this},clone:function(){return new Proton.Vector2D(this.x,this.y)}},Proton.Vector2D=Vector2D;var Polar2D=function(r,tha){this.r=Math.abs(r)||0,this.tha=tha||0};Polar2D.prototype={set:function(r,tha){return this.r=r,this.tha=tha,this},setR:function(r){return this.r=r,this},setTha:function(tha){return this.tha=tha,this},copy:function(p){return this.r=p.r,this.tha=p.tha,this},toVector:function(){return new Proton.Vector2D(this.getX(),this.getY())},getX:function(){return this.r*Math.sin(this.tha)},getY:function(){return-this.r*Math.cos(this.tha)},normalize:function(){return this.r=1,this},equals:function(v){return v.r===this.r&&v.tha===this.tha},toArray:function(){return[this.r,this.tha]},clear:function(){return this.r=0,this.tha=0,this},clone:function(){return new Proton.Polar2D(this.r,this.tha)}},Proton.Polar2D=Polar2D,Span.prototype={getValue:function(INT){return this.isArray?this.a[Math.floor(this.a.length*Math.random())]:this.center?Proton.MathUtils.randomFloating(this.a,this.b,INT):Proton.MathUtils.randomAToB(this.a,this.b,INT)}},Proton.Span=Span,Proton.getSpan=function(a,b,center){return new Proton.Span(a,b,center)},Proton.Util.inherits(ColorSpan,Proton.Span),ColorSpan.prototype.getValue=function(){var color=this.colorArr[Math.floor(this.colorArr.length*Math.random())];return"random"==color||"Random"==color?Proton.MathUtils.randomColor():color},Proton.ColorSpan=ColorSpan,Rectangle.prototype={contains:function(x,y){return x<=this.right&&x>=this.x&&y<=this.bottom&&y>=this.y}},Proton.Rectangle=Rectangle;var Mat3=Mat3||{create:function(mat3){var mat=new Float32Array(9);return mat3&&this.set(mat3,mat),mat},set:function(mat1,mat2){for(var i=0;i<9;i++)mat2[i]=mat1[i];return mat2},multiply:function(mat,mat2,mat3){var a00=mat[0],a01=mat[1],a02=mat[2],a10=mat[3],a11=mat[4],a20=mat[6],a21=mat[7],b00=mat2[0],b01=mat2[1],b02=mat2[2],b10=mat2[3],b11=mat2[4],b20=mat2[6],b21=mat2[7];return mat3[0]=b00*a00+b01*a10,mat3[1]=b00*a01+b01*a11,mat3[2]=a02*b02,mat3[3]=b10*a00+b11*a10,mat3[4]=b10*a01+b11*a11,mat3[6]=b20*a00+b21*a10+a20,mat3[7]=b20*a01+b21*a11+a21,mat3},inverse:function(mat,mat3){var id,a00=mat[0],a01=mat[1],a10=mat[3],a11=mat[4],a20=mat[6],a21=mat[7],b01=a11,b11=-a10,b21=a21*a10-a11*a20,d=a00*b01+a01*b11;return id=1/d,mat3[0]=b01*id,mat3[1]=-a01*id,mat3[3]=b11*id,mat3[4]=a00*id,mat3[6]=b21*id,mat3[7]=(-a21*a00+a01*a20)*id,mat3},multiplyVec2:function(m,vec,mat3){var x=vec[0],y=vec[1];return mat3[0]=x*m[0]+y*m[3]+m[6],mat3[1]=x*m[1]+y*m[4]+m[7],mat3}};Proton.Mat3=Mat3,Behaviour.id=0,Behaviour.prototype={reset:function(life,easing){this.life=Proton.Util.initValue(life,1/0),this.easing=Proton.Util.initValue(easing,Proton.ease.setEasingByName(Proton.easeLinear))},normalizeForce:function(force){return force.multiplyScalar(Proton.MEASURE)},normalizeValue:function(value){return value*Proton.MEASURE},initialize:function(particle){},applyBehaviour:function(particle,time,index){if(this.age+=time,this.age>=this.life||this.dead)this.energy=0,this.dead=!0,this.destory();else{var scale=this.easing(particle.age/particle.life);this.energy=Math.max(1-scale,0)}},destory:function(){var i,length=this.parents.length;for(i=0;i<length;i++)this.parents[i].removeBehaviour(this);this.parents=[]}},Proton.Behaviour=Behaviour,Rate.prototype={init:function(){this.startTime=0,this.nextTime=this.timePan.getValue()},getValue:function(time){return this.startTime+=time,this.startTime>=this.nextTime?(this.startTime=0,this.nextTime=this.timePan.getValue(),1==this.numPan.b?this.numPan.getValue(!1)>.5?1:0:this.numPan.getValue(!0)):0}},Proton.Rate=Rate,Initialize.prototype.reset=function(){},Initialize.prototype.init=function(emitter,particle){particle?this.initialize(particle):this.initialize(emitter)},Initialize.prototype.initialize=function(target){},Proton.Initialize=Initialize;var InitializeUtil={initialize:function(emitter,particle,initializes){var i,length=initializes.length;for(i=0;i<length;i++)initializes[i]instanceof Proton.Initialize?initializes[i].init(emitter,particle):Proton.InitializeUtil.init(emitter,particle,initializes[i]);Proton.InitializeUtil.bindEmitter(emitter,particle)},init:function(emitter,particle,initialize){Proton.Util.setPrototypeByObject(particle,initialize),Proton.Util.setVector2DByObject(particle,initialize)},bindEmitter:function(emitter,particle){emitter.bindEmitter&&(particle.p.add(emitter.p),particle.v.add(emitter.v),particle.a.add(emitter.a),particle.v.rotate(Proton.MathUtils.degreeTransform(emitter.rotation)))}};Proton.InitializeUtil=InitializeUtil,Proton.Util.inherits(Life,Proton.Initialize),Life.prototype.initialize=function(target){this.lifePan.a==1/0?target.life=1/0:target.life=this.lifePan.getValue()},Proton.Life=Life,Proton.Util.inherits(Position,Proton.Initialize),Position.prototype.reset=function(zone){this.zone=Proton.Util.initValue(zone,new Proton.PointZone)},Position.prototype.initialize=function(target){this.zone.getPosition(),target.p.x=this.zone.vector.x,target.p.y=this.zone.vector.y},Proton.Position=Position,Proton.P=Position,Proton.Util.inherits(Velocity,Proton.Initialize),Velocity.prototype.reset=function(rpan,thapan,type){this.rPan=Proton.Util.setSpanValue(rpan),this.thaPan=Proton.Util.setSpanValue(thapan),this.type=Proton.Util.initValue(type,"vector")},Velocity.prototype.normalizeVelocity=function(vr){return vr*Proton.MEASURE},Velocity.prototype.initialize=function(target){if("p"==this.type||"P"==this.type||"polar"==this.type){var polar2d=new Proton.Polar2D(this.normalizeVelocity(this.rPan.getValue()),this.thaPan.getValue()*Math.PI/180);target.v.x=polar2d.getX(),target.v.y=polar2d.getY()}else target.v.x=this.normalizeVelocity(this.rPan.getValue()),target.v.y=this.normalizeVelocity(this.thaPan.getValue())},Proton.Velocity=Velocity,Proton.V=Velocity,Proton.Util.inherits(Mass,Proton.Initialize),Mass.prototype.initialize=function(target){target.mass=this.massPan.getValue()},Proton.Mass=Mass,Proton.Util.inherits(Radius,Proton.Initialize),Radius.prototype.reset=function(a,b,c){this.radius=Proton.Util.setSpanValue(a,b,c)},Radius.prototype.initialize=function(particle){particle.radius=this.radius.getValue(),particle.transform.oldRadius=particle.radius},Proton.Radius=Radius,Proton.Util.inherits(ImageTarget,Proton.Initialize),ImageTarget.prototype.initialize=function(particle){var imagetarget=this.image.getValue();"string"==typeof imagetarget?particle.target={width:this.w,height:this.h,src:imagetarget}:particle.target=imagetarget},ImageTarget.prototype.setSpanValue=function(color){return color instanceof Proton.ColorSpan?color:new Proton.ColorSpan(color)},Proton.ImageTarget=ImageTarget,Proton.Util.inherits(Force,Proton.Behaviour),Force.prototype.reset=function(fx,fy,life,easing){this.force=this.normalizeForce(new Proton.Vector2D(fx,fy)),life&&Force._super_.prototype.reset.call(this,life,easing)},Force.prototype.applyBehaviour=function(particle,time,index){Force._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.a.add(this.force)},Proton.Force=Force,Proton.F=Force,Proton.Util.inherits(Attraction,Proton.Behaviour),Attraction.prototype.reset=function(targetPosition,force,radius,life,easing){this.targetPosition=Proton.Util.initValue(targetPosition,new Proton.Vector2D),this.radius=Proton.Util.initValue(radius,1e3),this.force=Proton.Util.initValue(this.normalizeValue(force),100),this.radiusSq=this.radius*this.radius,this.attractionForce=new Proton.Vector2D,this.lengthSq=0,life&&Attraction._super_.prototype.reset.call(this,life,easing)},Attraction.prototype.applyBehaviour=function(particle,time,index){Attraction._super_.prototype.applyBehaviour.call(this,particle,time,index),this.attractionForce.copy(this.targetPosition),this.attractionForce.sub(particle.p),this.lengthSq=this.attractionForce.lengthSq(),this.lengthSq>4e-6&&this.lengthSq<this.radiusSq&&(this.attractionForce.normalize(),this.attractionForce.multiplyScalar(1-this.lengthSq/this.radiusSq),this.attractionForce.multiplyScalar(this.force),particle.a.add(this.attractionForce))},Proton.Attraction=Attraction,Proton.Util.inherits(RandomDrift,Proton.Behaviour),RandomDrift.prototype.reset=function(driftX,driftY,delay,life,easing){this.panFoce=new Proton.Vector2D(driftX,driftY),this.panFoce=this.normalizeForce(this.panFoce),this.delay=delay,life&&RandomDrift._super_.prototype.reset.call(this,life,easing)},RandomDrift.prototype.applyBehaviour=function(particle,time,index){RandomDrift._super_.prototype.applyBehaviour.call(this,particle,time,index),this.time+=time,this.time>=this.delay&&(particle.a.addXY(Proton.MathUtils.randomAToB(-this.panFoce.x,this.panFoce.x),Proton.MathUtils.randomAToB(-this.panFoce.y,this.panFoce.y)),this.time=0)},Proton.RandomDrift=RandomDrift,Proton.Util.inherits(Repulsion,Proton.Attraction),Repulsion.prototype.reset=function(targetPosition,force,radius,life,easing){Repulsion._super_.prototype.reset.call(this,targetPosition,force,radius,life,easing),this.force*=-1},Proton.Repulsion=Repulsion,Proton.Util.inherits(Gravity,Proton.Force),Gravity.prototype.reset=function(g,life,easing){Gravity._super_.prototype.reset.call(this,0,g,life,easing)},Proton.Gravity=Gravity,Proton.G=Gravity,Proton.Util.inherits(Collision,Proton.Behaviour),Collision.prototype.reset=function(emitter,mass,callback,life,easing){this.emitter=Proton.Util.initValue(emitter,null),this.mass=Proton.Util.initValue(mass,!0),this.callback=Proton.Util.initValue(callback,null),this.collisionPool=[],this.delta=new Proton.Vector2D,life&&Collision._super_.prototype.reset.call(this,life,easing)},Collision.prototype.applyBehaviour=function(particle,time,index){for(var otherParticle,lengthSq,overlap,averageMass1,averageMass2,newPool=this.emitter?this.emitter.particles.slice(index):this.pool.slice(index),length=newPool.length,i=0;i<length;i++)otherParticle=newPool[i],otherParticle!==particle&&(this.delta.copy(otherParticle.p),this.delta.sub(particle.p),lengthSq=this.delta.lengthSq(),distance=particle.radius+otherParticle.radius,lengthSq<=distance*distance&&(overlap=distance-Math.sqrt(lengthSq),overlap+=.5,totalMass=particle.mass+otherParticle.mass,averageMass1=this.mass?otherParticle.mass/totalMass:.5,averageMass2=this.mass?particle.mass/totalMass:.5,particle.p.add(this.delta.clone().normalize().multiplyScalar(overlap*-averageMass1)),otherParticle.p.add(this.delta.normalize().multiplyScalar(overlap*averageMass2)),this.callback&&this.callback(particle,otherParticle)))},Proton.Collision=Collision,Proton.Util.inherits(CrossZone,Proton.Behaviour),CrossZone.prototype.reset=function(zone,crossType,life,easing){this.zone=zone,this.zone.crossType=Proton.Util.initValue(crossType,"dead"),life&&CrossZone._super_.prototype.reset.call(this,life,easing)},CrossZone.prototype.applyBehaviour=function(particle,time,index){CrossZone._super_.prototype.applyBehaviour.call(this,particle,time,index),this.zone.crossing(particle)},Proton.CrossZone=CrossZone,Proton.Util.inherits(Alpha,Proton.Behaviour),
Alpha.prototype.reset=function(a,b,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,1)),this.b=Proton.Util.setSpanValue(b),life&&Alpha._super_.prototype.reset.call(this,life,easing)},Alpha.prototype.initialize=function(particle){particle.transform.alphaA=this.a.getValue(),this.same?particle.transform.alphaB=particle.transform.alphaA:particle.transform.alphaB=this.b.getValue()},Alpha.prototype.applyBehaviour=function(particle,time,index){Alpha._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.alpha=particle.transform.alphaB+(particle.transform.alphaA-particle.transform.alphaB)*this.energy,particle.alpha<.001&&(particle.alpha=0)},Proton.Alpha=Alpha,Proton.Util.inherits(Scale,Proton.Behaviour),Scale.prototype.reset=function(a,b,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,1)),this.b=Proton.Util.setSpanValue(b),life&&Scale._super_.prototype.reset.call(this,life,easing)},Scale.prototype.initialize=function(particle){particle.transform.scaleA=this.a.getValue(),particle.transform.oldRadius=particle.radius,this.same?particle.transform.scaleB=particle.transform.scaleA:particle.transform.scaleB=this.b.getValue()},Scale.prototype.applyBehaviour=function(particle,time,index){Scale._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.scale=particle.transform.scaleB+(particle.transform.scaleA-particle.transform.scaleB)*this.energy,particle.scale<1e-4&&(particle.scale=0),particle.radius=particle.transform.oldRadius*particle.scale},Proton.Scale=Scale,Proton.Util.inherits(Rotate,Proton.Behaviour),Rotate.prototype.reset=function(a,b,style,life,easing){null==b||b==undefined?this.same=!0:this.same=!1,this.a=Proton.Util.setSpanValue(Proton.Util.initValue(a,"Velocity")),this.b=Proton.Util.setSpanValue(Proton.Util.initValue(b,0)),this.style=Proton.Util.initValue(style,"to"),life&&Rotate._super_.prototype.reset.call(this,life,easing)},Rotate.prototype.initialize=function(particle){particle.rotation=this.a.getValue(),particle.transform.rotationA=this.a.getValue(),this.same||(particle.transform.rotationB=this.b.getValue())},Rotate.prototype.applyBehaviour=function(particle,time,index){Rotate._super_.prototype.applyBehaviour.call(this,particle,time,index),this.same?"V"!=this.a.a&&"Velocity"!=this.a.a&&"v"!=this.a.a||(particle.rotation=particle.getDirection()):"to"==this.style||"TO"==this.style||"_"==this.style?particle.rotation+=particle.transform.rotationB+(particle.transform.rotationA-particle.transform.rotationB)*this.energy:particle.rotation+=particle.transform.rotationB},Proton.Rotate=Rotate,Proton.Util.inherits(Color,Proton.Behaviour),Color.prototype.reset=function(color1,color2,life,easing){this.color1=this.setSpanValue(color1),this.color2=this.setSpanValue(color2),life&&Color._super_.prototype.reset.call(this,life,easing)},Color.prototype.initialize=function(particle){particle.color=this.color1.getValue(),particle.transform.beginRGB=Proton.Util.hexToRGB(particle.color),this.color2&&(particle.transform.endRGB=Proton.Util.hexToRGB(this.color2.getValue()))},Color.prototype.applyBehaviour=function(particle,time,index){this.color2?(Color._super_.prototype.applyBehaviour.call(this,particle,time,index),particle.transform.rgb.r=particle.transform.endRGB.r+(particle.transform.beginRGB.r-particle.transform.endRGB.r)*this.energy,particle.transform.rgb.g=particle.transform.endRGB.g+(particle.transform.beginRGB.g-particle.transform.endRGB.g)*this.energy,particle.transform.rgb.b=particle.transform.endRGB.b+(particle.transform.beginRGB.b-particle.transform.endRGB.b)*this.energy,particle.transform.rgb.r=parseInt(particle.transform.rgb.r,10),particle.transform.rgb.g=parseInt(particle.transform.rgb.g,10),particle.transform.rgb.b=parseInt(particle.transform.rgb.b,10)):(particle.transform.rgb.r=particle.transform.beginRGB.r,particle.transform.rgb.g=particle.transform.beginRGB.g,particle.transform.rgb.b=particle.transform.beginRGB.b)},Color.prototype.setSpanValue=function(color){return color?color instanceof Proton.ColorSpan?color:new Proton.ColorSpan(color):null},Proton.Color=Color,Proton.Util.inherits(GravityWell,Proton.Behaviour),GravityWell.prototype.reset=function(centerPoint,force,life,easing){this.distanceVec=new Proton.Vector2D,this.centerPoint=Proton.Util.initValue(centerPoint,new Proton.Vector2D),this.force=Proton.Util.initValue(this.normalizeValue(force),100),life&&GravityWell._super_.prototype.reset.call(this,life,easing)},GravityWell.prototype.initialize=function(particle){},GravityWell.prototype.applyBehaviour=function(particle,time,index){this.distanceVec.set(this.centerPoint.x-particle.p.x,this.centerPoint.y-particle.p.y);var distanceSq=this.distanceVec.lengthSq();if(0!=distanceSq){var distance=this.distanceVec.length(),factor=this.force*time/(distanceSq*distance);particle.v.x+=factor*this.distanceVec.x,particle.v.y+=factor*this.distanceVec.y}},Proton.GravityWell=GravityWell,Emitter.ID=0,Proton.Util.inherits(Emitter,Proton.Particle),Proton.EventDispatcher.initialize(Emitter.prototype),Emitter.prototype.emit=function(emitTime,life){this.emitTime=0,this.emitTotalTimes=Proton.Util.initValue(emitTime,1/0),1==life||"life"==life||"destroy"==life?"once"==emitTime?this.life=1:this.life=this.emitTotalTimes:isNaN(life)||(this.life=life),this.rate.init()},Emitter.prototype.stopEmit=function(){this.emitTotalTimes=-1,this.emitTime=0},Emitter.prototype.removeAllParticles=function(){for(var i=0;i<this.particles.length;i++)this.particles[i].dead=!0},Emitter.prototype.createParticle=function(initialize,behaviour){var particle=Proton.pool.get();return this.setupParticle(particle,initialize,behaviour),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_CREATED,particle:particle})),particle},Emitter.prototype.addSelfInitialize=function(pObj){pObj.init?pObj.init(this):this.initAll()},Emitter.prototype.addInitialize=function(){var i,length=arguments.length;for(i=0;i<length;i++)this.initializes.push(arguments[i])},Emitter.prototype.removeInitialize=function(initializer){var index=this.initializes.indexOf(initializer);index>-1&&this.initializes.splice(index,1)},Emitter.prototype.removeInitializers=function(){Proton.Util.destroyArray(this.initializes)},Emitter.prototype.addBehaviour=function(){var i,length=arguments.length;for(i=0;i<length;i++)this.behaviours.push(arguments[i]),arguments[i].hasOwnProperty("parents")&&arguments[i].parents.push(this)},Emitter.prototype.removeBehaviour=function(behaviour){var index=this.behaviours.indexOf(behaviour);index>-1&&this.behaviours.splice(index,1)},Emitter.prototype.removeAllBehaviours=function(){Proton.Util.destroyArray(this.behaviours)},Emitter.prototype.integrate=function(time){var damping=1-this.damping;Proton.integrator.integrate(this,time,damping);var i,length=this.particles.length;for(i=0;i<length;i++){var particle=this.particles[i];particle.update(time,i),Proton.integrator.integrate(particle,time,damping),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_UPDATE,particle:particle}))}},Emitter.prototype.emitting=function(time){if("once"==this.emitTotalTimes){var i,length=this.rate.getValue(99999);for(i=0;i<length;i++)this.createParticle();this.emitTotalTimes="none"}else if(!isNaN(this.emitTotalTimes)&&(this.emitTime+=time,this.emitTime<this.emitTotalTimes)){var i,length=this.rate.getValue(time);for(i=0;i<length;i++)this.createParticle()}},Emitter.prototype.update=function(time){this.age+=time,(this.age>=this.life||this.dead)&&this.destroy(),this.emitting(time),this.integrate(time);var particle,k,length=this.particles.length;for(k=length-1;k>=0;k--)particle=this.particles[k],particle.dead&&(Proton.pool.set(particle),this.particles.splice(k,1),this.dispatchEvent(new Proton.Event({type:Proton.PARTICLE_DEAD,particle:particle})))},Emitter.prototype.setupParticle=function(particle,initialize,behaviour){var initializes=this.initializes,behaviours=this.behaviours;initialize&&(initializes=initialize instanceof Array?initialize:[initialize]),behaviour&&(behaviours=behaviour instanceof Array?behaviour:[behaviour]),Proton.InitializeUtil.initialize(this,particle,initializes),particle.addBehaviours(behaviours),particle.parent=this,this.particles.push(particle)},Emitter.prototype.destroy=function(){this.dead=!0,this.emitTotalTimes=-1,0==this.particles.length&&(this.removeInitializers(),this.removeAllBehaviours(),this.parent&&this.parent.removeEmitter(this))},Proton.Emitter=Emitter,Proton.Util.inherits(BehaviourEmitter,Proton.Emitter),BehaviourEmitter.prototype.addSelfBehaviour=function(){var i,length=arguments.length;for(i=0;i<length;i++)this.selfBehaviours.push(arguments[i])},BehaviourEmitter.prototype.removeSelfBehaviour=function(behaviour){var index=this.selfBehaviours.indexOf(behaviour);index>-1&&this.selfBehaviours.splice(index,1)},BehaviourEmitter.prototype.update=function(time){if(BehaviourEmitter._super_.prototype.update.call(this,time),!this.sleep){var i,length=this.selfBehaviours.length;for(i=0;i<length;i++)this.selfBehaviours[i].applyBehaviour(this,time,i)}},Proton.BehaviourEmitter=BehaviourEmitter,Proton.Util.inherits(FollowEmitter,Proton.Emitter),FollowEmitter.prototype.initEventHandler=function(){var self=this;this.mousemoveHandler=function(e){self.mousemove.call(self,e)},this.mousedownHandler=function(e){self.mousedown.call(self,e)},this.mouseupHandler=function(e){self.mouseup.call(self,e)},this.mouseTarget.addEventListener("mousemove",this.mousemoveHandler,!1)},FollowEmitter.prototype.emit=function(){this._allowEmitting=!0},FollowEmitter.prototype.stopEmit=function(){this._allowEmitting=!1},FollowEmitter.prototype.mousemove=function(e){e.layerX||0==e.layerX?(this.p.x+=(e.layerX-this.p.x)*this.ease,this.p.y+=(e.layerY-this.p.y)*this.ease):(e.offsetX||0==e.offsetX)&&(this.p.x+=(e.offsetX-this.p.x)*this.ease,this.p.y+=(e.offsetY-this.p.y)*this.ease),this._allowEmitting&&FollowEmitter._super_.prototype.emit.call(this,"once")},FollowEmitter.prototype.destroy=function(){FollowEmitter._super_.prototype.destroy.call(this),this.mouseTarget.removeEventListener("mousemove",this.mousemoveHandler,!1)},Proton.FollowEmitter=FollowEmitter;var ease=ease||{easeLinear:function(value){return value},easeInQuad:function(value){return Math.pow(value,2)},easeOutQuad:function(value){return-(Math.pow(value-1,2)-1)},easeInOutQuad:function(value){return(value/=.5)<1?.5*Math.pow(value,2):-.5*((value-=2)*value-2)},easeInCubic:function(value){return Math.pow(value,3)},easeOutCubic:function(value){return Math.pow(value-1,3)+1},easeInOutCubic:function(value){return(value/=.5)<1?.5*Math.pow(value,3):.5*(Math.pow(value-2,3)+2)},easeInQuart:function(value){return Math.pow(value,4)},easeOutQuart:function(value){return-(Math.pow(value-1,4)-1)},easeInOutQuart:function(value){return(value/=.5)<1?.5*Math.pow(value,4):-.5*((value-=2)*Math.pow(value,3)-2)},easeInSine:function(value){return-Math.cos(value*(Math.PI/2))+1},easeOutSine:function(value){return Math.sin(value*(Math.PI/2))},easeInOutSine:function(value){return-.5*(Math.cos(Math.PI*value)-1)},easeInExpo:function(value){return 0===value?0:Math.pow(2,10*(value-1))},easeOutExpo:function(value){return 1===value?1:-Math.pow(2,-10*value)+1},easeInOutExpo:function(value){return 0===value?0:1===value?1:(value/=.5)<1?.5*Math.pow(2,10*(value-1)):.5*(-Math.pow(2,-10*--value)+2)},easeInCirc:function(value){return-(Math.sqrt(1-value*value)-1)},easeOutCirc:function(value){return Math.sqrt(1-Math.pow(value-1,2))},easeInOutCirc:function(value){return(value/=.5)<1?-.5*(Math.sqrt(1-value*value)-1):.5*(Math.sqrt(1-(value-=2)*value)+1)},easeInBack:function(value){var s=1.70158;return value*value*((s+1)*value-s)},easeOutBack:function(value){var s=1.70158;return(value-=1)*value*((s+1)*value+s)+1},easeInOutBack:function(value){var s=1.70158;return(value/=.5)<1?.5*(value*value*(((s*=1.525)+1)*value-s)):.5*((value-=2)*value*(((s*=1.525)+1)*value+s)+2)},setEasingByName:function(name){switch(name){case"easeLinear":return Proton.ease.easeLinear;case"easeInQuad":return Proton.ease.easeInQuad;case"easeOutQuad":return Proton.ease.easeOutQuad;case"easeInOutQuad":return Proton.ease.easeInOutQuad;case"easeInCubic":return Proton.ease.easeInCubic;case"easeOutCubic":return Proton.ease.easeOutCubic;case"easeInOutCubic":return Proton.ease.easeInOutCubic;case"easeInQuart":return Proton.ease.easeInQuart;case"easeOutQuart":return Proton.ease.easeOutQuart;case"easeInOutQuart":return Proton.ease.easeInOutQuart;case"easeInSine":return Proton.ease.easeInSine;case"easeOutSine":return Proton.ease.easeOutSine;case"easeInOutSine":return Proton.ease.easeInOutSine;case"easeInExpo":return Proton.ease.easeInExpo;case"easeOutExpo":return Proton.ease.easeOutExpo;case"easeInOutExpo":return Proton.ease.easeInOutExpo;case"easeInCirc":return Proton.ease.easeInCirc;case"easeOutCirc":return Proton.ease.easeOutCirc;case"easeInOutCirc":return Proton.ease.easeInOutCirc;case"easeInBack":return Proton.ease.easeInBack;case"easeOutBack":return Proton.ease.easeOutBack;case"easeInOutBack":return Proton.ease.easeInOutBack;default:return Proton.ease.easeLinear}}};Proton.ease=ease,Proton.easeLinear="easeLinear",Proton.easeInQuad="easeInQuad",Proton.easeOutQuad="easeOutQuad",Proton.easeInOutQuad="easeInOutQuad",Proton.easeInCubic="easeInCubic",Proton.easeOutCubic="easeOutCubic",Proton.easeInOutCubic="easeInOutCubic",Proton.easeInQuart="easeInQuart",Proton.easeOutQuart="easeOutQuart",Proton.easeInOutQuart="easeInOutQuart",Proton.easeInSine="easeInSine",Proton.easeOutSine="easeOutSine",Proton.easeInOutSine="easeInOutSine",Proton.easeInExpo="easeInExpo",Proton.easeOutExpo="easeOutExpo",Proton.easeInOutExpo="easeInOutExpo",Proton.easeInCirc="easeInCirc",Proton.easeOutCirc="easeOutCirc",Proton.easeInOutCirc="easeInOutCirc",Proton.easeInBack="easeInBack",Proton.easeOutBack="easeOutBack",Proton.easeInOutBack="easeInOutBack",Renderer.prototype={start:function(){this.addEventHandler(),this.renderer.start()},stop:function(){this.renderer.stop()},resize:function(width,height){this.renderer.resize(width,height)},setStroke:function(color,thinkness){this.renderer.hasOwnProperty("stroke")?this.renderer.setStroke(color,thinkness):alert("Sorry this renderer do not suppest stroke method!")},createImageData:function(data){this.renderer instanceof Proton.PixelRender&&this.renderer.createImageData(data)},setMaxRadius:function(radius){this.renderer instanceof Proton.WebGLRender&&this.renderer.setMaxRadius(radius)},blendEquation:function(A){this.renderer instanceof Proton.WebGLRender&&this.renderer.blendEquation(A)},blendFunc:function(A,B){this.renderer instanceof Proton.WebGLRender&&this.renderer.blendFunc(A,B)},setType:function(type){this.type=type,this.renderer=this.getRenderer()},getRenderer:function(){switch(this.type){case"dom":return new Proton.DomRender(this.proton,this.element);case"canvas":return new Proton.CanvasRender(this.proton,this.element);case"webgl":return new Proton.WebGLRender(this.proton,this.element);case"easel":return new Proton.EaselRender(this.proton,this.element);case"easeljs":return new Proton.EaselRender(this.proton,this.element);case"pixel":return new Proton.PixelRender(this.proton,this.element);default:return new Proton.BaseRender(this.proton,this.element)}},render:function(callback){this.renderer.render(callback)},addEventHandler:function(){this.onProtonUpdate&&(this.renderer.onProtonUpdate=this.onProtonUpdate),this.onParticleCreated&&(this.renderer.onParticleCreated=this.onParticleCreated),this.onParticleUpdate&&(this.renderer.onParticleUpdate=this.onParticleUpdate),this.onParticleDead&&(this.renderer.onParticleDead=this.onParticleDead)}},Proton.Renderer=Renderer,BaseRender.prototype={start:function(){var self=this;this.proton.addEventListener(Proton.PROTON_UPDATE,function(e){self.onProtonUpdate.call(self)}),this.proton.addEventListener(Proton.PROTON_UPDATE_AFTER,function(e){self.onProtonUpdateAfter.call(self)}),this.proton.addEventListener(Proton.EMITTER_ADDED,function(e){self.onEmitterAdded.call(self,e.emitter)}),this.proton.addEventListener(Proton.EMITTER_REMOVED,function(e){self.onEmitterRemoved.call(self,e.emitter)});var i,length=this.proton.emitters.length;for(i=0;i<length;i++){var emitter=this.proton.emitters[i];this.addEmitterListener(emitter)}},resize:function(width,height){},addEmitterListener:function(emitter){var self=this;emitter.addEventListener(Proton.PARTICLE_CREATED,function(e){self.onParticleCreated.call(self,e.particle)}),emitter.addEventListener(Proton.PARTICLE_UPDATE,function(e){self.onParticleUpdate.call(self,e.particle)}),emitter.addEventListener(Proton.PARTICLE_DEAD,function(e){self.onParticleDead.call(self,e.particle)})},stop:function(){var i,length=this.proton.emitters.length;for(this.proton.removeAllEventListeners(),i=0;i<length;i++){var emitter=this.proton.emitters[i];emitter.removeAllEventListeners()}},onEmitterAdded:function(emitter){this.addEmitterListener(emitter)},onEmitterRemoved:function(emitter){emitter.removeAllEventListeners()},onProtonUpdate:function(){},onProtonUpdateAfter:function(){},onParticleCreated:function(particle){},onParticleUpdate:function(particle){},onParticleDead:function(particle){}},Proton.BaseRender=BaseRender,Proton.Util.inherits(DomRender,Proton.BaseRender),DomRender.prototype.start=function(){DomRender._super_.prototype.start.call(this)},DomRender.prototype.setStroke=function(color,thinkness){color=Proton.Util.initValue(color,"#000000"),thinkness=Proton.Util.initValue(thinkness,1),this.stroke={color:color,thinkness:thinkness}},DomRender.prototype.onProtonUpdate=function(){},DomRender.prototype.onParticleCreated=function(particle){if(particle.target){var self=this;Proton.Util.getImage(particle.target,particle,!1,function(particle){self.setImgInDIV.call(self,particle)})}else particle.transform.canvas=Proton.DomUtil.createCanvas(particle.id+"_canvas",particle.radius+1,particle.radius+1,"absolute"),particle.transform.bakOldRadius=particle.radius,this.stroke?(particle.transform.canvas.width=2*particle.radius+2*this.stroke.thinkness,particle.transform.canvas.height=2*particle.radius+2*this.stroke.thinkness):(particle.transform.canvas.width=2*particle.radius+1,particle.transform.canvas.height=2*particle.radius+1),particle.transform.context=particle.transform.canvas.getContext("2d"),particle.transform.context.fillStyle=particle.color,particle.transform.context.beginPath(),particle.transform.context.arc(particle.radius,particle.radius,particle.radius,0,2*Math.PI,!0),this.stroke&&(particle.transform.context.strokeStyle=this.stroke.color,particle.transform.context.lineWidth=this.stroke.thinkness,particle.transform.context.stroke()),particle.transform.context.closePath(),particle.transform.context.fill(),this.element.appendChild(particle.transform.canvas)},DomRender.prototype.onParticleUpdate=function(particle){particle.target?particle.target instanceof Image&&(particle.transform.canvas.style.opacity=particle.alpha,Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.target.width/2,particle.p.y-particle.target.height/2,particle.scale,particle.rotation)):(particle.transform.canvas.style.opacity=particle.alpha,particle.transform.oldRadius?Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.transform.oldRadius,particle.p.y-particle.transform.oldRadius,particle.scale,particle.rotation):Proton.DomUtil.transformDom(particle.transform.canvas,particle.p.x-particle.transform.bakOldRadius,particle.p.y-particle.transform.bakOldRadius,particle.scale,particle.rotation))},DomRender.prototype.onParticleDead=function(particle){particle.transform.canvas&&this.element.removeChild(particle.transform.canvas)},DomRender.prototype.setImgInDIV=function(particle){particle.transform.canvas=Proton.DomUtil.createCanvas(particle.id+"_canvas",particle.target.width+1,particle.target.height+1,"absolute",particle.p.x-particle.radius,particle.p.y-particle.radius),particle.transform.context=particle.transform.canvas.getContext("2d"),particle.transform.context.drawImage(particle.target,0,0,particle.target.width,particle.target.height),this.element.appendChild(particle.transform.canvas)},Proton.DomRender=DomRender,Proton.Util.inherits(EaselRender,Proton.BaseRender),EaselRender.prototype.resize=function(width,height){},EaselRender.prototype.start=function(){EaselRender._super_.prototype.start.call(this)},EaselRender.prototype.onProtonUpdate=function(){},EaselRender.prototype.onParticleCreated=function(particle){if(particle.target)particle.target=particle.target.clone(),particle.target.parent||(particle.target.image&&(particle.target.regX=particle.target.image.width/2,particle.target.regY=particle.target.image.height/2),this.element.addChild(particle.target));else{var graphics=new createjs.Graphics;this.stroke&&(1==this.stroke?graphics.beginStroke("#000000"):this.stroke instanceof String&&graphics.beginStroke(this.stroke)),graphics.beginFill(particle.color).drawCircle(0,0,particle.radius);var shape=new createjs.Shape(graphics);particle.target=shape,this.element.addChild(particle.target)}},EaselRender.prototype.onParticleUpdate=function(particle){particle.target&&(particle.target.x=particle.p.x,particle.target.y=particle.p.y,particle.target.alpha=particle.alpha,particle.target.scaleX=particle.target.scaleY=particle.scale,particle.target.rotation=particle.rotation)},EaselRender.prototype.onParticleDead=function(particle){particle.target&&particle.target.parent&&particle.target.parent.removeChild(particle.target)},Proton.EaselRender=EaselRender,Proton.Util.inherits(CanvasRender,Proton.BaseRender),CanvasRender.prototype.resize=function(width,height){this.element.width=width,this.element.height=height},CanvasRender.prototype.start=function(){CanvasRender._super_.prototype.start.call(this)},CanvasRender.prototype.setStroke=function(color,thinkness){color=Proton.Util.initValue(color,"#000000"),thinkness=Proton.Util.initValue(thinkness,1),this.stroke={color:color,thinkness:thinkness}},CanvasRender.prototype.onProtonUpdate=function(){this.context.clearRect(0,0,this.element.width,this.element.height)},CanvasRender.prototype.onParticleCreated=function(particle){particle.target?Proton.Util.getImage(particle.target,particle,!1):particle.color=particle.color?particle.color:"#ff0000"},CanvasRender.prototype.onParticleUpdate=function(particle){if(particle.target){if(particle.target instanceof Image){var w=particle.target.width*particle.scale|0,h=particle.target.height*particle.scale|0,x=particle.p.x-w/2,y=particle.p.y-h/2;if(particle.color){particle.transform.buffer||(particle.transform.buffer=this.getBuffer(particle.target));var bufferContext=particle.transform.buffer.getContext("2d");bufferContext.clearRect(0,0,particle.transform.buffer.width,particle.transform.buffer.height),bufferContext.globalAlpha=particle.alpha,bufferContext.drawImage(particle.target,0,0),bufferContext.globalCompositeOperation="source-atop",bufferContext.fillStyle=Proton.Util.rgbToHex(particle.transform.rgb),bufferContext.fillRect(0,0,particle.transform.buffer.width,particle.transform.buffer.height),bufferContext.globalCompositeOperation="source-over",bufferContext.globalAlpha=1,this.context.drawImage(particle.transform.buffer,0,0,particle.transform.buffer.width,particle.transform.buffer.height,x,y,w,h)}else this.context.save(),this.context.globalAlpha=particle.alpha,this.context.translate(particle.p.x,particle.p.y),this.context.rotate(Proton.MathUtils.degreeTransform(particle.rotation)),this.context.translate(-particle.p.x,-particle.p.y),this.context.drawImage(particle.target,0,0,particle.target.width,particle.target.height,x,y,w,h),this.context.globalAlpha=1,this.context.restore()}}else particle.transform.rgb?this.context.fillStyle="rgba("+particle.transform.rgb.r+","+particle.transform.rgb.g+","+particle.transform.rgb.b+","+particle.alpha+")":this.context.fillStyle=particle.color,this.context.beginPath(),this.context.arc(particle.p.x,particle.p.y,particle.radius,0,2*Math.PI,!0),this.stroke&&(this.context.strokeStyle=this.stroke.color,this.context.lineWidth=this.stroke.thinkness,this.context.stroke()),this.context.closePath(),this.context.fill()},CanvasRender.prototype.onParticleDead=function(particle){},CanvasRender.prototype.getBuffer=function(image){if(image instanceof Image){var size=image.width+"_"+image.height,canvas=this.bufferCache[size];return canvas||(canvas=document.createElement("canvas"),canvas.width=image.width,canvas.height=image.height,this.bufferCache[size]=canvas),canvas}},Proton.CanvasRender=CanvasRender,Proton.Util.inherits(PixelRender,Proton.BaseRender),PixelRender.prototype.resize=function(width,height){this.element.width=width,this.element.height=height},PixelRender.prototype.createImageData=function(rectangle){rectangle?this.rectangle=rectangle:this.rectangle=new Proton.Rectangle(0,0,this.element.width,this.element.height),this.imageData=this.context.createImageData(this.rectangle.width,this.rectangle.height),this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},PixelRender.prototype.start=function(){PixelRender._super_.prototype.start.call(this)},PixelRender.prototype.onProtonUpdate=function(){this.context.clearRect(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height),this.imageData=this.context.getImageData(this.rectangle.x,this.rectangle.y,this.rectangle.width,this.rectangle.height)},PixelRender.prototype.onProtonUpdateAfter=function(){this.context.putImageData(this.imageData,this.rectangle.x,this.rectangle.y)},PixelRender.prototype.onParticleCreated=function(particle){},PixelRender.prototype.onParticleUpdate=function(particle){this.imageData&&this.setPixel(this.imageData,Math.floor(particle.p.x-this.rectangle.x),Math.floor(particle.p.y-this.rectangle.y),particle)},PixelRender.prototype.setPixel=function(imagedata,x,y,particle){var rgb=particle.transform.rgb;if(!(x<0||x>this.element.width||y<0||y>this.elementwidth)){var i=4*((y>>0)*imagedata.width+(x>>0));imagedata.data[i]=rgb.r,imagedata.data[i+1]=rgb.g,imagedata.data[i+2]=rgb.b,imagedata.data[i+3]=255*particle.alpha}},PixelRender.prototype.onParticleDead=function(particle){},Proton.PixelRender=PixelRender,Proton.Util.inherits(WebGLRender,Proton.BaseRender),WebGLRender.prototype.resize=function(width,height){this.umat[4]=-2,this.umat[7]=1,this.smat[0]=1/width,this.smat[4]=1/height,this.mstack.set(this.umat,0),this.mstack.set(this.smat,1),this.gl.viewport(0,0,width,height),this.element.width=width,this.element.height=height},WebGLRender.prototype.setMaxRadius=function(radius){this.circleCanvasURL=this.createCircle(radius)},WebGLRender.prototype.getVertexShader=function(){var vsSource=["uniform vec2 viewport;","attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 tMat;","varying vec2 vTextureCoord;","varying float alpha;","void main() {","vec3 v = tMat * vec3(aVertexPosition, 1.0);","gl_Position = vec4(v.x, v.y, 0, 1);","vTextureCoord = aTextureCoord;","alpha = tMat[0][2];","}"].join("\n");return vsSource},WebGLRender.prototype.getFragmentShader=function(){var fsSource=["precision mediump float;","varying vec2 vTextureCoord;","varying float alpha;","uniform sampler2D uSampler;","uniform vec4 color;","uniform bool useTexture;","uniform vec3 uColor;","void main() {","vec4 textureColor = texture2D(uSampler, vTextureCoord);","gl_FragColor = textureColor * vec4(uColor, 1.0);","gl_FragColor.w *= alpha;","}"].join("\n");return fsSource},WebGLRender.prototype.initVar=function(){this.mstack=new Proton.MStack,this.umat=Proton.Mat3.create([2,0,1,0,-2,0,-1,1,1]),this.smat=Proton.Mat3.create([.01,0,1,0,.01,0,0,0,1]),this.texturebuffers={}},WebGLRender.prototype.start=function(){WebGLRender._super_.prototype.start.call(this),this.resize(this.element.width,this.element.height)},WebGLRender.prototype.blendEquation=function(A){this.gl.blendEquation(this.gl[A])},WebGLRender.prototype.blendFunc=function(A,B){this.gl.blendFunc(this.gl[A],this.gl[B])},WebGLRender.prototype.getShader=function(gl,str,fs){var shader;return shader=fs?gl.createShader(gl.FRAGMENT_SHADER):gl.createShader(gl.VERTEX_SHADER),gl.shaderSource(shader,str),gl.compileShader(shader),gl.getShaderParameter(shader,gl.COMPILE_STATUS)?shader:(alert(gl.getShaderInfoLog(shader)),null)},WebGLRender.prototype.initShaders=function(){var fragmentShader=this.getShader(this.gl,this.getFragmentShader(),!0),vertexShader=this.getShader(this.gl,this.getVertexShader(),!1);this.sprogram=this.gl.createProgram(),this.gl.attachShader(this.sprogram,vertexShader),this.gl.attachShader(this.sprogram,fragmentShader),this.gl.linkProgram(this.sprogram),this.gl.getProgramParameter(this.sprogram,this.gl.LINK_STATUS)||alert("Could not initialise shaders"),this.gl.useProgram(this.sprogram),this.sprogram.vpa=this.gl.getAttribLocation(this.sprogram,"aVertexPosition"),this.sprogram.tca=this.gl.getAttribLocation(this.sprogram,"aTextureCoord"),this.gl.enableVertexAttribArray(this.sprogram.tca),this.gl.enableVertexAttribArray(this.sprogram.vpa),this.sprogram.tMatUniform=this.gl.getUniformLocation(this.sprogram,"tMat"),this.sprogram.samplerUniform=this.gl.getUniformLocation(this.sprogram,"uSampler"),this.sprogram.useTex=this.gl.getUniformLocation(this.sprogram,"useTexture"),this.sprogram.color=this.gl.getUniformLocation(this.sprogram,"uColor"),this.gl.uniform1i(this.sprogram.useTex,1)},WebGLRender.prototype.initBuffers=function(){this.unitIBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer);var vs=[0,3,1,0,2,3];this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(vs),this.gl.STATIC_DRAW);for(var ids=[],i=0;i<100;i++)ids.push(i);for(idx=new Uint16Array(ids),this.unitI33=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitI33),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW),ids=[],i=0;i<100;i++)ids.push(i,i+1,i+2);idx=new Uint16Array(ids),this.stripBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.stripBuffer),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,idx,this.gl.STATIC_DRAW)},WebGLRender.prototype.createCircle=function(raidus){this.circleCanvasRadius=Proton.WebGLUtil.nhpot(Proton.Util.initValue(raidus,32));var canvas=Proton.DomUtil.createCanvas("circle_canvas",2*this.circleCanvasRadius,2*this.circleCanvasRadius),context=canvas.getContext("2d");return context.beginPath(),context.arc(this.circleCanvasRadius,this.circleCanvasRadius,this.circleCanvasRadius,0,2*Math.PI,!0),context.closePath(),context.fillStyle="#FFF",context.fill(),canvas.toDataURL()},WebGLRender.prototype.setImgInCanvas=function(particle){var _w=particle.target.width,_h=particle.target.height,_width=Proton.WebGLUtil.nhpot(particle.target.width),_height=Proton.WebGLUtil.nhpot(particle.target.height),_scaleX=particle.target.width/_width,_scaleY=particle.target.height/_height;this.texturebuffers[particle.transform.src]||(this.texturebuffers[particle.transform.src]=[this.gl.createTexture(),this.gl.createBuffer(),this.gl.createBuffer()]),particle.transform.texture=this.texturebuffers[particle.transform.src][0],particle.transform.vcBuffer=this.texturebuffers[particle.transform.src][1],particle.transform.tcBuffer=this.texturebuffers[particle.transform.src][2],this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.tcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,_scaleX,0,0,_scaleY,_scaleY,_scaleY]),this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.vcBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array([0,0,_w,0,0,_h,_w,_h]),this.gl.STATIC_DRAW);var context=particle.transform.canvas.getContext("2d"),data=context.getImageData(0,0,_width,_height);this.gl.bindTexture(this.gl.TEXTURE_2D,particle.transform.texture),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,data),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR_MIPMAP_NEAREST),
this.gl.generateMipmap(this.gl.TEXTURE_2D),particle.transform.textureLoaded=!0,particle.transform.textureWidth=_w,particle.transform.textureHeight=_h},WebGLRender.prototype.setStroke=function(color,thinkness){},WebGLRender.prototype.onProtonUpdate=function(){},WebGLRender.prototype.onParticleCreated=function(particle){var self=this;particle.transform.textureLoaded=!1,particle.transform.tmat=Proton.Mat3.create(),particle.transform.tmat[8]=1,particle.transform.imat=Proton.Mat3.create(),particle.transform.imat[8]=1,particle.target?Proton.Util.getImage(particle.target,particle,!0,function(particle){self.setImgInCanvas.call(self,particle),particle.transform.oldScale=1}):Proton.Util.getImage(this.circleCanvasURL,particle,!0,function(particle){self.setImgInCanvas.call(self,particle),particle.transform.oldScale=particle.radius/self.circleCanvasRadius})},WebGLRender.prototype.onParticleUpdate=function(particle){particle.transform.textureLoaded&&(this.updateMatrix(particle),this.gl.uniform3f(this.sprogram.color,particle.transform.rgb.r/255,particle.transform.rgb.g/255,particle.transform.rgb.b/255),this.gl.uniformMatrix3fv(this.sprogram.tMatUniform,!1,this.mstack.top()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.vcBuffer),this.gl.vertexAttribPointer(this.sprogram.vpa,2,this.gl.FLOAT,!1,0,0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,particle.transform.tcBuffer),this.gl.vertexAttribPointer(this.sprogram.tca,2,this.gl.FLOAT,!1,0,0),this.gl.bindTexture(this.gl.TEXTURE_2D,particle.transform.texture),this.gl.uniform1i(this.sprogram.samplerUniform,0),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.unitIBuffer),this.gl.drawElements(this.gl.TRIANGLES,6,this.gl.UNSIGNED_SHORT,0),this.mstack.pop())},WebGLRender.prototype.onParticleDead=function(particle){},WebGLRender.prototype.updateMatrix=function(particle){var moveOriginMatrix=Proton.WebGLUtil.makeTranslation(-particle.transform.textureWidth/2,-particle.transform.textureHeight/2),translationMatrix=Proton.WebGLUtil.makeTranslation(particle.p.x,particle.p.y),angel=particle.rotation*(Math.PI/180),rotationMatrix=Proton.WebGLUtil.makeRotation(angel),scale=particle.scale*particle.transform.oldScale,scaleMatrix=Proton.WebGLUtil.makeScale(scale,scale),matrix=Proton.WebGLUtil.matrixMultiply(moveOriginMatrix,scaleMatrix);matrix=Proton.WebGLUtil.matrixMultiply(matrix,rotationMatrix),matrix=Proton.WebGLUtil.matrixMultiply(matrix,translationMatrix),Proton.Mat3.inverse(matrix,particle.transform.imat),matrix[2]=particle.alpha,this.mstack.push(matrix)},Proton.WebGLRender=WebGLRender,Zone.prototype={getPosition:function(){},crossing:function(particle){}},Proton.Zone=Zone,Proton.Util.inherits(LineZone,Proton.Zone),LineZone.prototype.getPosition=function(){return this.random=Math.random(),this.vector.x=this.x1+this.random*this.length*Math.cos(this.gradient),this.vector.y=this.y1+this.random*this.length*Math.sin(this.gradient),this.vector},LineZone.prototype.getDirection=function(x,y){var A=this.dy,B=-this.dx,C=this.dot,D=0==B?1:B;return(A*x+B*y+C)*D>0},LineZone.prototype.getDistance=function(x,y){var A=this.dy,B=-this.dx,C=this.dot,D=A*x+B*y+C;return D/Math.sqrt(this.xxyy)},LineZone.prototype.getSymmetric=function(v){var tha2=v.getGradient(),tha1=this.getGradient(),tha=2*(tha1-tha2),oldx=v.x,oldy=v.y;return v.x=oldx*Math.cos(tha)-oldy*Math.sin(tha),v.y=oldx*Math.sin(tha)+oldy*Math.cos(tha),v},LineZone.prototype.getGradient=function(){return Math.atan2(this.dy,this.dx)},LineZone.prototype.getRange=function(particle,fun){var angle=Math.abs(this.getGradient());angle<=Math.PI/4?particle.p.x<this.maxx&&particle.p.x>this.minx&&fun():particle.p.y<this.maxy&&particle.p.y>this.miny&&fun()},LineZone.prototype.getLength=function(){return Math.sqrt(this.dx*this.dx+this.dy*this.dy)},LineZone.prototype.crossing=function(particle){var self=this;"dead"==this.crossType?">"==this.direction||"R"==this.direction||"right"==this.direction||"down"==this.direction?this.getRange(particle,function(){self.getDirection(particle.p.x,particle.p.y)&&(particle.dead=!0)}):this.getRange(particle,function(){self.getDirection(particle.p.x,particle.p.y)||(particle.dead=!0)}):"bound"==this.crossType?this.getRange(particle,function(){self.getDistance(particle.p.x,particle.p.y)<=particle.radius&&(0==self.dx?particle.v.x*=-1:0==self.dy?particle.v.y*=-1:self.getSymmetric(particle.v))}):"cross"==this.crossType&&this.alert&&(alert("Sorry lineZone does not support cross method"),this.alert=!1)},Proton.LineZone=LineZone,Proton.Util.inherits(CircleZone,Proton.Zone),CircleZone.prototype.getPosition=function(){return this.random=Math.random(),this.angle=2*Math.PI*Math.random(),this.vector.x=this.x+this.random*this.radius*Math.cos(this.angle),this.vector.y=this.y+this.random*this.radius*Math.sin(this.angle),this.vector},CircleZone.prototype.setCenter=function(x,y){this.center.x=x,this.center.y=y},CircleZone.prototype.crossing=function(particle){var d=particle.p.distanceTo(this.center);"dead"==this.crossType?d-particle.radius>this.radius&&(particle.dead=!0):"bound"==this.crossType?d+particle.radius>=this.radius&&this.getSymmetric(particle):"cross"==this.crossType&&this.alert&&(alert("Sorry CircleZone does not support cross method"),this.alert=!1)},CircleZone.prototype.getSymmetric=function(particle){var tha2=particle.v.getGradient(),tha1=this.getGradient(particle),tha=2*(tha1-tha2),oldx=particle.v.x,oldy=particle.v.y;particle.v.x=oldx*Math.cos(tha)-oldy*Math.sin(tha),particle.v.y=oldx*Math.sin(tha)+oldy*Math.cos(tha)},CircleZone.prototype.getGradient=function(particle){return-Math.PI/2+Math.atan2(particle.p.y-this.center.y,particle.p.x-this.center.x)},Proton.CircleZone=CircleZone,Proton.Util.inherits(PointZone,Proton.Zone),PointZone.prototype.getPosition=function(){return this.vector.x=this.x,this.vector.y=this.y,this.vector},PointZone.prototype.crossing=function(particle){this.alert&&(alert("Sorry PointZone does not support crossing method"),this.alert=!1)},Proton.PointZone=PointZone,Proton.Util.inherits(RectZone,Proton.Zone),RectZone.prototype.getPosition=function(){return this.vector.x=this.x+Math.random()*this.width,this.vector.y=this.y+Math.random()*this.height,this.vector},RectZone.prototype.crossing=function(particle){"dead"==this.crossType?(particle.p.x+particle.radius<this.x?particle.dead=!0:particle.p.x-particle.radius>this.x+this.width&&(particle.dead=!0),particle.p.y+particle.radius<this.y?particle.dead=!0:particle.p.y-particle.radius>this.y+this.height&&(particle.dead=!0)):"bound"==this.crossType?(particle.p.x-particle.radius<this.x?(particle.p.x=this.x+particle.radius,particle.v.x*=-1):particle.p.x+particle.radius>this.x+this.width&&(particle.p.x=this.x+this.width-particle.radius,particle.v.x*=-1),particle.p.y-particle.radius<this.y?(particle.p.y=this.y+particle.radius,particle.v.y*=-1):particle.p.y+particle.radius>this.y+this.height&&(particle.p.y=this.y+this.height-particle.radius,particle.v.y*=-1)):"cross"==this.crossType&&(particle.p.x+particle.radius<this.x&&particle.v.x<=0?particle.p.x=this.x+this.width+particle.radius:particle.p.x-particle.radius>this.x+this.width&&particle.v.x>=0&&(particle.p.x=this.x-particle.radius),particle.p.y+particle.radius<this.y&&particle.v.y<=0?particle.p.y=this.y+this.height+particle.radius:particle.p.y-particle.radius>this.y+this.height&&particle.v.y>=0&&(particle.p.y=this.y-particle.radius))},Proton.RectZone=RectZone,Proton.Util.inherits(ImageZone,Proton.Zone),ImageZone.prototype.reset=function(imageData,x,y,d){this.imageData=imageData,this.x=Proton.Util.initValue(x,0),this.y=Proton.Util.initValue(y,0),this.d=Proton.Util.initValue(d,2),this.vectors=[],this.setVectors()},ImageZone.prototype.setVectors=function(){var i,j,length1=this.imageData.width,length2=this.imageData.height;for(i=0;i<length1;i+=this.d)for(j=0;j<length2;j+=this.d){var index=4*((j>>0)*length1+(i>>0));this.imageData.data[index+3]>0&&this.vectors.push({x:i+this.x,y:j+this.y})}return this.vector},ImageZone.prototype.getBound=function(x,y){var index=4*((y>>0)*this.imageData.width+(x>>0));return this.imageData.data[index+3]>0},ImageZone.prototype.getPosition=function(){return this.vector.copy(this.vectors[Math.floor(Math.random()*this.vectors.length)])},ImageZone.prototype.getColor=function(x,y){x-=this.x,y-=this.y;var i=4*((y>>0)*this.imageData.width+(x>>0));return{r:this.imageData.data[i],g:this.imageData.data[i+1],b:this.imageData.data[i+2],a:this.imageData.data[i+3]}},ImageZone.prototype.crossing=function(particle){"dead"==this.crossType?this.getBound(particle.p.x-this.x,particle.p.y-this.y)?particle.dead=!0:particle.dead=!1:"bound"==this.crossType&&(this.getBound(particle.p.x-this.x,particle.p.y-this.y)||particle.v.negate())},Proton.ImageZone=ImageZone;var log=function(){if(window.console&&window.console.log){var arg=arguments;if("string"==typeof arguments[0])if(0==arguments[0].indexOf("+")){var n=parseInt(arguments[0]);log.once<n&&(delete arg[0],console.log(arg),log.once++)}else console.log(arg);else console.log(arg)}};log.once=0,Proton.log=log;var Debug=Debug||{addEventListener:function(proton,fun){proton.addEventListener(Proton.PROTON_UPDATE,function(e){fun()})},setStyle:function(c){var color=c||"#ff0000",rgb=Proton.Util.hexToRGB(color),style="rgba("+rgb.r+","+rgb.g+","+rgb.b+",0.5)";return style},drawZone:function(proton,canvas,zone,clear){var context=canvas.getContext("2d"),style=this.setStyle();this.addEventListener(proton,function(){clear&&context.clearRect(0,0,canvas.width,canvas.height),zone instanceof Proton.PointZone?(context.beginPath(),context.fillStyle=style,context.arc(zone.x,zone.y,10,0,2*Math.PI,!0),context.fill(),context.closePath()):zone instanceof Proton.LineZone?(context.beginPath(),context.strokeStyle=style,context.moveTo(zone.x1,zone.y1),context.lineTo(zone.x2,zone.y2),context.stroke(),context.closePath()):zone instanceof Proton.RectZone?(context.beginPath(),context.strokeStyle=style,context.drawRect(zone.x,zone.y,zone.width,zone.height),context.stroke(),context.closePath()):zone instanceof Proton.CircleZone&&(context.beginPath(),context.strokeStyle=style,context.arc(zone.x,zone.y,zone.radius,0,2*Math.PI,!0),context.stroke(),context.closePath())})},drawEmitter:function(proton,canvas,emitter,clear){var context=canvas.getContext("2d"),style=this.setStyle();this.addEventListener(proton,function(){clear&&context.clearRect(0,0,canvas.width,canvas.height),context.beginPath(),context.fillStyle=style,context.arc(emitter.p.x,emitter.p.y,10,0,2*Math.PI,!0),context.fill(),context.closePath()})},test:{},setTest:function(id,value){this.test[id]=value},getTest:function(id){return!!this.test.hasOwnProperty(id)&&this.test[id]}};Proton.Debug=Debug}(window),function(){for(var lastTime=0,vendors=["ms","moz","webkit","o"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(callback,element){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=window.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(id){clearTimeout(id)})}();var core={version:"3.1.19"};console.log("core.js - version "+core.version),core.load={},core.utils={},core.display={},core.ui={},core.motion={},core.screens={},core.audio={},core.game={},PIXI.DisplayObject.prototype.removeFromParent=function(){this.parent&&this.parent.removeChild(this)},PIXI.Container.prototype.contains=function(child){return this.children.indexOf(child)>-1},Object.defineProperties(PIXI.Container.prototype,{scaleX:{set:function(value){this.scale.x=value},get:function(){return this.scale.x}},scaleY:{set:function(value){this.scale.y=value},get:function(){return this.scale.y}}}),PIXI.extras.BitmapText.prototype.updateText=function(){for(var data=PIXI.extras.BitmapText.fonts[this._font.name],pos=new PIXI.Point,prevCharCode=null,chars=[],lastLineWidth=0,maxLineWidth=0,lineWidths=[],line=0,scale=this._font.size/data.size*data.baseTexture.resolution,lastSpace=-1,maxLineHeight=0,i=0;i<this.text.length;i++){var charCode=this.text.charCodeAt(i);if(lastSpace=/(\s)/.test(this.text.charAt(i))?i:lastSpace,/(?:\r\n|\r|\n)/.test(this.text.charAt(i)))lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else if(lastSpace!==-1&&this.maxWidth>0&&pos.x*scale>this.maxWidth)PIXI.utils.removeItems(chars,lastSpace,i-lastSpace),i=lastSpace,lastSpace=-1,lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),line++,pos.x=0,pos.y+=data.lineHeight,prevCharCode=null;else{var charData=data.chars[charCode];charData&&(prevCharCode&&charData.kerning[prevCharCode]&&(pos.x+=charData.kerning[prevCharCode]),chars.push({texture:charData.texture,line:line,charCode:charCode,position:new PIXI.Point(pos.x+charData.xOffset,pos.y+charData.yOffset)}),lastLineWidth=pos.x+(charData.texture.width+charData.xOffset),pos.x+=charData.xAdvance,maxLineHeight=Math.max(maxLineHeight,charData.yOffset+charData.texture.height),prevCharCode=charCode)}}lineWidths.push(lastLineWidth),maxLineWidth=Math.max(maxLineWidth,lastLineWidth),this.numLines=line+1;var lineAlignOffsets=[];for(i=0;i<=line;i++){var alignOffset=0;"right"===this._font.align?alignOffset=maxLineWidth-lineWidths[i]:"center"===this._font.align&&(alignOffset=(maxLineWidth-lineWidths[i])/2),lineAlignOffsets.push(alignOffset)}var lenChars=chars.length,tint=this.tint;for(i=0;i<lenChars;i++){var c=this._glyphs[i];c?c.texture=chars[i].texture:(c=new PIXI.Sprite(chars[i].texture),this._glyphs.push(c)),c.position.x=(chars[i].position.x+lineAlignOffsets[chars[i].line])*scale,c.position.y=chars[i].position.y*scale,c.scale.x=c.scale.y=scale,c.tint=tint,c.parent||this.addChild(c)}for(i=lenChars;i<this._glyphs.length;++i)this.removeChild(this._glyphs[i]);this.textWidth=maxLineWidth*scale,this.textHeight=(pos.y+data.lineHeight)*scale,this.maxLineHeight=maxLineHeight*scale},PIXI.interaction.InteractionManager.prototype.getTouchData=function(touchEvent){var touchData=this.interactiveDataPool.pop();return touchData||(touchData=new PIXI.interaction.InteractionData),touchData.identifier=touchEvent.identifier,this.mapPositionToPoint(touchData.global,touchEvent.clientX,touchEvent.clientY),navigator.isCocoonJS&&(touchData.global.x=touchData.global.x/this.resolution,touchData.global.y=touchData.global.y/this.resolution),touchEvent.globalX=touchData.global.x,touchEvent.globalY=touchData.global.y,touchData.originalTouch=touchEvent,touchData},core.settings={DEFAULT_W:568,DEFAULT_H:320,STAGE_W:568,STAGE_H:320,MIN_W:400,MIN_H:320,IPAD_W:512,IPAD_H:384,IPAD_MIN:288,CONTENT_SCALE:1,FONT:"Arial",BG_COLOR:"#000000",IFRAME_MODE:2,RES_2_MIN_H:320,RES_2_MIN_W:640,MAX_RESOLUTON:2,ORIENTATION:2,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,USE_WIDTH:!1,SCALE_MODES:{MATCH_HEIGHT:1,MATCH_WIDTH:2},MUTE_STATE:!1,CHECK_ORIENTATION:!0,FULLSCREEN_ENABLED:!0,DESKTOP_FULLSCREEN:!1,DESKTOP_RESIZE:!0,WEB_AUDIO_ENABLED:!0,WEB_GL_ENABLED:!0,AUDIO_ENABLED:!0,IMG_DIR:"./img/",SND_DIR:"./snd/",JSON_DIR:"./json/",FONT_DIR:"./font/",GAME_ID:"template_game",FIRST_SCREEN:"title",copy:function(vars){for(var s in vars)vars.hasOwnProperty(s)&&(this[s]=vars[s]);vars.ROOT_DIR&&this.setRootDir(vars.ROOT_DIR)},setIpad:function(){var isLandscape=this.ORIENTATION===this.ORIENTATION_LANDSCAPE,w=this.IPAD_W,h=this.IPAD_H,min=this.IPAD_MIN;this.DEFAULT_W=this.STAGE_W=isLandscape?w:h,this.DEFAULT_H=this.STAGE_H=isLandscape?h:w,this.MIN_W=isLandscape?w:min,this.MIN_H=isLandscape?min:w},setIphone:function(){var isLandscape=this.ORIENTATION===this.ORIENTATION_LANDSCAPE,minW=this.MIN_W,minH=this.MIN_H,stageW=this.STAGE_W,stageH=this.STAGE_H;this.DEFAULT_W=this.STAGE_W=isLandscape?stageW:stageH,this.DEFAULT_H=this.STAGE_H=isLandscape?stageH:stageW,this.MIN_W=isLandscape?minW:minH,this.MIN_H=isLandscape?minH:minW},setRootDir:function(root){var lastChar=root.charAt(root.length-1);"/"!=lastChar&&(root+="/"),this.IMG_DIR=root+"img/",this.SND_DIR=root+"snd/",this.JSON_DIR=root+"json/",this.FONT_DIR=root+"font/"}},game_shell.Keys={_pressed:{},LEFT_KEY:37,ENTER_KEY:13,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,SPACE_KEY:32,SHIFT_KEY:16,UP:0,JUST_PRESSED:1,DOWN:2,onKeydown:function(event){this._pressed[event.keyCode]||(this._pressed[event.keyCode]=this.JUST_PRESSED);var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},onKeyup:function(event){delete this._pressed[event.keyCode];var evt=event||window.event;void 0!==evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0,evt.preventDefault&&evt.preventDefault()},update:function(dt){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&this._pressed[s]===this.JUST_PRESSED&&(this._pressed[s]=this.DOWN)},clear:function(){for(var s in this._pressed)this._pressed.hasOwnProperty(s)&&delete this._pressed[s]},enable:function(bool){this.boundKeyUp||(this.boundKeyUp=this.onKeyup.bind(this)),this.boundKeyDown||(this.boundKeyDown=this.onKeydown.bind(this));var isIframe=window.parent!==window,w=isIframe?document:window;w.removeEventListener("keyup",this.boundKeyUp),w.removeEventListener("keydown",this.boundKeyDown),bool?(w.addEventListener("keyup",this.boundKeyUp,!1),w.addEventListener("keydown",this.boundKeyDown,!1),isIframe&&window.focus()):this.clear()},isDown:function(keyCode){return this._pressed[keyCode]>0},wasPressed:function(keyCode){return this._pressed[keyCode]===this.JUST_PRESSED},keyState:function(code){return this._pressed[code]||this.UP}},game_shell.KeyListener=function(){},game_shell.KeyListener.prototype=Object.create(game_shell.Keys),game_shell.KeyListener.prototype.constructor=game_shell.KeyListener,core.utils.EventDispatcher=function(){},core.utils.EventDispatcher.prototype={constructor:core.utils.EventDispatcher,apply:function(object){object.addEventListener=core.utils.EventDispatcher.prototype.addEventListener,object.on=core.utils.EventDispatcher.prototype.addEventListener,object.hasEventListener=core.utils.EventDispatcher.prototype.hasEventListener,object.has=core.utils.EventDispatcher.prototype.hasEventListener,object.removeEventListener=core.utils.EventDispatcher.prototype.removeEventListener,object.off=core.utils.EventDispatcher.prototype.removeEventListener,object.removeEventListeners=core.utils.EventDispatcher.prototype.removeEventListeners,object.offAll=core.utils.EventDispatcher.prototype.removeEventListeners,object.dispatchEvent=core.utils.EventDispatcher.prototype.dispatchEvent,object.emit=core.utils.EventDispatcher.prototype.dispatchEvent},addEventListener:function(type,listener){void 0===this._listeners&&(this._listeners={});var listeners=this._listeners;void 0===listeners[type]&&(listeners[type]=[]),listeners[type].indexOf(listener)===-1&&listeners[type].push(listener)},hasEventListener:function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return void 0!==listeners[type]&&listeners[type].indexOf(listener)!==-1},removeEventListener:function(type,listener){if(void 0!==this._listeners){var listeners=this._listeners,index=listeners[type].indexOf(listener);index!==-1&&listeners[type].splice(index,1)}},removeEventListeners:function(){if(void 0!==this._listeners){var listeners=this._listeners;for(var s in listeners)delete listeners[s]}},dispatchEvent:function(event){if(void 0!==this._listeners){var listeners=this._listeners,listenerArray=listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;i<l;i++)listenerArray[i].call(this,event)}}},dispose:function(){void 0!==this._listeners&&(this._listeners.length=0,this._listeners=null)}},core.utils.EventDispatcher.prototype.on=core.utils.EventDispatcher.prototype.addEventListener,core.utils.EventDispatcher.prototype.emit=core.utils.EventDispatcher.prototype.dispatchEvent,core.utils.EventDispatcher.prototype.has=core.utils.EventDispatcher.prototype.hasEventListener,core.utils.EventDispatcher.prototype.off=core.utils.EventDispatcher.prototype.removeEventListener,core.utils.EventDispatcher.prototype.offAll=core.utils.EventDispatcher.prototype.removeEventListeners,core.utils.EventQueue=function(){core.utils.EventDispatcher.call(this),this.queue=[]},core.utils.EventQueue.prototype=Object.create(core.utils.EventDispatcher.prototype),core.utils.EventQueue.prototype.constructor=core.utils.EventQueue,core.utils.EventQueue.prototype.queueEvent=function(event){this.queue[this.queue.length]=event},core.utils.EventQueue.prototype.dispatchQueuedEvents=core.utils.EventQueue.prototype.update=function(delta){for(;this.queue.length>0;)this.dispatchEvent(this.queue.shift())},core.utils.Randomise={HOLDER:[],randomise:function(p_list){this.HOLDER.length=0;var i,l_nItems=p_list.length;for(i=0;i<l_nItems;i++)this.HOLDER[i]=p_list[i];for(p_list.length=0;this.HOLDER.length>0;){var index=this.randomInt(this.HOLDER.length-1);p_list[p_list.length]=this.HOLDER.splice(index,1)[0]}},randomisedCopy:function(p_list){for(var randomised=[],list=p_list.slice();list.length>0;){var index=this.randomInt(list.length-1);randomised[randomised.length]=list.splice(index,1)[0]}return randomised},randomNumber:function(range){return Math.random()*range},randomInRange:function(p_min,p_max){var dif=p_max-p_min;return p_min+Math.random()*dif},randomInt:function(range){return Math.floor(Math.random()*(range+1))}},core.utils.Timer=function(p_interval,p_repeat){core.utils.EventDispatcher.call(this),this.interval=p_interval||1e3,"undefined"!=typeof p_repeat?this.repeat=p_repeat:this.repeat=-1,this.running=!1,this.currentTime=0,this.tickCount=0,this.evt={time:0,count:0},this.onTimer=function(p_count){},this.onTimerComplete=function(){}},core.utils.Timer.prototype=Object.create(core.utils.EventDispatcher.prototype),core.utils.Timer.prototype.constructor=core.utils.Timer,core.utils.Timer.prototype.start=function(){this.running=!0,this.currentTime=0,this.tickCount=0},core.utils.Timer.prototype.stop=function(){this.running=!1},core.utils.Timer.prototype.resume=function(){this.running=!0},core.utils.Timer.prototype.reset=function(){this.running=!1,this.currentTime=0,this.tickCount=0},Object.defineProperties(core.utils.Timer.prototype,{isComplete:{get:function(){return this.tickCount===this.repeat}},remaining:{get:function(){return this.repeat-this.tickCount}}}),core.utils.Timer.prototype.update=function(elapsed){this.running&&(this.currentTime+=elapsed,this.currentTime>this.interval&&this.tick())},core.utils.Timer.prototype.tick=function(){this.currentTime-=this.interval,this.tickCount++,this.evt.time=this.currentTime,this.evt.count=this.tickCount,this.evt.countDown=this.repeat-this.tickCount,this.evt.type="timer",this.dispatchEvent(this.evt),this.onTimer(this.tickCount),this.tickCount===this.repeat&&(this.stop(),this.evt.type="complete",this.dispatchEvent(this.evt),this.onTimerComplete())},core.utils.Timer.prototype.dispose=function(){this.onTimer=null,this.onTimerComplete=null,core.utils.EventDispatcher.prototype.dispose.call(this)},core.utils.RandomTimer=function(p_interval){p_interval||(p_interval=3e3),core.utils.Timer.call(this,p_interval),this.baseInterval=this.interval},core.utils.RandomTimer.prototype=Object.create(core.utils.Timer.prototype),core.utils.RandomTimer.constructor=core.utils.RandomTimer,core.utils.RandomTimer.prototype.start=function(){core.utils.Timer.prototype.start.call(this),this.currentTime=Math.floor(Math.random()*this.baseInterval)},core.utils.RandomTimer.prototype.tick=function(){core.utils.Timer.prototype.tick.call(this),this.interval=this.baseInterval+Math.floor(Math.random()*this.baseInterval)},core.utils.DelayedAction=function(poolSize){var size=poolSize||50;this.createPool(size),this._actions=[],this._cancelledActions=[]},core.utils.DelayedAction.prototype.createPool=function(size){for(this._pool=[];size>0;)this._pool[this._pool.length]={_targetTime:-1,_callback:null},size--},core.utils.DelayedAction.prototype._next=function(){var item=this._pool.shift();return this._pool[this._pool.length]=item,item},core.utils.DelayedAction.prototype.delay=function(p_callback,p_ms,p_scope){var action=this._next();return action._targetTime=p_ms||-1,"undefined"!=typeof p_scope?action._callback=function(){p_callback.call(p_scope)}:action._callback=p_callback||null,this._actions[this._actions.length]=action,action},core.utils.DelayedAction.prototype.update=function(elapsedTime){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)if(action=this._actions[i],action._targetTime===-1)this._cancelledActions[this._cancelledActions.length]=i;else if(action._targetTime>0&&action._callback&&(action._targetTime-=elapsedTime,action._targetTime<=0)){var callback=action._callback;action._callback=null,action._targetTime=-1,this._actions.splice(i,1),callback()}for(;this._cancelledActions.length>0;){var n=this._cancelledActions.length;i=this._cancelledActions[n-1],this._actions.splice(i,1),this._cancelledActions.length=n-1}}},core.utils.DelayedAction.prototype.cancel=function(action){action._targetTime=-1},core.utils.DelayedAction.prototype.clear=core.utils.DelayedAction.prototype.purge=function(){var n=this._actions.length;if(n>0){var i,action;for(i=n-1;i>-1;i--)action=this._actions[i],action._callback=null,action._targetTime=-1}this._actions.length=0},core.utils.DelayedAction.prototype.dispose=function(){this.clear(),this._pool=null},core.utils.SystemInfo=function(){this.browser=-1,this.os=-1,this.device=-1,this.browserUnknown=-1,this.browserSafari=1,this.browserIE=2,this.browserFirefox=3,this.browserChrome=4,this.browserAndroidStock=5,this.browserKindleSilk=6,this.browserOpera=7,this.deviceUnknown=-1,this.deviceDesktop=1,this.deviceMobile=2,this.osUnknown=-1,this.osWindows=1,this.osOSX=2,this.osLinux=3,this.osIOS=4,this.osAndroid=5,this.osBlackberry=6,this.osVersion=-1,this.audioType="",this.webAudio=!1},core.utils.SystemInfo.prototype.run=function(){this._checkDevice(),this._checkAudio()},core.utils.SystemInfo.prototype._checkDevice=function(){var systemString=navigator.userAgent;if(systemString.length>0)if(null!==systemString.match(/mobile/i)?this.device=this.deviceMobile:null!==systemString.match(/tablet/i)?this.device=this.deviceMobile:null!==systemString.match(/android/i)?this.device=this.deviceMobile:this.device=this.deviceDesktop,null!==systemString.match(/windows/i)?this.os=this.osWindows:null!==systemString.match(/iphone os/i)?this.os=this.osIOS:null!==systemString.match(/ipad/i)?this.os=this.osIOS:null!==systemString.match(/mac os x/i)?this.device===this.deviceMobile?this.os=this.osIOS:this.os=this.osOSX:null!==systemString.match(/android/i)?this.os=this.osAndroid:null!==systemString.match(/linux/i)&&(this.os=this.osLinux),null!==systemString.match(/MSIE/i)||null!==systemString.match(/rv:11.0/i)?this.browser=this.browserIE:this.os!==this.osAndroid||null===systemString.match(/samsung/i)&&null===systemString.match(/534.30/i)&&null===systemString.match(/535.19/i)?null!==systemString.match(/silk/i)||null!==systemString.match(/kindle fire/i)?this.browser=this.browserKindleSilk:null!==systemString.match(/chrome/i)?this.browser=this.browserChrome:null!==systemString.match(/CriOS/i)?this.browser=this.browserChrome:null!==systemString.match(/Firefox/i)?this.browser=this.browserFirefox:null!==systemString.match(/safari/i)&&(this.browser=this.browserSafari):this.browser=this.browserAndroidStock,this.os===this.osIOS)null!==systemString.match(/iPhone OS 5/i)?this.osVersion=5:null!==systemString.match(/iPhone OS 6/i)?this.osVersion=6:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 7_\d/i)?this.osVersion=7:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 8_\d/i)?this.osVersion=8:null!==systemString.match(/(iPad|iPhone);.*CPU.*OS 9_\d/i)&&(this.osVersion=9);else if(this.os===this.osAndroid)try{var androidVersionString=systemString.match(/Android [\d+(?:\.\d+]{3,5}/)[0].replace("Android ","");this.osVersion=parseFloat(androidVersionString)}catch(e){this.osVersion=-1}},core.utils.SystemInfo.prototype._checkAudio=function(){var canPlayOgg=!0;if(this.isIOS||this.browser===this.browserSafari)canPlayOgg=!1;else{var a=document.createElement("audio");canPlayOgg=!(!a.canPlayType||!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,""))}canPlayOgg?this.audioType=".ogg":this.audioType=".m4a",window.AudioContext?this.webAudio=!0:window.webkitAudioContext?this.webAudio=!0:this.webAudio=!1},Object.defineProperties(core.utils.SystemInfo.prototype,{isAndroidStock:{get:function(){return this.browser===this.browserAndroidStock}},isIOS:{get:function(){return this.os===this.osIOS}},isMobile:{get:function(){return this.device===this.deviceMobile}},isDesktop:{get:function(){return this.device===this.deviceDesktop}},isAndroid:{get:function(){return this.os===this.osAndroid}},isSafari:{get:function(){return this.browser===this.browserSafari}},isMobileSafari:{get:function(){return this.os===this.osIOS&&this.isSafari}},isIE:{get:function(){return this.browser===this.browserIE}}}),core.utils.FullscreenMgr=function(){this.canvas=null,this.isMobile=!1,this.fullScreenState=!1,this.isFullScreen=!1,this.fullscreenChanged=this._fullscreenChanged.bind(this),this.goFullscreen=this._goFullscreen.bind(this)},core.utils.FullscreenMgr.prototype.init=function(config){this.canvas=config.canvas,this.isMobile=config.isMobile,this.isAvailable=this.checkAvailable(),this.activate(this.isAvailable)},core.utils.FullscreenMgr.prototype.activate=function(state){this.fullScreenState=state,this.canvas.removeEventListener("click",this.goFullscreen),this.canvas.removeEventListener("touchend",this.goFullscreen),state&&(this.canvas.addEventListener("click",this.goFullscreen,!1),this.canvas.addEventListener("touchend",this.goFullscreen,!1))},core.utils.FullscreenMgr.prototype._goFullscreen=function(){var gameDiv=document.documentElement;gameDiv.requestFullscreen?gameDiv.requestFullscreen():gameDiv.mozRequestFullScreen?gameDiv.mozRequestFullScreen():gameDiv.webkitRequestFullscreen?gameDiv.webkitRequestFullscreen():gameDiv.msRequestFullscreen&&gameDiv.msRequestFullscreen(),this.activate(!1)},core.utils.FullscreenMgr.prototype.reactivate=function(){this.activate(!this.isFullScreen)},core.utils.FullscreenMgr.prototype.checkAvailable=function(){var doc=document.documentElement;doc.allowfullscreen=!0;var available=doc.requestFullscreen||doc.webkitRequestFullscreen||doc.msRequestFullscreen||doc.mozRequestFullScreen;if(available){var self=this;document.onfullscreenchange=function(event){self.fullscreenChanged(event)},document.onwebkitfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmozfullscreenchange=function(event){self.fullscreenChanged(event)},document.onmsfullscreenchange=function(event){self.fullscreenChanged(event)},document.onfullscreenerror=function(event){self.fullscreenError(event)},document.onmozfullscreenerror=function(event){self.fullscreenError(event)},document.onwebkitfullscreenerror=function(event){self.fullscreenError(event)},document.onmsfullscreenerror=function(event){self.fullscreenError(event)}}return available},core.utils.FullscreenMgr.prototype._fullscreenChanged=function(event){var fullscreenElement=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;this.isFullScreen=null!==fullscreenElement&&"undefined"!=typeof fullscreenElement,console.log("FullscreenMg -> fullscreenChanged -- isFullScreen: "+this.isFullScreen),this.isFullScreen||this.isMobile&&this.activate(!0)},core.utils.FullscreenMgr.prototype.fullscreenError=function(event){console.log("* !!!! fullscreenError !!! * "+event),console.log("* event.message: "+event.message),this.fullscreenChanged(null)},core.utils.UpdateLoop=function(fps){this.gameLoopId=-1,this.fps=fps||60,this.interval=1e3/this.fps,
this.accumulator=0,this.currentTime=0,this.gameLoop=this._gameLoop.bind(this)},core.utils.UpdateLoop.prototype.start=function(){clearInterval(this.gameLoopId),this.currentTime=Date.now(),this.gameLoopId=setInterval(this.gameLoop,this.interval)},core.utils.UpdateLoop.prototype.stop=function(){clearInterval(this.gameLoopId)},core.utils.UpdateLoop.prototype.updateGame=function(p_time){},core.utils.UpdateLoop.prototype._gameLoop=function(){var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.accumulator+=elapsed;for(var chunk=this.interval;this.accumulator>chunk;)this.accumulator-=chunk,this.updateGame(chunk)},core.utils.RenderLoop=function(){this.currentTime=0,this.requestId=-1,this.stage=null,this.screenMgr=null},core.utils.RenderLoop.prototype.init=function(p_config){this.stage=p_config.stage,this.screenMgr=p_config.screenMgr,p_config.useStats?this.render=this._statsRender.bind(this):this.render=this._defaultRender.bind(this)},core.utils.RenderLoop.prototype._defaultRender=function(){var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.stage.draw(),this.screenMgr.render(elapsed),this.requestId=requestAnimationFrame(this.render)},core.utils.RenderLoop.prototype._statsRender=function(){stats.begin();var newTime=Date.now(),elapsed=newTime-this.currentTime;this.currentTime=newTime,this.stage.draw(),this.screenMgr.render(elapsed),stats.end(),this.requestId=requestAnimationFrame(this.render)},core.utils.RenderLoop.prototype.start=function(){this.currentTime=Date.now(),this.render()},core.utils.RenderLoop.prototype.stop=function(){cancelAnimationFrame(this.requestId)},core.utils.Resolution=function(){this.resolution=1,this.minHeight2=core.settings.RES_2_MIN_H||320,this.minHeight4=2*this.minHeight2,this.minWidth2=core.settings.RES_2_MIN_W||512,this.minWidth4=2*this.minWidth2,this.maxResolution=core.settings.MAX_RESOLUTON,this.pixelRatio=window.devicePixelRatio||1},core.utils.Resolution.prototype.init=function(config){this.forceResolution=config.forceResolution,this.forceResolution>-1&&(this.resolution=this.forceResolution)},core.utils.Resolution.prototype.setByHeight=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var shortEdge=Math.min(window.innerHeight,window.innerWidth),size=Math.round(shortEdge*this.pixelRatio);size<=this.minHeight2?this.resolution=1:size<=this.minHeight4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}return this.resolution},core.utils.Resolution.prototype.setByWidth=function(){if(this.forceResolution>-1)this.resolution=this.forceResolution;else{var longEdge=Math.max(window.innerHeight,window.innerWidth),size=Math.round(longEdge*this.pixelRatio);size<=this.minWidth2?this.resolution=1:size<=this.minWidth4?this.resolution=2:this.resolution=this.maxResolution>2?4:2}return console.log("Resolution -> setResolution: "+this.resolution),this.resolution},core.utils.Viewport=function(){core.utils.EventDispatcher.call(this),this.PORTRAIT=core.settings.ORIENTATION_PORTRAIT,this.LANDSCAPE=core.settings.ORIENTATION_LANDSCAPE,this.scaleModes=core.settings.SCALE_MODES,this.settings=null,this.resize=core.utils.Viewport.prototype.resize.bind(this)},core.utils.Viewport.prototype=Object.create(core.utils.EventDispatcher.prototype),core.utils.Viewport.prototype.constructor=core.utils.Viewport,core.utils.Viewport.prototype.IFRAME_MODE_1=1,core.utils.Viewport.prototype.IFRAME_MODE_2=2,core.utils.Viewport.prototype.init=function(config){this.CHECK_ORIENTATION=config.CHECK_ORIENTATION,this.DESKTOP_RESIZE=config.DESKTOP_RESIZE,this.isMobile=config.isMobile,this.DEFAULT_W=config.DEFAULT_W,this.DEFAULT_H=config.DEFAULT_H,this.MIN_W=config.MIN_W,this.MIN_H=config.MIN_H,this.rotateImg=config.rotateImg,this.gameDiv=config.gameDiv,this.pixelRatio=window.devicePixelRatio||1,this.isIframe=window.parent!==window,this.iframeMode=config.iframeMode||this.IFRAME_MODE_2,this.settings=this.createSettings(config),this.eventResize={type:"resize",wrongOrientation:!1,settings:this.settings},this.initResize(),this.setScaleMode(config.scaleMode||this.settings.SCALE_MATCH_HEIGHT)},core.utils.Viewport.prototype.initResize=function(){window.addEventListener("resize",this.resize,!1),window.addEventListener("orientationchange",this.resize,!1)},core.utils.Viewport.prototype.resize=function(){this.eventResize.settings=this.getSize(),this.emit(this.eventResize)},core.utils.Viewport.prototype.setScaleMode=function(mode){switch(this.settings.scaleMode=mode,this.settings.scaleMode){case this.settings.SCALE_MATCH_HEIGHT:this.setAspect=this._matchHeight;break;case this.settings.SCALE_MATCH_WIDTH:this.setAspect=this._matchWidth}},core.utils.Viewport.prototype.createSettings=function(config){var settings={};return settings.windowWidth=-1,settings.windowHeight=-1,settings.width=config.STAGE_W,settings.height=config.STAGE_H,settings.scale=1,settings.shouldResize=!(!this.isMobile&&!this.DESKTOP_RESIZE),settings.ORIENTATION_PORTRAIT=this.PORTRAIT,settings.ORIENTATION_LANDSCAPE=this.LANDSCAPE,settings.ORIENTATION_ANY=3,settings.orientation=config.orientation||settings.ORIENTATION_LANDSCAPE,settings.SCALE_MATCH_HEIGHT=this.scaleModes.MATCH_HEIGHT,settings.SCALE_MATCH_WIDTH=this.scaleModes.MATCH_WIDTH,settings.scaleMode=-1,settings},core.utils.Viewport.prototype.getSize=function(){var dimensions=this.checkWindowSize(),showRotate=this.checkRotation(dimensions.width,dimensions.height);return this.eventResize.wrongOrientation=showRotate,showRotate?null:(this.setAspect(dimensions.width,dimensions.height),this.settings)},core.utils.Viewport.prototype.checkWindowSize=function(){var dstW,dstH;try{dstW=window.innerWidth,dstH=window.innerHeight}catch(e){return this.restoreDefaults(),null}if(this.isIframe&&1===this.iframeMode)try{dstW=window.parent.innerWidth,dstH=window.parent.innerHeight}catch(e){}return this.settings.windowWidth=dstW,this.settings.windowHeight=dstH,{width:dstW,height:dstH}},core.utils.Viewport.prototype.restoreDefaults=function(){this.settings.pixelWidth=this.DEFAULT_W,this.settings.pointWidth=this.DEFAULT_W,this.settings.windowWidth=this.DEFAULT_W,this.settings.pixelHeight=this.DEFAULT_H,this.settings.pointHeight=this.DEFAULT_H,this.settings.windowHeight=this.DEFAULT_H},core.utils.Viewport.prototype._matchWidth=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var maxRatio=fullW/this.MIN_H,aspectRatio=fullW/fullH,windowAspect=dstW/dstH;this.settings.targetH=Math.ceil(dstW/aspectRatio),windowAspect>aspectRatio&&(aspectRatio=windowAspect<=maxRatio?windowAspect:maxRatio);var w=dstW,h=dstH,targetH=Math.ceil(dstW/aspectRatio);dstH>targetH?h=targetH:w=Math.ceil(aspectRatio*dstH);var scale=w/fullW,stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},core.utils.Viewport.prototype._matchHeight=function(dstW,dstH){var fullW=this.DEFAULT_W,fullH=this.DEFAULT_H;this.settings.shouldResize||(dstW=fullW,dstH=fullH);var minRatio,aspectRatio,windowAspect,isInPortrait=fullW<fullH;isInPortrait?(minRatio=this.MIN_H/fullW,aspectRatio=fullH/fullW,windowAspect=dstH/dstW):(minRatio=this.MIN_W/fullH,aspectRatio=fullW/fullH,windowAspect=dstW/dstH),windowAspect<aspectRatio&&(aspectRatio=windowAspect>=minRatio?windowAspect:minRatio);var w=dstW,h=dstH,scale=1;isInPortrait?(dstH>aspectRatio*dstW?h=Math.ceil(aspectRatio*dstW):w=Math.ceil(dstH/aspectRatio),scale=w/fullW):(dstW>aspectRatio*dstH?w=Math.ceil(aspectRatio*dstH):h=Math.ceil(dstW/aspectRatio),scale=h/fullH);var stageW=Math.floor(w/scale),stageH=Math.floor(h/scale);this.settings.pixelWidth=w,this.settings.pointWidth=stageW,this.settings.pixelHeight=h,this.settings.pointHeight=stageH,this.settings.scale=scale},core.utils.Viewport.prototype.checkRotation=function(ww,hh){var showRotate=!1;return this.CHECK_ORIENTATION&&(this.settings.orientation===this.settings.ORIENTATION_LANDSCAPE&&hh>ww?showRotate=!0:this.settings.orientation===this.settings.ORIENTATION_PORTRAIT&&ww>hh&&(showRotate=!0)),showRotate?(this.gameDiv.style.display="none",this.rotateImg.style.display="block"):(this.rotateImg.style.display="none",this.gameDiv.style.display="block"),showRotate},Object.defineProperties(core.utils.Viewport.prototype,{height:{get:function(){return this.settings.height}},width:{get:function(){return this.settings.width}},isPortrait:{get:function(){return this.settings.orientation===this.PORTRAIT}}}),core.utils.PauseController=function(){this.isPaused=!1,this.wrongOrientation=!1,this.pause=this._pause.bind(this),this.onResized=this._resized.bind(this)},core.utils.PauseController.prototype.init=function(config){this.updateLoop=config.updateLoop,this.renderLoop=config.renderLoop,this.snd=config.snd,this.initPageHidden()},core.utils.PauseController.prototype.initPageHidden=function(){var self=this;window.addEventListener("blur",function(){self.pause.call(self,!0)},!1),window.addEventListener("focus",function(){self.pause.call(self,!1)},!1);var hidden,visibilityChange;"undefined"!=typeof document.hidden?(hidden="hidden",visibilityChange="visibilitychange"):"undefined"!=typeof document.mozHidden?(hidden="mozHidden",visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.msHidden?(hidden="msHidden",visibilityChange="msvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(hidden="webkitHidden",visibilityChange="webkitvisibilitychange"),document.addEventListener(visibilityChange,function(e){document[hidden]?self.pause.call(self,!0):self.pause.call(self,!1)})},core.utils.PauseController.prototype._resized=function(event){event.wrongOrientation?this.isPaused||(this.pause(!0),this.wrongOrientation=!0):(this.wrongOrientation&&this.pause(!1),this.wrongOrientation=!1)},core.utils.PauseController.prototype._pause=function(p_state){p_state&&!this.isPaused?(console.log("PauseController -> "+p_state),TWEEN.pause(),this.updateLoop.stop(),this.renderLoop.stop(),this.snd.mute(!0),this.isPaused=!0):!p_state&&this.isPaused&&(console.log("PauseController -> "+p_state),TWEEN.unpause(),this.updateLoop.start(),this.renderLoop.start(),this.snd.mute(!1),this.isPaused=!1)},core.utils.UpdateList=function(){this.updateItems=[],this.removeItems=[],this.isPaused=!1},core.utils.UpdateList.prototype.mixin=function(target){target.updateItems=[],target.removeItems=[],target.update=core.utils.UpdateList.prototype.update,target.addUpdateItem=core.utils.UpdateList.prototype.addUpdateItem,target.removeUpdateItem=core.utils.UpdateList.prototype.removeUpdateItem,target.purge=core.utils.UpdateList.prototype.purge},core.utils.UpdateList.prototype.update=function(p_delta){if(!this.isPaused){var item,i,n=this.updateItems.length;for(i=n-1;i>-1;i--)item=this.updateItems[i],item.update(p_delta);if(n=this.removeItems.length,n>0){for(i=0;i<n;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}}},core.utils.UpdateList.prototype.purge=function(){this.updateItems.length=0,this.removeItems.length=0},core.utils.UpdateList.prototype.addUpdateItem=core.utils.UpdateList.prototype.add=function(p_item){this.updateItems.indexOf(p_item)===-1&&(this.updateItems[this.updateItems.length]=p_item)},core.utils.UpdateList.prototype.removeUpdateItem=core.utils.UpdateList.prototype.remove=function(p_item){this.removeItems[this.removeItems.length]=p_item},core.utils.UpdateList.prototype.removeUpdateItem=core.utils.UpdateList.prototype._remove=function(p_item){var index=this.updateItems.indexOf(p_item);index>-1&&this.updateItems.splice(index,1)},Object.defineProperty(core.utils.UpdateList.prototype,"length",{get:function(){return this.updateItems.length}}),core.utils.Sequence=function(stuff,randomise){this.list=[],stuff&&this.add(stuff,randomise)},core.utils.Sequence.prototype.add=function(stuff,randomise){if(Array.isArray(stuff)){var i,n=stuff.length;for(i=0;i<n;i++)this.list[this.list.length]=stuff[i]}else this.list[this.list.length]=stuff;randomise&&this.randomise()},core.utils.Sequence.prototype.remove=function(stuff){var index;if(Array.isArray(stuff)){var i,item,n=stuff.length;for(i=0;i<n;i++)item=stuff[i],index=this.list.indexOf(item),index>-1&&this.list.splice(index,1)}else index=this.list.indexOf(stuff),index>-1&&this.list.splice(index,1)},core.utils.Sequence.prototype.randomise=function(){core.utils.Randomise.randomise(this.list)},core.utils.Sequence.prototype.next=function(){var item=null;return this.list.length>0&&(item=this.list.shift(),this.list[this.list.length]=item),item},Object.defineProperty(core.utils.Sequence.prototype,"length",{get:function(){return this.list.length}}),core.utils.Save=function(key){this.key=key||"game_data",this.isSupported=this.checkSupported()},core.utils.Save.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.utils.Save.prototype.save=function(data){this.isSupported&&data&&("string"!=typeof data&&(data=JSON.stringify(data)),this._saveItem(this.key,data))},core.utils.Save.prototype.restore=function(){if(this.isSupported)try{var stringValue=localStorage[this.key];if("undefined"!=typeof stringValue){var data=JSON.parse(stringValue);return data}}catch(e){console.log("ERROR - core.utils.Save.restore:"),console.log(e)}return null},core.utils.Save.prototype.checkSupported=function(){try{return"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},core.utils.Save.prototype._saveItem=function(p_key,p_value){var success=!0;try{localStorage.removeItem(p_key),localStorage.setItem(p_key,p_value)}catch(e){console.log("*** LOCAL STORAGE ERROR! "+e.message),success=!1}return success},core.utils.Maths={rotate:function(point,angle,output){var x=point.x,y=point.y;output||(output=point);var cosAngle=Math.cos(angle),sinAngle=Math.sin(angle);return output.x=cosAngle*x-sinAngle*y,output.y=sinAngle*x+cosAngle*y,output},matrixRotatePoint:function(p,m,pt){var x=p.x,y=p.y,output=pt||p;return output.x=m.a*x+m.c*y,output.y=m.d*y+m.b*x,output},dot:function(a,b){return a.x*b.x+a.y*b.y},vectorLengthSquared:function(vector){return vector.x*vector.x+vector.y*vector.y},vectorLength:function(vector){return Math.sqrt(this.vectorLengthSquared(vector))},vectorDistanceSquared:function(vectorA,vectorB){return this.vectorLengthSquared(this.relativeVector(vectorA,vectorB))},relativeVector:function(origin,target,output){return output||(output={}),output.x=target.x-origin.x,output.y=target.y-origin.y,output},vectorDistance:function(vectorA,vectorB){return Math.sqrt(this.vectorDistanceSquared(vectorA,vectorB))},normaliseVector:function(vector){return this.scaleVector(vector,1/this.vectorLength(vector))},scaleVector:function(vector,scale,output){return output||(output=vector),output.x=vector.x*scale,output.y=vector.y*scale,output},polygonDirection:function(vertices){var i,v1,v2,next,value,n=vertices.length,total=0;for(i=0;i<n;i++)next=(i+1)%n,v1=vertices[i],v2=vertices[next],value=(v2.x-v1.x)*(v2.y-v1.y),total+=value;return total},isClockwise:function(vertices){var total=this.polygonDirection(vertices);return total<0}},core.load.BootStrap=function(){this.resolution=2,this.stageW=568,this.stage=null,this.barColor=16777215},core.load.BootStrap.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.BootStrap.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.bundle={json:[],images:[]},this.step=this.stageW/2,this.createLoadBar(),this.defineBundle()},core.load.BootStrap.prototype.defineBundle=function(){},core.load.BootStrap.prototype.start=function(){this.loadJson()},core.load.BootStrap.prototype.addJson=function(item){this.bundle.json[this.bundle.json.length]=item},core.load.BootStrap.prototype.addImage=function(item){this.bundle.images[this.bundle.images.length]=item},core.load.BootStrap.prototype.loadJson=function(){var items=this.bundle.json;if(0===items.length)this.loadImages();else{var loader=new core.load.JsonQueue,self=this;loader.on("loaded",function(event){game_shell.json[event.id]=event.jsonData,self.growBar()}),loader.on("complete",function(event){self.loadImages.call(self)}),loader.load(items);var i,item,n=items.length;for(i=0;i<n;i++)item=items[i],game_shell.loader.urls.add(item)}},core.load.BootStrap.prototype.loadImages=function(){var items=this.bundle.images,n=items.length;if(this.loadedImages=0,0===n)this.finished();else for(var i=0;i<n;i++)this.loadImage(items[i])},core.load.BootStrap.prototype.loadImage=function(item){var id=item.id,self=this;game_shell.loader.urls.add(item);var baseTexture=PIXI.BaseTexture.fromImage(item.src,!1);baseTexture.hasLoaded?this.imageLoaded(baseTexture,id):baseTexture.on("loaded",function(event){self.imageLoaded(baseTexture,id)})},core.load.BootStrap.prototype.imageLoaded=function(baseTexture,id){this.loadedImages++;for(var item,isAtlas=!1,json=this.bundle.json,n=json.length,i=0;i<n;i++)if(item=json[i],item.id===id){isAtlas=!0;break}if(isAtlas){var atlasJson=game_shell.json[id];game_shell.loader.imageLoad.addAtlasData(baseTexture,atlasJson)}else PIXI.utils.TextureCache[id]=new PIXI.Texture(baseTexture);this.loadedImages===this.bundle.images.length&&(this.growBar(),this.finished())},core.load.BootStrap.prototype.createLoadBar=function(){var w=10,h=20;this.bar=new core.display.Quad(w,h,this.barColor),this.bar.x=this.stageW*-.5,this.bar.y=.5*this.stageH-.5*h,this.stage.addChild(this.bar)},core.load.BootStrap.prototype.growBar=function(){new TWEEN.Tween(this.bar).to({width:this.bar.width+this.step},50).start()},core.load.BootStrap.prototype.finished=function(){this.stage.removeChild(this.bar),this.emit({type:"complete"})},core.load.ImageLoader=function(){core.utils.EventDispatcher.call(this),this.manifest=null,this.eventLoaded={type:"loaded",progress:0,img:null,success:!1,data:null}},core.load.ImageLoader.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.ImageLoader.prototype.constructor=core.load.ImageLoader,core.load.ImageLoader.prototype.load=function(items){this.numTotal=items.length,this.numLoaded=0;var item,i;for(i=0;i<this.numTotal;i++)item=items[i],item.loadState=0;this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},core.load.ImageLoader.prototype.findNext=function(){for(var checkObj,assetData=null,n=this.manifest.length,i=0;i<n;i++)if(checkObj=this.manifest[i],0===checkObj.loadState){assetData=checkObj;break}return assetData},core.load.ImageLoader.prototype.loadNext=function(){var assetData=this.findNext();assetData?this.loadImage(assetData):(this.manifest.length=0,this.loadComplete())},core.load.ImageLoader.prototype.loadImage=function(assetData){var img=new Image,self=this;return img.onload=function(){img.onerror=null,assetData.loadState=1,self.imageLoaded(img,assetData)},img.onerror=function(e){console.log("ERROR - image load failed: "+assetData.src),console.log(e),assetData.loadState=2,self.imageLoaded(null,assetData)},img.src=assetData.src,img},core.load.ImageLoader.prototype.imageLoaded=function(img,assetData){this.numLoaded++,this.eventLoaded.progress=this.numLoaded/this.numTotal,this.eventLoaded.success=null!==img,this.eventLoaded.data=assetData,this.eventLoaded.img=img,this.emit(this.eventLoaded),this.loadNext()},core.load.ImageLoader.prototype.loadComplete=function(){this.emit({type:"complete"}),this.eventLoaded.img=null},core.load.LoadManifest=function(){this.bulkLoader=null,this.resolution=1,this.audioType=null,this.audioFolder=null,this.manifest=null},core.load.LoadManifest.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.resolution=this.bulkLoader.resolution,this.audioType=this.bulkLoader.audioType,this.audioFolder=this.bulkLoader.audioFolder},core.load.LoadManifest.prototype.load=function(){var path=this.bulkLoader.manifestPath,loader=new core.load.JsonLoader(path),self=this;loader.on("loaded",function(event){var jsonData=event.data;self.bulkLoader.emit({type:"manifest_json",data:jsonData}),self.parseConfig.call(self,jsonData),self.isEmpty?game_shell.timeout.delay(function(){self.bulkLoader.loadComplete()},100):self.bulkLoader.sequence.next()}),loader.load()},core.load.LoadManifest.prototype.parseConfig=function(p_data){this.manifest=p_data;var res=this.resolution.toString()+"x",fallback=1===this.resolution?"sd":"hd",bulkLoader=this.bulkLoader;bulkLoader.jsonManifest=this.getManifestSection("json_",res,fallback),this.setRoot(bulkLoader.jsonManifest,core.settings.IMG_DIR),bulkLoader.imgManifest=this.getManifestSection("img_",res,fallback),bulkLoader.fontManifest=this.getManifestSection("bm_font_",res,fallback),this.manifest.hasOwnProperty("json")&&(this.setRoot(this.manifest.json,core.settings.JSON_DIR),bulkLoader.jsonManifest=bulkLoader.jsonManifest.concat(this.manifest.json)),bulkLoader.imgManifest=this.setRoot(bulkLoader.imgManifest,core.settings.IMG_DIR),bulkLoader.fontManifest=this.setRoot(bulkLoader.fontManifest,core.settings.FONT_DIR),bulkLoader.urls.storeLookup(bulkLoader.jsonManifest),bulkLoader.urls.storeLookup(bulkLoader.imgManifest),bulkLoader.urls.storeLookup(bulkLoader.fontManifest),bulkLoader.webAudioManifest=this.parseAudio(this.manifest.snd_webaudio),bulkLoader.audioSpriteManifest=this.manifest.snd_sprite||{}},core.load.LoadManifest.prototype.setRoot=function(list,root){if(!list)return[];for(var item,n=list.length,i=0;i<n;i++)item=list[i],item.src.indexOf(root)===-1&&(item.src=root+item.src);return list},core.load.LoadManifest.prototype.getManifestSection=function(name,res,fallback){var list=null,nameWithResolution=name+res;return this.manifest.hasOwnProperty(nameWithResolution)?list=this.manifest[nameWithResolution]:(nameWithResolution=name+fallback,this.manifest.hasOwnProperty(nameWithResolution)&&(list=this.manifest[nameWithResolution])),list||(list=[]),list},core.load.LoadManifest.prototype.parseAudio=function(input){if(!input)return[];for(var item,folder=this.audioFolder,n=input.length,i=0;i<n;i++)item=input[i],item.src=folder+item.src+this.audioType;return input},Object.defineProperties(core.load.LoadManifest.prototype,{isEmpty:{get:function(){var loader=this.bulkLoader,count=0;return loader.jsonManifest&&(count+=loader.jsonManifest.length),loader.imgManifest&&(count+=loader.imgManifest.length),loader.fontManifest&&(count+=loader.fontManifest.length),loader.webAudioManifest&&(count+=loader.webAudioManifest.length),0===count}}}),core.load.JSONLoadState=function(){this.bulkLoader=null,this.jsonCache=null,this.numLoaded=0,this.numTotal=0},core.load.JSONLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.jsonLoaded=this._jsonLoaded.bind(this)},core.load.JSONLoadState.prototype.unload=function(ids){var i,id,n=ids.length;for(i=0;i<n;i++)id=ids[i],delete this.jsonCache[id]},core.load.JSONLoadState.prototype.load=function(){var self=this;this.queue=new core.load.JsonQueue,this.queue.on("complete",function(){self.bulkLoader.sequence.next()}),this.queue.on("loaded",this.jsonLoaded),this.queue.load(this.bulkLoader.jsonManifest)},core.load.JSONLoadState.prototype._jsonLoaded=function(event){var filePath=event.url,assetData=this.bulkLoader.urls.getAssetData(filePath);assetData.jsonData=event.jsonData,assetData.loaded=!0,this.jsonProgress(event.numLoaded,event.numTotal);var isAtlas=assetData.jsonData.hasOwnProperty("frames")&&assetData.jsonData.hasOwnProperty("meta")||"atlas"==assetData.type;isAtlas&&this.addImageToQueue(assetData.id,assetData.jsonData,filePath),this.jsonCache[assetData.id]=assetData.jsonData},core.load.JSONLoadState.prototype.jsonProgress=function(numLoaded,total){this.bulkLoader.jsonLoaded(numLoaded/total)},core.load.JSONLoadState.prototype.toString=function(){return"[JSONLoadState]"},core.load.JSONLoadState.prototype.addImageToQueue=function(id,jsonData,jsonFilePath){for(var imgFilename=jsonData.meta.image,imgManifest=this.bulkLoader.imgManifest,n=imgManifest.length,item=null,i=0;i<n;i++)if(item=imgManifest[i],item.src.indexOf(imgFilename)>-1)return void(item.atlasData=jsonData);var data={},lastSlash=jsonFilePath.lastIndexOf("/"),folderpath=jsonFilePath.substr(0,lastSlash+1);data.src=folderpath+imgFilename,data.id=id,data.atlasData=jsonData,imgManifest[imgManifest.length]=data,this.bulkLoader.urls.add(data)},core.load.ImageLoadState=function(){this.bulkLoader=null,this.imageLoader=new core.load.ImageLoader,this._assets={},this._srcPaths={},this.resolution=1},core.load.ImageLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.imageLoaded=this._imageLoaded.bind(this),this.imageProgress=this._imageProgress.bind(this),this.loadComplete=this._loadComplete.bind(this)},core.load.ImageLoadState.prototype.load=function(){var files=this.bulkLoader.imgManifest;0===files.length?this.bulkLoader.sequence.next():(this.storeSourcePaths(files),this.imageLoader.on("loaded",this.imageLoaded),this.imageLoader.on("progress",this.imageProgress),this.imageLoader.on("complete",this.loadComplete),this.imageLoader.load(files))},core.load.ImageLoadState.prototype._imageLoaded=function(event){var img=event.img,success=event.success,assetData=event.data;success&&(assetData.hasOwnProperty("atlasData")?this.addAtlas(img,assetData.atlasData,assetData.src):this.addTexture(img,assetData.src)),this._assets[assetData.id]=img,this.imageProgress(event)},core.load.ImageLoadState.prototype.getAsset=function(id){return this._assets[id]},core.load.ImageLoadState.prototype._imageProgress=function(event){this.bulkLoader.imageLoaded(event.progress)},core.load.ImageLoadState.prototype.storeSourcePaths=function(files){var item,i,n=files.length;for(i=0;i<n;i++)item=files[i],this._srcPaths[item.id]=item.src},core.load.ImageLoadState.prototype._loadComplete=function(){this.imageLoader.offAll(),this.bulkLoader.sequence.next()},core.load.ImageLoadState.prototype.addTexture=function(img,src){var tx=null;if(null!==img){var baseTexture=this.createBaseTexture(img,src);tx=new PIXI.Texture(baseTexture),PIXI.utils.TextureCache[src]=tx}return tx},core.load.ImageLoadState.prototype.createBaseTexture=function(img,src){var baseTexture=new PIXI.BaseTexture(img,null,PIXI.utils.getResolutionOfUrl(src));return baseTexture.imageUrl=src,PIXI.utils.BaseTextureCache[src]=baseTexture,baseTexture},core.load.ImageLoadState.prototype.addAtlas=function(p_img,p_json,p_src){var baseTexture=this.createBaseTexture(p_img,p_src);this.addAtlasData(baseTexture,p_json)},core.load.ImageLoadState.prototype.addAtlasData=function(baseTexture,p_json){var frameId,item,frameData=p_json.frames;if(Array.isArray(frameData)){var i,n=frameData.length;for(i=0;i<n;i++)item=frameData[i],this.addAtlasFrame(item,item.filename,baseTexture)}else for(frameId in frameData)frameData.hasOwnProperty(frameId)&&(item=frameData[frameId],this.addAtlasFrame(item,frameId,baseTexture))},core.load.ImageLoadState.prototype.addAtlasFrame=function(item,key,baseTexture){var rect=item.frame,tx=null,resolution=this.resolution;if(rect){var size=null,trim=null;if(size=item.rotated?new PIXI.Rectangle(rect.x,rect.y,rect.h,rect.w):new PIXI.Rectangle(rect.x,rect.y,rect.w,rect.h),item.trimmed&&(trim=new PIXI.Rectangle(item.spriteSourceSize.x/resolution,item.spriteSourceSize.y/resolution,item.sourceSize.w/resolution,item.sourceSize.h/resolution)),item.rotated){var temp=size.width;size.width=size.height,size.height=temp}size.x/=resolution,size.y/=resolution,size.width/=resolution,size.height/=resolution,tx=new PIXI.Texture(baseTexture,size,size.clone(),trim,item.rotated),PIXI.utils.TextureCache[key]=tx}return tx},core.load.ImageLoadState.prototype.purge=function(){this._assets={}},core.load.ImageLoadState.prototype.unloadImage=function(id){delete this._assets[id];var src=this._srcPaths[id];delete this._srcPaths[id],this.unloadTextures(src)},core.load.ImageLoadState.prototype.unloadTextures=function(src){var baseTextureCache=PIXI.utils.BaseTextureCache,textureCache=PIXI.utils.TextureCache,baseTexture=baseTextureCache[src];if(baseTexture){var tx;for(var s in textureCache)textureCache.hasOwnProperty(s)&&(tx=textureCache[s],tx.baseTexture===baseTexture&&(delete textureCache[s],tx.destroy()));delete baseTextureCache[src],baseTexture.destroy()}},core.load.ImageLoadState.prototype.unload=function(items){var i,id,n=items.length;for(i=0;i<n;i++)id=items[i],this.unloadImage(id);this.purge()},core.load.AudioLoadState=function(){this.bulkLoader=null,this.soundLoader=null},core.load.AudioLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.load.AudioLoadState.prototype.load=function(){var bulkLoader=this.bulkLoader,soundLoader=this.soundLoader;if(0===bulkLoader.webAudioManifest.length)bulkLoader.sequence.next();else{soundLoader.on("progress",function(event){bulkLoader.audioLoaded(event.value)}),soundLoader.on("complete",function(event){soundLoader.offAll(),bulkLoader.audioLoaded(1),bulkLoader.sequence.next()});var copy=JSON.parse(JSON.stringify(bulkLoader.webAudioManifest));soundLoader.load(copy)}},core.load.FontLoadState=function(){this.bulkLoader=null,this.loadedFonts=[],this.resolution=1},core.load.FontLoadState.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.load.FontLoadState.prototype.unload=function(){var i,n=this.loadedFonts.length;for(i=0;i<n;i++)this.removeFont(this.loadedFonts[i])},core.load.FontLoadState.prototype.removeFont=function(fontName){var fontCache=PIXI.extras.BitmapText.fonts;if(fontCache.hasOwnProperty(fontName)){var fontData=fontCache[fontName],chars=fontData.chars;for(var charCode in chars)chars.hasOwnProperty(charCode)&&delete PIXI.utils.TextureCache[charCode];delete fontCache[fontName]}},core.load.FontLoadState.prototype.load=function(){var files=this.bulkLoader.fontManifest,n=files.length;if(0===n)this.bulkLoader.sequence.next();else for(var numLoaded=0,loader=null,dataItem=null,bulkLoader=this.bulkLoader,self=this,i=0;i<n;i++)dataItem=files[i],loader=new core.load.BitmapFontLoader(dataItem.src,this.resolution),loader.on("loaded",function(event){numLoaded++,bulkLoader.fontLoaded(numLoaded/n),self.loadedFonts[self.loadedFonts.length]=event.name,numLoaded===n&&bulkLoader.sequence.next()}),loader.on("error",function(event){numLoaded++,bulkLoader.fontLoaded(numLoaded/n),numLoaded===n&&bulkLoader.sequence.next()}),loader.load()},core.load.BulkLoader=function(){core.utils.EventDispatcher.call(this),this.resolution=1,this.jsonCache=null,this.sequence=null,this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null},core.load.BulkLoader.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.BulkLoader.prototype.constructor=core.load.BulkLoader,core.load.BulkLoader.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.webAudio=this.settings.WEB_AUDIO_ENABLED&&this.system.webAudio,core.load.soundLoader=new core.audio.SoundLoader,this.webAudio&&(core.load.soundLoader.context=game_shell.snd.snd.context),this.loadManifest=this.createLoadManifest(),this.jsonLoad=this.createJsonLoad(),this.imageLoad=this.createImageLoad(),this.audioLoad=this.createAudioLoad(),this.fontLoad=this.createFontLoad(),this.sequence=new core.load.LoadingSequence(this,this.webAudio),this.urls=new core.utils.UrlLookup,this.progressTracker=new core.load.ProgressTracker(this.webAudio)},core.load.BulkLoader.prototype.addFile=function(filepath,id,type){var manifest=this.getManifestByExtension(filepath),item=null;return null!==manifest&&(item={src:filepath,id:id},"undefined"!=typeof type&&(item.type=type),manifest[manifest.length]=item,this.urls.add(item)),item},Object.defineProperties(core.load.BulkLoader.prototype,{isLoading:{get:function(){return this.sequence.isLoading}}}),core.load.BulkLoader.prototype.getManifest=function(){return this.loadManifest.manifest},core.load.BulkLoader.prototype.getManifestByExtension=function(file){
var ext=file.match(/\.(\w+)$/)[0],manifest=null;switch(ext){case".png":case".jpg":manifest=this.imgManifest;break;case".json":manifest=this.jsonManifest;break;case".fnt":case".xml":manifest=this.fontManifest;break;case".ogg":case".m4a":case".mp3":case".wav":manifest=this.webAudioManifest}return manifest},core.load.BulkLoader.prototype.contains=function(file){var i,manifest=this.getManifestByExtension(file),item=null,n=manifest.length,itemFound=!1;for(i=0;i<n;i++)if(item=manifest[i],item.src.indexOf(file)>-1){itemFound=!0;break}return itemFound},core.load.BulkLoader.prototype.containsId=function(id,fileType){var i,manifest=this.getManifestByExtension(fileType),item=null,n=manifest.length,itemFound=!1;for(i=0;i<n;i++)if(item=manifest[i],item.id.indexOf(id)>-1){itemFound=!0;break}return itemFound},core.load.BulkLoader.prototype.load=function(manifestPath){this.manifestPath=manifestPath,this.progressTracker.reset(),this.sequence.reset(),this.sequence.next()},core.load.BulkLoader.prototype.loadProgress=function(){var overallProgress=this.progressTracker.overallProgress();this.emit({type:"progress",value:overallProgress})},core.load.BulkLoader.prototype.fontLoaded=function(percent){this.progressTracker.progressFonts=percent,this.loadProgress()},core.load.BulkLoader.prototype.imageLoaded=function(percent){this.progressTracker.progressImages=percent,this.loadProgress()},core.load.BulkLoader.prototype.jsonLoaded=function(percent){this.progressTracker.progressJSON=percent,this.loadProgress()},core.load.BulkLoader.prototype.audioLoaded=function(percent){this.progressTracker.progressSounds=percent,this.loadProgress()},core.load.BulkLoader.prototype.addSounds=function(){var soundData={};if(this.webAudio)soundData.assets=this.audioLoad.soundLoader.assets,game_shell.snd.addSounds(soundData.assets),this.audioLoad.soundLoader.assets={};else{var manifestData=this.audioSpriteManifest;soundData.autoplay=!0,soundData.sprites=manifestData.sprites?manifestData.sprites:null,soundData.src=null,manifestData.src&&(soundData.src=core.settings.SND_DIR+manifestData.src),game_shell.snd.addSounds(soundData)}},core.load.BulkLoader.prototype.loadComplete=function(){this.addSounds(),this.emit({type:"complete"}),this.offAll()},core.load.BulkLoader.prototype.unload=function(){var jsonData=this.loadManifest.manifest;jsonData&&(this.imageLoad.unload(this.getImageIds()),game_shell.snd.removeSounds(this.webAudioManifest),core.load.soundLoader.unload(this.getIds(this.webAudioManifest)),this.fontLoad.unload(),this.jsonLoad.unload(this.getIds(this.jsonManifest)),this.loadManifest.manifest=null,this.jsonManifest=null,this.imgManifest=null,this.fontManifest=null,this.webAudioManifest=null,this.audioSpriteManifest=null)},core.load.BulkLoader.prototype.getImageIds=function(){var i,item,list=this.getIds(this.imgManifest),n=this.jsonManifest.length;for(i=0;i<n;i++)item=this.jsonManifest[i],item.jsonData&&item.jsonData.hasOwnProperty("meta")&&item.jsonData.hasOwnProperty("frames")&&list.indexOf(item.id)===-1&&(list[list.length]=item.id);return list},core.load.BulkLoader.prototype.getIds=function(data){var i,item,ids=[],n=data.length;for(i=0;i<n;i++)item=data[i],ids[i]=item.id;return ids},core.load.BulkLoader.prototype.createFontLoad=function(){var fontLoad=new core.load.FontLoadState;return fontLoad.init({resolution:this.resolution,bulkLoader:this}),fontLoad},core.load.BulkLoader.prototype.createAudioLoad=function(){var audioLoad=new core.load.AudioLoadState;return audioLoad.init({bulkLoader:this,soundLoader:core.load.soundLoader}),audioLoad},core.load.BulkLoader.prototype.createImageLoad=function(){var imageLoad=new core.load.ImageLoadState(this);return imageLoad.init({resolution:this.resolution,bulkLoader:this}),imageLoad},core.load.BulkLoader.prototype.createLoadManifest=function(){var loadManifest=new core.load.LoadManifest;return loadManifest.init({resolution:this.resolution,bulkLoader:this}),loadManifest},core.load.BulkLoader.prototype.createJsonLoad=function(){var loader=new core.load.JSONLoadState;return loader.init({resolution:this.resolution,bulkLoader:this,jsonCache:this.jsonCache}),loader},core.load.LoadingSequence=function(p_loader,webAudio){this.loader=p_loader,this.webAudio=webAudio,this.currentState=null},Object.defineProperties(core.load.LoadingSequence.prototype,{isLoading:{get:function(){return null!==this.currentState}}}),core.load.LoadingSequence.prototype.reset=function(){this.currentState=null},core.load.LoadingSequence.prototype.next=function(){switch(this.currentState){case null:this.currentState=this.loader.loadManifest;break;case this.loader.loadManifest:this.loader.emit({type:"manifest_loaded"}),this.currentState=this.loader.jsonLoad;break;case this.loader.jsonLoad:this.currentState=this.loader.imageLoad;break;case this.loader.imageLoad:this.currentState=this.loader.fontLoad;break;case this.loader.fontLoad:this.webAudio?this.currentState=this.loader.audioLoad:this.currentState=null;break;case this.loader.audioLoad:this.loader.addSounds(),this.currentState=null}null!==this.currentState?this.currentState.load():this.loader.loadComplete()},core.utils.UrlLookup=function(){},core.utils.UrlLookup.prototype.storeLookup=function(p_list){if(p_list)for(var item,n=p_list.length,i=0;i<n;i++)item=p_list[i],this.add(item)},core.utils.UrlLookup.prototype.add=function(item){this[item.src]=item,this[item.id]=item},core.utils.UrlLookup.prototype.getAssetData=function(key){return this[key]},core.utils.UrlLookup.prototype.getURL=function(key){var assetData=this[key];return assetData?assetData.src:(console.log("ERROR - no asset found for key  -> "+key),null)},core.utils.UrlLookup.prototype.pathForFile=function(fileName){var id,item,foundPath=null;for(id in this)if(this.hasOwnProperty(id)&&(item=this[id],item.hasOwnProperty("src")&&item.src.indexOf(fileName)>-1)){foundPath=item.src;break}return foundPath},core.load.ProgressTracker=function(webAudio){this.webAudio=webAudio,this.reset(),this.total=this.webAudio?4:3},core.load.ProgressTracker.prototype.totalProgress=function(){var prg=this.progressJSON+this.progressImages+this.progressFonts;return this.webAudio&&(prg+=this.progressSounds),prg},core.load.ProgressTracker.prototype.overallProgress=function(){var prg=this.totalProgress();return prg/this.total},core.load.ProgressTracker.prototype.reset=function(){this.progressJSON=0,this.progressImages=0,this.progressSounds=0,this.progressFonts=0},core.load.ProgressTracker.prototype.debugLog=function(){var s="* ProgressTracker: \n\r";return s+=" - total: "+this.total+" \n\r",s+=" - overall: "+this.totalProgress()+" \n\r",s+=" - progressJSON: "+this.progressJSON+" \n\r",s+=" - progressImages: "+this.progressImages+" \n\r",s+=" - progressSounds: "+this.progressSounds+" \n\r",s+=" - progressFonts: "+this.progressFonts+" \n\r"},core.load.JsonLoader=function(url){core.utils.EventDispatcher.call(this),this.url=url,this.id=null},core.load.JsonLoader.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.JsonLoader.prototype.constructor=core.load.JsonLoader,core.load.JsonLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var scope=this;this.ajaxRequest.onreadystatechange=function(){scope.onJSONLoaded()},this.jsonData=null,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/json"),this.ajaxRequest.send(null)},core.load.JsonLoader.prototype.onJSONLoaded=function(){4===this.ajaxRequest.readyState&&(200===this.ajaxRequest.status||0===this.ajaxRequest.status&&""!==this.ajaxRequest.responseText?(this.responseText=this.ajaxRequest.responseText,this.jsonData=JSON.parse(this.responseText),this.dispatchEvent({type:"loaded",data:this.jsonData})):404===this.ajaxRequest.status?(console.log("Asset Failed to Load (Status:404): "+this.url),this.dispatchEvent({type:"error",data:null})):0===this.ajaxRequest.status&&(console.log("Asset Failed to Load (Status:0): "+this.url),this.dispatchEvent({type:"error",data:null})))},PIXI.AjaxRequest=function(){var activexmodes=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"];if(!window.ActiveXObject)return window.XMLHttpRequest?new window.XMLHttpRequest:null;for(var i=0;i<activexmodes.length;i++)try{return new window.ActiveXObject(activexmodes[i])}catch(e){}},core.load.JsonQueue=function(){core.utils.EventDispatcher.call(this),this.queue=[],this.results={}},core.load.JsonQueue.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.JsonQueue.prototype.constructor=core.load.JsonQueue,core.load.JsonQueue.prototype.load=function(p_manifest){this.queue=this.queue.concat(p_manifest),this.numTotal=this.queue.length,this.numLoaded=0,this.boundCallback=this._jsonLoaded.bind(this),this.loadNext()},core.load.JsonQueue.prototype.loadNext=function(){if(this.queue.length>0){var obj=this.queue.shift(),id=obj.id,src=obj.src;this.results[id]=null;var loader=new core.load.JsonLoader(src);loader.id=id,loader.on("loaded",this.boundCallback),loader.load()}else this.emit({type:"complete",results:this.results})},core.load.JsonQueue.prototype._jsonLoaded=function(p_evt){var loader=p_evt.target,jsonData=loader.jsonData,id=loader.id;return this.results[id]=jsonData,loader.removeEventListeners(),this.numLoaded++,this.emit({type:"loaded",id:id,url:loader.url,loader:loader,numLoaded:this.numLoaded,numTotal:this.numTotal,jsonData:jsonData}),this.loadNext(),jsonData},core.load.BitmapFontLoader=function(url,resolution){core.utils.EventDispatcher.call(this),this.url=url,this.resolution=resolution},core.load.BitmapFontLoader.prototype=Object.create(core.utils.EventDispatcher.prototype),core.load.BitmapFontLoader.prototype.constructor=core.load.BitmapFontLoader,core.load.BitmapFontLoader.prototype.load=function(){this.ajaxRequest=new PIXI.AjaxRequest;var self=this;this.ajaxRequest.onreadystatechange=function(){self.onXMLLoaded()},this.jsonData=null,this.ajaxRequest.open("GET",this.url,!0),this.ajaxRequest.overrideMimeType&&this.ajaxRequest.overrideMimeType("application/xml"),this.ajaxRequest.send(null)},core.load.BitmapFontLoader.prototype.onXMLLoaded=function(){if(4===this.ajaxRequest.readyState)if(200===this.ajaxRequest.status||0===this.ajaxRequest.status&&""!==this.ajaxRequest.responseText){var responseXML=this.ajaxRequest.responseXML;if(!responseXML||/MSIE 9/i.test(navigator.userAgent)||navigator.isCocoonJS)if("function"==typeof window.DOMParser){var domparser=new DOMParser;responseXML=domparser.parseFromString(this.ajaxRequest.responseText,"text/xml")}else{var div=document.createElement("div");div.innerHTML=this.ajaxRequest.responseText,responseXML=div}this.loadFontImage(responseXML)}else 404!==this.ajaxRequest.status&&0!==this.ajaxRequest.status||this.emit({type:"error",data:null,name:null})},core.load.BitmapFontLoader.prototype.loadFontImage=function(responseXML){var imageFile=responseXML.getElementsByTagName("page")[0].getAttribute("file"),slashIndex=this.url.lastIndexOf("/"),folderURL=this.url.substr(0,slashIndex+1),textureUrl=folderURL+imageFile,texture=PIXI.utils.TextureCache[textureUrl];if(texture)this.parseFontData(responseXML,texture);else{var img=new Image,self=this;img.onload=function(){var baseTexture=core.load.ImageLoadState.prototype.createBaseTexture(img,textureUrl);texture=new PIXI.Texture(baseTexture),PIXI.utils.TextureCache[textureUrl]=texture,self.parseFontData(responseXML,texture)},img.src=textureUrl}},core.load.BitmapFontLoader.prototype.parseFontData=function(responseXML,texture){var data={},info=responseXML.getElementsByTagName("info")[0],common=responseXML.getElementsByTagName("common")[0];data.font=info.getAttribute("face"),data.size=parseInt(info.getAttribute("size"),10),data.lineHeight=parseInt(common.getAttribute("lineHeight"),10),data.chars={},data.baseTexture=texture.baseTexture;for(var letters=responseXML.getElementsByTagName("char"),letter=null,i=0;i<letters.length;i++){letter=letters[i];var charCode=parseInt(letter.getAttribute("id"),10),textureRect=new PIXI.Rectangle(this.scaleValue(parseInt(letter.getAttribute("x"),10)+texture.frame.x),this.scaleValue(parseInt(letter.getAttribute("y"),10)+texture.frame.y),this.scaleValue(parseInt(letter.getAttribute("width"),10)),this.scaleValue(parseInt(letter.getAttribute("height"),10)));data.chars[charCode]={xOffset:this.scaleValue(parseInt(letter.getAttribute("xoffset"),10)),yOffset:this.scaleValue(parseInt(letter.getAttribute("yoffset"),10)),xAdvance:this.scaleValue(parseInt(letter.getAttribute("xadvance"),10)),kerning:{},texture:new PIXI.Texture(texture.baseTexture,textureRect)}}var kernings=responseXML.getElementsByTagName("kerning");for(i=0;i<kernings.length;i++){var first=this.scaleValue(parseInt(kernings[i].getAttribute("first"),10)),second=this.scaleValue(parseInt(kernings[i].getAttribute("second"),10)),amount=this.scaleValue(parseInt(kernings[i].getAttribute("amount"),10));data.chars[second].kerning[first]=amount}return PIXI.extras.BitmapText.fonts[data.font]=data,this.emit({name:data.font,data:data,type:"loaded"}),data},core.load.BitmapFontLoader.prototype.scaleValue=function(value){return value/this.resolution},core.audio.MusicLoop=function(config){if(this.type=core.audio.AudioModes.MUSIC_LOOP,this.isMuted=!1,this.isPaused=!1,this.grp="music",this.id="MUSIC_LOOP",this.volume=1,this.soundGroups={music:{volume:1,isMuted:!1}},config)for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.audio.MusicLoop.prototype.init=function(config){this.sound=this.initSnd(config)},core.audio.MusicLoop.prototype.initSnd=function(config){config.src+=config.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.loop=!0;var loopingSupported="boolean"==typeof(new Audio).loop;return loopingSupported||snd.addEventListener("ended",function(){snd.currentTime=0,snd.play()},!1),snd.autoplay=config.autoplay,snd.src=config.src,snd},core.audio.MusicLoop.prototype.pause=function(b){this.isPaused=b,this.isPaused?this.sound.pause():this.sound.play()},core.audio.MusicLoop.prototype.isPlaying=function(){return!this.isPaused},core.audio.MusicLoop.prototype.update=function(elapsedTime){},core.audio.MusicLoop.prototype.dispose=function(){null!==this.sound&&(this.sound.pause(),this.sound=null)},core.audio.MusicLoop.prototype.mute=function(bool){this.isMuted=bool,bool?this.stop():this.isGroupMuted(this.grp)||this.sound.play()},core.audio.MusicLoop.prototype.muteGroup=function(grp,bool){var soundGroup=this.soundGroups[grp];soundGroup&&(soundGroup.isMuted=bool,soundGroup.isMuted?this.stop():this.isMuted||this.sound.play())},core.audio.MusicLoop.prototype.isGroupMuted=function(grp){var soundGroup=this.soundGroups[grp];return!!soundGroup&&soundGroup.isMuted},core.audio.MusicLoop.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},core.audio.MusicLoop.prototype.play=function(p_id,p_vol,p_loop){p_id||this.sound.play()},core.audio.MusicLoop.prototype.preload=function(p_id){},core.audio.MusicLoop.prototype.stop=function(p_id){p_id||this.sound.pause()},core.audio.MusicLoop.prototype.addSounds=function(p_id){},core.audio.MusicLoop.prototype.stopAll=function(){},core.audio.PauseManager=function(){this.snd=null,this.isPaused=!1,this.pausedSounds=null},core.audio.PauseManager.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.pausedSounds={}},core.audio.PauseManager.prototype.pause=function(bool){bool?this.pauseOn():this.resume(),this.isPaused=bool},core.audio.PauseManager.prototype.clear=function(){for(var s in this.pausedSounds)this.pausedSounds.hasOwnProperty(s)&&delete this.pausedSounds[s]},core.audio.PauseManager.prototype.resume=function(){var s,time;for(s in this.pausedSounds)this.pausedSounds.hasOwnProperty(s)&&(time=this.pausedSounds[s],delete this.pausedSounds[s],this.snd.resume(s,time))},core.audio.PauseManager.prototype.pauseOn=function(){var s,channel,time,channels=this.snd.channels;for(s in channels)channels.hasOwnProperty(s)&&(channel=channels[s],time=channel.pause(),time>0&&(this.pausedSounds[s]=time));this.snd.stopAll()},core.audio.SndNone=function(){this.init=function(){},this.addSounds=function(){},this.removeSounds=function(){},this.mute=function(b){},this.muteGroup=function(grp,b){},this.muteAllGroups=function(b){},this.isGroupMuted=function(blah){return!0},this.pause=function(b){},this.isPlaying=function(){return!1},this.update=function(elapsedTime){return!1},this.play=function(p_id,p_vol,p_loop){},this.stop=function(p_id){},this.stopAll=function(){},this.dispose=function(){}},core.audio.SoundLoader=function(){core.utils.EventDispatcher.call(this),this.assets={},this.manifest=null,this.context=null,this.numLoaded=0,this.evtProgress={type:"progress",value:0},this.evtComplete={type:"complete",value:1}},core.audio.SoundLoader.prototype=Object.create(core.utils.EventDispatcher.prototype),core.audio.SoundLoader.prototype.constructor=core.audio.SoundLoader,core.audio.SoundLoader.prototype.load=function(items){this.context||this.initContext(),this.manifest?this.manifest=this.manifest.concat(items):this.manifest=items,this.loadNext()},core.audio.SoundLoader.prototype.purge=function(){this.assets={}},core.audio.SoundLoader.prototype.unloadSound=function(id){delete this.assets[id]},core.audio.SoundLoader.prototype.unload=function(sounds){var i,id,n=sounds.length;for(i=0;i<n;i++)id=sounds[i],this.unloadSound(id)},core.audio.SoundLoader.prototype.initContext=function(){window.AudioContext?this.context=new AudioContext:window.webkitAudioContext&&(this.context=new webkitAudioContext)},core.audio.SoundLoader.prototype.nextItem=function(){for(var checkObj,foundObj=null,n=this.manifest.length,i=0;i<n;i++)if(checkObj=this.manifest[i],!this.assets.hasOwnProperty(checkObj.id)){foundObj=checkObj;break}return foundObj},core.audio.SoundLoader.prototype.countLoaded=function(){var checkObj,n=this.manifest.length;this.numLoaded=0;for(var i=0;i<n;i++)checkObj=this.manifest[i],this.assets.hasOwnProperty(checkObj.id)&&this.numLoaded++},core.audio.SoundLoader.prototype.loadNext=function(){function updateProgress(evt){if(evt.lengthComputable){var percentComplete=evt.loaded/evt.total;self.loadProgress(percentComplete)}}var itemData=this.nextItem();if(this.countLoaded(),itemData){var request=new XMLHttpRequest;request.open("GET",itemData.src,!0),request.responseType="arraybuffer";var self=this;request.onload=function(){self.onSoundLoaded.call(self,itemData,request)},request.onerror=function(){self.assets[itemData.id]=null,self.loadProgress(),self.loadNext()},request.addEventListener("progress",updateProgress,!1);try{request.send()}catch(e){console.log("SoundLoader: XHR error "+request.status)}}else this.manifest.length=0,this.loadComplete()},core.audio.SoundLoader.prototype.onSoundLoaded=function(itemData,request){var self=this,id=itemData.id;"function"==typeof this.context.decodeAudioData?this.context.decodeAudioData(request.response,function(decodedBuffer){itemData.soundData=decodedBuffer,self.assets[id]=itemData,self.loadProgress(),self.loadNext()},function(){self.assets[id]=null,self.loadProgress(),self.loadNext()}):(200===request.status?(window.AudioContext?itemData.soundData=this.context.createBuffer(request.response,1,44100):itemData.soundData=this.context.createBuffer(request.response,!0),this.assets[id]=itemData):this.assets[id]=null,this.loadProgress(),this.loadNext())},core.audio.SoundLoader.prototype.loadProgress=function(progress){void 0===progress&&(progress=0);var total=this.manifest.length,amount=(this.numLoaded+progress)/total;this.evtProgress.value=amount,this.emit(this.evtProgress)},core.audio.SoundLoader.prototype.loadComplete=function(){this.emit(this.evtComplete)},core.audio.SndSprite=function(config){core.utils.EventDispatcher.call(this),this.type=core.audio.AudioModes.AUDIO_SPRITE,this.endTime=-1,this.isMuted=!1,this.audioType=config.audioType,this.isReady=!1,this.bufferingComplete=!1,this.secondsBuffered=0,this.loadeddata=!1,this.SFX="sfx",this.MUSIC="music",this.soundGroups={},this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config&&config.src&&this.setSounds(config)},core.audio.SndSprite.prototype=Object.create(core.utils.EventDispatcher.prototype),core.audio.SndSprite.prototype.constructor=core.audio.SndSprite,core.audio.SndSprite.prototype.addSoundGroup=function(p_id){var group=new core.audio.SoundGroup(p_id);return this.soundGroups[p_id]=group,group},core.audio.SndSprite.prototype.setSounds=function(config){this.sprites=this.parseManifest(config.sprites),this.sound=this.initSnd(config),config.isIOS||this.preload()},core.audio.SndSprite.prototype.parseManifest=function(p_data){if(!p_data)return[];var obj,i,soundGroup,n=p_data.length,soundData=[];for(i=0;i<n;i++)obj=p_data[i],!obj.hasOwnProperty("end")&&obj.hasOwnProperty("duration")&&(obj.end=obj.start+obj.duration),obj.hasOwnProperty("grp")||(obj.grp=this.SFX),soundData[i]=obj,soundGroup=this.soundGroups[obj.grp],soundGroup.addSound(obj);return soundData},core.audio.SndSprite.prototype.initSnd=function(config){if(!config.src)return null;config.src+=this.audioType;var snd=document.createElement("audio");snd.preload="auto";var self=this;return snd.addEventListener("loadeddata",function(){self.loadeddata=!0},!1),snd.addEventListener("canplay",function(){self.loadeddata=!0},!1),snd.src=config.src,this.bufferSupported="undefined"!=typeof snd.buffered,snd},core.audio.SndSprite.prototype.preload=function(){this.sound&&(this.sound.autoplay=!0,this.endTime=2.5,this.sound.play())},core.audio.SndSprite.prototype.play=function(p_id,p_vol,p_loop){if(!this.bufferingComplete)return!1;var duration=this.sound.duration;if(isNaN(duration)||duration<2)return!1;if(this.isMuted)return this.stop(),!1;if(!this.isGamePaused){var foundObj=this.getSpriteData(p_id);if(null!==foundObj){var grpId=foundObj.grp,soundGroup=this.soundGroups[grpId];if(soundGroup.isMuted)return!1;this.endTime=foundObj.end;var success=!0;try{this.sound.paused||this.sound.pause(),this.sound.currentTime=foundObj.start,this.sound.play()}catch(e){this.endTime=-1,success=!1}return success}return!1}},core.audio.SndSprite.prototype.stop=function(p_id){this.sound&&(this.sound.pause(),this.endTime=-1)},core.audio.SndSprite.prototype.stopAll=function(){this.sound&&(this.sound.pause(),this.endTime=-1)},core.audio.SndSprite.prototype.dispose=function(){this.sound&&(this.sound.pause(),this.endTime=-1,this.sound=null)},core.audio.SndSprite.prototype.getSpriteData=function(id){for(var obj,foundObj=null,n=this.sprites.length,i=0;i<n;i++)if(obj=this.sprites[i],obj.id===id){foundObj=obj;break}return foundObj},core.audio.SndSprite.prototype.isPlaying=function(){return!!this.sound&&!this.sound.paused},core.audio.SndSprite.prototype.update=function(elapsedTime){if(this.loadeddata)if(this.bufferingComplete)this.endTime>-1&&this.sound.currentTime>=this.endTime&&(this.sound.pause(),this.endTime=-1,this.bufferingComplete=!0);else{if(this.bufferSupported){var timeRange=this.sound.buffered;try{this.secondsBuffered=timeRange.end(0)}catch(e){this.secondsBuffered+=elapsedTime/10}}else this.secondsBuffered+=elapsedTime/10;this.sound.duration>0&&this.secondsBuffered>=this.sound.duration&&(this.bufferingComplete=!0,this.isReady=!0,this.emit({type:"ready"}))}},core.audio.SndSprite.prototype.mute=function(bool){this.isMuted=bool,bool&&this.stop()},core.audio.SndSprite.prototype.muteGroup=function(grp,bool){var soundGroup=this.soundGroups[grp];soundGroup.isMuted=bool},core.audio.SndSprite.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},core.audio.SndSprite.prototype.isGroupMuted=function(groupId){var soundGroup=this.soundGroups[groupId];return void 0!==soundGroup&&soundGroup.isMuted},core.audio.SndSprite.prototype.pause=function(b){this.isGamePaused=b,b&&this.stop()},core.audio.SoundGroup=function(name){this.id=name,this.sounds=[],this.isMuted=!1,this.addSound=function(sndData){this.sounds[this.sounds.length]=sndData}},core.audio.Channel=function(config){core.utils.EventDispatcher.call(this),this.id=config.id,this.context=config.context,this.channel=null,this._scratchBuffer=null,this.eventComplete={type:"complete"},this.start=config.start||0,this.duration=config.duration||-1,this.numLoops=this.setNumLoops(config),this.channel=this.createChannel(config),this.gainNode=this.createGainNode(),this.channel.connect(this.gainNode),this.muteNode=null,void 0!==config.volume&&(this.volume=config.volume),this.startTime=0},core.audio.Channel.prototype=Object.create(core.utils.EventDispatcher.prototype),core.audio.Channel.prototype.constructor=core.audio.Channel,core.audio.Channel.prototype.createChannel=function(config){var self=this;this._scratchBuffer=config._scratchBuffer;var channel=this.context.createBufferSource();return channel.buffer=config.buffer,channel.loop=config.loop===!0||config.loop>0,config.loop?(channel.loopStart=this.start,channel.loopEnd=this.start+this.duration):channel.onended=function(){self.emit(self.eventComplete)},channel},core.audio.Channel.prototype.setNumLoops=function(config){var numLoops=0;return"number"==typeof config.loop&&(numLoops=config.loop>1?config.loop:0),numLoops},core.audio.Channel.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},core.audio.Channel.prototype.connect=function(p_muteNode){this.muteNode=p_muteNode,this.gainNode.connect(this.muteNode)},core.audio.Channel.prototype.play=function(){var duration;duration=this.channel.loop?this.numLoops>0?this.duration*this.numLoops:1800:this.duration,this.channel.start?this.duration>-1?this.channel.start(0,this.start,duration):this.channel.start(0):this.channel.noteOn&&(this.duration>-1?this.channel.noteGrainOn(0,this.start,duration):this.channel.noteOn()),this.startTime=this.context.currentTime},core.audio.Channel.prototype.pause=function(){var currentTime=0;return null!==this.channel&&this.startTime>0&&(currentTime=this.context.currentTime-this.startTime,this.stop()),currentTime},core.audio.Channel.prototype.resume=function(time){var duration=this.channel.loop?1800:this.duration-time;this.channel.start?this.duration>-1?this.channel.start(time,this.start+time,duration):this.channel.start(time):this.channel.noteOn&&(this.duration>-1?this.channel.noteGrainOn(time,this.start+time,duration):this.channel.noteOn(time)),this.startTime=this.context.currentTime-time},core.audio.Channel.prototype.stop=function(){if(null!==this.channel)try{this.channel.stop?this.channel.stop(0):this.channel.noteOff&&this.channel.noteOff(0),this.channel.onended=null,this.channel.numberOfOutputs>0&&(this.channel.disconnect(0),this.gainNode.disconnect(0));try{this.channel.buffer=this._scratchBuffer}catch(e){}}catch(e){console.log("sound channel error on stop: "+e.message)}},Object.defineProperty(core.audio.Channel.prototype,"volume",{get:function(){return this.gainNode?this.gainNode.gain.value:0},set:function(value){this.gainNode&&(this.gainNode.gain.value=value)}}),core.audio.Channel.prototype.fadeOut=function(p_time){this.fadeTo(0,p_time/1e3)},core.audio.Channel.prototype.fadeIn=function(p_time,p_vol){var time=void 0===p_time?1e3:p_time;p_vol?p_vol>1&&(p_vol=1):p_vol=1,this.fadeTo(p_vol,time/1e3)},core.audio.Channel.prototype.fadeTo=function(p_vol,p_secs){var time=void 0===p_secs?1:p_secs,currentTime=this.context.currentTime;this.gainNode.gain.setValueAtTime(this.gainNode.gain.value,currentTime),this.gainNode.gain.linearRampToValueAtTime(p_vol,currentTime+time)},core.audio.Channel.prototype.dispose=function(){this.removeEventListeners(),null!==this.context&&(this.stop(),this.channel=null,this.muteNode=null,this.gainNode=null,this.context=null)},core.audio.WebAudioMgr=function(config){this.type=core.audio.AudioModes.WEB_AUDIO,this.context=config.context||this.createContext(),this._scratchBuffer=this.context.createBuffer(1,1,22050),this.sounds={},this.channels={},this.soundGroups={},this.catalog={},this.globalMute=new core.audio.WebAudioSoundGroup("master",this.createGainNode()),this.globalMute.connect(this.context.destination),this.SFX="sfx",this.MUSIC="music",this.addSoundGroup(this.SFX),this.addSoundGroup(this.MUSIC),config.assets&&this.addSounds(config.assets),this.timeout=new core.utils.DelayedAction,this.pauseManager=this.createPauseManager()},core.audio.WebAudioMgr.prototype.createPauseManager=function(){var pauseManager=new core.audio.PauseManager;return pauseManager.init({snd:this}),pauseManager},core.audio.WebAudioMgr.prototype.createContext=function(){var ctx;return window.AudioContext?ctx=new AudioContext:window.webkitAudioContext&&(ctx=new webkitAudioContext),ctx},core.audio.WebAudioMgr.prototype.createGainNode=function(){return this.context.createGainNode?this.context.createGainNode():this.context.createGain?this.context.createGain():null},core.audio.WebAudioMgr.prototype.play=function(id,volume,loop){var channel=this.createChannel(id,volume,loop);return channel&&channel.play(),channel},core.audio.WebAudioMgr.prototype.resume=function(id,time,volume,loop){var channel=this.createChannel(id,volume,loop);return channel&&channel.resume(time),channel},core.audio.WebAudioMgr.prototype.createChannel=function(id,p_vol,p_loop){var audioData=this.catalog[id],channel=null;if(void 0===audioData)return channel;var buffer=audioData.soundData;if(null!==buffer&&void 0!==buffer){var vol=p_vol||audioData.volume||1,loop=p_loop||audioData.loop||!1,start=audioData.start||0,duration=audioData.duration||-1,config={id:id,context:this.context,_scratchBuffer:this._scratchBuffer,buffer:buffer,loop:loop,start:start,duration:duration,volume:vol};channel=new core.audio.Channel(config);var self=this;channel.on("complete",function(event){self.stopChannel(event.target)});var group=this.soundGroups[audioData.grp];channel.connect(group.node),this.channels[id]=channel}return channel},core.audio.WebAudioMgr.prototype.isPlaying=function(id){return this.channels.hasOwnProperty(id)},core.audio.WebAudioMgr.prototype.stop=function(id){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];this.stopChannel(channel)}},core.audio.WebAudioMgr.prototype.stopAll=function(){var id,channel;for(id in this.channels)this.channels.hasOwnProperty(id)&&(channel=this.channels[id],this.stopChannel(channel))},core.audio.WebAudioMgr.prototype.stopChannel=function(channel){var id=channel.id;this.channels[id]===channel&&delete this.channels[id],channel.dispose(),channel=null},core.audio.WebAudioMgr.prototype.fadeOut=function(id,p_time){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id],fadeTime=void 0===p_time?1e3:p_time;channel.fadeOut(fadeTime);var self=this;this.timeout.delay(function(){self.stopChannel(channel)},fadeTime)}},core.audio.WebAudioMgr.prototype.fadeIn=function(id,p_time,p_vol){if(this.channels.hasOwnProperty(id)){var channel=this.channels[id];if(channel){var fadeTime=void 0===p_time?1e3:p_time,fadeVol=void 0===p_vol?1:p_vol;channel.fadeIn(fadeTime,fadeVol)}}},core.audio.WebAudioMgr.prototype.addSounds=function(p_assets){var audioData,jsonData,id;for(id in p_assets)p_assets.hasOwnProperty(id)&&(this.sounds.hasOwnProperty(id)||(jsonData=p_assets[id],null!==jsonData.soundData&&(audioData=new core.audio.WebAudioData(jsonData),jsonData.soundData=null,delete jsonData.soundData,this.sounds[id]=audioData,this.addToCatalog(audioData))))},core.audio.WebAudioMgr.prototype.removeSounds=function(webAudioManifest){var i,data,id,item,n=webAudioManifest.length;for(i=0;i<n;i++)data=webAudioManifest[i],id=data.id,this.sounds.hasOwnProperty(id)&&(item=this.sounds[id],item.soundData=null,delete this.sounds[id]),this.catalog.hasOwnProperty(id)&&(item=this.catalog[id],item.soundData=null,delete this.catalog[id]),data.sprites&&this.removeSounds(data.sprites)},core.audio.WebAudioMgr.prototype.purge=function(){
var item;for(var s in this.sounds)this.sounds.hasOwnProperty(s)&&(item=this.sounds[id],item.soundData=null,delete this.sounds[s]);for(s in this.catalog)this.catalog.hasOwnProperty(s)&&(item=this.catalog[id],item.soundData=null,delete this.catalog[s]);this.pauseManager.clear()},core.audio.WebAudioMgr.prototype.addToCatalog=function(audioData){if(audioData.sprites){var i,sprite,sprites=audioData.sprites,n=sprites.length;for(i=0;i<n;i++)sprite=sprites[i],this.catalog[sprite.id]=sprite}else this.catalog[audioData.id]=audioData},core.audio.WebAudioData=function(config){if(this.src=config.src,this.soundData=config.soundData,this.id=config.id,this.grp=config.grp||"sfx",this.volume=config.volume||1,this.loop=!!config.hasOwnProperty("loop")&&config.loop,config.hasOwnProperty("duration")&&(this.duration=config.duration),this.sprites=null,config.hasOwnProperty("sprites")){var i,item,grp,id,loop,n=config.sprites.length;if(n>0)for(this.sprites=[],i=0;i<n;i++)item=config.sprites[i],id=item.id,grp=item.grp,grp||(null!==id.match(/music/i)?(grp="music",loop=!item.hasOwnProperty("loop")||item.loop):(grp=this.grp,loop=!!item.hasOwnProperty("loop")&&item.loop)),this.sprites[i]={id:id,start:item.start,soundData:this.soundData,grp:grp,loop:loop,duration:item.duration}}},core.audio.WebAudioMgr.prototype.addSoundGroup=function(p_id){var gainNode=this.createGainNode(),group=new core.audio.WebAudioSoundGroup(p_id,gainNode);return group.connect(this.globalMute.node),this.soundGroups[p_id]=group,group},core.audio.WebAudioMgr.prototype.isGroupMuted=function(groupId){var group=this.soundGroups[groupId];return void 0!==group&&group.isMuted},core.audio.WebAudioMgr.prototype.mute=function(b){this.globalMute.isMuted=b,this.globalMute.volume=b?0:1},core.audio.WebAudioMgr.prototype.muteGroup=function(grp,b){var grpNode=this.soundGroups[grp];grpNode.volume=b?0:1,grpNode.isMuted=b},core.audio.WebAudioMgr.prototype.muteAllGroups=function(b){for(var s in this.soundGroups)this.soundGroups.hasOwnProperty(s)&&this.muteGroup(s,b)},core.audio.WebAudioMgr.prototype.pause=function(bool){this.pauseManager.pause(bool)},Object.defineProperties(core.audio.WebAudioMgr.prototype,{isPaused:{get:function(){return this.pauseManager.isPaused},set:function(value){this.pauseManager.pause(value)}}}),core.audio.WebAudioMgr.prototype.update=function(delta){this.timeout.update(delta)},core.audio.WebAudioMgr.prototype.wakeAudioSystem=function(){var buffer=this.context.createBuffer(1,1,22050),source=this.context.createBufferSource();source.buffer=buffer,source.connect(this.context.destination),source.play?source.play(0):source.noteOn&&source.noteOn(0)},core.audio.WebAudioSoundGroup=function(name,gainNode){this.id=name,this.node=gainNode,this.isMuted=!1,this.connect=function(dest){this.node.connect(dest)}},Object.defineProperty(core.audio.WebAudioSoundGroup.prototype,"volume",{get:function(){return this.node.gain.value},set:function(value){this.node.gain.value=value}}),core.audio.SndMgr=function(){this.snd=new core.audio.SndNone,this.audioModes=core.audio.AudioModes,this.audioType=null,this.mode=-1,this.isMuted=!1,this.updateList=new core.utils.UpdateList,this.timeout=new core.utils.DelayedAction,this.updateList.add(this.timeout)},core.audio.AudioModes={NONE:0,WEB_AUDIO:1,AUDIO_SPRITE:2,MUSIC_LOOP:3},core.audio.SndMgr.prototype.init=function(config){function touchHandler(){canvas.removeEventListener(event,touchHandler),self.prepare()}this.audioType=config.audioType,this.isMuted=config.isMuted;var isIOS=config.isIOS,audioEnabled=config.audioEnabled,webAudioEnabled=config.webAudioEnabled;if(audioEnabled?webAudioEnabled&&core.utils.system.webAudio?(this.createWebAudio(config),isIOS||this.prepare()):this.createAudioSprite(config):this.initNone(),isIOS&&this.mode!==this.audioModes.NONE){var canvas=game_shell.stage.renderer.view,self=this,event="touchend";canvas.addEventListener(event,touchHandler,!1)}return this.mode},core.audio.SndMgr.prototype.addSounds=function(data){if(!core.settings.AUDIO_ENABLED)return void this.initNone();if(this.webAudio)this.snd.addSounds(data);else{data.audioType=this.audioType;var hasSprites=null!==data.sprites,hasSrc=null!==data.src;hasSrc?hasSprites?this.snd.type===this.audioModes.AUDIO_SPRITE?this.snd.setSounds(data):this.createAudioSprite(data):this.createAudioLoop(data):this.initNone()}},core.audio.SndMgr.prototype.createWebAudio=function(config){this.snd=new core.audio.WebAudioMgr(config),this.mode=this.audioModes.WEB_AUDIO},core.audio.SndMgr.prototype.createAudioSprite=function(config){this.snd&&this.snd.dispose(),this.snd=new core.audio.SndSprite(config),this.mode=this.audioModes.AUDIO_SPRITE},core.audio.SndMgr.prototype.createAudioLoop=function(config){this.snd&&this.snd.dispose(),this.snd=new core.audio.MusicLoop,this.snd.init(config),this.mode=this.audioModes.MUSIC_LOOP},core.audio.SndMgr.prototype.pause=function(p_b){this.snd.pause(p_b)},core.audio.SndMgr.prototype.play=function(p_id,p_vol,p_loop){return this.snd.play(p_id,p_vol,p_loop)},core.audio.SndMgr.prototype.stop=function(id){this.snd.stop(id)},core.audio.SndMgr.prototype.stopAll=function(){this.snd.stopAll()},core.audio.SndMgr.prototype.playWithDelay=function(p_id,p_delay,p_vol,p_loop){var snd=this.snd;return this.timeout.delay(function(){snd.play(p_id,p_vol,p_loop)},p_delay)},core.audio.SndMgr.prototype.cancelDelayedSounds=function(){this.timeout.purge()},core.audio.SndMgr.prototype.isPlaying=function(id){return this.webAudio?this.snd.isPlaying(id):this.snd.isPlaying()},core.audio.SndMgr.prototype.update=function(delta){this.updateList.update(delta),this.snd.update(delta)},core.audio.SndMgr.prototype.fadeOut=function(id,time){this.webAudio&&this.snd.fadeOut(id,time)},core.audio.SndMgr.prototype.fadeIn=function(id,time,vol){this.webAudio?this.snd.fadeIn(id,time,vol):this.snd.play(id)},core.audio.SndMgr.prototype.mute=function(bool){this.isMuted=bool,this.snd.mute(bool)},core.audio.SndMgr.prototype.muteGroup=function(grp,bool){this.snd.muteGroup(grp,bool)},core.audio.SndMgr.prototype.isGroupMuted=function(groupId){return this.snd.isGroupMuted(groupId)},core.audio.SndMgr.prototype.muteAllGroups=function(bool){this.snd.muteAllGroups(bool)},core.audio.SndMgr.prototype.prepare=function(){this.webAudio?this.snd.wakeAudioSystem():this.snd.preload()},core.audio.SndMgr.prototype.removeSounds=function(data){this.webAudio&&data&&this.snd.removeSounds(data)},core.audio.SndMgr.prototype.purge=function(){this.webAudio&&(this.timeout.purge(),this.snd.purge())},core.audio.SndMgr.prototype.initNone=function(){this.snd&&this.snd.dispose(),this.mode=this.audioModes.NONE,this.snd=new core.audio.SndNone},core.audio.SndMgr.prototype.checkReady=function(){return null!==this.snd},Object.defineProperties(core.audio.SndMgr.prototype,{isReady:{get:function(){return this.checkReady()}},webAudio:{get:function(){return this.mode===core.audio.AudioModes.WEB_AUDIO}}}),core.display.Stage=function(){this.centerV=!0,this.scaleModes=core.settings.SCALE_MODES,this.maxDPR=2},core.display.Stage.prototype.init=function(config){this.forceCanvas=config.forceCanvas,this.isIOS=config.system&&config.system.isIOS||game_shell.system.isIOS,this.stage=new PIXI.Container,this.createRenderer(config),this.createHolder(config),this.addToDOM()},core.display.Stage.prototype.resize=function(settings){var resolution=this.renderer.resolution,dpr=window.devicePixelRatio||1;if(!this.isIOS){var isCanvas=2===this.renderer.type;isCanvas&&dpr>this.maxDPR&&(dpr=this.maxDPR)}var configHeight=settings.height;this.content.scale.set(dpr);var scale=configHeight*resolution/settings.pixelHeight,aspectRatio=settings.pixelWidth/settings.pixelHeight,croppedWidth=configHeight*aspectRatio,pixelW=croppedWidth*dpr,pixelH=configHeight*dpr;this.renderer.resize(pixelW,pixelH),this.content.x=.5*pixelW,this.content.y=.5*pixelH;var scaledW,scaledH,isPortrait=game_shell.viewport.isPortrait;isPortrait?(scaledW=configHeight/scale,scaledH=croppedWidth/scale):(scaledW=croppedWidth/scale,scaledH=configHeight/scale);var canvasCSSWidth=scaledW*resolution,canvasCSSHeight=scaledH*resolution,canvasElement=this.renderer.view;canvasElement.style.width=canvasCSSWidth+"px",canvasElement.style.height=canvasCSSHeight+"px",this.draw()},core.display.Stage.prototype.createRenderer=function(config){var settings=config.settings;"undefined"==typeof settings.backgroundColor&&(settings.backgroundColor=0),this.forceCanvas?this.renderer=new PIXI.CanvasRenderer(config.width,config.height,settings):this.renderer=PIXI.autoDetectRenderer(config.width,config.height,settings)},core.display.Stage.prototype.createHolder=function(config){this.content=new PIXI.Container,this.content.x=.5*config.width,this.stage.addChild(this.content)},core.display.Stage.prototype.draw=function(){this.renderer.render(this.stage)},core.display.Stage.prototype.addToDOM=function(){var view=this.renderer.view,gameDiv=document.getElementById("game");gameDiv.appendChild(view),view.style.marginLeft="auto",view.style.marginRight="auto",view.style.display="block"},core.display.Quad=function(p_w,p_h,p_color,p_alpha){PIXI.Graphics.call(this),"undefined"==typeof p_color&&(p_color=16711680),this.tint=p_color,"undefined"==typeof p_h&&(p_h=100),"undefined"==typeof p_w&&(p_w=100),"object"==typeof p_w?this.fromRect(p_w):(this._width=p_w,this._height=p_h),this.drawQuad(),"undefined"==typeof p_alpha&&(p_alpha=1),this.alpha=p_alpha,this.hitArea=new PIXI.Rectangle(0,0,this._width,this._height)},core.display.Quad.prototype=Object.create(PIXI.Graphics.prototype),core.display.Quad.prototype.constructor=core.display.Quad,core.display.Quad.prototype.fromRect=function(rect){this._width=this.hitArea.width=rect.width,this._height=this.hitArea.height=rect.height,this.x=rect.x,this.y=rect.y,this.drawQuad()},core.display.Quad.prototype.drawQuad=function(){this.clear(),this.beginFill(this.tint),this.drawRect(0,0,this._width,this._height),this.endFill()},Object.defineProperties(core.display.Quad.prototype,{width:{get:function(){return this._width},set:function(value){this._width=value,this.drawQuad(),this.hitArea.width=value}},height:{get:function(){return this._height},set:function(value){this._height=value,this.drawQuad(),this.hitArea.height=value}}}),core.display.Circle=function(p_radius,p_color){PIXI.Graphics.call(this),this.tint="undefined"!=typeof p_color?p_color:16711680,this.radius="undefined"!=typeof p_radius?p_radius:50},core.display.Circle.prototype=Object.create(PIXI.Graphics.prototype),core.display.Circle.prototype.constructor=core.display.Circle,Object.defineProperty(core.display.Circle.prototype,"radius",{get:function(){return this._radius},set:function(value){this._radius=value,this.clear(),this.beginFill(this.tint),this.drawCircle(0,0,this._radius),this.endFill()}}),core.display.Button=function(p_upImgId,p_downImgId,p_disabledImgId){"string"==typeof p_upImgId?this.txUp=PIXI.utils.TextureCache[p_upImgId]:this.txUp=p_upImgId,PIXI.Sprite.call(this,this.txUp),this.upScale=1,this.downScale=1,this._pressed=!1,this.evtPress="press",this.evtRelease="release",this.evtReleaseOutside="release_outside",this.touchstart=this._touchstart.bind(this),this.on("mousedown",this.touchstart),this.on("touchstart",this.touchstart),this.touchend=this._touchend.bind(this),this.on("mouseup",this.touchend),this.on("touchend",this.touchend),this.touchendoutside=this._touchendoutside.bind(this),this.on("mouseupoutside",this.touchendoutside),this.on("touchendoutside",this.touchendoutside),this.enabled=!0,this.createHitArea(),this.setAdditionalTextures(p_downImgId,p_disabledImgId)},core.display.Button.prototype=Object.create(PIXI.Sprite.prototype),core.display.Button.prototype.constructor=core.display.Button,core.display.Button.prototype.setAdditionalTextures=function(p_downImgId,p_disabledImgId){var downType=typeof p_downImgId;p_downImgId&&"undefined"!==downType?("string"===downType?this.txDown=PIXI.utils.TextureCache[p_downImgId]:this.txDown=p_downImgId,this.downScale=1):(this.txDown=null,this.downScale=.95,this.pivot.x=.5*this.hitArea.width,this.pivot.y=.5*this.hitArea.height);var disabledType=typeof p_disabledImgId;disabledType&&"undefined"!==disabledType?"string"===disabledType?this.txDisabled=PIXI.utils.TextureCache[disabledType]:this.txDisabled=disabledType:this.txDisabled=null},core.display.Button.prototype.createHitArea=function(){var w=this.txUp.frame.width,h=this.txUp.frame.height;this.hitArea=new PIXI.Rectangle(0,0,w,h)},core.display.Button.prototype._touchstart=function(){this.txDown?this.texture=this.txDown:this.scale.x=this.scale.y=this.downScale,this._pressed=!0,this.emit(this.evtPress)},core.display.Button.prototype._touchend=function(){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtRelease))},core.display.Button.prototype._touchendoutside=function(){this._pressed&&(this._pressed=!1,this.restore(),this.emit(this.evtReleaseOutside))},core.display.Button.prototype.restore=function(){this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this.texture!==this.txUp&&(this.texture=this.txUp)},Object.defineProperty(core.display.Button.prototype,"enabled",{get:function(){return this.interactive},set:function(bool){this.interactive=bool,this.buttonMode=bool,this.txDisabled&&(bool?this.texture=this.txUp:this.texture=this.txDisabled)}}),core.display.Toggle=function(p_onImg,p_offImg,p_on){this.isOn=p_on!==!1,this.txOn=this.getTexture(p_onImg),this.txOff=this.getTexture(p_offImg),this.upScale=1,this.downScale=.95;var tx=this.isOn?this.txOn:this.txOff;PIXI.Sprite.call(this,tx),this.touchstart=this._touchstart.bind(this),this.on("mousedown",this.touchstart),this.on("touchstart",this.touchstart),this.touchend=this._touchend.bind(this),this.on("mouseup",this.touchend),this.on("touchend",this.touchend),this.touchendoutside=this._touchendoutside.bind(this),this.on("mouseupoutside",this.touchendoutside),this.on("touchendoutside",this.touchendoutside),this.anchor.x=this.anchor.y=.5,this.createHitArea(),this.enabled=!0},core.display.Toggle.prototype=Object.create(PIXI.Sprite.prototype),core.display.Toggle.prototype.constructor=core.display.Toggle,core.display.Toggle.prototype.getTexture=function(p_img){var tx=null;return tx="string"==typeof p_img?PIXI.utils.TextureCache[p_img]:p_img},core.display.Toggle.prototype.createHitArea=function(){var w=this.txOn.frame.width,h=this.txOn.frame.height,x=w*-this.anchor.x,y=h*-this.anchor.x;this.hitArea=new PIXI.Rectangle(x,y,w,h)},core.display.Toggle.prototype._touchstart=function(event){this._pressed=!0,this.scale.x=this.scale.y=this.downScale},core.display.Toggle.prototype._touchend=function(event){this._pressed&&(this._pressed=!1,this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this.toggle())},core.display.Toggle.prototype._touchendoutside=function(event){this._pressed&&(this.downScale<1&&(this.scale.x=this.scale.y=this.upScale),this._pressed=!1)},core.display.Toggle.prototype.toggle=function(){this.isOn=!this.isOn,this.isOn?this.texture=this.txOn:this.texture=this.txOff,this.emit("toggle")},core.display.Toggle.prototype.setOff=function(){this.texture=this.txOff,this.isOn=!1},core.display.Toggle.prototype.setOn=function(){this.texture=this.txOn,this.isOn=!0},Object.defineProperty(core.display.Toggle.prototype,"enabled",{get:function(){return this.interactive},set:function(value){this.interactive=value,this.buttonMode=value}}),core.display.MovieClip=function(textures){PIXI.Sprite.call(this,textures[0]),this.textures=textures,this.eventComplete="complete",this.loop=!0,this._fps=25,this.onComplete=null,this.currentFrame=0,this.currentTime=0,this.playing=!1,this.duration=0,this.lastFrame=0,this.setDuration()},core.display.MovieClip.prototype=Object.create(PIXI.Sprite.prototype),core.display.MovieClip.prototype.constructor=core.display.MovieClip,core.display.MovieClip.prototype.gotoAndPlay=function(frameNumber){return this.gotoAndStop(frameNumber),this.playing=!0,this},core.display.MovieClip.prototype.gotoAndStop=function(frameNumber){this.playing=!1,this.currentTime=frameNumber*(1e3/this._fps),this.currentFrame=frameNumber;var round=this.currentFrame+.5|0;return this.texture=this.textures[round%this.textures.length],this},core.display.MovieClip.prototype.stop=function(){return this.playing=!1,this},core.display.MovieClip.prototype.play=function(){return this.playing=!0,this},core.display.MovieClip.prototype.setFPS=function(fps){return this._fps=fps,this.setDuration(),this},core.display.MovieClip.prototype.updateTransform=function(){PIXI.Sprite.prototype.updateTransform.call(this)},core.display.MovieClip.prototype.setDuration=function(){var l=this.textures.length;return this.duration=1e3/this._fps*l,this.lastFrame=l-1,this},core.display.MovieClip.prototype.update=function(elapsed){if(this.playing){this.currentTime+=elapsed,this.currentTime>this.duration&&(this.loop?this.currentTime-=this.duration:(this.currentTime=this.duration,this.stop(),this.isComplete=!0,this.onComplete&&this.onComplete(),this.emit(this.eventComplete)));var frameIndex=Math.floor(this.currentTime/this.duration*(this.lastFrame+1));frameIndex>this.lastFrame&&(frameIndex=this.lastFrame),this.currentFrame=frameIndex,this.texture=this.textures[this.currentFrame]}},Object.defineProperties(core.display.MovieClip.prototype,{totalFrames:{get:function(){return this.textures.length}},fps:{get:function(){return this._fps},set:function(value){this.setFPS(value)}}}),core.display.MaskJpeg=function(jpegImg,pngMask,callback){var txImg=jpegImg,txMask=pngMask,canvasImg=document.createElement("canvas");canvasImg.width=txImg.width,canvasImg.height=txImg.height;var ctxImg=canvasImg.getContext("2d");ctxImg.drawImage(txImg,0,0),ctxImg.globalCompositeOperation="xor",ctxImg.drawImage(txMask,0,0);var img=new Image;return callback&&(img.onload=function(){callback(img)}),img.src=canvasImg.toDataURL(),img},core.display.CropSprite=function(sprite){this.sprite=null,this.useCopy=!0,core.utils.EventDispatcher.call(this),sprite&&this.init({sprite:sprite})},core.display.CropSprite.prototype=Object.create(core.utils.EventDispatcher.prototype),core.display.CropSprite.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.copyFrame()},core.display.CropSprite.prototype.copyFrame=function(){if(this.realFrame=this.sprite.texture.frame,this.frame=new PIXI.Rectangle(this.realFrame.x,this.realFrame.y,this.realFrame.width,this.realFrame.height),this.useCopy){var baseTexture=this.sprite.texture.baseTexture;this.sprite.texture=new PIXI.Texture(baseTexture,this.frame)}else this.sprite.texture.frame=this.frame},Object.defineProperties(core.display.CropSprite.prototype,{width:{get:function(){return this.frame.width},set:function(value){this.setWidth(value)}},height:{get:function(){return this.frame.height},set:function(value){this.setHeight(value)}},heightAlt:{get:function(){return this.frame.height},set:function(value){this.setHeightAlt(value)}},x:{get:function(){return this.sprite.x},set:function(value){this.sprite.x=value}},y:{get:function(){return this.sprite.y},set:function(value){this.sprite.y=value}},visible:{get:function(){return this.sprite.visible},set:function(bool){this.sprite.visible=bool}},fullHeight:{get:function(){return this.realFrame.height}},fullWidth:{get:function(){return this.realFrame.width}}}),core.display.CropSprite.prototype.setWidth=function(value){this.frame.width=value,this.sprite.texture.crop.width=this.frame.width,this.sprite.texture.width=this.frame.width,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs(),this.sprite.width=this.frame.width},core.display.CropSprite.prototype.setHeight=function(value){this.frame.height=value,this.sprite.texture.crop.height=this.frame.height,this.sprite.texture.height=this.frame.height,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs(),this.sprite.height=this.frame.height},core.display.CropSprite.prototype.setHeightAlt=function(value){this.setHeight(value),this.frame.y=this.realFrame.y+this.realFrame.height-value,this.sprite.texture.crop.y=this.frame.y},core.display.CropSprite.prototype.restore=function(){this.sprite.texture.frame=this.realFrame,this.sprite.texture.crop.width=this.realFrame.width,this.sprite.texture.width=this.realFrame.width,this.sprite.texture.crop.y=this.realFrame.y,this.sprite.texture.crop.height=this.realFrame.height,this.sprite.texture.height=this.realFrame.height,this.sprite.texture.requiresUpdate=!0,this.sprite.texture._updateUvs()},core.display.CropSprite.prototype.slideUp=function(y,time,amount){var fullH=amount||this.realFrame.height,distY=fullH/this.resolution;this.y=y+distY,this.height=0,new TWEEN.Tween(this).to({height:fullH,y:y},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onUp).start()},core.display.CropSprite.prototype.revealUp=function(y,time,amount){var fullH=amount||this.realFrame.height;time||(time=600),this.heightAlt=0,new TWEEN.Tween(this).to({heightAlt:fullH},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onUp).start()},core.display.CropSprite.prototype.revealDown=function(time,amount){new TWEEN.Tween(this).to({heightAlt:0},time).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onDown).start()},core.display.CropSprite.prototype.slideDown=function(time,delay){var y=this.y,delay=delay||0,targetY=y+this.height/this.resolution;new TWEEN.Tween(this).to({height:0,y:targetY},time).delay(delay).easing(TWEEN.Easing.Quadratic.Out).onComplete(this.onDown).start()},core.display.CropSprite.prototype.onUp=function(){},core.display.CropSprite.prototype.onDown=function(){},core.screens.ScreenBase=function(config){PIXI.Container.call(this),this.screenW=0,this.screenH=0,this.defaultW=0,this.defaultH=0,this.resolution=1,this.eventQueue=null,this.lastScreenId=null,this.snd=null;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);core.utils.UpdateList.prototype.mixin(this),this.delayedAction=new core.utils.DelayedAction,this.addUpdateItem(this.delayedAction)},core.screens.ScreenBase.prototype=Object.create(PIXI.Container.prototype),core.screens.ScreenBase.prototype.constructor=core.screens.ScreenBase,core.screens.ScreenBase.prototype.run=function(){},core.screens.ScreenBase.prototype.resize=function(p_w,p_h){this.screenW=p_w,this.screenH=p_h},core.screens.ScreenBase.prototype.getSceneConfig=function(){return{screenW:this.screenW,screenH:this.screenH,defaultW:this.defaultW,defaultH:this.defaultH,eventQueue:this.eventQueue,snd:this.snd,resolution:this.resolution}},core.screens.ScreenBase.prototype.createScene=function(SceneClass){var scene=new SceneClass;scene.init(this.getSceneConfig()),this.addChild(scene.root),this.addUpdateItem(scene.updateList);var self=this;return scene.bus.on("screen",function(event){self.newScreen(event.id)}),scene},core.screens.ScreenBase.prototype.delay=function(callback,p_ms){this.delayedAction.delay(callback,p_ms)},core.screens.ScreenBase.prototype.render=function(delta){},core.screens.ScreenBase.prototype.newScreen=function(p_screenId){var event;"string"==typeof p_screenId?event={type:"new_screen",screenId:p_screenId}:(event=p_screenId,event.type="new_screen"),this.eventQueue.queueEvent(event)},core.screens.ScreenBase.prototype.dispose=function(){this.removeFromParent(),this.updateItems.length=0,this.delayedAction.dispose(),this.removeAllListeners()},core.screens.LoadScreen=function(config){core.screens.ScreenBase.call(this,config)},core.screens.LoadScreen.prototype=Object.create(core.screens.ScreenBase.prototype),core.screens.LoadScreen.prototype.constructor=core.screens.LoadScreen,core.screens.LoadScreen.prototype.run=function(){if(this.loadBar=this.createBar(),this.loadComplete=this._loadComplete.bind(this),game_shell.loader.isLoading){var self=this;game_shell.loader.on("progress",function(event){self.loadBar.progress(event.value)}),game_shell.loader.on("complete",this.loadComplete)}else this.loadComplete()},core.screens.LoadScreen.prototype._loadComplete=function(){this.loadBar.progress(1),this.fadeOut()},core.screens.LoadScreen.prototype.fadeOut=function(){var self=this;new TWEEN.Tween(this.loadBar).to({alpha:0},500).onComplete(function(){self.newScreen(self.targetScreen)}).start()},core.screens.LoadScreen.prototype.createBar=function(){var w=200,h=30,loadBar=new core.ui.LoadBar(w,h,0,16777215);return loadBar.pivot.x=.5*w,loadBar.pivot.y=.5*h,this.addChild(loadBar),loadBar},core.screens.TitleScreen=function(config){core.screens.ScreenBase.call(this,config)},core.screens.TitleScreen.prototype=Object.create(core.screens.ScreenBase.prototype),core.screens.TitleScreen.prototype.constructor=core.screens.TitleScreen,core.screens.TitleScreen.prototype.run=function(){},core.screens.ScreenMgr=function(){this.currentScreen=null,this.lastScreenId=null,this.stage=null,this.snd=null,this.eventQueue=null,this.resolution=1},core.screens.ScreenMgr.prototype=Object.create(core.utils.EventDispatcher.prototype),core.screens.ScreenMgr.prototype.constructor=core.screens.ScreenMgr,core.screens.ScreenMgr.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.showScreen=this._showScreen.bind(this),this.eventQueue.on("new_screen",this.showScreen)},core.screens.ScreenMgr.prototype.getScreenConfig=function(p_event){var config="string"==typeof p_event?{screenId:p_event}:p_event;return config.screenW=this.settings.STAGE_W,config.screenH=this.settings.STAGE_H,config.defaultW=this.settings.DEFAULT_W,config.defaultH=this.settings.DEFAULT_H,config.resolution=this.resolution,config.eventQueue=this.eventQueue,config.lastScreenId=this.lastScreenId,config.snd=this.snd,config},core.screens.ScreenMgr.prototype.resize=function(settings){if(null!==this.currentScreen){var pointW=settings.pointWidth,pointH=settings.pointHeight;this.currentScreen.resize(pointW,pointH)}},core.screens.ScreenMgr.prototype.displayScreen=function(event){this.disposeScreen();var config=this.getScreenConfig(event);this.currentScreen=this.createScreen(config),this.stage.content.addChild(this.currentScreen),this.currentScreen.run()},core.screens.ScreenMgr.prototype._showScreen=function(data,callback){var config="string"==typeof data?{screenId:data}:data,screenId=config.screenId,manifest=this.getManifestPath(screenId);config.reload?(delete config.reload,this.loadWithManifest(config,manifest,callback)):manifest&&this.currentManifest!==manifest?(this.unloadScreen(),this.loadWithManifest(config,manifest,callback)):this.displayScreen(config)},core.screens.ScreenMgr.prototype.loadWithManifest=function(screenId,manifest,callback){this.currentManifest=manifest;var self=this;game_shell.loader.on("manifest_json",function(event){self.addToManifestJSON(screenId,event.data)}),game_shell.loader.on("manifest_loaded",function(){var data=game_shell.loader.getManifest();self.customizeManifest(screenId,data)}),"function"==typeof callback&&game_shell.loader.on("complete",function(){callback()}),game_shell.loader.load(manifest,!1),this.eventQueue.queueEvent({type:"new_screen",screenId:"load",targetScreen:screenId})},core.screens.ScreenMgr.prototype.merge=function(target,source){var i,n=source.length;for(i=0;i<n;i++)target[target.length]=source[i]},core.screens.ScreenMgr.prototype.getManifestPath=function(screenId){return core.settings.JSON_DIR+"asset_manifest.json"},core.screens.ScreenMgr.prototype.addToManifestJSON=function(screenId,jsonData){},core.screens.ScreenMgr.prototype.customizeManifest=function(screenId,data){},core.screens.ScreenMgr.prototype.unloadScreen=function(){game_shell.spineUtils&&game_shell.spineUtils.purge(),game_shell.snd.removeSounds(game_shell.loader.webAudioManifest),game_shell.loader.unload()},core.screens.ScreenMgr.prototype.createScreen=function(p_event){var screen,scr=core.screens,screenId="string"==typeof p_event?p_event:p_event.screenId;switch(screenId){case"load":screen=new scr.LoadScreen(p_event);break;case"title":screen=new scr.TitleScreen(p_event)}return screen},core.screens.ScreenMgr.prototype.update=function(p_time){this.currentScreen&&this.currentScreen.update(p_time)},core.screens.ScreenMgr.prototype.render=function(p_delta){this.currentScreen&&this.currentScreen.render(p_delta)},core.screens.ScreenMgr.prototype.disposeScreen=function(){null!==this.currentScreen&&("load"!==this.currentScreen.screenId&&(this.lastScreenId=this.currentScreen.screenId),this.currentScreen.dispose(),this.currentScreen=null)},core.screens.SceneBuilder=function(){this.scene=null,this.root=null,this.screenW=0,this.screenH=0,this.resolution=1},core.screens.SceneBuilder.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.scene.root=new PIXI.Container,this.scene.bus=new core.utils.EventQueue,this.scene.timeout=new core.utils.DelayedAction,this.scene.updateList=new core.utils.UpdateList,this.scene.updateList.add(this.scene.bus),this.scene.update&&this.scene.updateList.add(this.scene),this.scene.updateList.add(this.scene.timeout)},core.ui.LoadBar=function(p_w,p_h,p_color,p_color2){PIXI.Container.call(this);var c1=p_color||0,bg=new PIXI.Graphics;bg.beginFill(c1,1);var lineW=5,half=.5*lineW;bg.lineStyle(lineW,16777215,1),bg.drawRect(-half,-half,p_w+lineW,p_h+lineW),bg.endFill(),this.addChild(bg);var c2=p_color2||13408512,barW=p_w+lineW,barH=p_h+lineW;this.fullW=barW;var prgBar=new core.display.Quad(barW,barH,c2);prgBar.x=-half,prgBar.y=-half;var fg=new PIXI.Graphics;fg.beginFill(c1,0),fg.lineStyle(lineW,16777215,1),fg.moveTo(0,0),fg.lineTo(p_w,0),fg.lineTo(p_w,p_h),fg.lineTo(0,p_h),fg.lineTo(0,0),fg.endFill(),this.addChild(fg),this.progress=function(p_amount){prgBar.width=p_amount*this.fullW,1===p_amount&&this.complete()},this.complete=function(){prgBar.width=this.fullW,fg.visible=!1,bg.visible=!1},this.progress(0),this.addChild(prgBar)},core.ui.LoadBar.prototype=Object.create(PIXI.Container.prototype),core.ui.LoadBar.prototype.constructor=core.ui.LoadBar,core.ui.PopupBase=function(){this.quadAlpha=.5,this.fadeTime=250,this.tweenTime=750,this.minScale=.001,this.eventOpen={type:"open"},this.eventShut={type:"shut"},this.states={HIDDEN:0,OPENING:1,SHOWN:2,CLOSING:3},this.state=this.states.HIDDEN,this.root=new PIXI.Container,this.bgQuad=this.createQuad(),this.content=this.createContentHolder(),this.tweenOpen=this.createTweenOpen(),this.tweenShut=this.createTweenShut(),this.tweenQuadIn=this.createTweenQuadIn(),this.tweenQuadOut=this.createTweenQuadOut()},core.ui.PopupBase.prototype=Object.create(core.utils.EventDispatcher.prototype),core.ui.PopupBase.prototype.constructor=core.ui.PopupBase,core.ui.PopupBase.prototype.createQuad=function(){var w=core.settings.DEFAULT_W+2,h=core.settings.DEFAULT_H,bgQuad=new core.display.Quad(w,h,0);return bgQuad.alpha=0,bgQuad.x=w*-.5,bgQuad.y=h*-.5,this.root.addChild(bgQuad),bgQuad},core.ui.PopupBase.prototype.createContentHolder=function(){var content=new PIXI.Container;return this.root.addChild(content),content},core.ui.PopupBase.prototype.show=function(){this.state===this.states.HIDDEN&&(this.state=this.states.OPENING,this.bgQuad.alpha=0,this.content.scale.x=this.minScale,this.content.scale.y=this.minScale,this.tweenQuadIn.start(),this.tweenOpen.start())},core.ui.PopupBase.prototype.createTweenQuadIn=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:this.quadAlpha},this.fadeTime)},core.ui.PopupBase.prototype.createTweenQuadOut=function(){return new TWEEN.Tween(this.bgQuad).to({alpha:0},this.fadeTime)},core.ui.PopupBase.prototype.createTweenOpen=function(){var self=this;return new TWEEN.Tween(this.content.scale).to({x:1,y:1},this.tweenTime).easing(TWEEN.Easing.Back.Out).onComplete(function(){self.state=self.states.SHOWN,self.onShown()})},core.ui.PopupBase.prototype.onShown=function(){this.emit(this.eventOpen)},core.ui.PopupBase.prototype.hide=function(){this.state!==this.states.CLOSING&&(this.state=this.states.CLOSING,this.tweenQuadOut.start(),this.tweenShut.start())},core.ui.PopupBase.prototype.createTweenShut=function(){var self=this;return new TWEEN.Tween(this.content.scale).to({x:this.minScale,y:this.minScale},this.tweenTime).easing(TWEEN.Easing.Back.In).onComplete(function(){
self.state=self.states.HIDDEN,self.onHidden()})},core.ui.PopupBase.prototype.onHidden=function(){this.emit(this.eventShut)},Object.defineProperty(core.ui.PopupBase.prototype,"isShown",{get:function(){var isShownVar=this.state===this.states.SHOWN,isOpening=this.state===this.states.OPENING;return isShownVar||isOpening}}),core.ui.Carousel=function(){this.items=[],this._x=0,this.isMoving=!1,this.loops=!1,this.minX=0,this.maxX=0,this.sign=0,this.itemW=0,this.draggedX=0,this.duration=333,this.tweenManager=TWEEN,core.utils.EventDispatcher.prototype.apply(this)},core.ui.Carousel.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.evtStart={type:"start",sign:0,itemW:this.itemW,x:0,dist:0},this.evtComplete={type:"complete",focus:null},0===this.minX&&(this.minX=-this.itemW),0===this.maxX&&(this.maxX=this.itemW),this.tween=this.createTween()},core.ui.Carousel.prototype.createTween=function(){var tween=new this.tweenManager.Tween(this),self=this;return tween.onStart(function(){self.tweenStart(self.sign)}),tween.onComplete(function(){self.moveComplete.call(self)}),tween},core.ui.Carousel.prototype.start=function(sign){if(!this.isMoving){if(!this.loops){var canMove=this.checkMove(sign);if(!canMove)return}var start=this.draggedX/this.itemW,amount=start<0?1+start:1-start,duration=this.duration*amount;this._x=start,this.draggedX=0,this.isMoving=!0,this.sign=sign,this.tween.to({x:sign},duration).start()}},core.ui.Carousel.prototype.checkMove=function(sign){var canMove=!0,currentFocus=this.findFocus(),currentIndex=currentFocus.index;return 0===currentIndex&&sign>0?canMove=!1:currentIndex===this.items.length-1&&sign<0&&(canMove=!1),canMove},core.ui.Carousel.prototype.toNearest=function(){if(!this.isMoving){var sign=0,start=this.draggedX/this.itemW,amount=start<0?1+start:1-start,duration=this.duration*amount,absDrag=this.draggedX>0?this.draggedX:-this.draggedX,minDrag=.25*this.itemW;sign=absDrag>minDrag?this.draggedX>0?1:-1:0,this.checkMove(sign)||(sign=0),this.draggedX=0,this.isMoving=!0,this._x=start,this.sign=sign,this.tween.to({x:sign},duration).start()}},core.ui.Carousel.prototype.tweenStart=function(sign){var dist,x=this._x*this.itemW;if(this.loops)dist=sign>0?this.itemW-x:sign<0?0-(this.itemW+x):this.distToNearest(x);else{var currentFocus=this.findFocus(),currentIndex=currentFocus.index;dist=0===currentIndex&&sign>-1?0-(this.itemW+x):currentIndex===this.items.length-1&&sign<1?this.itemW-x:sign>0?this.itemW-x:sign<0?0-(this.itemW+x):this.distToNearest(x)}this.evtStart.dist=dist,this.evtStart.x=this._x,this.evtStart.sign=sign,this.emit(this.evtStart)},core.ui.Carousel.prototype.distToNearest=function(x){var dist,half=this.itemW/2;return dist=x>0?x>half?this.itemW-x:-x:x<-half?0-(this.itemW+x):-x},core.ui.Carousel.prototype.moveStart=function(){var i,item,n=this.items.length;for(i=0;i<n;i++)item=this.items[i],item.start=item.root.x},core.ui.Carousel.prototype.moveComplete=function(){if(this.isMoving=!1,this.loops){var item=null;this.sign>0?(item=this.findRightmost(),item.root.x=this.minX):this.sign<0&&(item=this.findLeftmost(),item.root.x=this.maxX)}this.moveStart(),this.evtComplete.focus=this.findFocus(),this.emit(this.evtComplete)},core.ui.Carousel.prototype.findRightmost=function(){var i,item,rightmost=this.items[0],n=this.items.length;for(i=1;i<n;i++)item=this.items[i],item.root.x>rightmost.root.x&&(rightmost=item);return rightmost},core.ui.Carousel.prototype.findLeftmost=function(){var i,item,leftmost=this.items[0],n=this.items.length;for(i=1;i<n;i++)item=this.items[i],item.root.x<leftmost.root.x&&(leftmost=item);return leftmost},core.ui.Carousel.prototype.findFocus=function(){var i,item,x,center=this.items[0],n=this.items.length;for(i=1;i<n;i++)item=this.items[i],x=item.root.x,x<0&&(x=-x),x<Math.abs(center.root.x)&&(center=item);return center},core.ui.Carousel.prototype.add=function(item){var x=item.root.x,index=this.items.length;this.items[index]={start:x,index:index,itemW:this.itemW,item:item,root:item.root},x<this.minX?this.minX=x:x>this.maxX&&(this.maxX=x),this.moveStart()},core.ui.Carousel.prototype.dragItems=function(distance){this.draggedX+=distance;var i,wrapper,amount,n=this.items.length;for(i=0;i<n;i++)wrapper=this.items[i],wrapper.root.x+=distance,amount=this.draggedX/this.itemW,wrapper.item.move&&wrapper.item.move(amount)},core.ui.Carousel.prototype.moveItems=function(amount){var i,wrapper,n=this.items.length;for(i=0;i<n;i++)wrapper=this.items[i],wrapper.root.x=wrapper.start+amount*this.itemW,wrapper.item.move&&wrapper.item.move(amount)},core.ui.Carousel.prototype.jumpToItem=function(item){var i,wrapper,n=this.items.length;if(this.loops){var newX,totalDist=this.maxX+9e3-(this.minX+9e3)+this.itemW,distanceToMove=-item.root.x;for(i=0;i<n;i++)wrapper=this.items[i],newX=wrapper.start+distanceToMove,newX<this.minX?newX+=totalDist:newX>this.maxX&&(newX-=totalDist),wrapper.root.x=newX}else{var shift=-item.root.x;for(i=0;i<n;i++)wrapper=this.items[i],wrapper.root.x=wrapper.start+shift}this.moveStart()},core.ui.Carousel.prototype.findWrapperByItem=function(item){var i,wrapper,n=this.items.length,result=null;for(i=0;i<n;i++)if(wrapper=this.items[i],wrapper.item===item){result=wrapper;break}return result},Object.defineProperties(core.ui.Carousel.prototype,{x:{get:function(){return this._x},set:function(value){this._x=value,this.moveItems(this._x)}},currentItem:{get:function(){var wrapperItem=this.findFocus();return wrapperItem.item},set:function(item){}},leftItem:{get:function(){var wrapperItem=this.findFocus(),index=this.items.indexOf(wrapperItem),length=this.items.length-1,leftIndex=index>0?index-1:length,leftItem=this.items[leftIndex];return leftItem.item}},rightItem:{get:function(){var wrapperItem=this.findFocus(),index=this.items.indexOf(wrapperItem),length=this.items.length-1,rightIndex=index<length?index+1:0,rightItem=this.items[rightIndex];return rightItem.item}}}),core.ui.CarouselItem=function(){this.root=null,this.data=null,this.index=0,this.size=100,this.pt=new PIXI.Point},core.ui.CarouselItem.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.root=new PIXI.Container,config.image&&(this.sprite=this.createSprite(config.image,this.root))},core.ui.CarouselItem.prototype.createSprite=function(imageId,root){var sprite=new PIXI.Sprite(PIXI.utils.TextureCache[imageId]);return sprite.anchor.set(.5),root.addChild(sprite),sprite},core.ui.CarouselItem.prototype.hitTest=function(iData){iData.getLocalPosition(this.root,this.pt);var range=this.size,hitX=this.pt.x>-range&&this.pt.x<range,hitY=this.pt.y>-range&&this.pt.y<range;return hitX&&hitY},core.ui.CarouselItem.prototype.move=function(){},Object.defineProperties(core.ui.CarouselItem.prototype,{x:{get:function(){return this.root.x},set:function(value){this.root.x=value}}}),core.ui.CarouselItem.prototype.addDebug=function(){var text=new PIXI.Text(this.index.toString(),{font:"bold 20px Arial",fill:"#000000"},this.resolution);this.root.addChild(text),text.y=-110},core.motion.Wiggle=function(p_displayObj,p_maxRotation){core.utils.EventDispatcher.call(this),this.img=p_displayObj,this.baseR=p_displayObj.rotation,void 0===p_maxRotation&&(p_maxRotation=.15),this.maxR=Math.PI*p_maxRotation,this.speed=.017,this.counter=0,this.duration=30},core.motion.Wiggle.prototype=Object.create(core.utils.EventDispatcher.prototype),core.motion.Wiggle.prototype.constructor=core.motion.Wiggle,core.motion.Wiggle.prototype.startWiggle=function(){this.counter=0},core.motion.Wiggle.prototype.update=function(delta){this.wiggle(delta)},core.motion.Wiggle.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;return this.img.rotation=l_nNewRotation,l_nNewRotation},core.motion.Twanger=function(p_displayObj,p_max){core.motion.Wiggle.call(this,p_displayObj,p_max),this.scale=1,this.decay=.95,this.MAX_R=.349,this.maxR=0,this.minR=.017},core.motion.Twanger.prototype=Object.create(core.motion.Wiggle.prototype),core.motion.Twanger.prototype.constructor=core.motion.Twanger,core.motion.Twanger.prototype.start=function(){this.maxR=this.MAX_R},Object.defineProperty(core.motion.Twanger.prototype,"isTwanging",{get:function(){return this.maxR>0}}),core.motion.Twanger.prototype.update=function(time){var isMoving=!1;return this.maxR>this.minR&&(this.wiggle(time),this.maxR*=this.decay,this.maxR<1e-5&&(this.stopTwang(),this.dispatchEvent({type:"complete"})),isMoving=!0),isMoving},core.motion.Twanger.prototype.wiggle=function(time){this.counter+=this.speed*time;var l_nSin=Math.sin(this.counter),l_nNewRotation=this.baseR-l_nSin*this.maxR;this.img.rotation=l_nNewRotation*this.scale},core.motion.Twanger.prototype.stopTwang=function(){this.maxR=0,this.img.rotation=this.baseR},core.motion.Oscillator=function(){this.speedX=5e-4,this.speedY=5e-4,this.time=0,this.x=0,this.y=0},core.motion.Oscillator.prototype.init=function(config){config.speedX&&(this.speedX=config.speedX),config.speedY&&(this.speedY=config.speedY),config.time&&(this.time=config.time),config.x&&(this.x=config.x),config.y&&(this.y=config.y)},core.motion.Oscillator.prototype.randomise=function(){this.speedX=5e-4+.001*Math.random(),this.speedY=5e-4+.001*Math.random()},core.motion.Oscillator.prototype.reset=function(){this.time=0,this.x=0,this.y=0},core.motion.Oscillator.prototype.update=function(p_delta){this.time+=p_delta,this.x=Math.cos(this.time*this.speedX),this.y=Math.sin(this.time*this.speedY)},core.motion.SawTooth=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},core.motion.SawTooth.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max&&(newValue-=this._max),this._value=newValue},core.motion.SawTooth.prototype.reset=function(){this._value=0},Object.defineProperty(core.motion.SawTooth.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/1e3}}),Object.defineProperty(core.motion.SawTooth.prototype,"value",{get:function(){return this._value}}),core.motion.TriangleWave=function(){this._value=0,this._min=0,this._max=1,this.oscillationsPerSec=1},core.motion.TriangleWave.prototype.update=function(delta){var newValue=this._value+delta*this._step;newValue>this._max?(this._value=this._max,this._step=-this._step):newValue<this._min?(this._value=this._min,this._step=-this._step):this._value=newValue},core.motion.TriangleWave.prototype.reset=function(){this._value=this._min,this._step<0&&(this._step=-this._step)},Object.defineProperty(core.motion.TriangleWave.prototype,"oscillationsPerSec",{set:function(oscillations){this._step=oscillations/500}}),Object.defineProperty(core.motion.TriangleWave.prototype,"value",{get:function(){return this._value}}),core.motion.ScreenShaker=function(p_target){core.utils.EventDispatcher.call(this);var time=0;this.rootPt=new PIXI.Point,this.target=p_target,this.target&&(this.rootPt.x=this.target.x,this.rootPt.y=this.target.y),this.rangeX=10,this.pulse=.005,this.duration=3e3,this.init=function(config){config.hasOwnProperty("rangeX")&&(this.rangeX=config.rangeX),config.hasOwnProperty("duration")&&(this.duration=config.duration),config.hasOwnProperty("pulse")&&(this.pulse=config.pulse),config.hasOwnProperty("target")&&(this.target=config.target,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y)},this.update=function(p_delta){if(this.isActive){time+=p_delta;var pulse=Math.sin(time*this.pulse),cos=Math.cos(time);this.target.x=this.rootPt.x+cos*this.rangeX*pulse,time>this.duration&&this.end()}},this.activate=function(){time=0,this.isActive=!0,this.rootPt.x=this.target.x,this.rootPt.y=this.target.y},this.end=function(){this.isActive=!1,this.target.x=this.rootPt.x,this.dispatchEvent({type:"complete"})}},core.motion.ScreenShaker.prototype=Object.create(core.utils.EventDispatcher.prototype),core.motion.ScreenShaker.prototype.constructor=core.motion.ScreenShaker,core.motion.Pulsar=function(config){"undefined"!=typeof config&&this.init(config)},core.motion.Pulsar.prototype.init=function(config){this.target=config.target,config.hasOwnProperty("target")?this.scale=config.target.scale:config.hasOwnProperty("scale")&&(this.scale=config.scale),this.maxScale=config.maxScale||1,this.minScale=config.minScale||.95,this.scaleAmount=this.maxScale-this.minScale;var startScale=config.hasOwnProperty("startScale")?config.startScale:this.minScale;this.scale.x=this.scale.y=startScale,this.rate=config.rate||.002,this.active=config.autostart||!1,this.count=startScale===this.maxScale?0:Math.PI},core.motion.Pulsar.prototype.start=function(){this.active=!0},core.motion.Pulsar.prototype.stop=function(){this.active=!1},core.motion.Pulsar.prototype.reset=function(){this.count=0},core.motion.Pulsar.prototype.update=function(delta){if(this.active){this.count+=delta*this.rate;var sin=Math.sin(this.count),scale=this.minScale+sin*this.scaleAmount;this.scale.x=this.scale.y=scale}},core.motion.Interpolation={catmullRomInterpolation:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f);return v[0]===v[m]?(k<0&&(i=Math.floor(f=m*(1+k))),this.catmullRom(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):k<0?v[0]-(this.catmullRom(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(this.catmullRom(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):this.catmullRom(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)},catmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1},bezierInterpolation:function(v,k){for(var b=0,n=v.length-1,i=0;i<=n;i++)b+=Math.pow(1-k,n-i)*Math.pow(k,i)*v[i]*this.bernstein(n,i);return b},linear:function(p0,p1,t){return(p1-p0)*t+p0},linearInterpolation:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f);return k<0?this.linear(v[0],v[1],f):k>1?this.linear(v[m],v[m-1],m-f):this.linear(v[i],v[i+1>m?m:i+1],f-i)}},core.motion.Flasher=function(){this.target=null,this.enabled=!0,this.currentTime=0,this.timeOff=500,this.timeOn=1e3},core.motion.Flasher.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.motion.Flasher.prototype.update=function(delta){if(this.enabled&&(this.currentTime+=delta,this.currentTime>this.timeOn)){this.target.visible&&(this.target.visible=!1);var totalTime=this.timeOn+this.timeOff;this.currentTime>totalTime&&(this.currentTime-=totalTime,this.target.visible=!0)}},core.motion.Flasher.prototype.start=function(){this.target.visible=!0,this.enabled=!0,this.currentTime=0},core.motion.Flasher.prototype.stop=function(){this.target.visible=!1,this.enabled=!1},core.game.HitTest={intersects:function(Object1,Object2){var overlap=this._intersection(Object1,Object2);return overlap>0},radius:function(pt1,pt2,radius){var dist=this._distance(pt1,pt2);return dist<radius},_intersection:function(Object1,Object2){var overlap=0,obj1R=Object1.x+Object1.width,obj2R=Object2.x+Object2.width,obj1B=Object1.y+Object1.height,obj2B=Object2.y+Object2.height;if(obj1R>Object2.x&&Object1.x<obj2R&&obj1B>Object2.y&&Object1.y<obj2B){var biggestX=Math.max(Object1.x,Object2.x),smallestR=Math.min(obj1R,obj2R),overlapX=smallestR-biggestX,biggestY=Math.max(Object1.y,Object2.y),smallestB=Math.min(obj1B,obj2B),overlapY=smallestB-biggestY;overlap=Math.max(overlapX,overlapY)}return overlap},_distance:function(pt1,pt2){var distX=Math.abs(pt2.x-pt1.x),distY=Math.abs(pt2.y-pt1.y);return Math.sqrt(distX*distX+distY*distY)},containsPoint:function(point,rect){var left=rect.x,right=left+rect.width,inX=point.x>left&&point.x<right;if(!inX)return!1;var bottom=rect.y,top=bottom+rect.height,inY=point.y>bottom&&point.y<top;return inY}},core.game.Camera=function(){this.maxY=0,this.minY=0,this.maxX=0,this.minX=0,this.trackX=0,this.defaultTrackX=0,this.trackY=0,this.defaultTrackY=0,this.moveY=!1,this.target=null},core.game.Camera.prototype=Object.create(core.game.HitTest),core.game.Camera.prototype.constructor=core.game.Camera,core.game.Camera.prototype.init=function(config){this.oldX=-100,this.defaultTrackX=this.trackX=0,this.defaultTrackY=this.trackY=0;for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.maxX=this.bgW-.5*this.screenW,this.minX=-this.maxX,this.viewport=new PIXI.Rectangle(0,0,this.screenW,this.screenH),this.isInFrame=this._frameCheckRect,this.moveY?this.update=this._updateBoth:this.update=this._update},core.game.Camera.prototype.reset=function(){this.trackX=this.defaultTrackX,this.trackY=this.defaultTrackY},core.game.Camera.prototype._update=function(delta){this.move(this.target.x)},core.game.Camera.prototype.move=function(px){px!==this.oldX&&(this.oldX=px,this.scrollX(px+this.trackX))},core.game.Camera.prototype._updateBoth=function(delta){this.moveBoth(this.target)},core.game.Camera.prototype.moveBoth=function(pt){pt.x!==this.oldX&&(this.oldX=pt.x,this.scrollX(pt.x+this.trackX)),pt.y!==this.oldY&&(this.oldY=pt.y,this.scrollY(pt.y+this.trackY))},core.game.Camera.prototype.scrollX=function(px){px>this.maxX?px=this.maxX:px<this.minX&&(px=this.minX),this.scene.x=-px,this.viewport.x=px-.5*this.viewport.width},core.game.Camera.prototype.scrollY=function(py){py>this.maxY?py=this.maxY:py<this.minY&&(py=this.minY),this.scene.y=-py,this.viewport.y=py-.5*this.viewport.height},core.game.Camera.prototype._frameCheckPoint=function(x,y){if(this.moveY){var inX=x>this.viewport.x&&x<this.viewport.x+this.viewport.width;if(!inX)return!1;var inY=y>this.viewport.y&&y<this.viewport.y+this.viewport.height;return inX&&inY}return x>this.viewport.x&&x<this.viewport.x+this.viewport.width},core.game.Camera.prototype._frameCheckRect=function(rect){if(this.moveY)return this.intersects(rect,this.viewport);var obj1R=rect.x+rect.width,obj2R=this.viewport.x+this.viewport.width;return obj1R>this.viewport.x&&rect.x<obj2R},core.game.Camera.prototype.getX=function(){return this.scene.pivot.x},core.game.Camera.prototype.getY=function(){return this.scene.pivot.y},core.game.CameraCull=function(){this.gameObjects=[],this.camera=null,this.enabled=!0},core.game.CameraCull.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.enabled||(this.update=function(){})},core.game.CameraCull.prototype.add=function(item){this.gameObjects[this.gameObjects.length]=item},core.game.CameraCull.prototype.update=function(delta){var i,obj,n=this.gameObjects.length;for(i=0;i<n;i++)obj=this.gameObjects[i],obj.graphics&&(obj.graphics.visible=this.camera.isInFrame(obj.frame))},core.game.GameLoop=function(){this.gameObjects=[],this.itemsToRemove=[],this.cameraCulling=!1,this.userPreUpdate=!1,this.isPaused=!0},core.game.GameLoop.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s])},core.game.GameLoop.prototype.add=function(item){var i=this.gameObjects.length;return this.gameObjects[i]=item,i},core.game.GameLoop.prototype.remove=function(item){this.itemsToRemove[this.itemsToRemove.length]=item},core.game.GameLoop.prototype.start=function(){this.isPaused=!1},core.game.GameLoop.prototype.stop=function(){this.isPaused=!0},core.game.GameLoop.prototype.pause=function(bool){this.isPaused=bool},core.game.GameLoop.prototype.update=function(p_delta){this.isPaused||(this.updateGameObjects(p_delta),this.postUpdate(p_delta),this.drawGameObjects(),this.input.check(p_delta))},core.game.GameLoop.prototype.updateGameObjects=function(p_delta){var i,obj,n=this.gameObjects.length;for(i=0;i<n;i++)obj=this.gameObjects[i],this.userPreUpdate&&obj.preUpdate(),obj.update(p_delta),obj.remove&&(this.itemsToRemove[this.itemsToRemove.length]=obj)},core.game.GameLoop.prototype.postUpdate=function(p_delta){var i,obj,index,n=this.itemsToRemove.length;for(i=0;i<n;i++)obj=this.itemsToRemove[i],index=this.gameObjects.indexOf(obj),index>-1&&this.gameObjects.splice(index,1);if(this.itemsToRemove.length=0,n=this.gameObjects.length,this.cameraCulling)for(i=0;i<n;i++)obj=this.gameObjects[i],obj.graphics&&(obj.graphics.visible=this.camera.isInFrame(obj.frame))},core.game.GameLoop.prototype.drawGameObjects=function(){var i,obj,n=this.gameObjects.length;for(i=0;i<n;i++)obj=this.gameObjects[i],obj.needsDraw&&obj.draw()},core.game.GameLoop.prototype.getGameObject=function(id){var i,obj,n=this.gameObjects.length,target=null;for(i=0;i<n;i++)if(obj=this.gameObjects[i],obj.id===id){target=obj;break}return target},core.game.GameObject=function(config){this.body=null,this.shape=null,this.graphics=null,this.type=-1,this.scaling=100,this.offsetR=0,this.offsetX=0,this.offsetY=0,this.needsDraw=!0,this.frame=new PIXI.Rectangle},core.game.GameObject.prototype=Object.create(core.utils.EventDispatcher.prototype),core.game.GameObject.prototype.createMultiShape=function(config,isSensor){var x=config.x/this.scaling,y=config.y/this.scaling;this.body=new p2.Body({position:[x,y],mass:config.mass||0});var i,rect,shape,w,h,n=config.shapes.length,shapes=[];for(i=0;i<n;i++)rect=config.shapes[i],w=rect.width/this.scaling,h=rect.height/this.scaling,x=rect.x/this.scaling,y=rect.y/this.scaling,shape=new p2.Box({width:w,height:h}),shape.material=config.friction,isSensor&&(shape.sensor=!0),this.body.addShape(shape,[x,y],rect.angle),shapes[i]=shape;return shapes},core.game.GameObject.prototype.createRectangle=function(config){var w=config.width/this.scaling,h=config.height/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,boxShape=new p2.Box({width:w,height:h}),boxBody=new p2.Body({position:[x,y]});return boxBody.addShape(boxShape),boxBody.userData=this,this.body=boxBody,this.shape=boxShape,this.parse(config),boxShape},core.game.GameObject.prototype.createCircle=function(config){var diameter=config.diameter/this.scaling,x=config.x/this.scaling,y=config.y/this.scaling,circleShape=new p2.Circle({radius:diameter/2}),circleBody=new p2.Body({position:[x,y]});return circleBody.addShape(circleShape),circleBody.userData=this,this.frame.width=this.frame.height=config.diameter,this.body=circleBody,this.shape=circleShape,this.parse(config),circleShape},core.game.GameObject.prototype.createPolygon=function(config){this.body=new p2.Body({position:[0,0]});var i,vert,shape=config.shapes[0],vertices=[],n=shape.vertices.length;for(i=0;i<n;i++){vert=shape.vertices[i];var x=vert.x/this.scaling,y=vert.y/-this.scaling;vertices[i]=[x,y]}var isClockwise=core.utils.Maths.isClockwise(vertices);return isClockwise&&vertices.reverse(),this.body.fromPolygon(vertices),this.parse(config),shape.vertices},core.game.GameObject.prototype.draw=function(force){if(this.graphics&&(this.needsDraw||force)){var x=this.graphics.position.x=-(this.body.position[0]*this.scaling),y=this.graphics.position.y=-(this.body.position[1]*this.scaling);this.graphics.rotation=this.body.angle,this.frame.x=x-.5*this.frame.width,this.frame.y=y-.5*this.frame.height}},core.game.GameObject.prototype.pixiToPhysics=function(point){this.body.position[0]=-point.x/this.scaling,this.body.position[1]=-point.y/this.scaling},core.game.GameObject.prototype.parse=function(config){this.resolution=config.resolution,this.setPosition(config),this.body.angle=config.angle||0,this.body.mass=config.mass||1,config.rotated&&(this.offsetR=-this.body.angle,this.offsetX=config.imgX,this.offsetY=config.imgY)},core.game.GameObject.prototype.makeSprite=function(image){return new PIXI.Sprite(PIXI.utils.TextureCache[image])},core.game.GameObject.prototype.updateFrame=function(){var bounds=this.graphics.getBounds();return this.frame.width=bounds.width,this.frame.height=bounds.height,this.frame.x=bounds.x,this.frame.y=bounds.y,bounds},core.game.GameObject.prototype.setPosition=function(pt){this.body.position[0]=pt.x/this.scaling,this.body.position[1]=pt.y/this.scaling},Object.defineProperties(core.game.GameObject.prototype,{x:{get:function(){return this.body.position[0]*this.scaling}},y:{get:function(){return this.body.position[1]*this.scaling}},height:{get:function(){return this.frame.height}},shapes:{get:function(){return this.body.shapes}},bottomEdge:{get:function(){return this.frame.y+this.frame.height}},leftEdge:{get:function(){return this.frame.x}},rightEdge:{get:function(){return this.frame.x+this.frame.width}},topEdge:{get:function(){var shapes=this.body.shapes;return 1===shapes.length&&shapes[0].type===p2.Shape.BOX?this.y+.5*shapes[0].height*this.scaling:this.frame.y}}}),core.game.GameObject.prototype.update=function(time){},core.game.GameObject.prototype.preUpdate=function(time){},core.game.GameObject.prototype.debugGraphics=function(shapes,positions,parent){var i,shape,gfx,position,holder=parent||new PIXI.Container,n=shapes.length;for(i=0;i<n;i++)shape=shapes[i],position=positions[i],gfx=this.graphicsRect(shape),gfx.x=-position.x,gfx.y=-position.y,gfx.rotation=position.angle,holder.addChild(gfx);return holder},core.game.GameObject.prototype.debugCircle=function(shape){var graphics=new PIXI.Graphics,color=16711680,fillAlpha=.4;graphics.lineStyle(2,color),graphics.beginFill(color,fillAlpha);var radius=shape.diameter*this.scaling/2;return graphics.drawCircle(0,0,radius),graphics.endFill(),graphics},core.game.GameObject.prototype.graphicsRect=function(boxShape){var graphics=new PIXI.Graphics,color=16711680,fillAlpha=.4;graphics.lineStyle(2,color),graphics.beginFill(color,fillAlpha);var w=boxShape.width*this.scaling,h=boxShape.height*this.scaling;return graphics.drawRect(-w/2,-h/2,w,h),graphics.endFill(),graphics},core.game.GameObject.prototype.debugRect=function(shape){shape||(shape=this.shape);var gfx=this.graphicsRect(shape);return gfx.x=-(this.body.position[0]*this.scaling),gfx.y=-(this.body.position[1]*this.scaling),gfx.rotation=this.body.angle,gfx},core.game.GameObject.prototype.debugFrame=function(){var q=new core.display.Quad;return q.fromRect(this.frame),q.alpha=.5,q},core.game.DragSprite=function(){this.useClickAndStick=!1,this.minSize=60,this.y=0,this.x=0,this.autoEnable=!0},core.game.DragSprite.prototype=Object.create(core.utils.EventDispatcher.prototype),core.game.DragSprite.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.texture||(this.texture=PIXI.utils.TextureCache[this.img]),this.root=new PIXI.Sprite(this.texture),this.root.anchor.x=.5,this.root.anchor.y=.5,this.root.x=this.x,this.root.y=this.y,this.startPt=new PIXI.Point(this.x,this.y);var w=this.texture.frame.width/this.resolution,h=this.texture.frame.height/this.resolution;this.rect=new PIXI.Rectangle(0,0,w,h),w=Math.max(w,this.minSize),h=Math.max(h,this.minSize);var y=h*-.5,x=w*-.5;this.root.hitArea=new PIXI.Rectangle(x,y,w,h),this.initDrag(),this.enable(this.autoEnable)},core.game.DragSprite.prototype.initDrag=function(){var pt=new PIXI.Point,global=new PIXI.Point,dragOffset=new PIXI.Point,root=this.root,self=this,modeDefault=1,modeClick=2,pressTime=0,useClickAndStick=this.useClickAndStick,clickThreshold=500,maxDist=20;this.dragging=0,this.touchstart=function(event){var iData=event.data;iData.getLocalPosition(root,pt),dragOffset.x=pt.x,dragOffset.y=pt.y,useClickAndStick&&(pressTime=game_shell.time,global.x=iData.global.x,global.y=iData.global.y),0===self.dragging&&(self.dragging=modeDefault,self.toFront())}.bind(this),root.on("mousedown",this.touchstart),root.on("touchstart",this.touchstart),this.touchmove=function(event){var iData=event.data;self.dragging>0&&(iData.getLocalPosition(root.parent,pt),root.x=pt.x-dragOffset.x,root.y=pt.y-dragOffset.y)}.bind(this),root.on("mousemove",this.touchmove),root.on("touchmove",this.touchmove),this.touchend=function(event){var iData=event.data,didClick=!1;if(useClickAndStick){var clickTime=game_shell.time-pressTime;if(clickTime<clickThreshold){var distX=Math.abs(iData.global.x-global.x),distY=Math.abs(iData.global.y-global.y);distX<maxDist&&distY<maxDist&&(didClick=!0)}}didClick&&self.dragging===modeDefault?self.dragging=modeClick:(self.dragging>0&&self.dropped.call(self),self.dragging=0,dragOffset.x=0,dragOffset.y=0)}.bind(this),root.on("mouseup",this.touchend),root.on("touchend",this.touchend),root.on("mouseupoutside",this.touchend),root.on("touchendoutside",this.touchend)},core.game.DragSprite.prototype.enable=function(bool){this.root.interactive=bool,this.root.buttonMode=bool},core.game.DragSprite.prototype.updateRect=function(){this.rect.x=this.root.x-.5*this.rect.width,this.rect.y=this.root.y-.5*this.rect.height},core.game.DragSprite.prototype.dropped=function(){this.updateRect(),this.emit({type:"dropped",rect:this.rect})},core.game.DragSprite.prototype.toFront=function(){var p=this.root.parent;this.root.removeFromParent(),p.addChild(this.root)},core.game.DragSprite.prototype.setStart=function(pt){this.startPt.x=pt.x,this.startPt.y=pt.y,this.root.x=pt.x,this.root.y=pt.y,this.updateRect()},core.game.ParticleBase=function(){this.root=null,this.texture=null,this.life=3,this.poolSize=150,this.proton=new Proton,this.rad=Math.PI/180,this.deg=180/Math.PI},core.game.ParticleBase.prototype.init=function(config){for(var s in config)config.hasOwnProperty(s)&&(this[s]=config[s]);this.emitter=this.createEmitter(),this.proton.addEmitter(this.emitter),this._spritePool=this._createPool(this.poolSize),this.renderer=this.createRenderer(),this.move(config.x,config.y),this.renderer.start()},core.game.ParticleBase.prototype.dispose=function(){this.proton&&this.proton.destroy(),this.proton=null},core.game.ParticleBase.prototype.fire=function(px,py,duration){var time=duration||.5;this.move(px,py),this.emit(time)},core.game.ParticleBase.prototype.move=function(px,py){this.emitter.p.x=px||0,this.emitter.p.y=py||0},core.game.ParticleBase.prototype.update=function(p_time){this.proton.update(p_time)},core.game.ParticleBase.prototype.emit=function(p_secs){var secs=p_secs||1/0;this.emitter.emit(secs)},core.game.ParticleBase.prototype.stop=function(andRemove){this.emitter.stopEmit(),andRemove&&this.emitter.removeAllParticles()},core.game.ParticleBase.prototype.burst=function(){this.emitter.emit(.2)},core.game.ParticleBase.prototype.rotate=function(radians){var degrees=radians*this.deg%360-180;this.emitter.velocity.thaPan.a=degrees},core.game.ParticleBase.prototype.createEmitter=function(){var texture=this.texture,vx=.5*this.life,vy=this.life,mass=1,gravity=2,lx=.35*this.life,ly=.5*this.life,emitter=new Proton.BehaviourEmitter;return emitter.addInitialize(new Proton.ImageTarget(texture)),emitter.rate=new Proton.Rate(10,.1),emitter.addInitialize(new Proton.Mass(mass)),emitter.addBehaviour(new Proton.Gravity(gravity)),emitter.addInitialize(new Proton.Life(lx,ly)),emitter.addInitialize(new Proton.Velocity(new Proton.Span(vx,vy),new Proton.Span(0,360),"polar")),emitter.addBehaviour(new Proton.Scale(Proton.getSpan(.5,1.5))),emitter.addBehaviour(new Proton.Alpha(1,0,1/0,Proton.easeInQuart)),emitter.addBehaviour(new Proton.Rotate(Proton.getSpan(0,360),Proton.getSpan(-3,3),"add")),emitter},core.game.ParticleBase.prototype.transformSprite=function(particleSprite,particle){particleSprite.x=particle.p.x,particleSprite.y=particle.p.y,particleSprite.scale.x=particle.scale,particleSprite.scale.y=particle.scale,particleSprite.alpha=particle.alpha,particleSprite.rotation=particle.rotation*this.rad},core.game.ParticleBase.prototype._createPool=function(size){for(var sp,_spritePool=[],tx=this.texture;size>0;)size--,sp=new PIXI.Sprite(tx),sp.anchor.x=.5,sp.anchor.y=.5,_spritePool[_spritePool.length]=sp;return _spritePool},core.game.ParticleBase.prototype.createRenderer=function(){var renderer=new Proton.Renderer("other",this.proton),self=this;return renderer.onParticleCreated=function(particle){particle.sprite=self.nextSprite(),self.root.addChild(particle.sprite)},renderer.onParticleUpdate=function(particle){self.transformSprite(particle.sprite,particle)},renderer.onParticleDead=function(particle){particle.sprite.removeFromParent()},renderer},core.game.ParticleBase.prototype.nextSprite=function(){var sp=this._spritePool.shift();return this._spritePool[this._spritePool.length]=sp,sp},core.game.NullParticles=function(){this.dispose=function(){},this.init=function(cfg){},this.fire=function(px,py,duration){},this.move=function(px,py){},this.update=function(p_time){},this.emit=function(p_secs){};
},core.GenericGame=function(){this.gameDiv=core.GenericGame.prototype.setGameDiv.call(this,"game"),this.system=core.GenericGame.prototype.createSystemInfo.call(this),this.eventQueue=core.GenericGame.prototype.createEventQueue.call(this),this.resolutionController=core.GenericGame.prototype.initResolution.call(this),this.viewport=core.GenericGame.prototype.createViewport.call(this),this.stage=core.GenericGame.prototype.createStage.call(this,core.settings,this.system),this.snd=core.GenericGame.prototype.createSoundManager.call(this),this.screenMgr=core.GenericGame.prototype.createScreenManager.call(this),this.renderLoop=core.GenericGame.prototype.createRenderLoop.call(this),this.updateList=new core.utils.UpdateList,this.timeout=new core.utils.DelayedAction,this.updateList.add(this.timeout),this.updateLoop=core.GenericGame.prototype.createUpdateLoop.call(this),this.pauseController=core.GenericGame.prototype.createPauseController.call(this),this.fullscreen=core.GenericGame.prototype.createFullscreenManager.call(this),this.loader=core.GenericGame.prototype.createLoader.call(this),"function"==typeof this.onReady&&this.onReady(),this.viewport.resize(),core.GenericGame.prototype.begin.call(this),this.getURL=function(id){return this.loader.urls.getURL(id)}},core.GenericGame.prototype.bootstrap=function(BootstrapClass){var preload=new BootstrapClass;preload.init({resolution:this.resolution,stageW:this.viewport.width,stageH:this.viewport.height,stage:this.stage.content});var self=this;return preload.on("complete",function(){self.preloadComplete()}),preload.start(),preload},core.GenericGame.prototype.createLoader=function(){var loader=new core.load.BulkLoader;return loader.init({resolution:this.resolution,system:this.system,settings:core.settings,jsonCache:this.json,audioType:this.system.audioType,audioFolder:core.settings.SND_DIR}),loader},core.GenericGame.prototype.updateGame=function(delta){TWEEN.update(this.updateLoop.currentTime),this.updateList.update(delta),this.screenMgr.update(delta),this.snd.update(delta),this.eventQueue.dispatchQueuedEvents()},core.GenericGame.prototype.begin=function(){this.updateLoop.start(),this.renderLoop.start()},core.GenericGame.prototype.setGameDiv=function(name){var gameDiv=document.getElementById(name);return gameDiv.style.backgroundColor=core.settings.BG_COLOR,gameDiv},core.GenericGame.prototype.createEventQueue=function(){var eventQueue=new core.utils.EventQueue;return eventQueue.on("game_event",this.onGameEvent.bind(this)),eventQueue},core.GenericGame.prototype.createScreenManager=function(){var screenMgr=new core.screens.ScreenMgr;return screenMgr.init({stage:this.stage,snd:this.snd,eventQueue:this.eventQueue,resolution:this.resolution,settings:core.settings}),screenMgr},core.GenericGame.prototype.createSystemInfo=function(){var system=new core.utils.SystemInfo;return system.run(!0),core.settings.AUDIO_TYPE&&(system.audioType=core.settings.AUDIO_TYPE),core.utils.system=system,system},core.GenericGame.prototype.createPauseController=function(){var pauseController=new core.utils.PauseController;return pauseController.init({updateLoop:this.updateLoop,renderLoop:this.renderLoop,snd:this.snd}),pauseController},core.GenericGame.prototype.createFullscreenManager=function(){var fullscreenMgr=null;if(core.utils.system.isMobile&&window.scrollTo(0,1),core.settings.FULLSCREEN_ENABLED){var disabledOnDesktop=core.utils.system.isDesktop&&!core.settings.DESKTOP_FULLSCREEN;disabledOnDesktop||(fullscreenMgr=new core.utils.FullscreenMgr,fullscreenMgr.init({canvas:this.stage.renderer.view,isMobile:core.utils.system.isMobile}))}return fullscreenMgr},core.GenericGame.prototype.createRenderLoop=function(){var renderLoop=new core.utils.RenderLoop;return renderLoop.init({stage:this.stage,screenMgr:this.screenMgr,useStats:this.config.SHOW_STATS===!0}),renderLoop},core.GenericGame.prototype.createStage=function(config){var stage=new core.display.Stage;return stage.init({width:config.STAGE_W,height:config.STAGE_H,forceCanvas:!config.WEB_GL_ENABLED,settings:{backgroundColor:parseInt(config.BG_COLOR.substr(1),16),resolution:this.resolutionController.resolution}}),stage},core.GenericGame.prototype.createUpdateLoop=function(){var updateLoop=new core.utils.UpdateLoop;return updateLoop.updateGame=core.GenericGame.prototype.updateGame.bind(this),updateLoop},core.GenericGame.prototype.initResolution=function(){var resolutionController=new core.utils.Resolution,forceResolution=core.GenericGame.prototype.checkForceResolution(this.config);return resolutionController.init({forceResolution:forceResolution}),2===core.settings.SCALE_MODE?(core.settings.setIpad(),resolutionController.setByWidth()):(core.settings.setIphone(),resolutionController.setByHeight()),resolutionController},core.GenericGame.prototype.checkForceResolution=function(config){var forceResolution=config.RESOLUTION||-1,system=core.utils.system,version=system.osVersion;return(system.isAndroid&&version<4||system.isAndroidStock)&&(forceResolution=1),forceResolution},core.GenericGame.prototype.createSoundManager=function(){var sndMgr=new core.audio.SndMgr,sndConfig=core.GenericGame.prototype.getSoundConfig();return sndMgr.init(sndConfig),sndMgr},core.GenericGame.prototype.getSoundConfig=function(){var settings=core.settings,system=core.utils.system;return{isIOS:system.isIOS,audioType:system.audioType,audioEnabled:settings.AUDIO_ENABLED,webAudioEnabled:settings.WEB_AUDIO_ENABLED,isMuted:settings.MUTE_STATE}},core.GenericGame.prototype.createViewport=function(){var settings=core.settings,scaleMode=settings.SCALE_MODE||1,isMobile=core.utils.system.isMobile,viewport=new core.utils.Viewport;viewport.init({CHECK_ORIENTATION:settings.CHECK_ORIENTATION&&isMobile,DESKTOP_RESIZE:settings.DESKTOP_RESIZE,DEFAULT_W:settings.DEFAULT_W,DEFAULT_H:settings.DEFAULT_H,MIN_W:settings.MIN_W,MIN_H:settings.MIN_H,STAGE_W:settings.STAGE_W,STAGE_H:settings.STAGE_H,iframeMode:settings.IFRAME_MODE,orientation:settings.ORIENTATION,isMobile:isMobile,scaleMode:scaleMode,rotateImg:document.getElementById("rotate"),gameDiv:document.getElementById("game")});var self=this;return viewport.on("resize",function(event){self.pauseController.onResized.call(self.pauseController,event),event.wrongOrientation||(settings.STAGE_W=event.settings.pointWidth,settings.STAGE_H=event.settings.pointHeight,self.stage.resize(event.settings),self.screenMgr.resize(event.settings)),isMobile&&window.scrollTo(0,1)}),viewport},core.utils.TweenGroup=function(){core.utils.UpdateList.call(this)},core.utils.TweenGroup.prototype=Object.create(core.utils.UpdateList.prototype),core.utils.TweenGroup.prototype.update=function(p_delta){for(var item,isComplete,n=this.updateItems.length,i=n-1;i>-1;i--)item=this.updateItems[i],isComplete=item.update(p_delta),isComplete&&(this.removeItems[this.removeItems.length]=item);if(n=this.removeItems.length,n>0){for(i=0;i<n;i++)item=this.removeItems[i],this._remove(item);this.removeItems.length=0}},void 0===Date.now&&(Date.now=function(){return(new Date).valueOf()}),core.TweenManager=function(){var _tweens=[],tweenManager=this;this.REVISION="15",this.getAll=function(){return _tweens},this.removeAll=function(){_tweens=[]},this.pausedTweens=[],this.pauseTime=-1,this.pause=function(){this.pausedTweens=_tweens.slice(),this.removeAll(),this.pauseTime=Date.now()},this.unpause=function(){for(var tween,unpauseTime=Date.now(),pauseDuration=unpauseTime-this.pauseTime,numTweens=this.pausedTweens.length,i=0;i<numTweens;i++)tween=this.pausedTweens[i],tween.restart(pauseDuration),this.add(tween);this.pausedTweens.length=0},this.add=function(tween){_tweens.push(tween)},this.remove=function(tween){var i=_tweens.indexOf(tween);i!==-1&&_tweens.splice(i,1)},this.killTweensOf=function(target){if(_tweens.length>0)for(var tween,i=_tweens.length-1;i>-1;i--)tween=_tweens[i],tween.isTweenOf(target)&&_tweens.splice(i,1)},this.update=function(time){if(0===_tweens.length)return!1;for(var i=0;i<_tweens.length;)_tweens[i].update(time)?i++:_tweens.splice(i,1);return!0},this.Tween=function(object){var _object=object,_valuesStart={},_valuesEnd={},_valuesStartRepeat={},_duration=1e3,_repeat=0,_yoyo=!1,_isPlaying=!1,_reversed=!1,_delayTime=0,_startTime=null,_easingFunction=TWEEN.Easing.Linear.None,_interpolationFunction=TWEEN.Interpolation.Linear,_chainedTweens=[],_onStartCallback=null,_onStartCallbackFired=!1,_onUpdateCallback=null,_onCompleteCallback=null,_onStopCallback=null;for(var field in object)_valuesStart[field]=parseFloat(object[field],10);this.isTweenOf=function(target){return target===_object},this.to=function(properties,duration){return void 0!==duration&&(_duration=duration),_valuesEnd=properties,this},this.start=function(time){tweenManager.add(this),this._start(time)},this._start=function(time){_isPlaying=!0,_onStartCallbackFired=!1,_startTime=void 0!==time?time:Date.now(),_startTime+=_delayTime;for(var property in _valuesEnd){if(_valuesEnd[property]instanceof Array){if(0===_valuesEnd[property].length)continue;_valuesEnd[property]=[_object[property]].concat(_valuesEnd[property])}_valuesStart[property]=_object[property],_valuesStart[property]instanceof Array==!1&&(_valuesStart[property]*=1),_valuesStartRepeat[property]=_valuesStart[property]||0}return this},this.stop=function(){return _isPlaying?(tweenManager.remove(this),_isPlaying=!1,null!==_onStopCallback&&_onStopCallback.call(_object),this.stopChainedTweens(),this):this},this.stopChainedTweens=function(){for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++)_chainedTweens[i].stop()},this.delay=function(amount){return _delayTime=amount,this},this.repeat=function(times){return _repeat=times,this},this.yoyo=function(yoyo){return _yoyo=yoyo,this},this.easing=function(easing){return _easingFunction=easing,this},this.interpolation=function(interpolation){return _interpolationFunction=interpolation,this},this.chain=function(){return _chainedTweens=arguments,this},this.onStart=function(callback){return _onStartCallback=callback,this},this.onUpdate=function(callback){return _onUpdateCallback=callback,this},this.onComplete=function(callback){return _onCompleteCallback=callback,this},this.onStop=function(callback){return _onStopCallback=callback,this},this.restart=function(pause_duration){_startTime+=pause_duration},this.changeDuration=function(new_duration){_duration=new_duration},this.update=function(time){var property;if(time<_startTime)return!0;_onStartCallbackFired===!1&&(null!==_onStartCallback&&_onStartCallback.call(_object),_onStartCallbackFired=!0);var elapsed=(time-_startTime)/_duration;elapsed=elapsed>1?1:elapsed;var value=_easingFunction(elapsed);for(property in _valuesEnd){var start=_valuesStart[property]||0,end=_valuesEnd[property];end instanceof Array?_object[property]=_interpolationFunction(end,value):("string"==typeof end&&(end=start+parseFloat(end,10)),"number"==typeof end&&(_object[property]=start+(end-start)*value))}if(null!==_onUpdateCallback&&_onUpdateCallback.call(_object,value),1===elapsed){if(_repeat>0){isFinite(_repeat)&&_repeat--;for(property in _valuesStartRepeat){if("string"==typeof _valuesEnd[property]&&(_valuesStartRepeat[property]=_valuesStartRepeat[property]+parseFloat(_valuesEnd[property],10)),_yoyo){var tmp=_valuesStartRepeat[property];_valuesStartRepeat[property]=_valuesEnd[property],_valuesEnd[property]=tmp}_valuesStart[property]=_valuesStartRepeat[property]}return _yoyo&&(_reversed=!_reversed),_startTime=time+_delayTime,!0}null!==_onCompleteCallback&&_onCompleteCallback.call(_object);for(var i=0,numChainedTweens=_chainedTweens.length;i<numChainedTweens;i++)_chainedTweens[i].start(time);return!1}return!0}}};var TWEEN=new core.TweenManager;TWEEN.UpdateTween=function(object){var self=TWEEN.Tween.call(this,object);return this.passedTime=0,this.isCompleted=!0,this.baseUpdate=this.update,this.baseStart=this._start,this.start=function(delta){return this.isCompleted=!1,this.passedTime=Date.now(),this.baseStart(),this},this.update=function(delta){return this.isCompleted||(this.passedTime+=delta,this.isCompleted=!this.baseUpdate(this.passedTime)),this.isCompleted,this.isCompleted},self},TWEEN.Easing={Linear:{None:function(k){return k}},Quadratic:{In:function(k){return k*k},Out:function(k){return k*(2-k)},InOut:function(k){return(k*=2)<1?.5*k*k:-.5*(--k*(k-2)-1)}},Cubic:{In:function(k){return k*k*k},Out:function(k){return--k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k:.5*((k-=2)*k*k+2)}},Quartic:{In:function(k){return k*k*k*k},Out:function(k){return 1- --k*k*k*k},InOut:function(k){return(k*=2)<1?.5*k*k*k*k:-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function(k){return k*k*k*k*k},Out:function(k){return--k*k*k*k*k+1},InOut:function(k){return(k*=2)<1?.5*k*k*k*k*k:.5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function(k){return 1-Math.cos(k*Math.PI/2)},Out:function(k){return Math.sin(k*Math.PI/2)},InOut:function(k){return.5*(1-Math.cos(Math.PI*k))}},Exponential:{In:function(k){return 0===k?0:Math.pow(1024,k-1)},Out:function(k){return 1===k?1:1-Math.pow(2,-10*k)},InOut:function(k){return 0===k?0:1===k?1:(k*=2)<1?.5*Math.pow(1024,k-1):.5*(-Math.pow(2,-10*(k-1))+2)}},Circular:{In:function(k){return 1-Math.sqrt(1-k*k)},Out:function(k){return Math.sqrt(1- --k*k)},InOut:function(k){return(k*=2)<1?-.5*(Math.sqrt(1-k*k)-1):.5*(Math.sqrt(1-(k-=2)*k)+1)}},Elastic:{In:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),-(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)))},Out:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),a*Math.pow(2,-10*k)*Math.sin((k-s)*(2*Math.PI)/p)+1)},InOut:function(k){var s,a=.1,p=.4;return 0===k?0:1===k?1:(!a||a<1?(a=1,s=p/4):s=p*Math.asin(1/a)/(2*Math.PI),(k*=2)<1?-.5*(a*Math.pow(2,10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)):a*Math.pow(2,-10*(k-=1))*Math.sin((k-s)*(2*Math.PI)/p)*.5+1)}},Back:{In:function(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function(k){var s=2.5949095;return(k*=2)<1?.5*(k*k*((s+1)*k-s)):.5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function(k){return k<1/2.75?7.5625*k*k:k<2/2.75?7.5625*(k-=1.5/2.75)*k+.75:k<2.5/2.75?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375},InOut:function(k){return k<.5?.5*TWEEN.Easing.Bounce.In(2*k):.5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}},TWEEN.Interpolation={Linear:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.Linear;return k<0?fn(v[0],v[1],f):k>1?fn(v[m],v[m-1],m-f):fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function(v,k){var i,b=0,n=v.length-1,pw=Math.pow,bn=TWEEN.Interpolation.Utils.Bernstein;for(i=0;i<=n;i++)b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i);return b},CatmullRom:function(v,k){var m=v.length-1,f=m*k,i=Math.floor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;return v[0]===v[m]?(k<0&&(i=Math.floor(f=m*(1+k))),fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)):k<0?v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0]):k>1?v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m]):fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)},Utils:{Linear:function(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var i,s=1;if(a[n])return a[n];for(i=n;i>1;i--)s*=i;return a[n]=s}}(),CatmullRom:function(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t,t3=t*t2;return(2*p1-2*p2+v0+v1)*t3+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}},"undefined"!=typeof module&&module.exports&&(module.exports=TWEEN);